name: Giguna Steppes
short: Giguna

areas:
- name: Giguna Northeast
  on_entry: $reset_old_area(^newpos)
  start:
    _door_opened: false
  spots:
    - name: East 9
      coord: [18.95, 8.8]
      exits:
        - to: Ebih > Ebih West > West 9
          tags: [xshift]
    - name: Inner Wall
      coord: [18.7, 9.0]
      local:
        - to: East 9
          jumps: 2
        - to: Crow Eating
          jumps: 4
    - name: Crow Eating
      coord: [17.9, 8.9]
      local:
        - to: Save Point
        - to: Gate Left
      exits:
        - to: Gate Vent
          req: $hover
    - name: Save Point
      coord: [17.5, 9.5]
      local:
        - to: Step
          jumps: 1
        - to: Gate Left
        - to: Crow Eating
      locations:
        - name: Seen
          item: Map_17_10
          time: 0
          tags: [map]
      actions:
        - name: Save
          do: $save
          time: 1.3
        # Stopgap for greedy search not able to do a global Recall
        - name: Save-Recall
          req: $can_recall
          do: $save; ^mode = 'Indra'
          to: ^indra
          time: 4.3
      exits:
        - to: Gate Vent
          req: $hover and $hook
          time: 2
    - name: Step
      coord: [17.3, 9.4]
      local:
        - to: West 10
        - to: Save Point
      exits:
        - to: West 9
          req: $climb or $hook
          time: 1.7
        - to: West 9
          req: $grab
          time: 1.9
        - to: Gate Vent
          req: $hover
          time: 2.3
    - name: West 10
      coord: [17.05, 9.5]
      local:
        - to: Step
          jumps: 1
      exits:
        - to: Carnelian > East 10
          tags: [xshift]
    - name: West 9
      coord: [17.05, 8.8]
      local:
        - to: Step
      exits:
        - to: Ruins East > East 9
          tags: [xshift]
    - name: Gate Left
      coord: [17.8, 9.6]
      local:
        - to: Save Point
          jumps: 1
      exits:
        - to: Gate Button
          req: Giguna_Northeast_Gate
          time: 2.5
      actions:
        - name: Throw Drone
          req: $can_deploy and Slingshot_Hook
          do: $deploy_drone
          to: Giguna > Giguna Northeast > Gate Vent
          time: 1.25

    - name: Gate Vent
      coord: [18, 9.1]
      local:
        - to: Gate Button
          thru: [18.35, 9.1]
        - to: Save Point
    - name: Gate Button
      coord: [18.5, 9.8]
      local:
        - to: Gate Right
          jumps: 1
      locations:
        - name: Open Gate
          item: Giguna_Northeast_Gate
          canon: Giguna_Northeast_Gate
          time: 0.5
      exits:
        - to: Gate Left
          req: Giguna_Northeast_Gate
          time: 2.5
    - name: Gate Right
      coord: [18.75, 9.6]
      local:
        - to: Gate Button
        - to: Shaft Bottom
      locations:
        - name: Remote Button
          item: Giguna_Northeast_Gate
          canon: Giguna_Northeast_Gate
          req: $boomerang

    - name: Shaft Bottom
      coord: [18.8, 10.6]
      local:
        - to: East 11
        - to: Right Column
          jumps: 1
      # TODO: measure time going back up
    - name: East 11
      coord: [18.95, 10.75]
      local:
        - to: Shaft Bottom
          jumps: 1
      exits:
        - to: Ebih > Ebih West > West 11
          tags: [xshift]
    - name: Right Column
      coord: [17.9, 10.5]
      local:
        - to: Switch
        - to: Shaft Bottom
      actions:
        - name: Open Door From Afar
          req: $unlock3 and Infection_Range{3} and not ^_door_opened
          do: ^_door_opened = true
          time: 0.5
      exits:
        - to: Door
          req: ^_door_opened
          movement: base
    - name: Switch
      coord: [17.7, 10.8]
      exits:
        - to: Door
          req: ^_door_opened and ($grab or $hook)
        - to: Right Column
          req: $grab or $hook
      actions:
        - name: Open Door
          req: $unlock3 and not ^_door_opened
          do: ^_door_opened = true
    - name: Door
      coord: [17.5, 10.5]
      local:
        - to: Right Column
        - to: Vault
      locations:
        - name: Remote Flask
          item: Flask
          canon: Giguna_Northeast_Flask
          req: $boomerang
          tags: [remote_flask]
    - name: Vault
      coord: [17.2, 10.8]
      locations:
        - name: Item
          item: Flask
          canon: Giguna_Northeast_Flask
          tags: [flask]
      exits:
        - to: Door
          req: ^_door_opened
          movement: base
          jumps: 2
        - to: Door
          req: ^_door_opened and $hook
          time: 0.7

- name: Carnelian
  on_entry: $reset_old_area(^newpos)
  start:
    _door_opened: false
  reset:
    _upper_susar: false
    _lower_susar: false
  spots:
    - name: East 10
      coord: [16.95, 9.5]
      local:
        - to: East Cliff
      exits:
        - to: Giguna Northeast > West 10
          tags: [xshift]
    - name: East Cliff
      coord: [16.35, 9.7]
      local:
        - to: East 10
          jumps: 2
        - to: Upper Susar
          jumps: 2
        - to: Middle Platforms
        - to: Switch
    - name: Upper Susar
      coord: [15.85, 9.6]
      exits:
        - to: Upper Path
          req: ^_upper_susar
          movement: base
        - to: Middle Platforms
          req: ^_upper_susar
          movement: base
        - to: East Cliff
          req: ^_upper_susar
          movement: base
      actions:
        - name: Caught
          req: not ^_upper_susar
          do: ^_upper_susar = true
          time: 3
        - name: Hack
          req: not ^_upper_susar and $allegiance1
          price: 100
          do: ^_upper_susar = true
          time: 0.5
    - name: Middle Platforms
      coord: [16.1, 10]
      local:
        - to: Rock
        - to: Switch
      exits:
        - to: Upper Susar
          req: $climb
          time: 1.75  # TODO: better than a guess
        - to: East Cliff
          req: $grab
          time: 1.5
    - name: Switch
      coord: [16.2, 10.7]
      local:
        - to: Rock
          jumps: 1
      exits:
        - to: Door
          req: ^_door_opened
          movement: base
      actions:
        - name: Open Door
          req: $unlock3 and not ^_door_opened
          do: ^_door_opened = true
          time: 0.5
    - name: Door
      coord: [16.4, 10.7]
      exits:
        - to: Switch
          req: ^_door_opened
          movement: base
        - to: Vault
          req: ^_door_opened
          movement: base
          jumps: 1
    - name: Vault
      coord: [16.7, 10.6]
      locations:
        - name: Item
          item: Carnelian_Ring
          tags: [standing]
      exits:
        - to: Door
          req: ^_door_opened
          movement: base
    - name: Rock
      coord: [16, 10.4]
      local:
        - to: Lower Susar
        - to: Middle Platforms
          jumps: 2
        - to: Switch
    - name: Lower Susar
      coord: [15.6, 10.5]
      exits:
        - to: West Ledge
          req: ^_lower_susar and $grab
          time: 1.25
        - to: West Ledge
          req: ^_lower_susar and $hook
        - to: Rock
          req: ^_lower_susar
          movement: base
          jumps: 1
      actions:
        - name: Caught
          req: not ^_lower_susar
          do: ^_lower_susar = true
          time: 3
        - name: Hack
          req: not ^_lower_susar and $allegiance1
          do: ^_lower_susar = true
          price: 100
          time: 0.5
    - name: Upper Path
      coord: [15.6, 9.6]
      local:
        - to: Upper Susar
        - to: West Ledge
    - name: West Ledge
      coord: [15.3, 10.1]
      local:
        - to: Lower Susar
        - to: West 10
        - to: Upper Path
      exits:
        - to: West 10
          req: $grab
    - name: West 10
      coord: [15.05, 9.7]
      local:
        - to: West Ledge
      exits:
        - to: West Caverns > East 10
          tags: [xshift]

- name: West Caverns
  on_entry: $reset_old_area(^newpos)
  reset:
    _east_susar: false
  spots:
    - name: East 10
      coord: [14.95, 9.8]
      local:
        - to: East Platform
        - to: Small Staircase
        - to: Tunnel Entrance
          jumps_down: 1
      exits:
        - to: Carnelian > West 10
          tags: [xshift]
        - to: Column 2 Top
          req: $hover
          time: 6
    - name: East Platform
      coord: [14.5, 10.1]
      local:
        - to: Small Staircase
          jumps_down: 1
        - to: Tunnel Entrance
          jumps_down: 1
        - to: Small Platform
    - name: Small Staircase
      coord: [14.55, 10.5]
      local:
        - to: Tunnel Entrance
          jumps_down: 1
        - to: Small Platform
          jumps: 3
      exits:
        - to: East 10
          req: $climb
          movement: base
          jumps: 4
    - name: Tunnel Entrance
      coord: [14.55, 10.7]
      local:
        - to: Small Platform
          jumps: 3
        - to: Tunnel Bottom
          jumps_down: 1
        - to: Small Staircase
          jumps: 2
    - name: Small Platform
      coord: [14.2, 10.2]
      local:
        - to: Higher Ledge
      actions:
        - name: Throw Drone Up
          req: $can_deploy
          do: $deploy_drone
          to: Giguna > West Caverns > Higher Ledge
          time: 1.5
    - name: Higher Ledge
      coord: [14.1, 9.9]
      local:
        - to: Floating Brick
          jumps: 2
        - to: Small Platform
        - to: East Platform
        - to: Small Staircase
        - to: Tunnel Entrance
    - name: Floating Brick
      coord: [14.25, 9.6]
      local:
        - to: Higher Ledge
        - to: East Platform
        - to: Column 2 Top
          jumps: 2
    - name: Column 2 Top
      coord: [14, 9.3]
      local:
        - to: Higher Ledge
        - to: East Platform
        - to: Top Gap Right
    - name: Top Gap Right
      coord: [13.65, 9.5]
      local:
        - to: Column 2 Top
        - to: Top Gap Left
    - name: Top Gap Left
      coord: [13.4, 9.6]
      local:
        - to: Top Gap Right
        - to: Column 1 Top Right
          jumps: 1
    - name: Column 1 Top Right
      coord: [13.35, 9.3]
      local:
        - to: Top Gap Left
        - to: Top Gap Right
        - to: Column 1 Top Left
    - name: Column 1 Top Left
      coord: [13, 9.3]
      local:
        - to: Column 1 Top Right
        - to: Cache
        - to: Bush
    - name: Cache
      coord: [13.1, 9.8]
      local:
        - to: Bush
        - to: Column 1 Top Left
          thru: [12.875, 9.5]
          jumps: [2, 1]
      locations:
        - name: Item
          item: Power_Matrix
          tags: [standing]
    - name: Bush
      coord: [12.5, 9.8]
      local:
        - to: Cache
        - to: Column 1 Top Left
          thru: [12.875, 9.5]
          jumps: [2, 1]
      locations:
        - name: Item
          item: Power_Core
          req: $more_refills
          tags: [standing]

    - name: Tunnel Bottom
      coord: [14.8, 11.45]
      local:
        - to: Tunnel Fork
        - to: Tunnel Entrance
      exits:
        - to: Tunnel Entrance
          req: $grab
          time: 2.25
    - name: Tunnel Fork
      coord: [14.7, 11.7]
      local:
        - to: East Susar
        - to: East 13
          thru: [14.5, 11.75]
      exits:
        - to: Tunnel Bottom
          req: $grab
          time: 0.85
        - to: Tunnel Entrance
          req: $hook
          time: 2.25
    - name: East Susar
      coord: [14.8, 11.75]
      exits:
        - to: Tunnel Fork
          req: ^_east_susar
          movement: base
          jumps: 1
        - to: East 12
          req: ^_east_susar
          movement: base
      actions:
        - name: Caught
          req: not ^_east_susar
          do: ^_east_susar = true
          time: 3
        - name: Hack
          req: not ^_east_susar and $allegiance1
          do: ^_east_susar = true
          price: 100
          time: 0.5
    - name: East 12
      coord: [14.95, 11.75]
      local:
        - to: East Susar
      exits:
        - to: Wasteland > West 12
          tags: [xshift]
    - name: East 13
      coord: [14.95, 12.75]
      exits:
        - to: Wasteland > West 13
          tags: [xshift]

    - name: Northwest
      coord: [12.2, 9.1]
      local:
        - to: West 13
    - name: West 13
      coord: [12.05, 12.3]
      exits:
        - to: Far Corner > East 13
          tags: [xshift]

- name: Wasteland
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West 12
      coord: [15.05, 11.75]
      local:
        - to: Upper Cliff
      exits:
        - to: West Caverns > East 12
          tags: [xshift]
    - name: Upper Cliff
      coord: [15.3, 11.95]
      local:
        - to: West 12
          jumps: 1
        - to: West 13
          thru: [15.4, 12.2]
        - to: Lower Cliff
    - name: West 13
      coord: [15.05, 12.75]
      local:
        - to: Middle Path
          jumps: 1
      exits:
        - to: West Caverns > East 13
          tags: [xshift]
    - name: Middle Path
      coord: [15.4, 12.65]
      local:
        - to: West 13
        - to: Middle Cliff
          jumps: 2
    - name: Middle Cliff
      coord: [15.7, 12.45]
      local:
        - to: Upper Cliff
        - to: Middle Path
        - to: Lower Cliff
        - to: Lower Path Right
      actions:
        - name: Throw Drone
          req: $can_deploy and Slingshot_Hook
          do: $deploy_drone_and_move(`Giguna > Wasteland > Middle Path`)
          to: Giguna > Wasteland > West 12
          time: 3.5
    - name: Lower Path Right
      coord: [15.65, 13.3]
      local:
        - to: Lower Path Left
      exits:
        - to: Lower Cliff
          req: $climb
          time: 1.5
    - name: Lower Path Left
      coord: [15.4, 13.3]
      local:
        - to: Lower Path Right
        - to: West 14
    - name: Lower Cliff
      coord: [15.85, 12.85]
      local:
        - to: Lower Path Left
      exits:
        - to: Middle Cliff
          req: $climb
        - to: Middle Cliff
          req: $grab
          time: 0.85
    - name: West 14
      coord: [15.05, 13.7]
      local:
        - to: Lower Path Left
          jumps: 2
      exits:
        - to: Giguna Base > East 14
          tags: [xshift]

    # East half, er, three-quarters
    - name: East 12
      coord: [18.95, 11.8]
      local:
        - to: East Ledge
      exits:
        - to: Ebih > Ebih West > West 12
          tags: [xshift]
    - name: East 13
      coord: [18.95, 12.7]
      local:
        - to: Door Left
        - to: Bluff by Door
        - to: Tiny Hill
    - name: East 14
      coord: [18.95, 13.6]
      local:
        - to: Door Right
          jumps: 2  # ?
    - name: East Ledge
      coord: [18.7, 12.2]
      local:
        - to: East 13
        - to: Door Left
        - to: Bluff by Door
        - to: Tiny Hill
      exits:
        - to: East 12
          req: $grab or $climb
          movement: base
          jumps: 3
        - to: East 12
          req: $hook
          time: 1  # ?
    - name: Door Left
      coord: [18.5, 13.2]
      local:
        - to: Bluff by Door
        - to: Tiny Hill
      exits:
        - to: Door Right
          req: Ebih_Wasteland_Door
          movement: base
    - name: Door Right
      coord: [18.65, 13.2]
      local:
        - to: East 14
      exits:
        - to: Door Left
          req: Ebih_Wasteland_Door
          movement: base
    - name: Bluff by Door
      coord: [18.4, 13.6]
      local:
        - to: Tiny Hill
          jumps: 2
      exits:
        - to: Door Left
          req: $climb and $grab
          movement: base
          jumps: 3
        - to: Door Left
          req: $hook
          time: 1  # ?
    - name: Tiny Hill
      coord: [18.0, 13.5]
      local:
        - to: Bluff by Door
        - to: Center Plains
    - name: Steeper Hill
      coord: [17.2, 13.3]
      local:
        - to: Center Plains
        - to: West Plains
    - name: Center Plains
      coord: [17.4, 13.6]
      local:
        - to: Tiny Hill
          jumps: 1
      exits:
        - to: Steeper Hill
          req: $grab or $climb
          movement: base
          jumps: 2
    - name: West Plains
      coord: [17.0, 13.6]
      local:
        - to: Steeper Hill
          jumps: 3
        - to: Passage East
        - to: Westward Hill
    - name: Passage East
      coord: [16.6, 13.6]
      local:
        - to: West Plains
        - to: Westward Hill
      exits:
        - to: Passage Cache
          req: ^mode == 'drone' and Ebih_Wasteland_Passage_H
          movement: base
      hybrid:
        - name: Clear Horizontal Passage Manually
          to: Passage Cache
          item: Ebih_Wasteland_Passage_H
          canon: Ebih_Wasteland_Passage_H
          req: ^mode == 'drone'
          time: 15  # ?
          item_time: 0
        - name: Mist through Horizontal Passage
          to: Passage Cache
          item: Ebih_Wasteland_Passage_H
          canon: Ebih_Wasteland_Passage_H
          req: ^mode == 'drone' and Mist_Upgrade
          movement: mist2
          item_time: 0

    - name: Passage Cache
      coord: [15.4, 13.6]
      exits:
        - to: Passage East
          req: ^mode == 'drone' and Ebih_Wasteland_Passage_H
          movement: base
      hybrid:
        - name: Clear Horizontal Passage Manually
          to: Passage East
          item: Ebih_Wasteland_Passage_H
          canon: Ebih_Wasteland_Passage_H
          req: ^mode == 'drone'
          time: 15  # ?
          item_time: 0
        - name: Mist through Horizontal Passage
          to: Passage East
          item: Ebih_Wasteland_Passage_H
          canon: Ebih_Wasteland_Passage_H
          req: ^mode == 'drone' and Mist_Upgrade
          movement: mist2
          item_time: 0
    - name: Westward Hill
      coord: [16.45, 13.4]
      local:
        - to: Lower Cliff
          jumps: 4
        - to: Passage East
        - to: West Plains

    # Upper portion
    - name: Upper Cache
      coord: [16.4, 11.5]
    - name: Cache Ledge
      coord: [16.5, 11.8]
    - name: Left Platform West
      coord: [16.75, 11.9]
    - name: Left Platform East
      coord: [17.0, 12.0]
    - name: Center Platform West
      coord: [17.25, 11.7]
    - name: Center Platform East
      coord: [17.5, 11.8]
    - name: Right Platform West
      coord: [17.75, 12.05]
    - name: Right Platform East
      coord: [17.95, 12.1]
    - name: Lower Platform West
      coord: [17.9, 13.0]
    - name: Lower Platform East
      coord: [18.15, 13.0]
    - name: Ladder Ledge
      coord: [18.15, 12.4]
    - name: Switch Ledge
      coord: [18.05, 11.6]
    - name: Switch Approach
      coord: [18.3, 11.5]
    - name: Switch
      coord: [18.5, 11.5]

- name: Giguna Base
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 14
      coord: [14.95, 13.7]
      local:
        - to: Stone Knob
      exits:
        - to: Wasteland > West 14
          tags: [xshift]
    - name: Stone Knob
      coord: [14.55, 13.9]
      local:
        - to: Upper Cliff
        - to: Kari
          thru: [14.35, 14.1]
        - to: Middle Platform
          thru: [14.35, 14.1]
      exits:
        - to: Upper Cliff
          req: $climb
          time: 1.5
        - to: Upper Cliff
          req: $hook
          time: 1
      actions:
        - name: Throw Drone
          req: $can_deploy
          do: $deploy_drone_and_move(`Giguna > Giguna Base > Kari`)
          to: Giguna > Giguna Base > Upper Cliff
    - name: Upper Cliff
      coord: [14.25, 13.6]
      local:
        - to: Stone Knob
        - to: Kari
          thru: [14.35, 14.1]
        - to: Middle Platform
          thru: [14.35, 14.1]
        - to: Right Pillar
    - name: Right Pillar
      coord: [13.9, 13.65]
      local:
        - to: Ruin
        - to: Upper Cliff
          jumps: 1
      exits:
        - to: Left Pillar
          req: $grab
          time: 1.5
    - name: Left Pillar
      coord: [13.5, 13.6]
      local:
        - to: Ruin
      exits:
        - to: Right Pillar
          req: $grab
          time: 1.5
    - name: Ruin
      coord: [13.75, 14.1]
      locations:
        - name: Item
          item: Wall_Climb
          tags: [urn]
      exits:
        - to: Right Pillar
          req: $climb
          time: 1.5
        - to: Left Pillar
          req: $grab and $climb
          time: 1.5
    - name: Middle Platform
      coord: [14.45, 14.7]
      local:
        - to: Kari
        - to: Building Entry
      exits:
        - to: Stone Knob
          req: $grab
          time: 2.35
        - to: Stone Knob
          req: $hook
          time: 1.5
        - to: Staircase Top
          req: $hover
          time: 4.2
    - name: Kari
      coord: [14.4, 15.55]
      local:
        - to: Middle Platform
          jumps: 5
        - to: Building Entry
          jumps: 1
        - to: Table
          jumps_down: 1
    - name: Building Entry
      coord: [14.1, 15.5]
      local:
        - to: Staircase Bottom
        - to: Save Point
          jumps_down: 1
        - to: Table
          jumps_down: 1
        - to: Kari
      exits:
        - to: Building Interior > Entry
          tags: [interior]
    - name: Staircase Top
      coord: [13.35, 14.8]
      local:
        - to: Staircase Bottom
          jumps_down: 2
        - to: Table
          jumps_down: 4
        - to: Save Point
          jumps_down: 3
        - to: Building Entry
        - to: West Grate
      exits:
        - to: Left Pillar
          req: $grab
          time: 4
        - to: Left Pillar
          req: $hook
          time: 3.5
    - name: West Grate
      coord: [13.15, 14.8]
      local:
        - to: Staircase Top
      exits:
        - to: West 15
          req: Nanite_Mist
          price: 30
          movement: mist2
    - name: West 15
      coord: [13.05, 14.8]
      exits:
        - to: West Grate
          req: Nanite_Mist
          price: 30
          movement: mist2
        - to: Helipad > East 15
          tags: [xshift]
    - name: Staircase Bottom
      coord: [13.2, 15.7]
      local:
        - to: Staircase Top
          jumps: 5
        - to: Save Point
          jumps_down: 1
        - to: West 16
        - to: Building Entry
          jumps: 1
    - name: Table
      coord: [13.7, 16]
      local:
        - to: Kari
          thru: [14, 15.9]
          jumps: [1, 2]
        - to: Building Entry
          thru: [14, 15.9]
          jumps: [1, 2]
        - to: Save Point
          jumps: 1
      locations:
        - name: News
          item: Researchers_Missing
          tags: [standing]
    - name: Save Point
      coord: [13.5, 15.85]
      local:
        - to: Staircase Bottom
          jumps: 1
        - to: Building Entry
          jumps: 2
        - to: Table
        - to: West 16
      actions:
        - name: Save
          do: $save
          time: 1.3
    - name: West 16
      coord: [13.05, 15.85]
      local:
        - to: Staircase Bottom
          jumps: 1
        - to: Save Point
      exits:
        - to: Helipad > East 16
          tags: [xshift]

- name: Building Interior
  graph_offset: [0, -0.2]
  graph_attrs: shape="house",fillcolor="8"
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: Entry
      coord: [14.1, 15.5]
      local:
        - to: Bookshelf
          jumps: 3
      exits:
        - to: Bookshelf
          req: $grab or $climb
          time: 1.35
        - to: Bookshelf
          req: $hook
          time: 1
        - to: Giguna Base > Building Entry
          tags: [exterior]
    - name: Bookshelf
      coord: [13.9, 15.1]
      local:
        - to: Entry
          jumps_down: 2
      locations:
        - name: Note
          item: Letter_from_Trace
          tags: [standing]

- name: Ruins East
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 9
      coord: [16.95, 8.8]
      local:
        - to: Bottom Rock
          jumps: 2
        - to: Cliff
    - name: Bottom Rock
      coord: [16.3, 8.5]
      local:
        - to: East 9
        - to: West 9
      exits:
        - to: Cliff
          req: $hook
          time: 3.45
    - name: West 9
      coord: [16.05, 8.6]
      local:
        - to: Bottom Rock
          jumps: 1
      exits:
        - to: Ruins Center > East 9
          tags: [xshift]
    - name: Cliff
      coord: [16.6, 7.6]
      local:
        - to: Bottom Rock
        - to: East 9
        - to: West 9
          thru: [16.2, 7.7]
      exits:
        - to: Ledge
          req: $climb
        - to: Ledge
          req: $hook
          time: 0.8
    - name: Ledge
      coord: [16.55, 7.4]
      local:
        - to: Cliff
      exits:
        - to: Small Passage
          req: ^mode == 'drone'
          time: 0.35
        # TODO: to: Pillar
    - name: Small Passage
      coord: [16.45, 7.4]
      local:
        - to: West 8
      exits:
        - to: Ledge
          req: ^mode == 'drone'
          time: 0.35
    - name: West 8
      coord: [16.05, 7.5]
      local:
        - to: Small Passage
          jumps: 1
      exits:
        - to: Ruins Center > East 8
          tags: [xshift]
    - name: Pillar
      coord: [16.25, 6.4]
      local:
        - to: West 7
        - to: Way Up High
        - to: Ledge
    - name: West 7
      coord: [16.05, 6.8]
      #exits:
      #  - to: Ruins Top > East 7
      #    tags: [xshift]
        # TODO: to: Pillar
    - name: Way Up High
      coord: [16.6, 5.2]
      local:
        - to: Pillar
        - to: Cliff
        - to: East 9
      #locations:
      #  - name: Item
      #    item: Flask
      #    tags: [flask]
      # TODO: exits toward Ruins Top?

- name: Ruins Center
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 8
      coord: [15.95, 7.5]
      local:
        - to: Tablet
      exits:
        - to: Ruins East > West 8
          tags: [xshift]
    - name: Tablet
      coord: [15.8, 7.5]
      local:
        - to: East 8
      locations:
        - name: Item
          item: Aansur
          tags: [standing]
    - name: East 9
      coord: [15.95, 8.6]
      local:
        - to: Wall Bottom
      exits:
        - to: Ruins East > West 9
          tags: [xshift]
    - name: Wall Bottom
      coord: [15.2, 8.4]
      local:
        - to: East 9
          jumps: 1
      exits:
        - to: Wall Top
          req: $climb
    - name: Wall Top
      coord: [15.2, 8.1]
      local:
        - to: Wall Bottom
          jumps_down: 1
        - to: East 9
      exits:
        - to: Center Top
          req: $grab
          time: 1.5
    - name: Center Top
      coord: [15.1, 7.7]
      local:
        - to: West Platform Right
    - name: West Platform Right
      coord: [14.8, 8.1]
      local:
        - to: West Platform Left
        - to: Center Top
      # exit?
    - name: West Platform Left
      coord: [14.4, 8.1]
      local:
        - to: West Platform Right
        - to: West 9
          jumps_down: 1
    - name: West 9
      coord: [14.05, 8.6]
      # todo: connection to West Platform Left?
      exits:
        - to: Ruins West > East 9
          tags: [xshift]

- name: Ruins West
  on_entry: $reset_old_area(^newpos)
  reset:
    _kishib_handled: false
  spots:
    - name: East 9
      coord: [13.95, 8.6]
      local:
        - to: Save Point
        - to: Platform
          jumps: 1
      exits:
        - to: Ruins Center > West 9
          tags: [xshift]
    - name: Save Point
      coord: [13.5, 8.7]
      local:
        - to: Platform
          jumps: 2
        - to: East 9
          jumps: 1
      actions:
        - name: Save
          do: $save
          tags: [save]
    - name: Platform
      coord: [13.5, 8.5]
      local:
        - to: Save Point
          jumps_down: 2
        - to: East 9
        - to: Nook
          jumps: 2
    - name: Nook
      coord: [13.4, 8.0]
      local:
        - to: Platform
      exits:
        - to: Lower Ledge
          req: $climb and $grab
          time: 2.35
    - name: Lower Ledge
      coord: [13.4, 7.4]
      local:
        - to: Nook
        - to: Platform
      exits:
        - to: Upper Ledge
          req: $grab and ^_kishib_handled
          time: 4
      actions:
        - name: Hack Kishib
          req: not ^_kishib_handled and $allegiance1
          price: 100
          do: ^_kishib_handled = true
          tags: [hack]
        - name: Destroy Kishib
          req: not ^_kishib_handled and $shockwave
          price: 100
          do: ^_kishib_handled = true
          tags: [shockwave]
    - name: Upper Ledge
      coord: [13.6, 6.4]
      local:
        - to: Lower Ledge
        - to: Platform
        - to: East 7
    - name: East 7
      coord: [13.95, 6.7]
      exits:
        - to: Upper Ledge
          req: $grab
          time: 1.2
        - to: Ruins Top > West 7
          tags: [xshift]
    
    - name: Rooftop East Edge
      coord: [13.6, 5.7]
      local:
        - to: Rooftop West Edge
          jumps: 1
        # I mean... we *could* jump back down, but why?
    - name: Rooftop West Edge
      coord: [13.3, 5.4]
      local:
        - to: West 7
    - name: West 7
      coord: [13.05, 6.3]
      exits:
        - to: West Tower > East 7
          tags: [xshift]

- name: Ruins Top
  on_entry: $reset_old_area(^newpos)
  start:
    _doors_open: false
  spots:
    - name: West 7
      coord: [14.05, 6.7]
      exits:
        - to: Ruins West > East 7
          tags: [xshift]
        - to: West Door
          req: ^_doors_open
          movement: base
          jumps: 1
        - to: West Pillar
          req: $grab or $climb
          time: 2.25
    - name: West Door
      coord: [14.3, 6.6]
      exits:
        - to: West 7
          req: ^_doors_open
          movement: base
        - to: Entryway
          req: ^_doors_open
          movement: base
    - name: West Pillar
      coord: [14.3, 6.0]
      local:
        - to: West 7
        - to: Entryway
    - name: Entryway
      coord: [14.45, 6.8]
      local:
        - to: Portal Left
      exits:
        - to: West Door
          req: ^_doors_open
          movement: base
          jumps: 2
    - name: Portal Left
      coord: [15.3, 6.8]
      local:
        - to: Entryway
        - to: Portal
          jumps: 1
      exits:
        - to: Small Ledge
          req: $grab or $hook
          time: 1.0
    - name: Small Ledge
      coord: [15.25, 6.5]
      local:
        - to: Portal Left
        - to: Portal
      locations:
        - name: Shockwave Flask
          item: Flask
          canon: Giguna_Top_Flask
          tags: [shockwave]
          time: 4.0
      exits:
        - to: Interior Ledge
          req: $hook
          time: 1.5  # ?
    - name: Portal
      coord: [15.5, 6.7]
      local:
        - to: Portal Left
        - to: Small Ledge
          jumps: 1
      exits:
        - to: Interior Ledge
          req: $hook
          time: 1.5  # ?
        - to: East Door
          req: ^_doors_open
          movement: base
      actions:
        - name: Enter Portal
          to: Giguna Breach > Peak > Save Point
          req: ^mode == 'drone'
          do: $portal(`Giguna Breach > Peak > Save Point`)
          tags: [portal]
    - name: Interior Ledge
      coord: [15.65, 6.2]
      exits:
        - to: Portal
          req: ^mode == 'drone'
          time: 0.8
        - to: Upper Tunnel
          req: $grab or $hook
          time: 1.0  # ?
    - name: Upper Tunnel
      coord: [15.5, 5.8]
      local:
        - to: Interior Ledge
        - to: Flask
      # boomerang remote flask?
    - name: Flask
      coord: [15.3, 6.0]
      local:
        - to: Upper Tunnel
          jumps: 1
      locations:
        - name: Flask
          item: Flask
          canon: Giguna_Top_Flask
          tags: [flask]
    - name: East Door
      coord: [15.7, 6.8]
      exits:
        - to: Portal
          req: ^_doors_open
          movement: base
          jumps: 1
        - to: East 7
          req: ^_doors_open
          movement: base
    - name: East 7
      coord: [15.95, 6.8]
      exits:
        - to: East Door
          req: ^_doors_open
          movement: base
        - to: Ruins East > West 7
          tags: [xshift]
    
    # post-breach
    - name: Save Point
      coord: [14.8, 5.7]
      local:
        - to: Switch
          jumps: 1
      actions:
        - name: Save
          do: $save
          tags: [save]
      # TODO: move through the small passage with the drone
    - name: Switch
      coord: [15.0, 5.5]
      local:
        - to: Save Point
      actions:
        - name: Open Doors
          req: $open
          do: ^_doors_open = true
          tags: [hack]
      exits:
        - to: Rooftop West
          req: $grab
          movement: base
          jumps: 3
        - to: Turret Balcony East
          req: $grab
          movement: base
          jumps: 4
    - name: Rooftop West
      coord: [15.1, 5.2]
      local:
        - to: Switch
        - to: Rooftop East
      exits:
        - to: Turret Balcony East
          req: $grab
          movement: base
          jumps: 2
    - name: Rooftop East
      coord: [15.6, 5.2]
      local:
        - to: Rooftop West
        - to: Rooftop Gutter
      # TODO: Movement to the high flask
    - name: Rooftop Gutter
      coord: [15.8, 5.6]
      local:
        - to: Rooftop East
          jumps: 2
      # TODO: movement to the high flask and the pillar
    - name: Turret Balcony East
      coord: [14.8, 5.2]
      local:
        - to: Turret Balcony West
        - to: Switch
      exits:
        - to: Rooftop West
          req: $grab
          movement: base
          jumps: 2
    - name: Turret Balcony West
      coord: [14.3, 5.2]
      local:
        - to: West Pillar
        - to: Entryway
        - to: West 7
      actions:
        - name: Throw Drone onto Tower
          req: $grab and $can_deploy
          do: $deploy_drone_and_move(`Giguna > Ruins Top > West 7`)
          to: Giguna > Ruins West > Rooftop East Edge
          time: 3.8
          tags: [xshift]
    
- name: West Tower
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 7
      coord: [12.95, 6.3]
      local:
        - to: Top
    - name: Top
      coord: [12.5, 7.1]
      local:
        - to: Southwest
      locations:
        - name: Tablet
          item: The_Ideal_Kiengir
          tags: [standing]
    - name: Southwest
      coord: [12.2, 8.9]
      exits:
        - to: West Caverns > Northwest
          tags: [yshift]

- name: Far Corner
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 13
      coord: [11.95, 12.3]
      local:
        - to: Grass
    - name: Grass
      coord: [11.5, 12.8]
      local:
        - to: South
      locations:
        - name: Obscured Item
          item: Flask
          tags: [flask]
    - name: South
      coord: [11.4, 12.9]
      exits:
        - to: Helipad > North
          tags: [yshift]

- name: Helipad
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 15
      coord: [12.95, 14.8]
      local:
        - to: Helicopter
          jumps: 2
      exits:
        - to: Giguna Base > West 15
          tags: [xshift]
    - name: North
      coord: [11.4, 13.1]
      local:
        - to: Helicopter
        - to: Wall Top
        - to: Irikar Drop
    - name: Helicopter
      coord: [11.7, 14.65]
      local:
        - to: East 15
        - to: Wall Top
        - to: Irikar Drop
    - name: East 16
      coord: [12.95, 15.85]
      local:
        - to: Railing
      exits:
        - to: Giguna Base > West 16
          tags: [xshift]
    - name: Irikar Drop
      coord: [11.1, 15.5]
      local:
        - to: So Close!
        - to: South Left
        - to: South Middle
        - to: South Right
    - name: Wall Top
      coord: [11.8, 15.45]
      local:
        - to: Wall Bottom
        - to: Staircase Top
      exits:
        - to: Railing
          req: $hover
          movement: base
    - name: Railing
      coord: [12.5, 15.85]
      local:
        - to: East 16
        - to: Wall Bottom
        - to: Staircase Top
          jumps_down: 1
        - to: East 18
          thru: [12.55, 16.45]
          jumps_down: [1, 0]
      exits:
        - to: Wall Top
          req: Nanite_Mist and Mist_Upgrade
          price: 70
          movement: mist2
    - name: Wall Bottom
      coord: [11.9, 16.7]
      local:
        - to: Staircase Top
        # TODO: balloon boost
    - name: So Close!
      coord: [11.4, 16.65]
      local:
        - to: South Right
      exits:
        - to: Tablet Ledge
          req: $hover
          movement: base
        - to: Tablet Ledge
          req: Nanite_Mist and Mist_Upgrade
          price: 20
          movement: base
    - name: Tablet Ledge
      coord: [11.5, 16.7]
      local:
        - to: South Middle
        - to: South Right
      locations:
        - name: Tablet
          item: Journal_2049_10_29
          tags: [standing]
    - name: Staircase Top
      coord: [12.45, 16.7]
      local:
        - to: Wall Bottom
        - to: East 18
    - name: East 18
      coord: [12.95, 17.4]
      local:
        - to: Staircase Top
          jumps: 4
      exits:
        - to: Lamassu > West 18
          tags: [xshift]
    - name: South Left
      coord: [11.1, 17.9]
    - name: South Middle
      coord: [11.3, 17.9]
    - name: South Right
      coord: [11.75, 17.9]
    - name: Lowest Ledge
      coord: [12.3, 17.9]

- name: Clouds
  on_entry: $reset_old_area(^newpos)
  reset:
    _platform_moved: false
    _portal_moved: false
  spots:
    - name: North Left
      coord: [11.1, 18.1]
    - name: North Middle
      coord: [11.3, 18.1]
    - name: North Right
      coord: [11.75, 18.1]
    - name: North Under Ledge
      coord: [12.3, 18.1]
    - name: Platform Start
      coord: [12.3, 19.5]
      # TODO: early portal in a single action
      # with hack, [deploy], attract, and sight
    - name: Platform Stop
      coord: [13.5, 18.7]
    - name: Cache
      coord: [13.9, 18.3]
    - name: Platform Early Portal
      coord: [13.5, 18.85]

- name: Lamassu
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West 18
      coord: [13.05, 17.4]
      local:
        - to: Staircase Top
      exits:
        - to: Helipad > East 18
          tags: [xshift]
    - name: Staircase Top
      coord: [13.45, 17.4]
      local:
        - to: West 18
        - to: Staircase Bottom
    - name: Staircase Bottom
      coord: [13.7, 17.8]
      local:
        - to: Staircase Top
          jumps: 2
        - to: Staircase Landing
        - to: Broken Pillar
        - to: Upper Platform Edge
    - name: Staircase Landing
      coord: [13.75, 18.05]
      local:
        - to: Staircase Bottom
          jumps: 2
        - to: Broken Pillar
        - to: Upper Platform Edge
    - name: Broken Pillar
      coord: [13.8, 18.3]
      local:
        - to: Upper Platform Edge
      exits:
        - to: Staircase Landing
          req: $grab
          movement: base
          jumps: 2
    - name: Upper Platform Edge
      coord: [14.15, 18.45]
      local:
        - to: Broken Pillar
          jumps: 1
        - to: Lower Platform Left
    - name: Lower Platform Left
      coord: [14.35, 18.7]
      local:
        - to: Lower Platform Right
      exits:
        - to: Upper Platform Edge
          req: $grab  # ?
          movement: base
          jumps: 2
    - name: Lower Platform Right
      coord: [14.6, 18.7]
      local:
        - to: Lower Platform Left
      exits:
        - to: Head
          req: $grab and $climb
          movement: base
          jumps: 3
    - name: Head
      coord: [14.9, 18.2]
      local:
        - to: Wingtip
        - to: Lower Platform Right
        - to: Lower Platform Left
    - name: Rear Platform
      coord: [15.5, 17.8]
      local:
        - to: Head
        - to: East 18  # or requires grab?
          jumps: 2
    - name: Wingtip
      coord: [15.7, 18.1]
      local:
        - to: Head
        - to: Deposit
        - to: Rear Gap
          jumps: 1
    - name: Rear Gap
      coord: [15.8, 18.0]
      local:
        - to: Deposit
        - to: Wingtip
      exits:
        - to: East 18
          req: $grab
          movement: base
          jumps: 4
    - name: Deposit
      coord: [15.65, 19.5]
      local:
        - to: Wingtip
          jumps: 8
        - to: Rear Gap
          jumps: 9
      locations:
        - name: Flask
          item: Flask
          tags: [flask]
    - name: East 18
      coord: [15.95, 17.5]
      local:
        - to: Rear Platform
        - to: Rear Gap
      exits:
        - to: Dual Path > West 18
          tags: [xshift]

- name: Dual Path
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West 18
      coord: [16.05, 17.5]
    - name: Below Left Switch
      coord: [16.2, 17.7]
    - name: Left Switch
      coord: [16.3, 17.5]
    - name: West Slope
      coord: [16.85, 17.7]
    - name: Base of Wall
      coord: [17.85, 17.75]
    - name: Wall Secret
      coord: [17.95, 17.75]
    - name: Wall Top
      coord: [17.85, 17.25]
    - name: Right Switch
      coord: [18.1, 17.3]
    - name: Below Right Switch
      coord: [18.15, 17.45]
    - name: East Gate
      coord: [18.4, 17.3]
    - name: East 18
      coord: [18.95, 17.65]

    # Upper path
    - name: West Gate
      coord: [16.3, 17.2]
    - name: West Gate NW
      coord: [16.2, 16.85]
    - name: West Gate NE
      coord: [16.4, 16.85]
    - name: West 17
      coord: [16.05, 16.85]
    - name: Midway
      coord: [17.35, 16.8]
    - name: Midway Plateau
      coord: [17.55, 16.5]
    - name: East Gate NW
      coord: [18.25, 16.8]
    - name: East Gate NE
      coord: [18.55, 16.45]
    - name: East 17
      coord: [18.95, 16.85]

