name: Giguna Steppes
short: Giguna

areas:
- name: Giguna Northeast
  on_entry: $reset_old_area(^newpos)
  start:
    _door_opened: false
  spots:
    - name: East 9
      coord: [18.95, 8.8]
      exits:
        - to: Ebih > Ebih West > West 9
          tags: [xshift]
    - name: Inner Wall
      coord: [18.7, 9.0]
      local:
        - to: East 9
          jumps: 2
        - to: Crow Eating
          jumps: 4
    - name: Crow Eating
      coord: [17.9, 8.9]
      local:
        - to: Save Point
        - to: Gate Left
      exits:
        - to: Gate Vent
          req: $hover
    - name: Save Point
      coord: [17.5, 9.5]
      local:
        - to: Step
          jumps: 1
        - to: Gate Left
        - to: Crow Eating
      locations:
        - name: Seen
          item: Map_17_10
          time: 0
          tags: [map]
      actions:
        - name: Save
          do: $save
          time: 1.3
        # Stopgap for greedy search not able to do a global Recall
        - name: Save-Recall
          req: $can_recall
          do: $save; ^mode = 'Indra'
          to: ^indra
          time: 4.3
      exits:
        - to: Gate Vent
          req: $hover and $hook
          time: 2
    - name: Step
      coord: [17.3, 9.4]
      local:
        - to: West 10
        - to: Save Point
      exits:
        - to: West 9
          req: $climb or $hook
          time: 1.7
        - to: West 9
          req: $grab
          time: 1.9
        - to: Gate Vent
          req: $hover
          time: 2.3
    - name: West 10
      coord: [17.05, 9.5]
      local:
        - to: Step
          jumps: 1
      exits:
        - to: Carnelian > East 10
          tags: [xshift]
    - name: West 9
      coord: [17.05, 8.8]
      local:
        - to: Step
      exits:
        - to: Ruins East > East 9
          tags: [xshift]
    - name: Gate Left
      coord: [17.8, 9.6]
      local:
        - to: Save Point
          jumps: 1
      exits:
        - to: Gate Button
          req: Giguna_Northeast_Gate
          time: 2.5
      actions:
        - name: Throw Drone
          req: $can_deploy and Slingshot_Hook
          do: $deploy_drone
          to: Giguna > Giguna Northeast > Gate Vent
          time: 1.25

    - name: Gate Vent
      coord: [18, 9.1]
      local:
        - to: Gate Button
          thru: [18.35, 9.1]
        - to: Save Point
    - name: Gate Button
      coord: [18.5, 9.8]
      local:
        - to: Gate Right
          jumps: 1
      locations:
        - name: Open Gate
          item: Giguna_Northeast_Gate
          canon: Giguna_Northeast_Gate
          time: 0.5
      exits:
        - to: Gate Left
          req: Giguna_Northeast_Gate
          time: 2.5
    - name: Gate Right
      coord: [18.75, 9.6]
      local:
        - to: Gate Button
        - to: Shaft Bottom
      locations:
        - name: Remote Button
          item: Giguna_Northeast_Gate
          canon: Giguna_Northeast_Gate
          req: $boomerang

    - name: Shaft Bottom
      coord: [18.8, 10.6]
      local:
        - to: East 11
        - to: Right Column
          jumps: 1
      # TODO: measure time going back up
    - name: East 11
      coord: [18.95, 10.7]
      local:
        - to: Shaft Bottom
          jumps: 1
      exits:
        # TODO: replace fake way back with real way back
        - to: Ebih > Ebih West > Alcove
          time: 2
    - name: Right Column
      coord: [17.9, 10.5]
      local:
        - to: Switch
        - to: Shaft Bottom
      actions:
        - name: Open Door From Afar
          req: $unlock3 and Infection_Range{3} and not ^_door_opened
          do: ^_door_opened = true
          time: 0.5
      exits:
        - to: Door
          req: ^_door_opened
          time: 1.25
    - name: Switch
      coord: [17.7, 10.8]
      exits:
        - to: Door
          req: ^_door_opened and ($grab or $hook)
        - to: Right Column
          req: $grab or $hook
      actions:
        - name: Open Door
          req: $unlock3 and not ^_door_opened
          do: ^_door_opened = true
    - name: Door
      coord: [17.5, 10.5]
      local:
        - to: Right Column
        - to: Vault
      #locations:
      #  - name: Remote Flask
      #    item: Flask
      #    canon: Giguna_Northeast_Flask
      #    req: $boomerang
      #    tags: [remote_flask]
    - name: Vault
      coord: [17.2, 10.8]
      #locations:
      #  - name: Item
      #    item: Flask
      #    canon: Giguna_Northeast_Flask
      #    tags: [flask]
      exits:
        - to: Door
          req: ^_door_opened

- name: Carnelian
  on_entry: $reset_old_area(^newpos)
  start:
    _door_opened: false
  reset:
    _upper_susar: false
    _lower_susar: false
  spots:
    - name: East 10
      coord: [16.95, 9.5]
      local:
        - to: East Cliff
      exits:
        - to: Giguna Northeast > West 10
          tags: [xshift]
    - name: East Cliff
      coord: [16.35, 9.7]
      local:
        - to: East 10
          jumps: 2
        - to: Upper Susar
          jumps: 2
        - to: Middle Platforms
        - to: Switch
    - name: Upper Susar
      coord: [15.85, 9.6]
      exits:
        - to: Upper Path
          req: ^_upper_susar
        - to: Middle Platforms
          req: ^_upper_susar
        - to: East Cliff
          req: ^_upper_susar
          time: 2
      actions:
        - name: Caught
          req: not ^_upper_susar
          do: ^_upper_susar = true
          time: 3
        - name: Hack
          req: not ^_upper_susar and $allegiance1
          price: 100
          do: ^_upper_susar = true
          time: 0.5
    - name: Middle Platforms
      coord: [16.1, 10]
      local:
        - to: Rock
        - to: Switch
      exits:
        - to: Upper Susar
          req: $climb
          time: 1.75  # TODO: better than a guess
        - to: East Cliff
          req: $grab
          time: 1.5
    - name: Switch
      coord: [16.2, 10.7]
      local:
        - to: Rock
          jumps: 1
      exits:
        - to: Door
          req: ^_door_opened
          time: 0.75
      actions:
        - name: Open Door
          req: $unlock3 and not ^_door_opened
          do: ^_door_opened = true
          time: 0.5
    - name: Door
      coord: [16.4, 10.7]
      exits:
        - to: Switch
          req: ^_door_opened
          time: 0.75
        - to: Vault
          req: ^_door_opened
    - name: Vault
      coord: [16.7, 10.6]
      locations:
        - name: Item
          item: Carnelian_Ring
          tags: [standing]
      exits:
        - to: Door
          req: ^_door_opened
    - name: Rock
      coord: [16, 10.4]
      local:
        - to: Lower Susar
        - to: Middle Platforms
          jumps: 2
        - to: Switch
    - name: Lower Susar
      coord: [15.6, 10.5]
      exits:
        - to: West Ledge
          req: ^_lower_susar and $grab
          time: 1.25
        - to: West Ledge
          req: ^_lower_susar and $hook
        - to: Rock
          req: ^_lower_susar
          time: 1.3
      actions:
        - name: Caught
          req: not ^_lower_susar
          do: ^_lower_susar = true
          time: 3
        - name: Hack
          req: not ^_lower_susar and $allegiance1
          do: ^_lower_susar = true
          price: 100
          time: 0.5
    - name: Upper Path
      coord: [15.6, 9.6]
      local:
        - to: Upper Susar
        - to: West Ledge
    - name: West Ledge
      coord: [15.3, 10.1]
      local:
        - to: Lower Susar
        - to: West 10
        - to: Upper Path
      exits:
        - to: West 10
          req: $grab
    - name: West 10
      coord: [15.05, 9.7]
      local:
        - to: West Ledge
      exits:
        - to: West Caverns > East 10
          tags: [xshift]

- name: West Caverns
  on_entry: $reset_old_area(^newpos)
  reset:
    _east_susar: false
  spots:
    - name: East 10
      coord: [14.95, 9.7]
      local:
        - to: East Platform
        - to: Tunnel Entrance
      exits:
        - to: Carnelian > West 10
          tags: [xshift]
        - to: Column 2 Top
          req: $hover
          time: 6
    - name: East Platform
      coord: [14.5, 10.1]
      local:
        - to: Tunnel Entrance
          jumps_down: 1
        - to: Small Platform
    - name: Tunnel Entrance
      coord: [14.55, 10.7]
      local:
        - to: Small Platform
          jumps: 3
        - to: Tunnel Bottom
      # TODO: exit to East 10 with wall climb?
    - name: Small Platform
      coord: [14.2, 10.2]
      local:
        - to: Higher Ledge
      actions:
        - name: Throw Drone Up
          req: $can_deploy
          do: $deploy_drone
          to: Giguna > West Caverns > Higher Ledge
          time: 1.5
    - name: Higher Ledge
      coord: [14.1, 9.9]
      local:
        - to: Column 2 Top
          jumps: 4
        - to: Small Platform
        - to: East Platform
        - to: Tunnel Entrance
    - name: Column 2 Top
      coord: [14, 9.3]
      local:
        - to: Higher Ledge
        - to: East Platform
        - to: Top Gap Right
    - name: Top Gap Right
      coord: [13.6, 9.5]
      local:
        - to: Column 2 Top
        - to: Top Gap Left
    - name: Top Gap Left
      coord: [13.4, 9.6]
      local:
        - to: Top Gap Right
        - to: Column 1 Top Right
          jumps: 1
    - name: Column 1 Top Right
      coord: [13.35, 9.3]
      local:
        - to: Top Gap Left
        - to: Top Gap Right
        - to: Column 1 Top Left
    - name: Column 1 Top Left
      coord: [13, 9.3]
      local:
        - to: Column 1 Top Right
        - to: Cache
        - to: Bush
    - name: Cache
      coord: [13.1, 9.8]
      local:
        - to: Bush
        - to: Column 1 Top Left
          thru: [12.8, 9.5]
          jumps: [2, 1]
      locations:
        - name: Item
          item: Power_Matrix
          tags: [standing]
    - name: Bush
      coord: [12.5, 9.8]
      local:
        - to: Cache
        - to: Column 1 Top Left
          thru: [12.8, 9.5]
          jumps: [2, 1]
      locations:
        - name: Item
          item: Power_Core
          req: $more_refills
          tags: [standing]

    - name: Tunnel Bottom
      coord: [14.8, 11.4]
      local:
        - to: Tunnel Fork
        - to: Tunnel Entrance
      exits:
        - to: Tunnel Entrance
          req: $grab
          time: 2.25
    - name: Tunnel Fork
      coord: [14.7, 11.7]
      local:
        - to: East Susar
        - to: East 13
          thru: [14.5, 11.7]
      exits:
        - to: Tunnel Bottom
          req: $grab
          time: 0.85
        - to: Tunnel Entrance
          req: $hook
          time: 2.25
    - name: East Susar
      coord: [14.8, 11.7]
      exits:
        - to: Tunnel Fork
          req: ^_east_susar
          time: 0.35
        - to: East 12
          req: ^_east_susar
          time: 0.5
      actions:
        - name: Caught
          req: not ^_east_susar
          do: ^_east_susar = true
          time: 3
        - name: Hack
          req: not ^_east_susar and $allegiance1
          do: ^_east_susar = true
          price: 100
          time: 0.5
    - name: East 12
      coord: [14.95, 11.7]
      local:
        - to: East Susar
      exits:
        - to: Wasteland > West 12
          tags: [xshift]
    - name: East 13
      coord: [14.95, 12.7]
      exits:
        - to: Wasteland > West 13
          tags: [xshift]

- name: Wasteland
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West 12
      coord: [15.05, 11.7]
      local:
        - to: Upper Cliff
      exits:
        - to: West Caverns > East 12
          tags: [xshift]
    - name: Upper Cliff
      coord: [15.3, 11.9]
      local:
        - to: West 12
          jumps: 1
        - to: West 13
          thru: [15.4, 12.2]
        - to: Lower Cliff
    - name: West 13
      coord: [15.05, 12.7]
      local:
        - to: Middle Path
          jumps: 1
      exits:
        - to: West Caverns > East 13
          tags: [xshift]
    - name: Middle Path
      coord: [15.4, 12.6]
      local:
        - to: West 13
        - to: Middle Cliff
          jumps: 2
    - name: Middle Cliff
      coord: [15.7, 12.4]
      local:
        - to: Upper Cliff
        - to: Middle Path
        - to: Lower Cliff
        - to: Lower Path Right
      actions:
        - name: Throw Drone
          req: $can_deploy and Slingshot_Hook
          do: $deploy_drone_and_move(`Giguna > Wasteland > Middle Path`)
          to: Giguna > Wasteland > West 12
          time: 3.5
    - name: Lower Path Right
      coord: [15.65, 13.3]
      local:
        - to: Lower Path Left
      exits:
        - to: Lower Cliff
          req: $climb
          time: 1.5
    - name: Lower Path Left
      coord: [15.4, 13.3]
      local:
        - to: Lower Path Right
        - to: West 14
    - name: Lower Cliff
      coord: [15.8, 12.8]
      local:
        - to: Lower Path Left
      exits:
        - to: Middle Cliff
          req: $climb
        - to: Middle Cliff
          req: $grab
          time: 0.85
    - name: West 14
      coord: [15.05, 13.7]
      local:
        - to: Lower Path Left
          jumps: 2
      exits:
        - to: Giguna Base > East 14
          tags: [xshift]

- name: Giguna Base
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 14
      coord: [14.95, 13.7]
      local:
        - to: Stone Knob
      exits:
        - to: Wasteland > West 14
          tags: [xshift]
    - name: Stone Knob
      coord: [14.5, 13.9]
      local:
        - to: Upper Cliff
        - to: Kari
          thru: [14.35, 14.1]
        - to: Middle Platform
          thru: [14.35, 14.1]
      exits:
        - to: Upper Cliff
          req: $climb
          time: 1.5
        - to: Upper Cliff
          req: $hook
          time: 1
      actions:
        - name: Throw Drone
          req: $can_deploy
          do: $deploy_drone_and_move(`Giguna > Giguna Base > Kari`)
          to: Giguna > Giguna Base > Upper Cliff
    - name: Upper Cliff
      coord: [14.2, 13.6]
      local:
        - to: Stone Knob
        - to: Kari
          thru: [14.35, 14.1]
        - to: Middle Platform
          thru: [14.35, 14.1]
        - to: Right Pillar
    - name: Right Pillar
      coord: [13.95, 13.6]
      local:
        - to: Ruin
      exits:
        - to: Left Pillar
          req: $grab
          time: 1.5
    - name: Left Pillar
      coord: [13.5, 13.6]
      local:
        - to: Ruin
      exits:
        - to: Right Pillar
          req: $grab
          time: 1.5
    - name: Ruin
      coord: [13.75, 14]
      locations:
        - name: Item
          item: Wall_Climb
          tags: [urn]
      exits:
        - to: Right Pillar
          req: $climb
          time: 1.5
        - to: Left Pillar
          req: $grab and $climb
          time: 1.5
    - name: Middle Platform
      coord: [14.5, 14.7]
      local:
        - to: Kari
        - to: Building Entry
      exits:
        - to: Stone Knob
          req: $grab
          time: 2.35
        - to: Stone Knob
          req: $hook
          time: 1.5
        - to: West Grate
          req: $hover
          time: 4.2
    - name: Kari
      coord: [14.4, 15.5]
      local:
        - to: Middle Platform
          jumps: 5
        - to: Building Entry
          jumps: 1
        - to: Table
          jumps_down: 1
    - name: Building Entry
      coord: [14.1, 15.5]
      local:
        - to: Staircase Bottom
        - to: Save Point
          jumps_down: 1
        - to: Table
          jumps_down: 1
        - to: Kari
      exits:
        - to: Building Interior > Entry
          tags: [interior]
    - name: West Grate
      coord: [13.2, 14.8]
      local:
        - to: Staircase Bottom
          jumps_down: 2
        - to: Table
          jumps_down: 4
        - to: Save Point
          jumps_down: 3
        - to: Building Entry
      exits:
        - to: Left Pillar
          req: $grab
          time: 4
        - to: Left Pillar
          req: $hook
          time: 3.5
        # TODO: next area
    - name: Staircase Bottom
      coord: [13.2, 15.7]
      local:
        - to: West Grate
          jumps: 5
        - to: Save Point
          jumps_down: 1
        - to: West 16
        - to: Building Entry
          jumps: 1
    - name: Table
      coord: [13.7, 16]
      local:
        - to: Kari
          thru: [14, 15.9]
          jumps: [1, 2]
        - to: Building Entry
          thru: [14, 15.9]
          jumps: [1, 2]
        - to: Save Point
          jumps: 1
      locations:
        - name: News
          item: Researchers_Missing
          tags: [standing]
    - name: Save Point
      coord: [13.5, 15.8]
      local:
        - to: Staircase Bottom
          jumps: 1
        - to: Building Entry
          jumps: 2
        - to: Table
        - to: West 16
      actions:
        - name: Save
          do: $save
          time: 1.3
    - name: West 16
      coord: [13.05, 15.8]
      local:
        - to: Staircase Bottom
          jumps: 1
        - to: Save Point
      # todo: next area

- name: Building Interior
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: Entry
      coord: [14.1, 15.5]
      local:
        - to: Bookshelf
          jumps: 3
      exits:
        - to: Bookshelf
          req: $grab or $climb
          time: 1.35
        - to: Bookshelf
          req: $hook
          time: 1
        - to: Giguna Base > Building Entry
          tags: [exterior]
    - name: Bookshelf
      coord: [13.9, 15.1]
      local:
        - to: Entry
          jumps_down: 2
      locations:
        - name: Note
          item: Letter_from_Trace
          tags: [standing]

- name: Ruins East
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 9
      coord: [16.95, 8.8]
      local:
        - to: Bottom Rock
          jumps: 2
        - to: Cliff
    - name: Bottom Rock
      coord: [16.3, 8.5]
      local:
        - to: East 9
        - to: West 9
      exits:
        - to: Cliff
          req: $hook
          time: 3.45
    - name: West 9
      coord: [16.05, 8.6]
      local:
        - to: Bottom Rock
          jumps: 1
      exits:
        - to: Ruins Center > East 9
          tags: [xshift]
    - name: Cliff
      coord: [16.6, 7.6]
      local:
        - to: Bottom Rock
        - to: East 9
        - to: West 9
          thru: [16.2, 7.7]
      exits:
        - to: Ledge
          req: $climb
        - to: Ledge
          req: $hook
          time: 0.8
    - name: Ledge
      coord: [16.55, 7.4]
      local:
        - to: Cliff
      exits:
        - to: Small Passage
          req: ^mode == 'drone'
          time: 0.35
        # TODO: to: Pillar
    - name: Small Passage
      coord: [16.45, 7.4]
      local:
        - to: West 8
      exits:
        - to: Ledge
          req: ^mode == 'drone'
          time: 0.35
    - name: West 8
      coord: [16.05, 7.5]
      local:
        - to: Small Passage
          jumps: 1
      exits:
        - to: Ruins Center > East 8
          tags: [xshift]
    - name: Pillar
      coord: [16.25, 6.4]
      local:
        - to: West 7
        - to: Way Up High
        - to: Ledge
    - name: West 7
      coord: [16.05, 6.8]
      #exits:
      #  - to: Ruins Top > East 7
      #    tags: [xshift]
        # TODO: to: Pillar
    - name: Way Up High
      coord: [16.6, 5.2]
      local:
        - to: Pillar
        - to: Cliff
        - to: East 9
      #locations:
      #  - name: Item
      #    item: Flask
      #    tags: [flask]
      # TODO: exits toward Ruins Top?

- name: Ruins Center
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 8
      coord: [15.95, 7.5]
      local:
        - to: Tablet
      exits:
        - to: Ruins East > West 8
          tags: [xshift]
    - name: Tablet
      coord: [15.8, 7.5]
      local:
        - to: East 8
      locations:
        - name: Item
          item: Aansur
          tags: [standing]
    - name: East 9
      coord: [15.95, 8.6]
      local:
        - to: Wall Bottom
      exits:
        - to: Ruins East > West 9
          tags: [xshift]
    - name: Wall Bottom
      coord: [15.2, 8.4]
      local:
        - to: East 9
          jumps: 1
      exits:
        - to: Wall Top
          req: $climb
    - name: Wall Top
      coord: [15.2, 8.1]
      local:
        - to: Wall Bottom
          jumps_down: 1
        - to: East 9
      exits:
        - to: Center Top
          req: $grab
          time: 1.5
    - name: Center Top
      coord: [15.1, 7.7]
      local:
        - to: West Platform Right
    - name: West Platform Right
      coord: [14.8, 8.1]
      local:
        - to: West Platform Left
        - to: Center Top
      # exit?
    - name: West Platform Left
      coord: [14.4, 8.1]
      local:
        - to: West Platform Right
        - to: West 9
          jumps_down: 1
    - name: West 9
      coord: [14.05, 8.6]
      # todo: connection to West Platform Left?
      exits:
        - to: Ruins West > East 9
          tags: [xshift]

- name: Ruins West
  on_entry: $reset_old_area(^newpos)
  reset:
    _kishib_handled: false
  spots:
    - name: East 9
      coord: [13.95, 8.6]
      local:
        - to: Save Point
        - to: Platform
          jumps: 1
      exits:
        - to: Ruins Center > West 9
          tags: [xshift]
    - name: Save Point
      coord: [13.5, 8.7]
      local:
        - to: Platform
          jumps: 2
        - to: East 9
          jumps: 1
      actions:
        - name: Save
          do: $save
          tags: [save]
    - name: Platform
      coord: [13.5, 8.5]
      local:
        - to: Save Point
          jumps_down: 2
        - to: East 9
        - to: Nook
          jumps: 2
    - name: Nook
      coord: [13.4, 8.0]
      local:
        - to: Platform
      exits:
        - to: Lower Ledge
          req: $climb and $grab
          time: 2.35
    - name: Lower Ledge
      coord: [13.4, 7.4]
      local:
        - to: Nook
        - to: Platform
      exits:
        - to: Upper Ledge
          req: $grab and ^_kishib_handled
          time: 4
      actions:
        - name: Hack Kishib
          req: not ^_kishib_handled and $allegiance1
          price: 100
          do: ^_kishib_handled = true
          tags: [hack]
        - name: Destroy Kishib
          req: not ^_kishib_handled and $shockwave
          price: 100
          do: ^_kishib_handled = true
          tags: [shockwave]
    - name: Upper Ledge
      coord: [13.6, 6.4]
      local:
        - to: Lower Ledge
        - to: Platform
        - to: East 7
    - name: East 7
      coord: [13.95, 6.7]
      exits:
        - to: Upper Ledge
          req: $grab
          time: 1.2
        - to: Ruins Upper > West 7
          tags: [xshift]

- name: Ruins Upper
  on_entry: $reset_old_area(^newpos)
  start:
    _doors_open: false
  spots:
    - name: West 7
      coord: [14.05, 6.7]
      exits:
        - to: Ruins West > East 7
          tags: [xshift]