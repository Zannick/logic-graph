name: Giguna Steppes
short: Giguna

areas:
- name: Giguna Northeast  # MARK: Giguna Northeast
  on_entry: $reset_old_area(^newpos)
  start:
    _door_opened: false
  map:
    save: [17, 9, 18, 10]
    gate: [18, 9, 19, 10]
    vault: [17, 10, 18, 11]
  data:
    save_point: Save Point
    portal_start: Portal Hole
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Giguna Northeast
      gate: Menu > Kiengir Map > Giguna Northeast Gate
      vault: Menu > Kiengir Map > Giguna Northeast Flask
  spots:
    - name: Portal Hole
      coord: [18.475, 10.4]
      data:
        flipside: SpotId::None
    - name: Northeast Wall
      coord: [18.8, 8.75]
      data:
        flipside: Giguna Breach > Gate and Wall > Button Right
      local:
        - to: Inner Wall
      exits:
        - to: Portal Exit
          req: $hook
          movement: fast_hover
          jumps: 1
        - to: Upper Column
          req: $hookhover
          movement: fast_hover
          jumps: 1
        - to: Crow Eating
          req: $hookhover
          movement: fast_hover
          jumps: 1
        - to: Save Point
          req: $hookhover
          movement: fast_hover
          jumps: 1
        - to: Ebih > Ebih West > Giguna Pillar
          req: $hook or $grab or $climb
          movement: base
          jumps: 3
          penalty_tags: [xshift, -base.1]
          penalties:
            - when: not $hook
              jumps: 1
    - name: Inner Wall
      coord: [18.65, 8.95]
      local:
        - to: Northeast Wall
          jumps: 1
        - to: Portal Exit
          jumps: 2
    - name: Portal Exit
      coord: [18.475, 8.6]
      data:
        flipside: Giguna Breach > Gate and Wall > Portal Stand
      local:
        - to: Upper Column
          jumps: 2
        - to: Inner Wall
        - to: Northeast Wall
    - name: Upper Column
      coord: [18.15, 8.5]
      data:
        flipside: Giguna Breach > Gate and Wall > Brick Column
      local:
        - to: Crow Eating
        - to: Portal Exit
          jumps: 1
    - name: Crow Eating
      coord: [17.85, 8.9]
      local:
        - to: Save Point
        - to: Gate Left
      exits:
        - to: Gate Vent
          req: $hover
          time: 1  # ?
    - name: Save Point
      coord: [17.5, 9.5]
      local:
        - to: Step
          jumps: 1
        - to: Gate Left
      actions:
        - name: Save
          do: $save
          time: 1.3
      exits:
        - to: Gate Vent
          req: $hover and $hook
          time: 2
    - name: Step
      coord: [17.3, 9.4]
      local:
        - to: West 10
        - to: Save Point
      exits:
        - to: West 9
          req: $hook or $grab or $climb
          movement: base
          jumps: 3
          penalties:
            - when: not $hook
              jumps: 1
        - to: Gate Vent
          req: $hover
          time: 2.3
    - name: West 10
      coord: [17.05, 9.5]
      local:
        - to: Step
          jumps: 1
      exits:
        - to: Carnelian > East 10
          tags: [xshift]
    - name: West 9
      coord: [17.05, 8.8]
      local:
        - to: Step
      exits:
        - to: Crow Eating
          req: $hover
          movement: base
          jumps: 1
        - to: Ruins East > East 9
          tags: [xshift]
    - name: Gate Left
      coord: [17.8, 9.6]
      local:
        - to: Save Point
          jumps: 1
      exits:
        - to: Gate Button
          req: Giguna_Northeast_Gate
          time: 2.5
      actions:
        - name: Throw Drone
          req: $can_deploy and Slingshot_Hook
          do: $deploy_drone
          to: Giguna > Giguna Northeast > Gate Vent
          time: 1.25

    - name: Gate Vent
      coord: [18, 9.1]
      local:
        - to: Gate Button
          thru: [18.35, 9.1]
        - to: Save Point
    - name: Gate Button
      coord: [18.5, 9.75]
      local:
        - to: Gate Right
          jumps: 1
      locations:
        - name: Open Gate
          item: Giguna_Northeast_Gate
          canon: Giguna_Northeast_Gate
          tags: [button]
      exits:
        - to: Gate Left
          req: Giguna_Northeast_Gate
          time: 2.5
    - name: Gate Right
      coord: [18.775, 9.6]
      data:
        flipside: Giguna Breach > Gate and Wall > Walled Off
      local:
        - to: Gate Button
        - to: Shaft Bottom
      locations:
        - name: Remote Button
          item: Giguna_Northeast_Gate
          canon: Giguna_Northeast_Gate
          req: $boomerang

    - name: Shaft Bottom
      coord: [18.8, 10.6]
      local:
        - to: East 11
        - to: Right Column
          jumps: 1
      exits:
        - to: Gate Right
          req: $hook or $grab
          movement: base
          jumps: 4
          penalties:
            - when: not $hook
              jumps: 3
        - to: Gate Right
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: East 11
      coord: [18.95, 10.75]
      local:
        - to: Shaft Bottom
          jumps: 1
      exits:
        - to: Ebih > Ebih West > West 11
          tags: [xshift]
    - name: Right Column
      coord: [17.9, 10.5]
      local:
        - to: Switch
        - to: Shaft Bottom
      actions:
        - name: Open Door From Afar
          req: $unlock3 and $range2 and not ^_door_opened
          do: ^_door_opened = true
          tags: [hack]
      exits:
        - to: Door
          req: ^_door_opened
          movement: fast_hover
          penalties:
            - when: not $hook
              movement: base
        - to: Vault
          req: ^_door_opened and $hookhover
          movement: fast_hover
    - name: Switch
      coord: [17.7, 10.8]
      data:
        flipside: Giguna Breach > Slingshot > Ravine
      exits:
        - to: Door
          req: ^_door_opened and ($grab or $hook)
          movement: base
          jumps: 2
        - to: Right Column
          req: $grab or $hook
          movement: base
          jumps: 2
      actions:
        - name: Open Door
          req: $unlock3 and not ^_door_opened
          do: ^_door_opened = true
          tags: [hack]
    - name: Door
      coord: [17.5, 10.5]
      data:
        flipside: Giguna Breach > Slingshot > Column
      local:
        - to: Right Column
        - to: Vault
        - to: Vault East
      locations:
        - name: Remote Flask
          item: Flask
          canon: Giguna_Northeast_Flask
          req: $boomerang
          tags: [remote_flask]
    - name: Vault
      coord: [17.25, 10.8]
      local:
        - to: Vault East
          jumps: 1
      locations:
        - name: Item
          item: Flask
          canon: Giguna_Northeast_Flask
          tags: [flask]
        - name: Flask Collection Skip
          item: Flask
          canon: Giguna_Northeast_Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          item: Flask
          canon: Giguna_Northeast_Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
      exits:
        - to: Door
          req: ^_door_opened and $hook
          movement: fast_hover
          jumps: 1
        - to: Right Column
          req: ^_door_opened and $hookhover
          movement: fast_hover
          jumps: 2
    - name: Vault East
      coord: [17.4, 10.7]
      local:
        - to: Vault
      locations:
        - name: Shockwave Flask
          item: Flask
          canon: Giguna_Northeast_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
      exits:
        - to: Door
          req: ^_door_opened
          movement: base
          jumps: 2

- name: Carnelian  # MARK: Carnelian
  on_entry: $reset_old_area(^newpos)
  map:
    vault: [16, 10, 17, 11]
  datamap:
    map_spot:
      vault: Menu > Kiengir Map > Carnelian Ring
  start:
    _door_opened: false
  reset:
    _upper_susar: false
    _lower_susar: false
  spots:
    - name: East 10
      coord: [16.95, 9.5]
      local:
        - to: East Cliff
      exits:
        - to: Giguna Northeast > West 10
          tags: [xshift]
    - name: East Cliff
      coord: [16.35, 9.7]
      local:
        - to: East 10
          jumps: 2
        - to: Upper Susar
          jumps: 2
        - to: Middle Platforms
        - to: Switch
    - name: Upper Susar
      coord: [15.85, 9.6]
      exits:
        - to: Upper Path
          req: ^_upper_susar
          movement: base
        - to: Middle Platforms
          req: ^_upper_susar
          movement: base
        - to: East Cliff
          req: ^_upper_susar
          movement: base
      actions:
        - name: Caught
          req: not ^_upper_susar
          do: ^_upper_susar = true
          tags: [susar]
        - name: Hack
          req: not ^_upper_susar and $allegiance1
          price: 100
          do: ^_upper_susar = true
          time: 0.5
    - name: Middle Platforms
      coord: [16.1, 10]
      local:
        - to: Rock
        - to: Switch
      exits:
        - to: Upper Susar
          req: $hook or $climb
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: East Cliff
          req: $hook or $grab
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
    - name: Switch
      coord: [16.2, 10.7]
      local:
        - to: Rock
          jumps: 1
      exits:
        - to: Door
          req: ^_door_opened
          movement: base
      actions:
        - name: Open Door
          req: $unlock3 and not ^_door_opened
          do: ^_door_opened = true
          time: 0.5
    - name: Door
      coord: [16.4, 10.7]
      exits:
        - to: Switch
          req: ^_door_opened
          movement: base
        - to: Vault
          req: ^_door_opened
          movement: base
          jumps: 1
    - name: Vault
      coord: [16.7, 10.6]
      locations:
        - name: Item
          item: Carnelian_Ring
          tags: [standing]
      exits:
        - to: Door
          req: ^_door_opened
          movement: base
    - name: Rock
      coord: [16, 10.4]
      local:
        - to: Lower Susar
        - to: Middle Platforms
          jumps: 2
        - to: Switch
    - name: Lower Susar
      coord: [15.6, 10.5]
      exits:
        - to: West Ledge
          req: ^_lower_susar and ($hook or $grab)
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Rock
          req: ^_lower_susar
          movement: base
          jumps: 1
      actions:
        - name: Caught
          req: not ^_lower_susar
          do: ^_lower_susar = true
          tags: [susar]
        - name: Hack
          req: not ^_lower_susar and $allegiance1
          do: ^_lower_susar = true
          price: 100
          time: 0.5
    - name: Upper Path
      coord: [15.6, 9.6]
      local:
        - to: Upper Susar
        - to: West Ledge
    - name: West Ledge
      coord: [15.3, 10.1]
      local:
        - to: Lower Susar
      exits:
        - to: West 10
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Upper Path
          req: $hook
          movement: base
          jumps: 2
    - name: West 10
      coord: [15.05, 9.8]
      local:
        - to: West Ledge
      exits:
        - to: West Caverns > East 10
          tags: [xshift]

- name: West Caverns  # MARK: West Caverns
  on_entry: $reset_old_area(^newpos)
  map:
    matrix: [13, 9, 14, 10]
    core: [12, 9, 13, 10]
  datamap:
    map_spot:
      matrix: Menu > Kiengir Map > Giguna Caverns Matrix
      core: Menu > Kiengir Map > Giguna Caverns Core
  reset:
    _east_susar: false
  spots:
    - name: East 10
      coord: [14.95, 9.8]
      local:
        - to: East Platform
        - to: Small Staircase
        - to: Tunnel Entrance
          jumps_down: 1
      exits:
        - to: Carnelian > West 10
          tags: [xshift]
        - to: Column 2 Top
          req: $hover
          time: 6
    - name: East Platform
      coord: [14.5, 10.1]
      local:
        - to: Small Staircase
          jumps_down: 1
        - to: Tunnel Entrance
          jumps_down: 1
        - to: Small Platform
    - name: Small Staircase
      coord: [14.55, 10.5]
      local:
        - to: Tunnel Entrance
          jumps_down: 1
        - to: Small Platform
          jumps: 3
      exits:
        - to: East 10
          req: $climb
          movement: base
          jumps: 4
    - name: Tunnel Entrance
      coord: [14.55, 10.7]
      local:
        - to: Small Platform
          jumps: 3
        - to: Tunnel Bottom
          jumps_down: 1
        - to: Small Staircase
          jumps: 2
    - name: Small Platform
      coord: [14.2, 10.2]
      local:
        - to: East Platform
          jumps: 1
        - to: Small Staircase
        - to: Tunnel Entrance
      actions:
        - name: Throw Drone Up
          req: $can_deploy
          do: $deploy_drone
          to: Giguna > West Caverns > Higher Ledge
          time: 1.5
    - name: Higher Ledge
      coord: [14.1, 9.9]
      local:
        - to: Floating Brick
          jumps: 2
        - to: Small Platform
        - to: East Platform
        - to: Small Staircase
        - to: Tunnel Entrance
    - name: Floating Brick
      coord: [14.25, 9.6]
      local:
        - to: Higher Ledge
        - to: East Platform
        - to: Column 2 Top
          jumps: 2
    - name: Column 2 Top
      coord: [14, 9.3]
      local:
        - to: Higher Ledge
        - to: East Platform
        - to: Floating Brick
        - to: Small Platform
        - to: Small Staircase
        - to: Top Gap Right
    - name: Top Gap Right
      coord: [13.65, 9.5]
      local:
        - to: Column 2 Top
          jumps: 1
        - to: Top Gap Left
      exits:
        - to: Column 1 Top Right
          req: $hover
          movement: base
          jumps: 1
    - name: Top Gap Left
      coord: [13.4, 9.55]
      local:
        - to: Top Gap Right
          jumps: 1
        - to: Column 1 Top Right
          jumps: 1
    - name: Column 1 Top Right
      coord: [13.35, 9.3]
      local:
        - to: Top Gap Left
        - to: Top Gap Right
        - to: Column 1 Top Left
    - name: Column 1 Top Left
      coord: [13, 9.3]
      data:
        flipside: Giguna Breach > Below Chimney > West Passage
      local:
        - to: Column 1 Top Right
        - to: Cache
        - to: Bush
    - name: Cache
      coord: [13.1, 9.8]
      local:
        - to: Bush
        - to: Column 1 Top Left
          thru: [12.875, 9.5]
          jumps: [2, 1]
      locations:
        - name: Item
          item: Power_Matrix
          tags: [standing]
    - name: Bush
      coord: [12.5, 9.8]
      data:
        flipside: Giguna Breach > Below Chimney > Southwest
      local:
        - to: Cache
        - to: Column 1 Top Left
          thru: [12.875, 9.5]
          jumps: [2, 1]
      locations:
        - name: Item
          item: Power_Core
          req: $more_refills
          tags: [standing]

    - name: Tunnel Bottom
      coord: [14.8, 11.45]
      local:
        - to: Tunnel Fork
      exits:
        - to: Tunnel Entrance
          req: $hook or $grab
          movement: base
          jumps: 3
          penalties:
            - when: not $hook
              jumps: 2
    - name: Tunnel Fork
      coord: [14.7, 11.7]
      local:
        - to: East Susar
        - to: East 13
          thru: [14.5, 11.75]
      exits:
        - to: Tunnel Bottom
          req: $grab
          time: 0.85
        - to: Tunnel Entrance
          req: $hook
          time: 2.25
    - name: East Susar
      coord: [14.8, 11.75]
      exits:
        - to: Tunnel Fork
          req: ^_east_susar
          movement: base
          jumps: 1
        - to: East 12
          req: ^_east_susar
          movement: base
      actions:
        - name: Caught
          req: not ^_east_susar
          do: ^_east_susar = true
          tags: [susar]
        - name: Hack
          req: not ^_east_susar and $allegiance1
          do: ^_east_susar = true
          price: 100
          time: 0.5
    - name: East 12
      coord: [14.95, 11.75]
      local:
        - to: East Susar
      exits:
        - to: Wasteland > West 12
          tags: [xshift]
    - name: East 13
      coord: [14.95, 12.75]
      exits:
        - to: Wasteland > West 13
          tags: [xshift]

    - name: Northwest
      coord: [12.2, 9.1]
      local:
        - to: West 13
    - name: West 13
      coord: [12.05, 12.3]
      exits:
        - to: Far Corner > East 13
          tags: [xshift]

- name: Wasteland  # MARK: Wasteland
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [16, 11, 17, 12]
    core: [15, 13, 16, 14]
    switch: [18, 11, 19, 12]
    door: [18, 13, 19, 14]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Giguna Wasteland Flask
      core: Menu > Kiengir Map > Giguna Wasteland Core
      switch: Menu > Kiengir Map > Giguna Wasteland Switch
      door: Menu > Kiengir Map > Giguna Wasteland Health
  spots:
    - name: West 12
      coord: [15.05, 11.75]
      local:
        - to: Upper Cliff
      exits:
        - to: West Caverns > East 12
          tags: [xshift]
    - name: Upper Cliff
      coord: [15.3, 11.95]
      local:
        - to: West 12
          jumps: 1
        - to: West 13
          thru: [15.4, 12.2]
        - to: Lower Cliff
    - name: West 13
      coord: [15.05, 12.75]
      local:
        - to: Middle Path
          jumps: 1
      exits:
        - to: West Caverns > East 13
          tags: [xshift]
    - name: Middle Path
      coord: [15.4, 12.65]
      local:
        - to: West 13
        - to: Middle Cliff
          jumps: 2
    - name: Middle Cliff
      coord: [15.7, 12.45]
      local:
        - to: Middle Path
        - to: Lower Cliff
        - to: Lower Path Right
      exits:
        - to: Upper Cliff
          req: $hook
          movement: base
          jumps: 2
      actions:
        - name: Throw Drone
          req: $can_deploy and Slingshot_Hook
          do: $deploy_drone_and_move(`Giguna > Wasteland > Middle Path`)
          to: Giguna > Wasteland > West 12
          time: 3.5
    - name: Lower Path Right
      coord: [15.65, 13.3]
      local:
        - to: Lower Path Left
      exits:
        - to: Lower Cliff
          req: $grab or $climb
          movement: base
          jumps: 2
          penalties:
            - when: not $climb
              jumps: 1
    - name: Lower Path Left
      coord: [15.4, 13.3]
      local:
        - to: Lower Path Right
        - to: West 14
        - to: Passage Cache
    - name: Lower Cliff
      coord: [15.85, 12.85]
      local:
        - to: Lower Path Left
        - to: Westward Hill
      exits:
        - to: Middle Cliff
          req: $hook or $climb
          movement: base
          jumps: 2
    - name: West 14
      coord: [15.05, 13.7]
      local:
        - to: Lower Path Left
          jumps: 2
      exits:
        - to: Giguna Base > East 14
          tags: [xshift]

    # East half, er, three-quarters
    - name: East 12
      coord: [18.95, 11.8]
      local:
        - to: East Ledge
      exits:
        - to: Ebih > Ebih West > West 12
          tags: [xshift]
    - name: East 13
      coord: [18.95, 12.7]
      local:
        - to: East Bricks
      exits:
        - to: Ebih > Ebih West > West 13
          tags: [xshift]
    - name: East Bricks
      coord: [18.6, 12.7]
      local:
        - to: Door Left
        - to: Bluff by Door
        - to: Tiny Hill
        - to: East 13
      exits:
        - to: East Ledge
          req: $hook
          movement: base
          jumps: 2
        - to: Lower Platform East
          req: $hook or $hover
          movement: base
        - to: Ladder Ledge
          req: $hook and $hover
          movement: base
          jumps: 3
    - name: East 14
      coord: [18.95, 13.6]
      local:
        - to: Door Right
          jumps: 2  # ?
      exits:
        - to: East Caverns > West 14
          tags: [xshift]
    - name: East Ledge
      coord: [18.7, 12.2]
      local:
        - to: East 13
        - to: Door Left
        - to: Bluff by Door
        - to: Tiny Hill
      exits:
        - to: East 12
          req: $hook or $grab or $climb
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
    - name: Door Left
      coord: [18.5, 13.2]
      local:
        - to: Bluff by Door
        - to: Tiny Hill
      exits:
        - to: Door Right
          req: Giguna_Wasteland_Door
          movement: base
        - to: Lower Platform East
          req: $hook
          movement: base
          jumps: 1
    - name: Door Right
      coord: [18.65, 13.2]
      local:
        - to: East 14
      locations:
        - name: Health
          item: Health_Fragment
          tags: [standing]
      exits:
        - to: Door Left
          req: Giguna_Wasteland_Door
          movement: base
    - name: Bluff by Door
      coord: [18.4, 13.6]
      local:
        - to: Tiny Hill
          jumps: 2
      exits:
        - to: Door Left
          req: $hook or ($grab and $climb)
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
    - name: Tiny Hill
      coord: [18.0, 13.5]
      local:
        - to: Bluff by Door
        - to: Center Plains
      exits:
        - to: Door Left
          req: $hook
          movement: base
          jumps: 1
        - to: Lower Platform West
          req: $hook and $hover
          movement: base
          jumps: 4
    - name: Steeper Hill
      coord: [17.2, 13.3]
      local:
        - to: Center Plains
        - to: West Plains
      exits:
        - to: Lower Platform West
          req: $hook and $hover
          movement: base
          jumps: 2
        - to: Left Platform East
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Center Plains
      coord: [17.4, 13.6]
      local:
        - to: Tiny Hill
          jumps: 1
      exits:
        - to: Steeper Hill
          req: $grab or $climb
          movement: base
          jumps: 2
    - name: West Plains
      coord: [17.0, 13.6]
      local:
        - to: Steeper Hill
          jumps: 3
        - to: Passage East
        - to: Westward Hill
          jumps: 2
    - name: Passage East
      coord: [16.6, 13.6]
      local:
        - to: West Plains
        - to: Westward Hill
          jumps: 2
      exits:
        - to: Passage Cache
          req: ^mode == 'drone' and Giguna_Wasteland_Passage_H
          movement: base
      hybrid:
        - name: Clear Horizontal Passage Manually
          to: Passage Cache
          item: Giguna_Wasteland_Passage_H
          canon: Giguna_Wasteland_Passage_H
          req: ^mode == 'drone'
          time: 15  # ?
        - name: Mist through Horizontal Passage
          to: Passage Cache
          item: Giguna_Wasteland_Passage_H
          canon: Giguna_Wasteland_Passage_H
          req: ^mode == 'drone' and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1

    - name: Passage Cache
      coord: [15.4, 13.6]
      exits:
        - to: Passage East
          req: ^mode == 'drone' and Giguna_Wasteland_Passage_H
          movement: base
        - to: Lower Path Left
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
      hybrid:
        - name: Clear Horizontal Passage Manually
          to: Passage East
          item: Giguna_Wasteland_Passage_H
          canon: Giguna_Wasteland_Passage_H
          req: ^mode == 'drone'
          time: 15  # ?
        - name: Mist through Horizontal Passage
          to: Passage East
          item: Giguna_Wasteland_Passage_H
          canon: Giguna_Wasteland_Passage_H
          req: ^mode == 'drone' and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Westward Hill
      coord: [16.45, 13.4]
      local:
        - to: Lower Cliff
          jumps: 4
        - to: Passage East
        - to: West Plains

    # Upper portion
    - name: Upper Cache
      coord: [16.4, 11.5]
      data:
        flipside: Giguna Breach > Antechamber > Middle
      local:
        - to: Cache Ledge
        - to: West Plains
      locations:
        - name: Flask
          canon: Giguna_Wasteland_Flask
          item: Flask
          tags: [flask]
        - name: Shockwave Flask
          canon: Giguna_Wasteland_Flask
          item: Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
      exits:
        - to: Left Platform West
          req: $hover
          movement: base
        - to: Center Plains
          req: $hover
          movement: base
      hybrid:
        - name: Flask Collection Skip
          canon: Giguna_Wasteland_Flask
          item: Flask
          to: Menu > Warp Only > Kiengir
          req: $melee_cskip
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Giguna_Wasteland_Flask
          item: Flask
          to: ^map_spot
          req: $melee_cskip and Fast_Travel
          tags: [cskip]
    - name: Cache Ledge
      coord: [16.5, 11.8]
      data:
        flipside: Giguna Breach > Antechamber > South
      local:
        - to: Upper Cache
          thru: [16.4, 11.7]
          jumps: [1, 1]
        - to: Upper Mid-air Near Cache
        - to: Left Platform West
        - to: West Plains
        - to: Passage East
      exits:
        - to: Upper Cache
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Center Plains
          req: $hover
          movement: base
        - to: Lower Platform West
          req: $hook and $hover
          movement: base
    - name: Mid-air Near Cache
      coord: [16.5, 12.2]
      data:
        flipside: SpotId::None
      local:
        - to: West Plains
      exits:
        - to: Upper Mid-air Near Cache
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Center Platform West  # If we don't go up, we go to the right
          req: $hook and $hover
          movement: base
          jumps: 2
    - name: Upper Mid-air Near Cache
      coord: [16.5, 12.0]
      local:
        - to: Lower Cliff
        - to: West Plains
      exits:
        - to: Cache Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Upper Cache
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Left Platform West
          req: $hook and $hover
          movement: base
          jumps: 1
    - name: Left Platform West
      coord: [16.75, 11.9]
      local:
        - to: Lower Cliff
        - to: Cache Ledge
          jumps: 1
        - to: Left Platform East
      exits:
        - to: Upper Cache
          req: $hook
          movement: base
          jumps: 2
        - to: Center Platform West
          req: $hook and $hover
          movement: fast_hover
          jumps: 1
        - to: Door Left
          req: $hook and $hover
          movement: fast_hover
    - name: Left Platform East
      coord: [17.0, 12.0]
      local:
        - to: West Plains
        - to: Steeper Hill
      exits:
        - to: Center Platform West
          req: $hook
          movement: base
          jumps: 1
        - to: Lower Platform West
          req: $hover
          movement: base
    - name: Below Platforms Center
      coord: [17.15, 12.35]
      data:
        flipside: SpotId::None
      exits:
        - to: Left Platform East
          req: $hookhover
          movement: base
          jumps: 3
        - to: Left Platform East
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Cache Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Center Platform West
      coord: [17.25, 11.7]
      local:
        - to: Center Platform East
        - to: Passage East
      exits:
        - to: Left Platform East
          req: $hook
          movement: base
        - to: Switch Approach
          req: $hook and $hover
          movement: fast_hover
          jumps: 1
    - name: Center Platform East
      coord: [17.5, 11.8]
      local:
        - to: Center Platform West
          jumps: 1
        - to: Right Platform West
        - to: Lower Platform West
      exits:
        - to: Switch Ledge
          req: $hover
          movement: base
          jumps: 1
        - to: Passage East
          req: $hook
          movement: fast_hover
          jumps: 1
    - name: Right Platform West
      coord: [17.75, 12.05]
      local:
        - to: Right Platform East
        - to: West Plains
      exits:
        - to: Switch Ledge
          req: $hook
          movement: base
          jumps: 2
        - to: Center Platform East
          req: $hook
          movement: base
          jumps: 2
        - to: Passage East
          req: $hover
          movement: base
    - name: Right Platform East
      coord: [17.95, 12.1]
      local:
        - to: Right Platform West
          jumps: 1
        - to: Ladder Ledge
        - to: Lower Platform East
      exits:
        - to: Switch Ledge
          req: $hook
          movement: base
          jumps: 2
    - name: Lower Platform West
      coord: [17.9, 13.0]
      local:
        - to: West Plains
        - to: Lower Platform East
          jumps: 1
      exits:
        - to: Ladder Ledge
          req: $hook
          movement: base
          jumps: 3
        - to: Steeper Hill
          req: $hover
          movement: base
    - name: Lower Platform East
      coord: [18.15, 13.0]
      local:
        - to: Lower Platform West
          jumps: 1
        - to: Door Left
      exits:
        - to: East Bricks
          req: $hover
          movement: base
          jumps: 2
        - to: Ladder Ledge
          req: $hook
          movement: base
          jumps: 3
    - name: Ladder Ledge
      coord: [18.15, 12.4]
      local:
        - to: Lower Platform West
        - to: Lower Platform East
        - to: Bluff by Door
      exits:
        - to: Door Left
          req: $hover
          movement: base
        - to: Right Platform East
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: Switch Ledge
      coord: [18.05, 11.6]
      local:
        - to: Switch Approach
          jumps: 1
        - to: Ladder Ledge
        - to: Lower Platform East
        - to: Right Platform East
      exits:
        - to: Center Platform East
          req: $hover
          movement: base
        - to: Center Platform West
          req: $hover
          movement: base
    - name: Switch Approach
      coord: [18.3, 11.5]
      local:
        - to: Switch Ledge
        - to: Switch
      locations:
        - name: Boomerang Switch
          canon: Giguna_Wasteland_Switch
          item: Giguna_Wasteland_Door
          req: $boomerang
          tags: [button]  # you can just leave immediately after throwing it, including fast travel
    - name: Switch
      coord: [18.5, 11.5]
      local:
        - to: Switch Approach
      locations:
        - name: Switch
          canon: Giguna_Wasteland_Switch
          item: Giguna_Wasteland_Door
          req: $can_damage
          tags: [button]

- name: Giguna Base  # MARK: Giguna Base
  on_entry: $reset_old_area(^newpos)
  start:
    _door_open: false
  map:
    save: [13, 15, 14, 16]
    urn: [13, 14, 14, 15]
    kari: [14, 15, 15, 16]
  data:
    save_point: Save Point
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Giguna Base
      urn: Menu > Kiengir Map > Wall Climb
      kari: Menu > Kiengir Map > Kari
  spots:
    - name: East 14
      coord: [14.95, 13.7]
      local:
        - to: Stone Knob
      exits:
        - to: Wasteland > West 14
          tags: [xshift]
    - name: Stone Knob
      coord: [14.55, 13.9]
      local:
        - to: Kari
          thru: [14.35, 14.1]
        - to: Middle Platform
          thru: [14.35, 14.1]
      exits:
        - to: Upper Cliff
          req: $hook or ($grab and $climb)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 2
      actions:
        - name: Throw Drone
          req: $can_deploy
          do: $deploy_drone_and_move(`Giguna > Giguna Base > Kari`)
          to: Upper Cliff
    - name: Upper Cliff
      coord: [14.25, 13.55]
      local:
        - to: Stone Knob
        - to: Kari
          thru: [14.35, 14.1]
        - to: Middle Platform
          thru: [14.35, 14.1]
        - to: Right Pillar
    - name: Right Pillar
      coord: [13.9, 13.6]
      local:
        - to: Ruin
        - to: Upper Cliff
          jumps: 1
      exits:
        - to: Left Pillar
          req: $grab
          time: 1.5
    - name: Left Pillar
      coord: [13.5, 13.55]
      local:
        - to: Ruin
      exits:
        - to: Right Pillar
          req: $grab
          time: 1.5
    - name: Ruin
      coord: [13.75, 14.1]
      locations:
        - name: Item
          item: Wall_Climb
          tags: [urn]
      exits:
        - to: Right Pillar
          req: $climb
          time: 1.5
        - to: Left Pillar
          req: $grab and $climb
          time: 1.5
    - name: Middle Platform
      coord: [14.45, 14.7]
      local:
        - to: Kari
        - to: Building Entry
      exits:
        - to: Stone Knob
          req: $hook or $grab
          movement: base
          jumps: 3
          penalties:
            - when: not $hook
              jumps: 1
        - to: Staircase Top
          req: $hover
          time: 4.2
        - to: Below Gate
          req: ^_door_open
          movement: base
          jumps_down: 2
    - name: Kari
      coord: [14.4, 15.55]
      local:
        - to: Middle Platform
          jumps: 5
        - to: Building Entry
          jumps: 1
        - to: Table
          jumps_down: 1
      exits:
        - to: Below Gate
          req: ^_door_open
          movement: base
    - name: Building Entry
      coord: [14.1, 15.5]
      local:
        - to: Staircase Bottom
        - to: Save Point
          jumps_down: 1
        - to: Table
          jumps_down: 1
        - to: Kari
      exits:
        - to: Interior > Outpost Interior > Entry
          tags: [interior]
    - name: Staircase Top
      coord: [13.35, 14.75]
      local:
        - to: Staircase Bottom
          jumps_down: 2
        - to: Table
          jumps_down: 4
        - to: Save Point
          jumps_down: 3
        - to: Building Entry
        - to: West Grate
      exits:
        - to: Left Pillar
          req: $hook or $grab
          movement: base
          jumps: 5
          penalties:
            - when: not $hook
              jumps: 2
    - name: West Grate
      coord: [13.15, 14.75]
      local:
        - to: Staircase Top
      exits:
        - to: West 15
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: West 15
      coord: [13.05, 14.75]
      exits:
        - to: West Grate
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Helipad > East 15
          tags: [xshift]
    - name: Staircase Bottom
      coord: [13.2, 15.7]
      local:
        - to: Staircase Top
          jumps: 5
        - to: Save Point
          jumps_down: 1
        - to: West 16
        - to: Building Entry
          jumps: 1
    - name: Table
      coord: [13.7, 15.95]
      local:
        - to: Kari
          thru: [14, 15.9]
          jumps: [1, 2]
        - to: Building Entry
          thru: [14, 15.9]
          jumps: [1, 2]
        - to: Save Point
          jumps: 1
      locations:
        - name: News
          item: Researchers_Missing
          tags: [standing]
    - name: Save Point
      coord: [13.5, 15.8]
      local:
        - to: Staircase Bottom
          jumps: 1
        - to: Building Entry
          jumps: 2
        - to: Table
        - to: West 16
      actions:
        - name: Save
          do: $save
          time: 1.3
    - name: West 16
      coord: [13.05, 15.85]
      local:
        - to: Staircase Bottom
          jumps: 1
        - to: Save Point
          jumps: 1
      exits:
        - to: Helipad > East 16
          tags: [xshift]

    - name: East 17
      coord: [14.95, 16.6]
      local:
        - to: Lower Fork
          jumps: 2
      exits:
        - to: Hard Rock > West 17
          tags: [xshift]
    - name: Lower Fork
      coord: [14.75, 16.3]
      local:
        - to: East 17
        - to: Switch Distance 4
      exits:
        - to: Below Gate
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: Below Gate
      coord: [14.55, 16.05]
      local:
        - to: Lower Fork
      exits:
        - to: Kari
          req: ^_door_open and ($hook or ($grab and $climb))
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 4
        - to: Middle Platform
          req: ^_door_open and ($hook or ($grab and $climb))
          movement: base
          jumps: 6
          penalties:
            - when: not $hook
              jumps: 6
    - name: Switch Distance 1
      coord: [14.05, 16.65]
      local:
        - to: Switch Distance 2
      actions:
        - name: Open Door
          req: $open
          do: ^_door_open = true
          tags: [hack]
    - name: Switch Distance 2
      coord: [14.1, 16.7]
      local:
        - to: Switch Distance 1
          jumps: 1
        - to: Switch Distance 3
      actions:
        - name: Open Door
          req: $open and $range1
          do: ^_door_open = true
          tags: [hack]
    - name: Switch Distance 3
      coord: [14.15, 16.7]
      local:
        - to: Switch Distance 2
        - to: Switch Distance 4
      actions:
        - name: Open Door
          req: $open and $range2
          do: ^_door_open = true
          tags: [hack]
    - name: Switch Distance 4
      coord: [14.2, 16.7]
      local:
        - to: Switch Distance 3
        - to: Lower Fork
          jumps: 4
      actions:
        - name: Open Door
          req: $open and $range3
          do: ^_door_open = true
          tags: [hack]

- name: Ruins East  # MARK: Ruins East
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [16, 5, 17, 6]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Giguna Highest Flask
  spots:
    - name: East 9
      coord: [16.95, 8.8]
      local:
        - to: Bottom Rock
          jumps: 2
      exits:
        - to: Giguna Northeast > West 9
          tags: [xshift]
    - name: Bottom Rock
      coord: [16.3, 8.5]
      data:
        flipside: Giguna Breach > Ascent > Bottom
      local:
        - to: East 9
        - to: West 9
      exits:
        - to: Cliff
          req: $hook
          time: 3.45
    - name: West 9
      coord: [16.05, 8.6]
      local:
        - to: Bottom Rock
          jumps: 1
      exits:
        - to: Ruins Center > East 9
          tags: [xshift]
    - name: Cliff
      coord: [16.6, 7.6]
      local:
        - to: Bottom Rock
        - to: East 9
        - to: West 9
          thru: [16.2, 7.7]
      exits:
        - to: Ledge
          movement: base
          jumps: 0.5
          penalties:
            - when: not $hook
              jumps: 0.5
    - name: Ledge
      coord: [16.55, 7.4]
      local:
        - to: Cliff
      exits:
        - to: Small Passage
          req: ^mode == 'drone'
          time: 0.35
        - to: Pillar
          req: $grab and $climb
          movement: base
          jumps: 7
    - name: Small Passage
      coord: [16.45, 7.4]
      local:
        - to: West 8
      exits:
        - to: Ledge
          req: ^mode == 'drone'
          time: 0.35
    - name: West 8
      coord: [16.05, 7.5]
      local:
        - to: Small Passage
          jumps: 1
      exits:
        - to: Ruins Center > East 8
          tags: [xshift]
    - name: Pillar
      coord: [16.25, 6.4]
      local:
        - to: West 7
        - to: Ledge
      exits:
        - to: Way Up High
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: West 7
      coord: [16.05, 6.8]
      exits:
        - to: Ruins Top > East 7
          tags: [xshift]
        - to: Pillar
          req: $grab and $climb
          movement: base
          jumps: 3
    - name: Way Up High
      coord: [16.55, 5.45]
      local:
        - to: Pillar
        - to: Cliff
        - to: East 9
      locations:
        - name: Item
          canon: Giguna_Highest_Flask
          item: Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Giguna_Highest_Flask
          item: Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Giguna_Highest_Flask
          item: Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
        - name: Shockwave Flask
          canon: Giguna_Highest_Flask
          item: Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
      exits:
        - to: Ruins Top > Rooftop Gutter
          req: $hover
          movement: base
          penalty_tags: [xshift, -base.1]

- name: Ruins Center  # MARK: Ruins Center
  on_entry: $reset_old_area(^newpos)
  map:
    tablet: [15, 7, 16, 8]
  datamap:
    map_spot:
      tablet: Menu > Kiengir Map > A'ansur
  spots:
    - name: East 8
      coord: [15.95, 7.5]
      local:
        - to: Tablet
      exits:
        - to: Ruins East > West 8
          tags: [xshift]
    - name: Tablet
      coord: [15.8, 7.5]
      local:
        - to: East 8
      locations:
        - name: Item
          item: Aansur
          tags: [standing]
    - name: East 9
      coord: [15.95, 8.6]
      local:
        - to: Wall Bottom
          jumps: 1
      exits:
        - to: Ruins East > West 9
          tags: [xshift]
    - name: Wall Bottom
      coord: [15.2, 8.4]
      local:
        - to: East 9
          jumps: 1
      exits:
        - to: Wall Top
          req: $climb
          movement: base
          jumps: 2
    - name: Wall Top
      coord: [15.2, 8.15]
      local:
        - to: Wall Bottom
          jumps_down: 1
        - to: East 9
      exits:
        - to: Center Top
          req: $grab
          time: 1.5
    - name: Center Top
      coord: [15.1, 7.7]
      local:
        - to: West Platform Right
    - name: West Platform Right
      coord: [14.8, 8.15]
      local:
        - to: West Platform Left
      # exit?
    - name: West Platform Left
      coord: [14.4, 8.15]
      local:
        - to: West Platform Right
        - to: West 9
          jumps_down: 1
    - name: West 9
      coord: [14.05, 8.6]
      # todo: connection to West Platform Left?
      exits:
        - to: Ruins West > East 9
          tags: [xshift]

- name: Ruins West  # MARK: Ruins West
  on_entry: $reset_old_area(^newpos)
  reset:
    _kishib_handled: false
  map:
    save: [13, 8, 14, 9]
  data:
    save_point: Save Point
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Giguna Ruins West
  spots:
    - name: East 9
      coord: [13.95, 8.6]
      local:
        - to: Save Point
        - to: Platform
          jumps: 1
      exits:
        - to: Ruins Center > West 9
          tags: [xshift]
    - name: Save Point
      coord: [13.5, 8.7]
      local:
        - to: Platform
          jumps: 2
        - to: East 9
          jumps: 1
      actions:
        - name: Save
          do: $save
          tags: [save]
    - name: Platform
      coord: [13.5, 8.35]
      data:
        flipside: Giguna Breach > Chimney > Middle Platform
      local:
        - to: Save Point
          jumps_down: 2
        - to: East 9
        - to: Nook
          jumps: 2
    - name: Nook
      coord: [13.4, 8.0]
      local:
        - to: Platform
      exits:
        - to: Lower Ledge
          req: $grab and $climb
          time: 2.35
    - name: Lower Ledge
      coord: [13.4, 7.4]
      local:
        - to: Nook
        - to: Platform
      exits:
        - to: Upper Ledge
          req: $grab and ^_kishib_handled
          time: 4
      actions:
        - name: Hack/Destroy Kishib
          req: not ^_kishib_handled and ($allegiance1 or $shockwave)
          price: 100
          do: ^_kishib_handled = true
          tags: [hack]
          penalties:
            - when: not $allegiance1
              tags: [shockwave, -hack]
    - name: Upper Ledge
      coord: [13.6, 6.35]
      data:
        flipside: Giguna Breach > Chimney > Top
      local:
        - to: Lower Ledge
        - to: Platform
        - to: East 7
    - name: East 7
      coord: [13.95, 6.7]
      exits:
        - to: Upper Ledge
          req: $grab
          time: 1.2
        - to: Ruins Top > West 7
          tags: [xshift]
    
    - name: Rooftop East Edge
      coord: [13.6, 5.65]
      local:
        - to: Rooftop West Edge
          jumps: 1
        # I mean... we *could* jump back down, but why?
    - name: Rooftop West Edge
      coord: [13.3, 5.45]
      local:
        - to: West 7
    - name: West 7
      coord: [13.05, 6.3]
      exits:
        - to: West Tower > East 7
          tags: [xshift]

- name: Ruins Top  # MARK: Ruins Top
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal
    save_point: Save Point
  map:
    save: [14, 5, 15, 6]
    flask: [15, 5, 16, 6]
    portal: [15, 6, 16, 7]
    sw: [14, 6, 15, 7]
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Giguna Ruins Top
      flask: Menu > Kiengir Map > Giguna Ruins Top Flask
      portal: Menu > Kiengir Map > Giguna Ruins Top Portal
      sw: Menu > Kiengir Map > Giguna Ruins Top SW
  start:
    _doors_open: false
  spots:
    - name: West 7
      coord: [14.05, 6.7]
      exits:
        - to: Ruins West > East 7
          tags: [xshift]
        - to: West Door
          req: ^_doors_open
          movement: base
          jumps: 1
        - to: West Pillar
          req: $grab or $climb
          time: 2.25
    - name: West Door
      coord: [14.275, 6.55]
      exits:
        - to: West 7
          req: ^_doors_open
          movement: base
        - to: Entryway
          req: ^_doors_open
          movement: base
    - name: West Pillar
      coord: [14.3, 6.0]
      local:
        - to: West 7
        - to: Entryway
    - name: Entryway
      coord: [14.45, 6.75]
      local:
        - to: Portal Left
      exits:
        - to: West Door
          req: ^_doors_open
          movement: base
          jumps: 2
    - name: Portal Left
      coord: [15.3, 6.8]
      local:
        - to: Entryway
          jumps: 1
        - to: Portal
          jumps: 1
      exits:
        - to: Small Ledge
          req: $grab or $hook
          time: 1.0
    - name: Small Ledge
      coord: [15.25, 6.5]
      local:
        - to: Portal Left
        - to: Portal
      locations:
        - name: Shockwave Flask
          item: Flask
          canon: Giguna_Top_Flask
          tags: [shockwave]
          time: 4.0
      exits:
        - to: Interior Ledge
          req: $hook
          time: 1.5  # ?
    - name: Portal
      coord: [15.475, 6.6]
      data:
        flipside: Giguna Breach > Peak > Save Point
      local:
        - to: Portal Left
        - to: Small Ledge
          jumps: 1
      exits:
        - to: Interior Ledge
          req: $hook
          time: 1.5  # ?
        - to: East Door
          req: ^_doors_open
          movement: base
    - name: Interior Ledge
      coord: [15.65, 6.2]
      exits:
        - to: Portal
          req: ^mode == 'drone'
          time: 0.8
        - to: Upper Tunnel
          req: $grab or $hook
          time: 1.0  # ?
    - name: Upper Tunnel
      coord: [15.5, 5.8]
      local:
        - to: Interior Ledge
        - to: Flask
      # boomerang remote flask?
    - name: Flask
      coord: [15.3, 5.95]
      local:
        - to: Upper Tunnel
          jumps: 1
      locations:
        - name: Flask
          item: Flask
          canon: Giguna_Top_Flask
          tags: [flask]
    - name: East Door
      coord: [15.725, 6.75]
      exits:
        - to: Portal
          req: ^_doors_open
          movement: base
          jumps: 1
        - to: East 7
          req: ^_doors_open
          movement: base
    - name: East 7
      coord: [15.95, 6.8]
      exits:
        - to: East Door
          req: ^_doors_open
          movement: base
          jumps: 1
        - to: Ruins East > West 7
          tags: [xshift]
    
    # post-breach
    - name: Save Point
      coord: [14.8, 5.8]
      data:
        flipside: Giguna Breach > Peak > Portal
      exits:
        - to: Switch
          movement: fast_hover
          jumps: 1
          penalties:
            - when: not $hook
              movement: base
      actions:
        - name: Save
          do: $save
          tags: [save]
      # TODO: move through the small passage with the drone
    - name: Switch
      coord: [14.95, 5.6]
      local:
        - to: Save Point
      actions:
        - name: Open Doors
          req: $open
          do: ^_doors_open = true
          tags: [hack]
      exits:
        - to: Rooftop West
          req: $hook or $grab
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Turret Balcony East
          req: $hook or $grab
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 2
    - name: Rooftop West
      coord: [15.1, 5.2]
      local:
        - to: Switch
        - to: Rooftop East
      exits:
        - to: Turret Balcony East
          req: $grab
          movement: base
          jumps: 2
        - to: Rooftop Gutter
          req: $hookhover
          movement: fast_hover
        - to: Ruins East > Way Up High
          req: $hookhover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
        - to: Ruins East > Ledge
          req: $hookhover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: Rooftop East
      coord: [15.6, 5.2]
      local:
        - to: Rooftop West
        - to: Rooftop Gutter
      exits:
        - to: Ruins East > Way Up High
          req: $hover
          movement: base
          penalty_tags: [xshift, -base.1]
        - to: Ruins East > Way Up High
          req: Nanite_Mist
          movement: mist2
          penalty_tags: [xshift, -base.1]
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
              tags: [base.1, -base.2]
    - name: Rooftop Gutter
      coord: [15.825, 5.55]
      local:
        - to: Rooftop East
          jumps: 2
        - to: East 7
      exits:
        - to: Ruins East > Way Up High
          req: $hover
          movement: base
          jumps: 1
          penalty_tags: [xshift, -base.1]
        - to: Ruins East > Pillar
          movement: base
          penalty_tags: [xshift, -base.1]
    - name: Turret Balcony East
      coord: [14.8, 5.2]
      local:
        - to: Turret Balcony West
        - to: Switch
      exits:
        - to: Rooftop West
          req: $grab
          movement: base
          jumps: 2
    - name: Turret Balcony West
      coord: [14.35, 5.2]
      local:
        - to: West Pillar
        - to: Entryway
        - to: West 7
      actions:
        - name: Throw Drone onto Tower
          req: $grab and $can_deploy
          do: $deploy_drone_and_move(`Giguna > Ruins Top > West 7`)
          to: Giguna > Ruins West > Rooftop East Edge
          time: 3.8
          tags: [xshift]
    
- name: West Tower  # MARK: West Tower
  on_entry: $reset_old_area(^newpos)
  map:
    top: [12, 7, 13, 8]
  datamap:
    map_spot:
      top: Menu > Kiengir Map > The Ideal Kiengir
  spots:
    - name: East 7
      coord: [12.95, 6.3]
      local:
        - to: Top
    - name: Top
      coord: [12.6, 7.2]
      local:
        - to: Southwest
          thru: [12.4, 7.25]
      locations:
        - name: Tablet
          item: The_Ideal_Kiengir
          tags: [standing]
    - name: Southwest
      coord: [12.2, 8.9]
      exits:
        - to: West Caverns > Northwest
          tags: [yshift]

- name: Far Corner  # MARK: Far Corner
  on_entry: $reset_old_area(^newpos)
  data:
    map_spot: Menu > Kiengir Map > Giguna Far Corner
  spots:
    - name: East 13
      coord: [11.95, 12.3]
      local:
        - to: Grass
    - name: Grass
      coord: [11.55, 12.9]
      local:
        - to: South
      locations:
        - name: Obscured Item
          item: Flask
          tags: [flask]
    - name: South
      coord: [11.4, 12.9]  # TODO: yshifts should be at .95/.05 as well!
      exits:
        - to: Helipad > North
          tags: [yfade]

- name: Helipad  # MARK: Helipad
  on_entry: $reset_old_area(^newpos)
  map:
    journal: [11, 16, 12, 17]
  datamap:
    map_spot:
      journal: Menu > Kiengir Map > Journal 10/29/2049
  spots:
    - name: East 15
      coord: [12.95, 14.75]
      local:
        - to: Helicopter
          jumps: 2
      exits:
        - to: Giguna Base > West 15
          tags: [xshift]
    - name: North
      coord: [11.4, 13.1]
      local:
        - to: Helicopter
        - to: Wall Top
        - to: Irikar Drop
    - name: Helicopter
      coord: [11.7, 14.65]
      local:
        - to: East 15
        - to: Wall Top
        - to: Irikar Drop
    - name: East 16
      coord: [12.95, 15.85]
      local:
        - to: Railing
      exits:
        - to: Giguna Base > West 16
          tags: [xshift]
    - name: Irikar Drop
      coord: [11.1, 15.5]
      local:
        - to: So Close!
        - to: South Left
        - to: South Middle
        - to: South Right
        - to: Wall Top
          jumps: 1
    - name: Wall Top
      coord: [11.8, 15.45]
      local:
        - to: Wall Bottom
        - to: Staircase Top
        - to: Irikar Drop
      exits:
        - to: Railing
          req: $hover
          movement: base
    - name: Railing
      coord: [12.5, 15.85]
      local:
        - to: East 16
        - to: Wall Bottom
        - to: Staircase Top
          jumps_down: 1
        - to: East 18
          thru: [12.55, 16.45]
          jumps_down: [1, 0]
      exits:
        - to: Wall Top
          req: $hookhover
          movement: base
          jumps: 2
        - to: Wall Top
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Wall Bottom
      coord: [11.9, 16.7]
      local:
        - to: Staircase Top
        # TODO: balloon boost
    - name: So Close!
      coord: [11.4, 16.65]
      local:
        - to: South Right
      exits:
        - to: Tablet Ledge
          req: $hover
          movement: base
        - to: Tablet Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Tablet Ledge
      coord: [11.5, 16.7]
      local:
        - to: South Middle
        - to: South Right
      locations:
        - name: Tablet
          item: Journal_2049_10_29
          tags: [standing]
    - name: Staircase Top
      coord: [12.45, 16.7]
      local:
        - to: Wall Bottom
        - to: East 18
    - name: East 18
      coord: [12.95, 17.4]
      local:
        - to: Staircase Top
          jumps: 4
      exits:
        - to: Lamassu > West 18
          tags: [xshift]
    - name: South Left
      coord: [11.1, 17.9]
      exits:
        - to: Clouds > North Left
          tags: [yshift]
    - name: South Middle
      coord: [11.3, 17.9]
      exits:
        - to: Clouds > North Middle
          tags: [yshift]
    - name: South Right
      coord: [11.75, 17.9]
      exits:
        - to: Clouds > North Right
          tags: [yshift]
    - name: Lowest Ledge
      coord: [12.3, 17.9]
      exits:
        - to: Clouds > North Under Ledge
          tags: [yshift]

- name: Clouds  # MARK: Clouds
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [12, 18, 13, 19]
  data:
    portal_start: Cache
    portal_hidden: true
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Giguna Clouds Flask
  reset:
    _platform: false
  spots:
    - name: North Left
      coord: [11.1, 18.1]
      local:
        - to: Southwest
    - name: North Middle
      coord: [11.3, 18.1]
      local:
        - to: Southwest
        - to: Platform Start
    - name: North Right
      coord: [11.75, 18.1]
      local:
        - to: Pull Right
    - name: North Under Ledge
      coord: [12.3, 18.1]
    - name: Platform Start
      coord: [11.3, 19.5]
      local:
        - to: Straight Down
      actions:
        - name: Hack and Ride to Portal
          req: not ^_platform and $activate and $attract and Breach_Sight and Remote_Drone
          do: ^_platform = true; if (^indra WITHIN ^position) { ^indra = `Giguna > Clouds > Platform Stop`; }; ^portal = `Giguna > Clouds > Platform Stop`;
          to: Platform Stop
          time: 12  # estimate includes changing active item twice
        - name: Hack, Deploy, Ride to Portal
          req: not ^_platform and $activate and $can_deploy and $attract and Breach_Sight
          do: ^_platform = true; ^portal = `Giguna > Clouds > Platform Stop`; $deploy_drone_and_move(`Giguna > Clouds > Platform Stop`)
          to: Platform Stop
          time: 12  # it's not really additional time
        # Early portal gives us about .5s savings, is that worth modeling?
        # early platform exit to jump to the Irikar Hub Sat Tower
        - name: Hack and Maybe Get Off Early
          req: not ^_platform and $activate
          do: ^_platform = true
          to: Platform Early
          movement: platform

    - name: Platform Early
      coord: [12.5, 19.5]
      local:
        - to: Pull Right
        - to: Southeast
      actions:
        - name: Continue to Early Portal
          req: ^_platform and $attract and Breach_Sight and Remote_Drone
          do: if (^indra WITHIN ^position) { ^indra = `Giguna > Clouds > Platform Early Portal`; }; ^portal = `Giguna > Clouds > Platform Early Portal`;
          to: Platform Early Portal
          movement: platform
        - name: Deploy and Continue to Early Portal
          req: ^_platform and $attract and $can_deploy and Breach_Sight
          # Indra will continue on to the final stop
          do: ^portal = `Giguna > Clouds > Platform Early Portal`; $deploy_drone_and_move(`Giguna > Clouds > Platform Stop`)
          to: Platform Early Portal
          movement: platform
    - name: Platform Stop
      coord: [12.5, 18.7]
      data:
        flipside: Giguna Breach > Pink Clouds > Normal Entry
      local:
        - to: Pull Right
        - to: Southeast
      
    - name: Cache
      coord: [12.9, 18.3]
      data:
        flipside: Giguna Breach > Pink Clouds > Corner
      locations:
        - name: Item
          canon: Giguna_Clouds_Flask
          item: Big_Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Giguna_Clouds_Flask
          item: Big_Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Giguna_Clouds_Flask
          item: Big_Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
        - name: Shockwave Flask
          canon: Giguna_Clouds_Flask
          item: Big_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
    - name: Platform Early Portal
      coord: [12.5, 18.85]
      data:
        flipside: Giguna Breach > Pink Clouds > Quick Entry
    - name: Southwest
      coord: [11.0, 19.9]
      exits:
        - to: Irikar > Hub > Northwest
          tags: [yshift]
    - name: Straight Down
      coord: [11.3, 19.9]
      exits:
        - to: Irikar > Hub > North Above Portal
          tags: [yshift]
    - name: Pull Right
      coord: [12.25, 19.9]
      exits:
        - to: Irikar > Hub > Northwest Above Bowl
          tags: [yshift]
    - name: Southeast
      coord: [12.8, 19.9]
      exits:
        - to: Irikar > Hub > Northeast Above Bowl
          tags: [yshift]

- name: Lamassu  # MARK: Lamassu
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [15, 19, 16, 20]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Giguna Lamassu Flask
  spots:
    - name: West 18
      coord: [13.05, 17.4]
      local:
        - to: Staircase Top
      exits:
        - to: Helipad > East 18
          tags: [xshift]
    - name: Staircase Top
      coord: [13.45, 17.4]
      local:
        - to: West 18
        - to: Staircase Bottom
    - name: Staircase Bottom
      coord: [13.7, 17.8]
      local:
        - to: Staircase Top
          jumps: 2
        - to: Staircase Landing
        - to: Broken Pillar
        - to: Upper Platform Edge
    - name: Staircase Landing
      coord: [13.75, 18.05]
      local:
        - to: Staircase Bottom
          jumps: 2
        - to: Broken Pillar
        - to: Upper Platform Edge
    - name: Broken Pillar
      coord: [13.8, 18.3]
      local:
        - to: Upper Platform Edge
      exits:
        - to: Staircase Landing
          req: $grab
          movement: base
          jumps: 2
    - name: Upper Platform Edge
      coord: [14.15, 18.45]
      local:
        - to: Broken Pillar
          jumps: 1
        - to: Lower Platform Left
    - name: Lower Platform Left
      coord: [14.35, 18.7]
      local:
        - to: Lower Platform Right
      exits:
        - to: Upper Platform Edge
          req: $grab  # ?
          movement: base
          jumps: 2
    - name: Lower Platform Right
      coord: [14.6, 18.7]
      local:
        - to: Lower Platform Left
      exits:
        - to: Head
          req: $grab and $climb
          movement: base
          jumps: 3
    - name: Head
      coord: [14.9, 18.2]
      local:
        - to: Wingtip
          jumps: 1
        - to: Lower Platform Right
        - to: Lower Platform Left
    - name: Rear Platform
      coord: [15.5, 17.8]
      local:
        - to: Head
        - to: East 18  # or requires grab?
          jumps: 2
    - name: Wingtip
      coord: [15.7, 18.1]
      local:
        - to: Head
        - to: Deposit
        - to: Deposit Ledge
        - to: Rear Gap
          jumps: 1
    - name: Rear Gap
      coord: [15.8, 18.0]
      local:
        - to: Deposit Ledge
        - to: Wingtip
      exits:
        - to: East 18
          req: $grab
          movement: base
          jumps: 4
    - name: Deposit Ledge
      coord: [15.7, 19.2]
      local:
        - to: Deposit
        - to: Rear Gap
          jumps: 7
      locations:
        - name: Shockwave Flask
          canon: Giguna_Lamassu_Flask
          item: Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
      exits:
        - to: Wingtip
          movement: base
          jumps: 4
          penalties:
            - when: not $hook
              jumps: 2
    - name: Deposit
      coord: [15.65, 19.5]
      locations:
        - name: Flask
          canon: Giguna_Lamassu_Flask
          item: Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Giguna_Lamassu_Flask
          item: Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Giguna_Lamassu_Flask
          item: Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
      exits:
        - to: Deposit Ledge
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: East 18
      coord: [15.95, 17.5]
      local:
        - to: Rear Platform
        - to: Rear Gap
      exits:
        - to: Dual Path > West 18
          tags: [xshift]

- name: Dual Path  # MARK: Dual Path
  on_entry: $reset_old_area(^newpos)
  map:
    health: [17, 17, 18, 18]
  datamap:
    map_spot:
      health: Menu > Kiengir Map > Giguna Dual Path Health
  spots:
    - name: West 18
      coord: [16.05, 17.5]
      local:
        - to: Below Left Switch
      exits:
        - to: West Gate
          req: $hook or $grab
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Lamassu > East 18
          tags: [xshift]
    - name: Below Left Switch
      coord: [16.2, 17.7]
      local:
        - to: West 18
          jumps: 1
        - to: West Slope
        - to: Left Switch
          jumps: 1
      locations:
        - name: Remote Switch
          item: Giguna_Dual_Path_Switch
          canon: Giguna_Dual_Path_Switch
          req: $boomerang
          time: 0.5  # ?
    - name: Left Switch
      coord: [16.3, 17.5]
      local:
        - to: Below Left Switch
        - to: West Slope
      locations:
        - name: Hit Switch
          item: Giguna_Dual_Path_Switch
          canon: Giguna_Dual_Path_Switch
          req: $can_damage
          time: 0  # we don't exactly hang in the air
    - name: West Slope
      coord: [16.85, 17.7]
      local:
        - to: Below Left Switch
        - to: In the Grass
    - name: In the Grass
      coord: [17.7, 17.75]
      local:
        - to: West Slope
          jumps: 1
        - to: Base of Wall
      exits:
        - to: Wall Top
          req: $hook or ($grab and $climb)
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
    - name: Base of Wall
      coord: [17.85, 17.75]
      locations:
        - name: Break Wall
          item: Giguna_Dual_Path_Wall
          canon: Giguna_Dual_Path_Wall
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      local:
        - to: In the Grass
      exits:
        - to: Wall Top
          req: $hook or ($grab and $climb)
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Wall Secret
          req: ^mode == 'drone' and Giguna_Dual_Path_Wall
          movement: base
      hybrid:
        - name: Mist into Wall
          to: Wall Secret
          item: Giguna_Dual_Path_Wall
          canon: Giguna_Dual_Path_Wall
          req: ^mode == 'drone' and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
          tags: [event]
    - name: Wall Secret
      coord: [17.95, 17.75]
      locations:
        - name: Health
          item: Health_Fragment
      exits:
        - to: Base of Wall
          req: ^mode == 'drone'
          movement: base
    - name: Wall Top
      coord: [17.85, 17.25]
      local:
        - to: In the Grass
        - to: West Slope
        - to: Base of Wall
        - to: Below Right Switch
    - name: Right Switch
      coord: [18.1, 17.3]
      local:
        - to: Wall Top
          jumps: 2
        - to: Below Right Switch
      locations:
        - name: Hit Switch
          item: Giguna_Dual_Path_Switch
          canon: Giguna_Dual_Path_Switch
          req: $can_damage
          time: 0  # we don't exactly hang in the air
    - name: Below Right Switch
      coord: [18.15, 17.45]
      local:
        - to: Right Switch
          jumps: 1
        - to: Wall Top
          jumps: 2
        - to: East Gate
          jumps: 2
        - to: East 18
      locations:
        - name: Remote Switch
          item: Giguna_Dual_Path_Switch
          canon: Giguna_Dual_Path_Switch
          req: $boomerang
          time: 0.5  # ?
    - name: East Gate
      coord: [18.4, 17.3]
      local:
        - to: Below Right Switch
          jumps_down: 1
        - to: East 18
          jumps_down: 1
      exits:
        - to: East Gate NW
          req: Giguna_Dual_Path_Switch and ($hook or $grab or $climb)
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
    - name: East 18
      coord: [18.95, 17.65]
      local:
        - to: East Gate
          jumps: 2
        - to: Below Right Switch
          jumps: 2
      exits:
        - to: Gateway > West 18
          tags: [xshift]

    # Upper path
    - name: West Gate
      coord: [16.3, 17.2]
      local:
        - to: West 18
        - to: Below Left Switch
      exits:
        - to: West Gate NW
          req: Giguna_Dual_Path_Switch and ($hook or $climb)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: West Gate NE
          req: Giguna_Dual_Path_Switch and ($hook or $climb)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: West Gate NW
      coord: [16.2, 16.85]
      local:
        - to: West 17
        - to: West Gate NE
      exits:
        - to: West Gate
          req: Giguna_Dual_Path_Switch
          movement: base
    - name: West Gate NE
      coord: [16.4, 16.85]
      local:
        - to: West Gate NW
        - to: Midway
          jumps: 1
      exits:
        - to: West Gate
          req: Giguna_Dual_Path_Switch
          movement: base
    - name: West 17
      coord: [16.05, 16.85]
      local:
        - to: West Gate NW
      exits:
        - to: Hard Rock > East 17
          tags: [xshift]
    - name: Midway
      coord: [17.35, 16.8]
      local:
        - to: West Gate NE
          jumps: 1
      exits:
        - to: Midway Plateau
          req: $hook or $grab or $climb
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: Midway Plateau
      coord: [17.55, 16.5]
      local:
        - to: Midway
        - to: East Gate NW
    - name: East Gate NW
      coord: [18.25, 16.8]
      local:
        - to: Midway Plateau
          jumps: 2
      exits:
        - to: East Gate NE
          req: $hook
          time: 1  # ?
    - name: East Gate NE
      coord: [18.55, 16.45]
      local:
        - to: East Gate NW
        - to: East 17
      exits:
        - to: East Gate
          req: Giguna_Dual_Path_Switch
          movement: base
    - name: East 17
      coord: [18.95, 16.85]
      local:
        - to: East Gate NE
          jumps: 3
      exits:
        - to: East Caverns > West 17
          tags: [xshift]

- name: Hard Rock  # MARK: Hard Rock
  on_entry: $reset_old_area(^newpos)
  data:
    map_spot: Menu > Kiengir Map > Building of the School
  spots:
    - name: East 17
      coord: [15.95, 16.85]
      local:
        - to: Rock Right
      exits:
        - to: Dual Path > West 17
          tags: [xshift]
    - name: Rock Right
      coord: [15.7, 16.85]
      local:
        - to: East 17
      locations:
        - name: Shockwave Boulder
          item: Giguna_Boulder
          canon: Giguna_Boulder
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Rock Center
          req: Giguna_Boulder
          movement: base
      hybrid:
        - name: Enter Rock as Mist
          item: Giguna_Boulder
          canon: Giguna_Boulder
          to: Rock Center
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Rock Center
      coord: [15.55, 16.85]
      local:
        - to: Rock Left
        - to: Rock Right
      locations:
        - name: Tablet
          item: Building_of_the_School
          tags: [standing]
    - name: Rock Left
      coord: [15.4, 16.85]
      local:
        - to: West 17
          jumps: 2
      locations:
        - name: Shockwave Boulder
          item: Giguna_Boulder
          canon: Giguna_Boulder
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Rock Center
          req: Giguna_Boulder
          movement: base
      hybrid:
        - name: Enter Rock as Mist
          item: Giguna_Boulder
          canon: Giguna_Boulder
          to: Rock Center
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: West 17
      coord: [15.05, 16.6]
      local:
        - to: Rock Left
      exits:
        - to: Giguna Base > East 17
          tags: [xshift]

- name: East Caverns  # MARK: East Caverns
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [20, 15, 21, 16]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Giguna East Caverns Flask
  start:
    _door_opened: false
  load:
    _combo_entered: false
  reset:
    _upper_susar: false
    _mid_susar: false
    _lower_susar: false
  spots:
    - name: West 14
      coord: [19.05, 13.6]
      local:
        - to: Upper Platforms Left
        - to: Upper Floor
      exits:
        - to: Wasteland > East 14
          tags: [xshift]
      actions:
        - name: Enter Combo
          req: not ^_combo_entered
          do: ^_combo_entered = true
          tags: [combo]
    - name: Upper Platforms Left
      coord: [19.3, 13.65]
      local:
        - to: West 14
          jumps: 1
        - to: Upper Platforms Right
        - to: Upper Floor
    - name: Upper Platforms Right
      coord: [19.65, 13.8]
      local:
        - to: Upper Floor Ledge
        - to: Upper Susar
          jumps: 1
        - to: Upper Susar Mid-jump
          jumps: 1
        - to: Middle Ledge
      exits:
        - to: Upper Passage West
          req: $hook and $hover
          time: 1.5  # ?
        # mist movement is also possible
    - name: Upper Floor
      coord: [19.55, 13.9]
      local:
        - to: Upper Platforms Right
          jumps: 1
        - to: Upper Platforms Left
          jumps: 2
        - to: Upper Floor Ledge
      exits:
        - to: West 14
          req: $grab
          movement: base
          jumps: 3
        - to: Upper Passage West
          req: $hook and $hover
          time: 1  # ?
    - name: Upper Floor Ledge
      coord: [19.7, 14.0]
      local:
        - to: Upper Floor
          jumps: 1
        - to: Upper Platforms Right
          jumps: 1
        - to: Upper Susar
          jumps: 1
        - to: Middle Ledge
        - to: Midwest Ledge
    - name: Upper Susar
      coord: [19.875, 13.75]
      actions:
        - name: Caught
          req: not ^_upper_susar
          do: ^_upper_susar = true
          tags: [susar]
      exits:
        - to: Top Past Susar
          req: ^_upper_susar
          movement: base
          jumps: 1
        - to: Upper Floor Ledge
          req: ^_upper_susar
          movement: base
        - to: Upper Platforms Right
          req: ^_upper_susar
          movement: base
        - to: Middle Ledge
          req: ^_upper_susar
          movement: base
    - name: Upper Susar Mid-jump
      coord: [19.8, 13.6]
      local:
        - to: Upper Susar
      exits:
        - to: Top Past Susar
          req: ^_upper_susar
          movement: base
      actions:
        - name: Hack
          req: not ^_upper_susar and $allegiance1
          price: 100
          do: ^_upper_susar = true
          time: 0.5
    - name: Upper Susar Jump from East
      coord: [19.95, 13.5]
      local:
        - to: Upper Susar
      actions:
        - name: Hack
          req: not ^_upper_susar and $allegiance1
          price: 100
          do: ^_upper_susar = true
          tags: [hack]
        - name: Caught
          req: not ^_upper_susar
          do: ^_upper_susar = true
          tags: [susar]
      exits:
        - to: Middle Ledge
          req: ^_upper_susar
          movement: base
        - to: Midwest Ledge
          req: ^_upper_susar
          movement: base
    - name: Top Past Susar
      coord: [20.1, 13.65]
      local:
        - to: Upper Susar
        - to: Top Ledge
        - to: Upper Susar Jump from East
          jumps: 1
    - name: Top Ledge
      coord: [20.6, 13.65]
      local:
        - to: Top Past Susar
        - to: Upper Passage East
        - to: East Shaft

    - name: Upper Passage West
      coord: [20.0, 13.9]
      local:
        - to: Middle Ledge
        - to: Mid Susar
      exits:
        - to: Upper Passage East
          req: ^mode == 'drone'
          movement: base
    - name: Upper Passage East
      coord: [20.6, 13.9]
      local:
        - to: East Shaft
      exits:
        - to: Top Ledge
          req: $hook or ($grab and $climb)
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Upper Passage West
          req: ^mode == 'drone'
          movement: base
    - name: East Shaft
      coord: [20.8, 14.3]
      local:
        - to: Upper Passage East
          jumps: 2
        - to: East Side
    - name: East Side
      coord: [20.7, 14.7]
      local:
        - to: Carving
      exits:
        - to: East Shaft
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Middle Rock
          req: $hook
          time: 1.5  # ?
    - name: Carving
      coord: [20.55, 15.0]
      local:
        - to: Arc Passage
      exits:
        - to: Middle Rock
          req: $hook or ($grab and $climb)
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: East Side
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Hidden Passage East
          req: ^mode == 'drone' and ^_combo_entered
          movement: base
      actions:
        - name: Enter Combo
          req: not ^_combo_entered
          do: ^_combo_entered = true
          tags: [combo]

    - name: Middle Ledge
      coord: [19.85, 14.25]
      local:
        - to: Mid Susar
        - to: Midwest Ledge
      exits:
        - to: Upper Passage West
          req: $hook
          time: 0.5  # ?
        - to: Upper Floor Ledge
          req: $hook or $grab
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: Mid Susar
      coord: [20.1, 14.4]
      exits:
        - to: Middle Ledge
          req: ^_mid_susar and ($hook or $grab)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Middle Rock
          req: ^_mid_susar
          movement: base
      actions:
        - name: Hack
          req: not ^_mid_susar and $allegiance1
          price: 100
          do: ^_mid_susar = true
          tags: [hack]
        - name: Caught
          req: not ^_mid_susar
          do: ^_mid_susar = true
          tags: [susar]
    - name: Middle Rock
      coord: [20.35, 14.6]
      local:
        - to: Mid Susar
          jumps: 1
        - to: Carving
        - to: Arc Passage
      exits:
        - to: Hidden Passage East
          req: ^mode == 'drone' and ^_combo_entered
          movement: base

    - name: Hidden Passage East
      coord: [20.35, 15.05]
      local:
        - to: Carving
          jumps: 1
        - to: Arc Passage
      exits:
        - to: Hidden Passage Center
          req: ^mode == 'drone'
          movement: base
    - name: Hidden Passage Center
      coord: [20.0, 15.05]
      locations:
        - name: Hidden Flask
          canon: Giguna_East_Ruins_Flask
          item: Flask
          req: ^mode == 'drone'
          tags: [flask]
        - name: Flask Collection Skip
          canon: Giguna_East_Ruins_Flask
          item: Flask
          req: ^mode == 'drone'
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Giguna_East_Ruins_Flask
          item: Flask
          req: ^mode == 'drone' and Fast_Travel
          to: ^map_spot
          tags: [cskip]
      exits:
        - to: Hidden Passage West
          req: ^mode == 'drone'
          movement: base
        - to: Hidden Passage East
          req: ^mode == 'drone'
          movement: base
    - name: Hidden Passage West
      coord: [19.75, 15.05]
      local:
        - to: Lower Ledge
        - to: Arc Ledge
      exits:
        - to: Hidden Passage Center
          req: ^mode == 'drone'
          movement: base
        - to: Statues Ledge
          req: $hook or $hover
          movement: base
    - name: Midwest Ledge
      coord: [19.65, 14.9]
      local:
        - to: Lower Ledge
        - to: Arc Ledge
        - to: Statues Ledge
        - to: Middle Ledge
          thru: [19.6, 20.3]
          jumps: [4, 1]
      exits:
        - to: Middle Ledge
          req: $grab
          movement: base
          jumps: 6
        - to: Hidden Passage West
          req: $hover and $hook and ^_combo_entered
          time: 1.75  # ?
        - to: Hidden Passage West
          req: ^mode == 'drone' and Nanite_Mist and ^_combo_entered
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1

    - name: Statues Ledge
      coord: [19.5, 15.5]
      local:
        - to: Switch
        - to: Lower Ledge
      exits:
        - to: Midwest Ledge
          req: $hook or $grab
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 2
        - to: Hidden Passage West
          req: $hover and $hook and ^_combo_entered
          movement: base
          jumps: 1
        - to: Hidden Passage West
          req: ^mode == 'drone' and Nanite_Mist and ^_combo_entered
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
      actions:
        - name: Open Door
          req: not ^_door_opened and $unlock2 and $range1
          do: ^_door_opened = true
          tags: [hack]
        - name: Enter Combo
          req: not ^_combo_entered
          do: ^_combo_entered = true
          tags: [combo]

    - name: Switch
      coord: [19.3, 15.5]
      local:
        - to: Statues Ledge
      exits:
        - to: Door
          req: ^_door_opened
          movement: base
      actions:
        - name: Open Door
          req: not ^_door_opened and $unlock2
          do: ^_door_opened = true
          tags: [hack]
    - name: Door
      coord: [19.125, 15.5]
      local:
        - to: Switch
        - to: West 16
          jumps: 1
    - name: West 16
      coord: [19.05, 15.45]
      exits:
        - to: Door
          req: ^_door_opened
          movement: base
        - to: Antechamber > East 16
          tags: [xshift]
      actions:
        - name: Open Door
          req: not ^_door_opened and $open and $range2
          do: ^_door_opened = true
          tags: [hack]

    - name: Arc Ledge
      coord: [19.8, 15.7]
      local:
        - to: Lower Ledge
        - to: Arc Passage
          jumps: 3
      exits:
        - to: Statues Ledge
          req: $hook
          time: 1  # ?
        - to: Hidden Passage West
          req: ^mode == 'drone' and Nanite_Mist and ^_combo_entered
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Arc Passage
      coord: [20.4, 15.6]
      local:
        - to: Arc Ledge
          jumps: 3
        - to: Carving
          jumps: 3
      exits:
        - to: Hidden Passage West
          req: ^mode == 'drone' and ^_combo_entered
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
      actions:
        - name: Enter Combo
          req: not ^_combo_entered
          do: ^_combo_entered = true
          tags: [combo]
    - name: Lower Ledge
      coord: [19.55, 16.25]
      local:
        - to: West 17
        - to: West Grass
        - to: Under Lower Ledge
          thru: [19.5, 16.5]
      exits:
        - to: Arc Ledge
          req: $hook or $grab
          movement: base
          jumps: 3
          penalties:
            - when: not $hook
              jumps: 1

    - name: West 17
      coord: [19.05, 16.85]
      local:
        - to: West Grass
          jumps: 1
      exits:
        - to: Dual Path > East 17
          tags: [xshift]
    - name: West Grass
      coord: [19.4, 16.8]
      local:
        - to: West 17
        - to: Under Lower Ledge
      exits:
        - to: Lower Ledge
          req: $hook and $hover
          time: 2  # ?
    - name: Under Lower Ledge
      coord: [19.6, 16.8]
      local:
        - to: West Grass
        - to: Lower Susar
          jumps: 2
    - name: Lower Susar
      coord: [20.1, 16.5]
      exits:
        - to: Under Lower Ledge
          req: ^_lower_susar
          movement: base
        - to: East Grass
          req: ^_lower_susar
          movement: base
      actions:
        - name: Hack
          req: not ^_lower_susar and $allegiance1
          price: 100
          do: ^_lower_susar = true
          tags: [hack]
        - name: Caught
          req: not ^_lower_susar
          do: ^_lower_susar = true
          tags: [susar]
    - name: East Grass
      coord: [20.45, 16.7]
      local:
        - to: Lower Susar
          jumps: 1
      exits:
        - to: East 17
          req: $hook
          time: 1.5  # ?
    - name: East 17
      coord: [20.95, 16.3]
      local:
        - to: East Grass
      exits:
        - to: Vertical Interchange > West 17

- name: Gateway  # MARK: Gateway
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [20, 17, 21, 18]
    block: [20, 18, 21, 19]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Giguna Gateway Flask
      block: Menu > Kiengir Map > Giguna Gateway Block
  reset:
    _door_opened: false
  spots:
    - name: West 18
      coord: [19.05, 17.65]
      local:
        - to: Passage Entry
      exits:
        - to: Dual Path > East 18
    - name: Passage Entry
      coord: [19.3, 17.8]
      local:
        - to: West 18
          jumps: 1
      exits:
        - to: Passage Exit
          req: ^mode == 'drone'
          movement: base
        - to: Door
          req: ^_door_opened
          movement: base
          jumps: 2
    - name: Passage Exit
      coord: [19.75, 18.1]
      local:
        - to: Block Left
      exits:
        - to: Passage Entry
          req: ^mode == 'drone'
          movement: base
          jumps: 3
        - to: Left Platform
          req: $hook
          time: 1  # ?
    - name: Door
      coord: [19.6, 17.35]
      exits:
        - to: Passage Entry
          req: ^_door_opened
          movement: base
        - to: Block Left
          req: ^_door_opened
          movement: base
        - to: Left Platform
          req: ^_door_opened
          movement: base
    - name: Left Platform
      coord: [20.0, 17.7]
      local:
        - to: Passage Exit
          thru: [19.9, 17.7]
        - to: Block Left
          thru: [19.9, 17.7]
        - to: Block Right
        - to: Right Platform
          jumps: 1
        - to: Refill Station
      exits:
        - to: Block Lowered
          req: Giguna_Gateway_Block
          movement: base
        # TODO: slingshot+hover to the flask
    - name: Right Platform
      coord: [20.2, 17.65]
      local:
        - to: Left Platform
        - to: Block Right
        - to: Refill Station
      exits:
        - to: Far Ledge
          req: $hover or $hook
          movement: base
    - name: Block Left
      coord: [19.9, 18.2]
      local:
        - to: Passage Exit
          jumps: 1
        - to: Block Right
      locations:
        - name: Shockwave
          item: Giguna_Gateway_Block
          canon: Giguna_Gateway_Block
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Block Lowered
          req: Giguna_Gateway_Block
          movement: base
    - name: Block Right
      coord: [20.1, 18.2]
      local:
        - to: Block Left
        - to: Refill Station
          jumps: 1
      locations:
        - name: Shockwave
          item: Giguna_Gateway_Block
          canon: Giguna_Gateway_Block
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Block Lowered
          req: Giguna_Gateway_Block
          movement: base
    - name: Refill Station
      coord: [20.4, 18.15]
      local:
        - to: Block Right
      exits:
        - to: Far Ledge
          req: $hook
          movement: base
          jumps: 1
    - name: Far Ledge
      coord: [20.6, 17.8]
      data:
        flipside: Giguna Breach > Upper Machinery > Northeast Scaffold
      local:
        - to: Refill Station
        - to: Block Right
        - to: One Jump
          jumps: 1
      exits:
        - to: Flask Ledge
          req: $hook or ($grab and $climb)
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Right Platform
          req: $hook
          movement: base
          jumps: 1
        - to: Giguna > Dual Path > Below Right Switch
          req: $hookhover and ^_door_opened
          movement: fast_hover
          jumps: 2
          penalty_tags: [xshift, -fast_hover.1]
    - name: One Jump
      coord: [20.65, 17.7]
      local:
        - to: Far Ledge
      locations:
        - name: Shockwave Flask
          canon: Giguna_Gateway_Flask
          item: Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
      actions:
        - name: Open Door
          req: $open and $range2
          do: ^_door_opened = true
          tags: [hack]
    - name: Flask Ledge
      coord: [20.7, 17.45]
      local:
        - to: Far Ledge
        - to: Refill Station
        - to: Block Right
      locations:
        - name: Item
          canon: Giguna_Gateway_Flask
          item: Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Giguna_Gateway_Flask
          item: Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Giguna_Gateway_Flask
          item: Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
        # TODO: with boomerang?
      actions:
        - name: Open Door
          req: $open
          do: ^_door_opened = true
          tags: [hack]
    - name: Block Lowered
      coord: [20.0, 18.5]
      local:
        - to: West 19
        - to: Button
      exits:
        - to: Block Left
          req: Giguna_Gateway_Block and ($hook or $grab)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Block Right
          req: Giguna_Gateway_Block and ($hook or $grab)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: West 19
      coord: [19.05, 18.75]
      local:
        - to: Block Lowered
          jumps: 2
      exits:
        - to: Labyrinth East > East 19
          tags: [xshift]
    - name: Near Button
      coord: [20.5, 18.75]
      data:
        flipside: Giguna Breach > Upper Machinery > South
      local:
        - to: Button
          jumps: 1
        - to: Block Lowered
          jumps: 2
      exits:
        - to: West 19
          req: $hookhover
          movement: fast_hover
    - name: Button
      coord: [20.65, 18.65]
      local:
        - to: Block Lowered
          jumps: 2
      locations:
        - name: Hit Switch
          item: Giguna_Gateway_Gate
          req: $can_damage
          time: 0  # while moving to next spot
      exits:
        - to: East 19
          req: Giguna_Gateway_Gate
          movement: base
    - name: East 19
      coord: [20.95, 18.75]
      exits:
        - to: Button
          req: Giguna_Gateway_Gate
          movement: base
          jumps: 2
        - to: Vertical Interchange > West 19
          tags: [xshift]

- name: Labyrinth East  # MARK: Labyrinth East
  on_entry: $reset_old_area(^newpos)
  map:
    bottom: [18, 20, 19, 21]
  datamap:
    map_spot:
      bottom: Menu > Kiengir Map > Giguna Labyrinth Hole
  spots:
    - name: East 19
      coord: [18.95, 18.75]
      local:
        - to: Top Middle
      exits:
        - to: Gateway > West 19
          tags: [xshift]
    - name: Top Middle
      coord: [18.4, 19.1]
      local:
        - to: East 19
          jumps: 2
        - to: Top West
    - name: Top West
      coord: [18.05, 19.1]
      local:
        - to: Top Middle
      exits:
        - to: Labyrinth > Top East
          tags: [xshift]

    - name: Middle West
      coord: [18.05, 19.7]
      local:
        - to: Middle Drop
      exits:
        - to: Labyrinth > Middle East
          tags: [xshift]
    - name: Middle Drop
      coord: [18.5, 19.7]
      data:
        flipside: Giguna Breach > Labyrinth > Middle Tier Ledge
      local:
        - to: Middle West
        - to: Middle Tree
        - to: Lower Middle
    - name: Middle Tree
      coord: [18.6, 19.7]
      data:
        flipside: Giguna Breach > Labyrinth > Middle Tier Ledge East
      local:
        - to: Middle Drop
        - to: Lower Middle
        - to: East 20
    - name: East 20
      coord: [18.95, 20.0]
      local:
        - to: Middle Tree
          jumps: 3
      exits:
        - to: Mural > West 20
          tags: [xshift]

    - name: Lower Middle
      coord: [18.4, 20.1]
      data:
        flipside: Giguna Breach > Labyrinth > Lower Tier East
      local:
        - to: Lower West
      exits:
        - to: Middle Tree
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 2
        - to: Middle Drop
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 2
    - name: Lower West
      coord: [18.05, 20.1]
      local:
        - to: Lower Middle
      exits:
        - to: Labyrinth > Lower East
          tags: [xshift]

    - name: Hole
      coord: [18.8, 20.85]
      data:
        flipside: Giguna Breach > Labyrinth > Pipe Corner

- name: Labyrinth  # MARK: Labyrinth
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Stand
    save_point: Save Point
  map:
    save: [17, 21, 18, 22]
    portal: [16, 20, 17, 21]
    plinth: [16, 19, 17, 20]
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Giguna Labyrinth
      portal: Menu > Kiengir Map > Nano Lattice 1
      plinth: Menu > Kiengir Map > Giguna Labyrinth Empty Plinth
  start:
    _door: false
  spots:
    - name: Top East
      coord: [17.95, 19.1]
      local:
        - to: First Pillar
          jumps: 1
      exits:
        - to: Labyrinth East > Top West
          tags: [xshift]
    - name: First Pillar
      coord: [17.85, 18.9]
      local:
        - to: Top East
      exits:
        - to: Rooftop East
          req: $hook or $grab
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 2
            - when: not Drone_Hover
              jumps: 1
    - name: Rooftop East
      coord: [17.3, 18.5]
      local:
        - to: First Pillar
          jumps: 1
        - to: Rooftop Bush
          jumps: 1
    - name: Rooftop Bush
      coord: [17.1, 18.35]
      local:
        - to: Rooftop East
        - to: Rooftop West
    - name: Rooftop West
      coord: [16.95, 18.5]
      local:
        - to: Rooftop Bush
          jumps: 1
        - to: Upper Level Ledge
    - name: Upper Level Ledge
      coord: [16.6, 18.65]
      data:
        flipside: Giguna Breach > Labyrinth > Upper Tier West
      local:
        - to: Rooftop West
          jumps: 2
        - to: Empty Plinth
        - to: Second Tier Upper
          thru: [16.6, 18.9]

    - name: Empty Plinth
      coord: [16.525, 19.1]
      data:
        flipside: Giguna Breach > Labyrinth > Plinth
      local:
        - to: Second Tier Upper
      exits:
        - to: Upper Level Ledge
          req: $hook or $grab
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
    - name: Second Tier Upper
      coord: [16.85, 19.1]
      data:
        flipside: Giguna Breach > Labyrinth > Middle Tier Upper
      local:
        - to: Empty Plinth
        - to: Second Tier Lower
    - name: Second Tier Lower
      coord: [17.35, 19.45]
      local:
        - to: Second Tier Upper
          thru: [16.875, 19.3]
          jumps: [1, 1]
        - to: Middle East
      exits:
        - to: Second Tier Upper
          req: $hook and $hover
          movement: base
          jumps: 1
    - name: Middle East
      coord: [17.95, 19.7]
      local:
        - to: Second Tier Lower
          jumps: 3
      exits:
        - to: Labyrinth East > Middle West
          tags: [xshift]

    - name: Lower East
      coord: [17.95, 20.1]
      local:
        - to: Lower Tier West
          jumps: 4
      exits:
        - to: Labyrinth East > Lower West
          tags: [xshift]
    - name: Lower Tier West
      coord: [16.7, 19.65]
      data:
        flipside: Giguna Breach > Labyrinth > Lower Tier West
      local:
        - to: Lower East
        - to: Portal Stand
        - to: Middle Brick
    - name: Middle Brick
      coord: [16.6, 20.2]
      data:
        flipside: Giguna Breach > Labyrinth > Middle Brick
      local:
        - to: Portal Stand
      exits:
        - to: Lower Tier West
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Door
          req: ^_door
          movement: base
    - name: Portal Stand
      coord: [16.525, 20.7]
      data:
        flipside: Giguna Breach > Labyrinth > Save Point
      exits:
        - to: Middle Brick
          req: $hook or $grab
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Lower Tier West
          req: $hook
          movement: base
          jumps: 3
        - to: Door
          req: ^_door
          movement: base
    - name: Door
      coord: [16.8, 20.8]
      local:
        - to: Portal Stand
          jumps: 1
        - to: Door Ledge
      exits:
        - to: Middle Brick
          req: $hook
          movement: base
          jumps: 2
    - name: Door Ledge
      coord: [16.9, 20.8]
      local:
        - to: Switch Ledge
        - to: Rocky Stair
      locations:
        - name: Item
          item: Nano_Lattice_1
          tags: [standing]
      exits:
        - to: Door
          req: ^_door
          movement: base
      actions:
        - name: Open Door
          req: $open and $range2
          do: ^_door = true
          tags: [hack]
    - name: Switch Ledge
      coord: [17.1, 20.8]
      local:
        - to: Behind Switch
          jumps: 1
        - to: Door Ledge
        - to: Rocky Stair
      actions:
        - name: Open Door
          req: $open
          do: ^_door = true
          tags: [hack]
    - name: Behind Switch
      coord: [17.5, 20.75]
      local:
        - to: Switch Ledge
    
    - name: Rocky Stair
      coord: [17.05, 21.4]
      local:
        - to: Save Point
        - to: Save Ledge
        - to: East 23
      exits:
        - to: Door Ledge
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Switch Ledge
          req: $hook
          movement: base
          jumps: 2
        - to: Ledge 22
          req: $hook or $hover
          movement: base
          jumps: 1

    - name: Ledge 22
      coord: [17.55, 21.3]
      data:
        flipside: Giguna Breach > Lower Portal > West Ledge
      local:
        - to: East 22
          jumps: 1
        - to: Save Point
        - to: Save Ledge
      exits:
        - to: Rocky Stair
          req: $hover
          movement: base
    - name: East 22
      coord: [17.95, 21.2]
      local:
        - to: Ledge 22
      exits:
        - to: Cache > West
          tags: [xshift]
    - name: Save Point
      coord: [17.5, 21.75]
      data:
        flipside: Giguna Breach > Lower Portal > Portal Dais
      local:
        - to: Save Ledge
      exits:
        - to: Ledge 22
          req: $hook
          movement: base
          jumps: 1
        - to: Rocky Stair
          req: $hover
          movement: base
          jumps: 2
      actions:
        - name: Save
          do: $save
          tags: [save]
    - name: Save Ledge
      coord: [17.35, 21.9]
      local:
        - to: Save Point
          jumps: 1
        - to: Rocky Stair
          jumps: 3
        - to: East 23
          thru: [17.3, 22.0]
    - name: East 23
      coord: [17.95, 22.8]
      local:
        - to: Save Ledge
          thru: [17.3, 22.1]
          jumps: [4, 1]
        - to: Rocky Stair
          thru: [17.3, 22.1]
          jumps: [4, 3]
      exits:
        - to: Separator > West 23
          tags: [xshift]

- name: Cache  # MARK: Cache
  on_entry: $reset_old_area(^newpos)
  data:
    map_spot: Menu > Kiengir Map > Giguna Cache
  spots:
    - name: West
      coord: [18.05, 21.2]
      local:
        - to: Upper Ledge
      exits:
        - to: Labyrinth > East 22
          tags: [xshift]
    - name: Upper Ledge
      coord: [18.3, 21.2]
      data:
        flipside: Giguna Breach > Lower Portal > East Upper Ledge
      local:
        - to: Pit
        - to: West
    - name: Pit
      coord: [18.5, 21.9]
      data:
        flipside: Giguna Breach > Lower Portal > Bottom
      locations:
        - name: Item
          item: Health_Fragment
          tags: [standing]
      exits:
        - to: Upper Ledge
          req: $hook
          movement: base
          jumps: 2
        - to: Upper Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1

- name: Vertical Interchange  # MARK: Vertical Interchange
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [21, 19, 22, 20]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Giguna Vertical Interchange Flask
  spots:
    #region Upper
    - name: West 17
      coord: [21.05, 16.3]
      local:
        - to: Top Left Ledge
      exits:
        - to: East Caverns > East 17
          tags: [xshift]
    - name: North
      coord: [21.5, 16.2]
      local:
        - to: Top Right Ledge
        - to: Top Middle Ledge
      exits:
        - to: Ebih > Vertical Interchange > South
          tags: [ydoor]
    - name: Top Left Ledge
      coord: [21.25, 16.45]
      local:
        - to: Top Rocky Ledge
        - to: Top Middle Ledge
      exits:
        - to: Top Right Ledge
          req: $hook or $hover
          movement: fast_hover
          penalties:
            - when: not $hook
              movement: base
    - name: Top Right Ledge
      coord: [21.45, 16.45]
      local:
        - to: Top Middle Ledge
      exits:
        - to: North
          req: $hover or Anuman or $climb
          jumps: 1
          penalties:
            - when: $climb and not Anuman
              jumps: 1
            - when: $hover
              jumps: 2
        - to: Top Left Ledge
          req: $hook
          movement: fast_hover
        - to: East Caverns > East Grass
          req: $hookhover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: Top Middle Ledge
      coord: [21.35, 16.75]
      local:
        - to: Top Rocky Ledge
      exits:
        - to: Top Left Ledge
          req: $hook or Anuman or $hover
          movement: base
          jumps: 1
          penalties:
            - when: not $hook and not Anuman
              jumps: 2
        - to: Top Right Ledge
          req: $hook or Anuman or $hover
          movement: base
          jumps: 1
          penalties:
            - when: not $hook and not Anuman
              jumps: 2
        - to: North
          req: $hookhover
          movement: base
          jumps: 2
        - to: Ebih > Vertical Interchange > South
          req: Nanite_Mist
          movement: mist2
          penalty_tags: [ydoor, -mist2.4]
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
              tags: [mist2.4, -mist1.4]
        - to: East Caverns > East Grass
          req: $hookhover
          movement: fast_hover
          jumps: 2
          penalty_tags: [xshift, -fast_hover.1]
    - name: Top Rocky Ledge
      coord: [21.3, 17.6]
      local:
        - to: Top Rocky Outcrop
      exits:
        - to: Top Middle Ledge
          req: $hook or ($grab and Anuman)
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 2
        - to: Top Left Ledge
          req: $hook
          movement: base
          jumps: 3
    - name: Top Rocky Outcrop
      coord: [21.4, 18.0]
      local:
        - to: Top Passage Bottom
      exits:
        - to: Top Rocky Ledge
          req: $hook or ($grab and Anuman)
          movement: base
          jumps: 2
    - name: Top Passage Bottom
      coord: [21.35, 18.25]
      local:
        - to: West 19
          thru: [21.375, 18.5]
        - to: Middle Below Top
        - to: Middle Plateau
      exits:
        - to: Top Rocky Outcrop
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Ledge 19
          req: $hover
          movement: base
    #endregion

    #region Middle
    - name: Ledge 19
      coord: [21.65, 18.7]
      local:
        - to: West 19
        - to: Middle Below Top
        - to: Middle Plateau
          thru: [21.625, 19.0]
        - to: East 20
          thru: [21.625, 19.0]
          jumps_down: [0, 1]
      exits:
        - to: Top Passage Bottom
          req: $hook
          movement: base
          jumps: 2
    - name: West 19
      coord: [21.05, 18.75]
      local:
        - to: Middle Below Top
      exits:
        - to: Gateway > East 19
          tags: [xshift]
        - to: Ledge 19
          req: $hover
          movement: base
          jumps: 1
        - to: Top Passage Bottom
          req: $hookhover
          movement: base
          jumps: 3
    - name: Middle Below Top
      coord: [21.4, 19.1]
      local:
        - to: West 19
          jumps: 3
        - to: Middle Plateau
      exits:
        - to: Ledge 19
          req: $hook
          movement: base
          jumps: 2
        - to: Top Passage Bottom
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Middle Plateau
      coord: [21.75, 19.6]
      local:
        - to: East 20
          jumps_down: 1
      exits:
        - to: Gate
          req: Giguna_Vertical_Interchange_Gate
          movement: base
        - to: Middle Below Top
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Ledge 19
          req: $hookhover
          movement: fast_hover
          jumps: 4
    - name: East 20
      coord: [21.9, 19.8]
      local:
        - to: Middle Plateau
          jumps: 1
      exits:
        - to: Amagi > West Lake > West 20
          tags: [xdoor]
        - to: Gate
          req: Giguna_Vertical_Interchange_Gate
          movement: base
    - name: Gate
      coord: [21.55, 19.85]
      local:
        - to: Middle Ledge Below Gate
        - to: Middle Hill By Switch
          thru: [21.5, 20.1]
        - to: Switch
          thru: [21.5, 20.1]
      locations:
        - name: Jump Boomerang Flask
          canon: Giguna_Vertical_Interchange_Flask
          item: Big_Flask
          req: $boomerang
          to: Middle Ledge Below Gate
          tags: [remote_flask]
      exits:
        - to: Middle Plateau
          req: Giguna_Vertical_Interchange_Gate and ($hook or Anuman)
          movement: base
          jumps: 1
        - to: East 20
          req: Giguna_Vertical_Interchange_Gate
          movement: base
          jumps: 1
        - to: Dead-end Ledge
          req: $hover
          movement: base
          jumps: 1
        - to: Dead-end
          req: $hook
          movement: fast_hover
          jumps: 1
    - name: Dead-end Ledge
      coord: [21.3, 19.65]
      local:
        - to: Dead-end
          jumps: 1
        - to: Middle Ledge Below Gate
      locations:
        - name: Shockwave Flask
          canon: Giguna_Vertical_Interchange_Flask
          item: Big_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
      exits:
        - to: Gate
          req: $hover
          movement: base
    - name: Dead-end
      coord: [21.2, 19.5]
      local:
        - to: Dead-end Ledge
      locations:
        - name: Flask
          canon: Giguna_Vertical_Interchange_Flask
          item: Big_Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Giguna_Vertical_Interchange_Flask
          item: Big_Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Giguna_Vertical_Interchange_Flask
          item: Big_Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
    - name: Middle Ledge Below Gate
      coord: [21.45, 20.3]
      local:
        - to: Middle Hill By Switch
        - to: Ledge Above Rock
          thru: [21.5, 20.5]
        - to: Above Rock
      exits:
        - to: Gate
          req: $hook or $grab
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Dead-end Ledge
          req: $hook
          movement: base
          jumps: 3
        - to: Dead-end Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Middle Hill By Switch
      coord: [21.65, 20.7]
      local:
        - to: Switch
        - to: Ledge Above Rock
        - to: Above Rock
      locations:
        - name: Remote Button
          canon: Giguna_Vertical_Interchange_Gate
          item: Giguna_Vertical_Interchange_Gate
          req: $boomerang
          tags: [throw, event]
      exits:
        - to: Middle Ledge Below Gate
          req: $hook
          movement: base
          jumps: 2
        - to: West 21
          req: $hover
          movement: base
          jumps: 1
    - name: Switch
      coord: [21.8, 20.8]
      data:
        flipside: Giguna Breach > Secret Tunnel > Button Obverse
      local:
        - to: Middle Hill By Switch
          jumps: 1
      locations:
        - name: Button
          canon: Giguna_Vertical_Interchange_Gate
          item: Giguna_Vertical_Interchange_Gate
          req: $can_damage
          tags: [button, event]
    #endregion

    #region Lower
    - name: Ledge Above Rock
      coord: [21.4, 21.0]
      local:
        - to: Above Rock
        - to: Middle Hill By Switch
          jumps: 2
      exits:
        - to: West 21
          req: $hook or Anuman or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook and not Anuman
              jumps: 1
    - name: West 21
      coord: [21.05, 20.65]
      local:
        - to: Ledge Above Rock
      exits:
        - to: Mural > East 21
          tags: [xshift]
        - to: Middle Hill By Switch
          req: $hover
          movement: base
    - name: Above Rock
      coord: [21.5, 21.3]
      locations:
        - name: Spin Downwards
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: $spin or $charge
          to: Rock
          time: 2
          penalties:
            - when: not $spin
              tags: [charge_time]
        - name: Mist Downwards
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: Nanite_Mist
          to: Rock
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
      exits:
        - to: Rock
          req: Giguna_Vertical_Interchange_Rock
          movement: base
        - to: Ledge Above Rock
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Middle Hill By Switch
          movement: fast_hover
          jumps: 2
          penalties:
            - when: not $hook
              movement: base
              jumps: 2
        - to: Ledge Above Rock
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Rock
      coord: [21.5, 21.45]
      exits:
        - to: Ledge Above Rock
          req: Giguna_Vertical_Interchange_Rock and ($hook and $grab)
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Middle Hill By Switch
          req: Giguna_Vertical_Interchange_Rock and ($hook and $grab)
          movement: fast_hover
          jumps: 2.5
          penalties:
            - when: not $hook
              jumps: 2.5
        - to: Rock East
          req: Giguna_Vertical_Interchange_Rock
          movement: base
        - to: Rock West
          req: Giguna_Vertical_Interchange_Rock
          movement: base
    - name: Rock East
      coord: [21.65, 21.6]
      local:
        - to: East 22
      locations:
        - name: Spin Through Rock
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: $spin or $charge
          to: Rock West
          movement: fast_hover
          tags: [event]
          penalties:
            - when: not $spin
              movement: fling
              tags: [charge_time]
        - name: Mist Into Rock
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: Nanite_Mist
          to: Rock
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
          tags: [event]
        - name: Spin Upward Through Rock
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: $spin or $charge
          to: Above Rock
          movement: fast_hover
          jumps: 1
          tags: [event]
          penalties:
            - when: not $spin
              movement: fling
              tags: [charge_time]
        - name: Mist Upwards Through Rock
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: Nanite_Mist
          to: Above Rock
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
          tags: [event]
    - name: Rock West
      coord: [21.35, 21.6]
      local:
        - to: Lower West Slope
        - to: Lower Middle Corner
        - to: Lower Ledge 2
          thru: [[21.325, 21.8], [21.55, 22.2]]
      locations:
        - name: Spin Through Rock
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: $spin or $charge
          to: Rock East
          movement: fast_hover
          tags: [event]
          penalties:
            - when: not $spin
              movement: fling
              tags: [charge_time]
        - name: Spin Far Through Rock
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: $spinhover or $charge
          to: East 22
          movement: fast_hover
          tags: [event]
          penalties:
            - when: not $spinhover
              movement: fling
              tags: [charge_time]
        - name: Mist Into Rock
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: Nanite_Mist
          to: Rock
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
          tags: [event]
        - name: Mist Upwards Through Rock
          canon: Giguna_Vertical_Interchange_Rock
          item: Giguna_Vertical_Interchange_Rock
          req: Nanite_Mist
          to: Above Rock
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
          tags: [event]
      exits:
        - to: Rock
          req: Giguna_Vertical_Interchange_Rock
          movement: base
          jumps: 1
        - to: East 22
          req: Giguna_Vertical_Interchange_Rock and $hookhover
          movement: fast_hover
          jumps: 1
    - name: East 22
      coord: [21.95, 21.8]
      local:
        - to: Rock East
          jumps: 2
      exits:
        - to: Uhrum > Grassy Guardpost > West 22
          tags: [xshift]
    - name: Lower West Slope
      coord: [21.15, 21.95]
      local:
        - to: Lower Middle Corner
        - to: Lower Ledge 2
          thru: [21.55, 22.2]
      exits:
        - to: Rock West
          req: $hook or ($grab and Anuman)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Rock West
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Lower Middle Corner
      coord: [21.25, 22.5]
      local:
        - to: Lower West Slope
          jumps: 3
        - to: Lower Ledge 1
    - name: Lower Ledge 1
      coord: [21.6, 22.7]
      local:
        - to: Lower Ledge 2
      exits:
        - to: Lower Middle Corner
          movement: fast_hover
          jumps: 1
          penalties:
            - when: not $hookhover
              movement: base
              jumps: 1
    - name: Lower Ledge 2
      coord: [21.65, 22.9]
      local:
        - to: Lower Ledge 1
          jumps: 1
        - to: Lower Plateau Ledge
    - name: Lower Plateau Ledge
      coord: [21.6, 23.3]
      local:
        - to: South
        - to: Lower Platform
      exits:
        - to: Lower Ledge 2
          req: $hook
          movement: base
          jumps: 1
        - to: Lower Ledge 2
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Lower Platform
      coord: [21.45, 23.4]
      local:
        - to: Lower Plateau Ledge
          jumps: 1
        - to: South
        - to: Southeast Corner
    - name: Southeast Corner
      coord: [21.15, 23.6]
      local:
        - to: South
      exits:
        - to: Lower Platform
          req: $hook or Anuman or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook and not Anuman
              jumps: 1
    - name: South
      coord: [21.5, 23.8]
      local:
        - to: Southeast Corner
          jumps: 2
      exits:
        - to: Lower Plateau Ledge
          req: $hook
          movement: base
          jumps: 2
        - to: Lower Platform
          req: $hook
          movement: base
          jumps: 2
        - to: Lower Plateau Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Uhrum > Siege Corridor > Northwest Door
          tags: [ydoor]
    #endregion

- name: Antechamber  # MARK: Antechamber
  on_entry: $reset_old_area(^newpos)
  map:
    tablet: [18, 14, 19, 15]
  datamap:
    map_spot:
      tablet: Menu > Kiengir Map > Dangerous Ideas
  spots:
    - name: East 16
      coord: [18.95, 15.45]
      local:
        - to: Statues Ledge
      exits:
        - to: East Caverns > West 16
          tags: [xshift]
    - name: Statues Ledge
      coord: [18.75, 15.5]
      local:
        - to: East 16
          jumps: 1
        - to: Bottom
      exits:
        - to: Small Bricks
          req: $hook
          movement: base
          jumps: 2
    - name: Bottom
      coord: [18.5, 15.85]
      exits:
        - to: Left Wall Lower
          movement: base
          jumps: 1.5
          penalties:
            - when: not $hook
              jumps: 0.5
    - name: Small Bricks
      coord: [18.55, 15.15]
      local:
        - to: Statues Ledge
        - to: Bottom
      exits:
        - to: Statue Head
          req: $hook
          movement: base
          jumps: 2
        - to: Middle Bricks Right
          req: $hook
          movement: base
          jumps: 2
    - name: Statue Head
      coord: [18.75, 14.75]
      local:
        - to: Small Bricks
        - to: Statues Ledge
      locations:
        - name: Tablet
          item: Dangerous_Ideas
          tags: [standing]
      exits:
        - to: Middle Bricks Right
          req: $hook or $hover
          movement: fast_hover
          penalties:
            - when: not $hook
              movement: base
    - name: Middle Bricks Right
      coord: [18.45, 14.75]
      local:
        - to: Middle Bricks Left
          jumps: 1
        - to: Small Bricks
        - to: Statues Ledge
      exits:
        - to: Statue Head
          req: $hook or $hover
          movement: fast_hover
          penalties:
            - when: not $hook
              movement: base
      # TODO: Throw Drone and mist
    - name: Middle Bricks Left
      coord: [18.3, 14.6]
      local:
        - to: Middle Bricks Right
      exits:
        - to: West 15
          movement: fast_hover
          penalties:
            - when: not $hook
              movement: base
              jumps: 1
    - name: Left Wall Lower
      coord: [18.175, 15.5]
      local:
        - to: Bottom
      exits:
        - to: Left Wall Mid
          req: $hook or ($grab and $climb)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 2
    - name: Left Wall Mid
      coord: [18.15, 15.15]
      local:
        - to: Bottom
      exits:
        - to: West 15
          req: $hook or ($grab and $climb)
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 2
    - name: West 15
      coord: [18.05, 14.6]
      local:
        - to: Middle Bricks Left
        - to: Bottom
      exits:
        - to: Small Bricks
          req: $hook
          movement: base
        - to: Gubi Lair > East 15
          tags: [xshift]

- name: Gubi Lair  # MARK: Gubi Lair
  on_entry: $reset_old_area(^newpos)
  map:
    gubi: [17, 14, 18, 15]
    axe: [15, 14, 16, 15]
  datamap:
    map_spot:
      gubi: Menu > Kiengir Map > Giguna Gubi Flask
      axe: Menu > Kiengir Map > Double Axe
  spots:
    - name: East 15
      coord: [17.95, 14.6]
      local:
        - to: East Tree
      exits:
        - to: Antechamber > West 15
          tags: [xshift]
        - to: Center Platform
          req: $hover
          movement: base
    - name: East Tree
      coord: [17.75, 14.95]
      local:
        - to: Rightmost Platform
      exits:
        - to: East 15
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Center Platform
          req: $hover
          movement: base
          jumps: 1
    - name: Rightmost Platform
      coord: [17.5, 15.1]
      local:
        - to: East Tree
          jumps: 1
        - to: Lower Platform
      exits:
        - to: Center Platform
          req: $hover
          movement: base
          jumps: 1
    - name: Lower Platform
      coord: [17.25, 15.3]
      local:
        - to: Center-East Sapling
        - to: Center-West Sapling
        - to: Rightmost Platform
          jumps: 1
    - name: Center-East Sapling
      coord: [17.05, 15.5]
      local:
        - to: Lower Platform
          jumps: 1
        - to: Center-West Sapling
          jumps: 2
    - name: Center-West Sapling
      coord: [16.7, 15.45]
      local:
        - to: Center-East Sapling
        - to: Leftmost Platform
          jumps: 1
        - to: Grass by Wall
        - to: West Brickwork
    - name: Center Platform
      coord: [17.0, 14.9]
      local:
        - to: Leftmost Platform
        - to: Lower Platform
      locations:
        - name: Hack Gubi
          item: Giguna_Gubi
          canon: Giguna_Gubi
          req: $overheat  # may also include combat upgrades
          price: 200
          time: 9
        - name: Fight Gubi
          item: Giguna_Gubi
          canon: Giguna_Gubi
          time: 20  # ?
        - name: Boss Reward
          canon: Giguna_Gubi_Flask
          item: Big_Flask
          req: Giguna_Gubi and ($boomerang or $hover)
          tags: [flask]
          penalties:
            - when: not $boomerang
              add: 3.0  # estimated penalty to get close enough
    - name: Leftmost Platform
      coord: [16.55, 15.25]
      local:
        - to: Center-West Sapling
        - to: West Brickwork
        - to: Center Platform
          jumps: 2
    - name: Grass by Wall
      coord: [16.45, 15.85]
      local:
        - to: West Brickwork
          jumps: 1
      exits:
        - to: Center-West Sapling
          req: $hook or ($grab and $climb)
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
    - name: West Brickwork
      coord: [15.75, 15.8]
      local:
        - to: Grass by Wall
        - to: Shaft Bottom
          jumps: 2
    - name: Shaft Bottom
      coord: [15.25, 15.7]
      local:
        - to: West Brickwork
      exits:
        - to: Pedestal
          req: $hook or ($grab and $climb)
          movement: base
          jumps: 5
          penalties:
            - when: not $hook
              jumps: 6
            - when: not Drone_Hover
              jumps: 3
    - name: Pedestal
      coord: [15.4, 14.4]
      local:
        - to: Shaft Bottom
          thru: [15.25, 14.7]
      locations:
        - name: Axe
          item: Double_Axe
          tags: [standing]

- name: Mural  # MARK: Mural
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Enclosed Portal
    portal_hidden: true
  map:
    sword: [19, 19, 20, 20]
    portal: [19, 20, 20, 21]
    mural: [20, 19, 21, 20]
    flask: [19, 21, 20, 22]
  datamap:
    map_spot:
      sword: Menu > Kiengir Map > Assault Sword
      portal: Menu > Kiengir Map > Giguna Mural Portal
      mural: Menu > Kiengir Map > Giguna Mural NE
      flask: Menu > Kiengir Map > Giguna Mural Flask
  spots:
    - name: West 20
      coord: [19.05, 20.0]
      local:
        - to: NW Cache
          jumps: 2
        - to: NW Ledge
          jumps: 1
        - to: NW Bottom
      exits:
        - to: Labyrinth East > East 20
          tags: [xshift]
    - name: NW Cache
      coord: [19.5, 19.7]
      data:
        flipside: Giguna Breach > Portal Exchange > Upper Side
      local:
        - to: West 20
        - to: NW Ledge
        - to: NW Bottom
      locations:
        - name: Note
          item: Kazakh_Assault
          tags: [standing]
    - name: NW Bottom
      coord: [19.3, 20.1]
      data:
        flipside: Giguna Breach > Portal Exchange > Middle Gap
      local:
        - to: West 20
          jumps: 1
        - to: NW Ledge
          jumps: 1
    - name: NW Ledge
      coord: [19.35, 19.95]
      data:
        flipside: Giguna Breach > Portal Exchange > Middle Ledge
      local:
        - to: West 20
          jumps: 1
        - to: NW Bottom
        - to: NW Cache
          jumps: 2

    - name: Enclosed Portal
      coord: [19.45, 20.8]
      data:
        flipside: Giguna Breach > Portal Exchange > Bottom
      local:
        - to: Shocking Distance
    - name: Shocking Distance
      coord: [19.7, 21.0]
      local:
        - to: Enclosed Portal
          jumps: 1
        - to: Enclosed Cache
      locations:
        - name: Shockwave Flask
          canon: Giguna_Mural_Flask
          item: Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
    - name: Enclosed Cache
      coord: [19.85, 21.15]
      local:
        - to: Shocking Distance
          jumps: 1
      locations:
        - name: Flask
          canon: Giguna_Mural_Flask
          item: Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Giguna_Mural_Flask
          item: Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Giguna_Mural_Flask
          item: Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]

    - name: Pedestal
      coord: [19.875, 19.3]
      local:
        - to: Pedestal Ledge
        - to: Grass Gap
      locations:
        - name: Item
          item: Sickle_Sword
          tags: [standing]
      exits:
        - to: East Platform
          req: $hover
          movement: base
        - to: NE Ledge
          req: $hover
          movement: base
    - name: Pedestal Ledge
      coord: [20.0, 19.5]
      local:
        - to: Below Pedestal
        - to: Grass and Tree
        - to: Grass Gap
        - to: East Grass Ledge
        - to: Pedestal
          jumps: 1
      exits:
        - to: East Platform
          req: $hover
          movement: base
        - to: NE Ledge
          req: $hover
          movement: base
    - name: NE Ledge
      coord: [20.825, 19.5]
      data:
        flipside: Giguna Breach > East > Upper Ledge
      local:
        - to: East 21
          thru: [20.8, 20.3]
        - to: East Platform
        - to: East Grass Ledge
          jumps_down: 1
        - to: Grass Gap
          jumps_down: 1
        - to: Grass and Tree
      exits:
        - to: Pedestal Ledge
          req: $hover
          movement: base
        - to: Pedestal
          req: $hover
          movement: base
          jumps: 1
    - name: Below Pedestal
      coord: [20.0, 20.1]
      local:
        - to: Grass and Tree
        - to: Grass Gap
      exits:
        - to: East Platform
          req: $hover
          movement: base
        - to: NE Ledge
          req: $hookhover
          movement: base
          jumps: 4
        - to: Pedestal Ledge
          req: $hookhover
          movement: base
          jumps: 4
        - to: Pedestal Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: NE Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: East Platform
      coord: [20.75, 20.3]
      local:
        - to: East 21
        - to: East Grass Ledge
          jumps_down: 1
        - to: Grass Gap
          jumps_down: 1
        - to: Grass and Tree
      exits:
        - to: NE Ledge
          req: $infinite_climb
          movement: base
          jumps: 3
        - to: NE Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Pedestal Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: East 21
      coord: [20.95, 20.65]
      local:
        - to: East Grass Ledge
          jumps: 1
      exits:
        - to: East Platform
          movement: base
          jumps: 2
          penalties:
            - when: not Anuman
              jumps: 1
        - to: Vertical Interchange > West 21
          tags: [xshift]
    - name: East Grass Ledge
      coord: [20.65, 20.65]
      local:
        - to: East Platform
          jumps: 2
        - to: East 21
          jumps: 1
        - to: Grass Gap
        - to: Grass and Tree
          jumps: 2
    - name: Grass and Tree
      coord: [20.2, 20.55]
      local:
        - to: Grass Gap
        - to: Below Pedestal
          thru: [18.8, 20.3]
          jumps: [2, 1]
        - to: East Grass Ledge
          jumps: 2
    - name: Grass Gap
      coord: [20.5, 20.85]
      local:
        - to: East Grass Ledge
          jumps: 1
        - to: Grass and Tree
          jumps: 2
        - to: Rock Upper Ledge
    - name: Rock Upper Ledge
      coord: [20.6, 21.3]
      local:
        - to: Platform Below Ledge
      exits:
        - to: Grass Gap
          req: $hook
          movement: base
          jumps: 2
        - to: Grass Gap
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1

    - name: Platform Below Ledge
      coord: [20.65, 21.7]
      data:
        flipside: Giguna Breach > Lower Machinery > East Mid-air
      local:
        - to: Lower Middle Column
      exits:
        - to: Rock Upper Ledge
          req: $hook or ($grab and Anuman)
          movement: base
          jumps: 2
    - name: Lower Middle Column
      coord: [19.8, 21.8]
      data:
        flipside: Giguna Breach > Lower Machinery > Center Pillar West
      local:
        - to: Platform Below Ledge
          jumps: 2
      local:
        - to: Southwest Ledge
    - name: Southwest Ledge
      coord: [20.3, 22.35]
      local:
        - to: Southwest Cache
      exits:
        - to: Lower Middle Column
          req: $hook or $grab
          movement: base
          jumps: 3
          penalties:
            - when: not $hook
              jumps: 2
    - name: Southwest Cache
      coord: [20.35, 22.8]
      locations:
        - name: Refill
          item: Power_Core
          req: $more_refills
          tags: [standing]
      exits:
        - to: Southwest Ledge
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1

- name: Breachable Wall  # MARK: Breachable Wall
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Entry  # Needs confirmation
    portal_hidden: true
  map:
    flask: [16, 23, 17, 24]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Giguna Breachable Wall Flask
  spots:
    - name: West Mid-air
      coord: [16.05, 24.0]
      local:
        - to: Above West Catwalk
      exits:
        - to: Irikar > East Rooftops > East Mid-air
          tags: [xshift]
    - name: Above West Catwalk
      coord: [16.55, 24.9]
      exits:
        - to: Irikar > Boss Room > Above Catwalk
          tags: [yshift]
    - name: Above Middle Catwalk
      coord: [17.1, 24.9]
      exits:
        - to: Irikar > Lamassu > Northwest
          tags: [yshift]

    - name: West Ledge
      coord: [16.45, 23.15]
      data:
        flipside: Giguna Breach > White Clouds > West Ledge
      local:
        - to: Above the Hole
        - to: West Mid-air
        - to: Above West Catwalk
      exits:
        - to: Irikar > Boss Room > Healthy Rooftop
          movement: base
          penalty_tags: [yshift, -fall.2]
        - to: Cave Mouth West
          req: $hover
          movement: base
        - to: Cave Mouth West
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Above the Hole
      coord: [16.9, 23.3]
      data:
        flipside: Giguna Breach > White Clouds > Upper Middle
      local:
        - to: West Ledge
          jumps: 1
      locations:
        - name: Shockwave Flask
          item: Big_Flask
          canon: Giguna_Breachable_Wall_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
    - name: Wall Interior
      coord: [16.9, 23.6]
      data:
        flipside: Giguna Breach > White Clouds > Exit
      local:
        - to: Cave Mouth East
        - to: Above West Catwalk
      locations:
        - name: Flask
          item: Big_Flask
          canon: Giguna_Breachable_Wall_Flask
          tags: [flask]
        - name: Shockwave Flask
          item: Big_Flask
          canon: Giguna_Breachable_Wall_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
      exits:
        - to: Cave Mouth West
          req: $hover
          movement: base
    - name: Cave Mouth West
      coord: [16.7, 23.9]
      data:
        flipside: SpotId::None
      local:
        - to: Above Middle Catwalk
      exits:
        - to: Wall Interior
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: West Mid-air
          req: $hover
          movement: base
    - name: Cave Mouth East
      coord: [16.85, 23.9]
      local:
        - to: Above Middle Catwalk
      exits:
        - to: Irikar > Lamassu > Catwalk Middle
          movement: base
          penalty_tags: [yshift, -fall.2]

    - name: East 24
      coord: [17.95, 23.55]
      local:
        - to: East Ledge
      exits:
        - to: Separator > West 24
          tags: [xshift]
    - name: East Ledge
      coord: [17.825, 23.55]
      local:
        - to: East 24
        - to: Portal Entry
        - to: East 25
      exits:
        - to: Separator > Lower Brick
          req: $hook and $hover
          movement: fast_hover
          jumps: 1
          penalty_tags: [xshift, -fast_hover.1]
        - to: Separator > Save Point
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
          penalties:
            - when: not $hookhover
              movement: base
              tags: [fast_hover.1, -base.1]
    - name: Portal Entry
      coord: [17.5, 23.75]
      data:
        flipside: Giguna Breach > White Clouds > Entry
      local:
        - to: East Ledge
          jumps: 1
        - to: East 25
      exits:
        - to: Separator > Save Point
          movement: base
          penalty_tags: [xshift, -base.1]
    - name: East 25
      coord: [17.95, 24.5]
      exits:
        - to: Separator > West 25
          tags: [xshift]
        - to: Portal Entry
          req: $hook or $grab
          movement: base
          jumps: 3
          penalties:
            - when: not $hook
              jumps: 1
        - to: East Ledge
          req: $hook or $grab
          movement: base
          jumps: 3
          penalties:
            - when: not $hook
              jumps: 2

- name: Separator  # MARK: Separator
  on_entry: $reset_old_area(^newpos)
  data:
    save_point: Save Point
  map:
    save: [18, 24, 19, 25]
    sep: [18, 22, 19, 23]
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Giguna Separator Save
      sep: Menu > Kiengir Map > Giguna Separator
  spots:
    - name: West 23
      coord: [18.05, 22.8]
      local:
        - to: Platform
          jumps: 2
      exits:
        - to: Labyrinth > East 23
          tags: [xshift]
    - name: Platform
      coord: [18.225, 22.4]
      local:
        - to: West 23
        - to: Upper Brick
      exits:
        - to: Switch
          req: $hover
          movement: base
      actions:
        - name: Deploy to Switch
          req: $can_deploy and (Drone_Hover or Slingshot_Hook)
          do: $deploy_drone
          to: Switch
          movement: fast_hover
    - name: Upper Brick
      coord: [18.45, 22.8]
      local:
        - to: Platform
          jumps: 2
        - to: Switch
          jumps: 1
      exits:
        - to: Lower Brick
          req: Giguna_Separator_Bricks
          movement: base
      hybrid:
        - name: Break Bricks
          req: Nanite_Mist
          item: Giguna_Separator_Bricks
          canon: Giguna_Separator_Bricks
          to: Lower Brick
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        # Might be possible with Slingshot_Charge but may be difficult
    - name: Switch
      coord: [18.75, 22.6]
      local:
        - to: Lower Brick
      locations:
        - name: Separation
          item: Separation
          req: ^mode == 'drone' and ^indra == `Giguna > Separator > Platform`
          time: 10  # ? Needs measurement
          tags: [event]
      exits:
        - to: Platform
          req: $hover
          movement: base
          jumps: 1
    - name: Lower Brick
      coord: [18.4, 23.4]
      local:
        - to: West 24
      exits:
        - to: Upper Brick
          req: Giguna_Separator_Bricks
          movement: base
          jumps: 1.5
          penalties:
            - when: not $hook
              jumps: 1.5
      hybrid:
        - name: Break Bricks
          req: Nanite_Mist
          item: Giguna_Separator_Bricks
          canon: Giguna_Separator_Bricks
          to: Upper Brick
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: West 24
      coord: [18.05, 23.55]
      local:
        - to: Lower Brick
          jumps: 1
      exits:
        - to: Breachable Wall > East 24
          tags: [xshift]
    - name: West 25
      coord: [18.05, 24.5]
      local:
        - to: Save Point
          jumps: 1
      exits:
        - to: Breachable Wall > East 25
          tags: [xshift]
    - name: Save Point
      coord: [18.5, 24.6]
      local:
        - to: West 25
          jumps: 3
        - to: East 25
      actions:
        - name: Save
          do: $save
          tags: [save]
    - name: East 25
      coord: [18.95, 24.75]
      local:
        - to: Save Point
          jumps: 2
      exits:
        - to: Uhrum > West Entrance > West 25
          tags: [xshift]

- name: Secrecy  # MARK: Secrecy
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Stand
  map:
    portal: [19, 23, 20, 24]
    flask: [20, 23, 21, 24]
  datamap:
    map_spot:
      portal: Menu > Kiengir Map > Giguna Secrecy Portal
      flask: Menu > Kiengir Map > Giguna Secrecy Flask
  spots:
    - name: Portal Stand
      coord: [19.325, 23.6]
      data:
        flipside: Giguna Breach > South > Save Point
      exits:
        - to: West Column West
          req: $hook
          movement: base
          jumps: 2
        - to: West Column West
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: West Column West
      coord: [19.5, 23.2]
      data:
        flipside: SpotId::None
      local:
        - to: Portal Stand
        - to: Near East Column
      exits:
        - to: West Column East
          req: $grab
          movement: base
        - to: East Column
          req: $hover
          movement: base
    - name: West Column East
      coord: [19.8, 23.3]
      local:
        - to: West Column West
          jumps: 1
      locations:
        - name: Boomerang Flask
          canon: Giguna_Secrecy_Flask
          item: Big_Flask
          req: $boomerang
          tags: [remote_flask]
        - name: Boomerang Flask Fast Travel
          canon: Giguna_Secrecy_Flask
          item: Big_Flask
          req: $boomerang and Fast_Travel
          to: ^map_spot
          time: 1  # ?
    - name: Near East Column
      coord: [20.05, 23.4]
      locations:
        - name: Shockwave Flask
          canon: Giguna_Secrecy_Flask
          item: Big_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
      exits:
        - to: West Column West
          req: $hook
          movement: base
          jumps: 1
        - to: East Column
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: East Column
      coord: [20.25, 23.2]
      local:
        - to: Near East Column
      locations:
        - name: Flask
          canon: Giguna_Secrecy_Flask
          item: Big_Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Giguna_Secrecy_Flask
          item: Big_Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Giguna_Secrecy_Flask
          item: Big_Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
      exits:
        - to: West Column West
          req: $hook or $hover
          movement: base
