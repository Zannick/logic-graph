name: Glacier
start:
  _hammonds_doors: false

areas:
- name: Dock Outside  # MARK: Dock Outside
  on_entry: $reset_old_area(^newpos)
  map:
    note: [42, 7, 43, 8]
    flask: [44, 8, 45, 9]
  datamap:
    map_spot:
      note: Menu > Kiengir Map > Weekly Notes 2/27/2053
      flask: Menu > Kiengir Map > Glacier Dock Flask
  spots:
    - name: Entry
      coord: [43.475, 8.5]
      local:
        - to: Do Not Enter
          jumps: 3
      exits:
        - to: Interior > Dock Interior > Entry
          tags: [interior]
    # the first time you reach here, this becomes the save point.
    # however, this doesn't ever seem relevant
    # and I'm not sure how to force it in the logic
    #- name: Save Point
    #  coord: [43.0, 8.8]
    - name: Do Not Enter
      coord: [42.05, 8.5]
      local:
        - to: Entry
        - to: Lower Platforms
          jumps: 3
      exits:
        - to: Revival > East 9
          tags: [xshift]
    - name: Lower Platforms
      coord: [42.7, 8.4]
      local:
        - to: Do Not Enter
          jumps: 2
        - to: Entry
          jumps: 2
      exits:
        - to: Lower Mid-air
          req: $hover
          movement: base
          jumps: 2
      actions:
        - name: Throw Drone
          req: $can_deploy and Drone_Hover
          do: $deploy_drone
          to: Lower Mid-air
          time: 1.5  # ?
    - name: Lower Mid-air
      coord: [43.0, 8.15]
      local:
        - to: Do Not Enter
        - to: Entry
      exits:
        - to: Lower Platforms
          req: $hover
        - to: Upper Ledge
          req: Nanite_Mist
          movement: mist1
        - to: Upper Ledge
          req: $mist2
          movement: mist2
    - name: Upper Ledge
      coord: [43.0, 7.8]
      local:
        - to: Lower Mid-air
        - to: Entry
        - to: Ruins Platform
          jumps: 1
        - to: Ruins Stairs
        - to: Mid Toward Cave
          jumps: 1
    - name: Ruins Stairs
      coord: [42.85, 7.8]
      local:
        - to: Ruins Platform
          jumps: 1
        - to: Upper West Hill
          jumps: 1
        - to: Upper Ledge
      locations:
        - name: Note
          item: Notes_2053_02_27
          canon: Notes_2053_02_27
          tags: [standing]
    - name: Ruins Platform
      coord: [42.8, 7.7]
      local:
        - to: Ruins Stairs
          jumps_down: 1
        - to: Upper West Hill
          jumps: 1
        - to: Upper Ledge
      exits:
        - to: High Toward Cave
          req: $hover
          movement: base
          jumps: 2
      actions:
        - name: Throw Drone Up
          req: $can_deploy and Drone_Hover
          do: $deploy_drone
          to: Above Ruins
    - name: Above Ruins
      coord: [42.8, 7.3]
      local:
        - to: Ruins Platform
        - to: Upper Ledge
        - to: Upper West Hill
      exits:
        - to: Cave Mouth
          req: $hover
          movement: base
          jumps: 1
        - to: Cave Mouth
          req: Nanite_Mist
          movement: mist1
        - to: Cave Mouth
          req: $mist2
          movement: mist2
    - name: Upper West Hill
      coord: [42.1, 7.7]
      local:
        - to: Ruins Stairs
        - to: Ruins Platform
          jumps: 1
      exits:
        - to: Revival > Pillar
          req: $grab
          movement: base
          jumps: 2
          penalty_tags: [xshift, -base.1]
        - to: Revival > Pillar
          req: $hook
          movement: base
          jumps: 1
          penalty_tags: [xshift, -base.1]
        - to: Revival > Pillar Step
          movement: base
          jumps: 1
          penalty_tags: [xshift, -base.1]

    - name: High Toward Cave
      coord: [43.2, 7.45]
      local:
        - to: Entry
        - to: Lower Mid-air
      exits:
        - to: Cave Mouth
          req: Nanite_Mist
          movement: mist1
        - to: Cave Mouth
          req: $mist2
          movement: mist2
    - name: Mid Toward Cave
      coord: [43.1, 7.6]
      local:
        - to: Entry
        - to: Lower Mid-air
      exits:
        - to: Cave Mouth
          req: Nanite_Mist
          movement: mist1
        - to: Cave Mouth
          req: $mist2
          movement: mist2
    - name: Cave Mouth
      coord: [43.3, 7.2]
      local:
        - to: Entry
        - to: High Toward Cave
        - to: Cave Throat
      exits:
        - to: Ruins Stairs
          req: $hover
          movement: base
        - to: Above Ruins
          req: $hover
          movement: base
    - name: Cave Throat
      coord: [43.8, 7.2]
      local:
        - to: Cave Mouth
        - to: Cave Gullet
        - to: Cave Esophagus
    - name: Cave Gullet
      coord: [44.0, 7.55]
      local:
        - to: Cave Esophagus
      exits:
        - to: Cave Throat
          req: $grab
          movement: base
          jumps: 2
        - to: Cave Throat
          req: $hook
          movement: base
          jumps: 1
    - name: Cave Esophagus
      coord: [44.6, 7.6]
      local:
        - to: Cave Treasure
          thru: [44.55, 8.0]
        - to: Cave Gullet
          jumps: 1
    - name: Cave Treasure
      coord: [44.6, 8.5]
      locations:
        - name: Item
          canon: Glacier_Dock_Flask
          item: Big_Flask
          tags: [flask]
      exits:
        - to: Cave Esophagus
          req: $grab
          movement: base
          jumps: 6
        - to: Cave Esophagus
          req: $hook
          movement: base
          jumps: 3
      hybrid:
        - name: Flask Collection Skip
          to: Menu > Warp Only > Kiengir
          canon: Glacier_Dock_Flask
          item: Big_Flask
          req: $melee_cskip
          tags: [cskip]
        - name: Flask Fast Travel
          to: Menu > Kiengir Map > Glacier Dock Flask
          canon: Glacier_Dock_Flask
          item: Big_Flask
          req: Fast_Travel and $melee_cskip
          tags: [cskip]

- name: Revival  # MARK: Revival
  on_entry: $reset_old_area(^newpos)
  map:
    save: [41, 7, 42, 8]
  data:
    save_point: Save Point
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Glacier Revival
  spots:
    - name: East 9
      coord: [41.95, 8.5]
      local:
        - to: Overhang
      exits:
        - to: Dock Outside > Do Not Enter
          tags: [xshift]
    - name: Overhang
      coord: [41.6, 8.5]
      local:
        - to: East 9
        - to: Ledge
        - to: Lower East
          jumps_down: 2
      exits:
        - to: West 9
          req: $hover
          movement: base
          jumps: 1
    - name: Ledge
      coord: [41.3, 8.8]
      local:
        - to: Overhang
          jumps: 2
        - to: Lower East
          jumps_down: 3
      exits:
        - to: West 9
          req: $grab
          movement: base
          jumps: 2
        - to: West 9
          req: $hook
          movement: base
          jumps: 1
    - name: Lower East
      coord: [41.95, 9.7]
      local:
        - to: Ledge
          jumps: 8
      exits:
        - to: Grid 42,10 > West
          tags: [xshift]
    - name: West 9
      coord: [41.05, 8.4]
      local:
        - to: Ledge
      exits:
        - to: Overhang
          req: $hover
          movement: base
        - to: Grid 39-40,7-9 > East 9
          tags: [xshift]

    # Upper portion
    - name: Save Point
      coord: [41.5, 7.5]
      local:
        - to: West 8
        - to: Mid-air
          jumps: 1
      exits:
        - to: Grid 39-40,7-9 > First Upper Platform
          req: $hover
          movement: base
          jumps: 1
          penalty_tags: [xshift, -base.1]
        - to: Pillar
          req: $grab
          movement: base
          jumps: 2
      actions:
        - name: Save
          do: $save
          tags: [save]
        - name: Throw Drone West
          req: $can_deploy and Drone_Hover
          do: $deploy_drone
          to: Just Thrown
          time: 0.75
    # TODO: handle movement and penalty_tags in actions?
    - name: Just Thrown
      coord: [41.5, 7.3]
      local:
        - to: Save Point
      exits:
        - to: Grid 39-40,7-9 > First Upper Platform
          req: $hover
          movement: fast_hover
          penalty_tags: [xshift, -base.1]
    - name: West 8
      coord: [41.05, 7.95]
      local:
        - to: Save Point
          jumps: 2
      exits:
        - to: Grid 39-40,7-9 > Upper East
          tags: [xshift]
    - name: Pillar
      coord: [41.8, 7.4]
      local:
        - to: Save Point
      locations:
        - name: Health
          canon: Revival Health Node
          item: Health_Node
          tags: [standing]
      exits:
        - to: Dock Outside > Upper West Hill
          movement: base
          penalty_tags: [xshift, -base.1]
    - name: Pillar Step
      coord: [41.9, 7.6]
      local:
        - to: Pillar
          thru: [41.9, 7.4]
          jumps: [1, 0]
      exits:
        - to: Dock Outside > Upper West Hill
          movement: base
          penalty_tags: [xshift, -base.1]
    - name: Mid-air
      coord: [41.6, 7.5]
      local:
        - to: Save Point
      exits:
        - to: Dock Outside > Ruins Platform
          req: $hook and $hover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
        - to: Dock Outside > Ruins Stairs
          req: $hook and $hover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
      hybrid:
        - name: Fly to the Platform and Grab
          to: Dock Outside > Ruins Platform
          req: $hook and $hover
          canon: Revival Health Node
          item: Health_Node
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
        - name: Fly to the Stairs and Grab
          to: Dock Outside > Ruins Stairs
          req: $hook and $hover
          canon: Revival Health Node
          item: Health_Node
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]

# It sure is going to get difficult naming every room without generic names
- name: Grid 42,10  # MARK: Grid 42,10
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West
      coord: [42.05, 9.7]
      local:
        - to: East
      exits:
        - to: Revival > Lower East
          tags: [xshift]
    - name: East
      coord: [42.95, 9.7]
      local:
        - to: West
      exits:
        - to: Grid 43,10-11 > Top
          tags: [xshift]

- name: Grid 43,10-11  # MARK: Grid 43,10-11
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: Top
      coord: [43.05, 9.7]
      local:
        - to: Lower
          thru: [43.3, 9.95]
        - to: East
      exits:
        - to: Grid 42,10 > East
          tags: [xshift]
    - name: East
      coord: [43.95, 10.0]
      local:
        - to: Top
          jumps: 3
        - to: Lower
      exits:
        - to: Apocalypse Entry > West 10
          tags: [xshift]
    - name: Lower
      coord: [43.05, 10.8]
      local:
        - to: Top
          thru: [[43.2, 10.5], [43.3, 10.3], [43.3, 10.1]]
          jumps: [2, 3, 3, 1]
        - to: East
          thru: [[43.2, 10.5], [43.5, 10.2]]
          jumps: [2, 4, 2]
      exits:
        - to: Compass Room > East
          tags: [xshift]

- name: Compass Room  # MARK: Compass Room
  on_entry: $reset_old_area(^newpos)
  data:
    map_spot: Menu > Kiengir Map > Compass
  spots:
    - name: East
      coord: [42.95, 10.8]
      local:
        - to: Center
          jumps: 1
      exits:
        - to: Grid 43,10-11 > Lower
          tags: [xshift]
    - name: Center
      coord: [42.5, 10.7]
      local:
        - to: East
        - to: West
          jumps: 1
      locations:
        - name: Table
          item: Compass
          tags: [standing]
    - name: West  # This is also an autosave location in the early game, also irrelevant.
      coord: [42.05, 10.75]
      local:
        - to: Center
          jumps: 1
      exits:
        - to: The Big Drop > East
          tags: [xshift]

- name: The Big Drop  # MARK: The Big Drop
  on_entry: $reset_old_area(^newpos)
  map:
    bottom: [41, 13, 42, 14]
  datamap:
    water:
      bottom: true
  reset:
    _bridge_open: false
  spots:
    - name: East
      coord: [41.95, 10.75]
      local:
        - to: Solid Rock
      exits:
        - to: Compass Room > West
          tags: [xshift]
    - name: Solid Rock
      coord: [41.85, 10.75]
      local:
        - to: East
        - to: Unstable Footing
      actions:
        - name: Careful Break
          do: ^_bridge_open = true
          time: 1
    - name: Unstable Footing
      coord: [41.75, 10.75]
      enter:
        _bridge_open: true
      local:
        - to: Small Path
        - to: Water Surface
    - name: Small Path
      coord: [41.95, 12.8]
      exits:
        - to: East
          req: Nanite_Mist
          movement: mist1
        - to: East
          req: $mist2
          movement: mist2
    - name: Water Surface
      coord: [41.05, 12.9]
      exits:
        - to: Sea Burial > Collapsing Ceiling
          req: NOT Amashilama
          tags: [xshift]
      # other access is dependent on Amashilama, so leave isolated for now.

    - name: West 14
      coord: [41.05, 13.7]
      locations:
        - name: Break Rock
          req: $melee
          canon: Glacier_Big_Drop_Rock
          item: Glacier_Big_Drop_Rock
          time: 2
      exits:
        - to: Sea Burial > East 14
          tags: [xshift]
        - to: Breakable Rock Right
          req: Glacier_Big_Drop_Rock
          movement: base
      hybrid:
        - name: Mist Through
          to: Breakable Rock Right
          req: Nanite_Mist
          canon: Glacier_Big_Drop_Rock
          item: Glacier_Big_Drop_Rock
          movement: mist1
        - name: Mist Through Faster
          to: Breakable Rock Right
          req: $mist2
          canon: Glacier_Big_Drop_Rock
          item: Glacier_Big_Drop_Rock
          movement: mist2
    - name: Breakable Rock Right
      coord: [41.2, 13.7]
      locations:
        - name: Break Rock
          req: $melee
          canon: Glacier_Big_Drop_Rock
          item: Glacier_Big_Drop_Rock
          time: 2
      exits:
        - to: West 14
          req: Glacier_Big_Drop_Rock
          movement: base
      hybrid:
        - name: Mist Through
          to: West 14
          req: Nanite_Mist
          canon: Glacier_Big_Drop_Rock
          item: Glacier_Big_Drop_Rock
          movement: mist1
        - name: Mist Through Faster 
          to: West 14
          req: $mist2
          canon: Glacier_Big_Drop_Rock
          item: Glacier_Big_Drop_Rock
          movement: mist2

    - name: West 11 Door
      coord: [41.15, 10.55]
      local:
        - to: West Unstable Footing
      exits:
        - to: Hammond's End > East 11 Door
          req: ^_hammonds_doors
          movement: base
          penalty_tags: [xshift, -base.1]
        - to: East
          req: $hover
          movement: base
    - name: West Unstable Footing
      coord: [41.3, 10.75]
      enter:
        _bridge_open: true
      local:
        - to: Small Path
        - to: Breakable Rock Right

- name: Sea Burial  # MARK: Sea Burial
  on_entry: $reset_old_area(^newpos)
  map:
    note: [39, 13, 40, 14]
    health: [40, 13, 41, 14]
  data:
    water: true
  datamap:
    map_spot:
      note: Menu > Kiengir Map > Dr. Gloria
      health: Menu > Kiengir Map > Glacier Sea Burial Health
  spots:
    - name: Collapsing Ceiling
      coord: [40.95, 12.9]
      hybrid:
        - name: Drown  # This is technically the next grid over, but it's a cutscene really
          to: Glacier > Revival > Save Point
          req: NOT Amashilama
          item: Amashilama
          time: 47.15
    - name: West 13
      coord: [39.05, 12.75]
      data:
        water: false
      local:
        - to: West Water Surface
      exits:
        - to: Boomerang Antechamber > East 13
          tags: [xshift]
    - name: West Water Surface
      coord: [39.2, 13.0]
      local:
        - to: West 13
          jumps: 1
          jump_mvmt: water
        - to: Grate Ledge
    - name: Grate Ledge
      coord: [39.6, 13.15]
      local:
        - to: West Water Surface
          jumps: 1
        - to: Grate Right
        - to: West Basin
      exits:
        - to: Left Center Rock
          req: $hover
          movement: base
          jumps: 1
    - name: Grate Right
      coord: [39.65, 13.4]
      local:
        - to: West Basin
        - to: Grate Ledge
          jumps: 1
          jump_mvmt: water
      exits:
        - to: Grate Ledge
          req: $grab
          movement: base
          jumps: 2
        - to: Grate Ledge
          req: $hook
          movement: base
          jumps: 1
        - to: Grate Left
          req: Nanite_Mist
          movement: mist1
        - to: Grate Left
          req: $mist2
          movement: mist2
    - name: West Basin
      coord: [39.8, 13.4]
      local:
        - to: Grate Ledge
          jumps: 1
          jump_mvmt: water
        - to: Grate Right
        - to: Left Center Rock
          jumps: 1
          jump_mvmt: water
      exits:
        - to: Grate Ledge
          req: $grab
          movement: base
          jumps: 2
        - to: Grate Ledge
          req: $hook
          movement: base
          jumps: 1
        - to: Left Center Rock
          req: $hook
          movement: base
          jumps: 2
    - name: Left Center Rock
      coord: [40.0, 13.1]
      local:
        - to: Right Center Rock
          jumps: 1
        - to: Grate Right
        - to: West Basin
      exits:
        - to: Grate Ledge
          req: $hover
          movement: base
    - name: Right Center Rock
      coord: [40.2, 13.0]
      data:
        flipside: Glacier Breach > Grate Work > East Hill
      local:
        - to: Left Center Rock
        - to: Deep Cache
        - to: Breakable Rock Left
    - name: Deep Cache
      coord: [40.5, 13.75]
      local:
        - to: Right Center Rock
          jumps: 4
        - to: Breakable Rock Left
          jumps: 2
      locations:
        - name: Health
          item: Health_Fragment
          tags: [standing]
      exits:
        - to: Right Center Rock
          req: Underwater_Movement
          movement: base
          jumps: 3
    - name: Breakable Rock Left
      coord: [40.6, 13.4]
      local:
        - to: Deep Cache
        - to: Right Center Rock
          jumps: 3
      locations:
        - name: Break Rock
          req: $melee
          canon: Glacier_Sea_Burial_Rock
          item: Glacier_Sea_Burial_Rock
          time: 2
      exits:
        - to: Breakable Rock Right
          req: Glacier_Sea_Burial_Rock
          movement: base
      hybrid:
        - name: Mist Through
          to: Breakable Rock Right
          req: Nanite_Mist
          canon: Glacier_Sea_Burial_Rock
          item: Glacier_Sea_Burial_Rock
          movement: mist1
        - name: Mist Through Faster
          to: Breakable Rock Right
          req: $mist2
          canon: Glacier_Sea_Burial_Rock
          item: Glacier_Sea_Burial_Rock
          movement: mist2
    - name: Breakable Rock Right
      coord: [40.725, 13.4]
      local:
        - to: Underwater Passage Center
      locations:
        - name: Break Rock while Jumping
          req: $melee
          canon: Glacier_Sea_Burial_Rock
          item: Glacier_Sea_Burial_Rock
          time: 4
      exits:
        - to: Breakable Rock Left
          req: Glacier_Sea_Burial_Rock
          movement: base
      hybrid:
        - name: Mist Through
          to: Breakable Rock Left
          req: Nanite_Mist
          canon: Glacier_Sea_Burial_Rock
          item: Glacier_Sea_Burial_Rock
          movement: mist1
        - name: Mist Through Faster
          to: Breakable Rock Left
          req: $mist2
          canon: Glacier_Sea_Burial_Rock
          item: Glacier_Sea_Burial_Rock
          movement: mist2
    - name: Underwater Passage Center
      coord: [40.8, 13.55]
      local:
        - to: Breakable Rock Right
          jumps: 1
        - to: East 14
    - name: East 14
      coord: [40.95, 13.7]
      local:
        - to: Underwater Passage Center
          jumps: 1
      exits:
        - to: The Big Drop > West 14
          tags: [xshift]

    - name: West 14
      coord: [39.1, 13.65]
      data:
        flipside: Glacier Breach > Grate Work > West 14
      local:
        - to: Inside the Grate
        - to: Grate Left
          jumps: 1
      exits:
        - to: Annuna > Lamassu > East 14
          tags: [xdoor]
    - name: Inside the Grate
      coord: [39.5, 13.65]
      data:
        flipside: Glacier Breach > Grate Work > Below Grate
      local:
        - to: West 14
        - to: Grate Left
          jumps: 1
      locations:
        - name: Notes
          item: Dr_Gloria
          tags: [standing]
    - name: Grate Left
      coord: [39.55, 13.4]
      local:
        - to: Inside the Grate
        - to: West 14
      exits:
        - to: Grate Right
          req: Nanite_Mist
          movement: mist1
        - to: Grate Right
          req: $mist2
          movement: mist2

- name: Grid 39-40,7-9  # MARK: Grid 39-40,7-9
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [40, 6, 41, 7]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Glacier East Revival Flask
  spots:
    - name: Upper East
      coord: [40.95, 7.95]
      local:
        - to: Upper Scaffolding
      exits:
        - to: Revival > West 8
          tags: [xshift]
    - name: First Upper Platform
      coord: [40.9, 7.5]
      local:
        - to: Upper Scaffolding
        - to: Third Upper Platform
          jumps: 2
      exits:
        - to: Revival > Save Point
          movement: base
          penalty_tags: [xshift, -base.1]
    - name: Third Upper Platform
      coord: [40.6, 6.95]
      local:
        - to: Floating Rock
          thru: [40.5, 6.7]
          jumps: [1, 0]
        - to: Upper Scaffolding
        - to: West
      exits:
        - to: Fortress Ledge
          req: $hook and $hover
          movement: fast_hover
          jumps: 1
      hybrid:
        # in theory we can do these? maybe even without the upgrades
        - name: Fly-by Flask Toward Fortress
          to: Fortress Ledge
          canon: Glacier 40,8 Flask
          item: Flask
          req: $hook and $hover and Slingshot_Weapon
          movement: fast_hover
          jumps: 1
          item_tags: [flask]
        - name: Charged Fly-by Flask Toward Fortress
          to: Fortress Ledge
          canon: Glacier 40,8 Flask
          item: Flask
          req: $hook and $hover and Slingshot_Charge
          movement: fast_hover
          jumps: 1
          item_tags: [flask]
          penalty_tags: [charge_time]
    - name: Floating Rock
      coord: [40.4, 6.7]
      local:
        - to: First Upper Platform
        - to: West
        - to: Upper Scaffolding
          thru: [40.3, 6.7]
      locations:
        - name: Item
          canon: Glacier 40,8 Flask
          item: Flask
          tags: [flask]
      exits:
        - to: Fortress Ledge
          req: $hover
          movement: base
          jumps: 1
        - to: Fortress Ledge
          req: $mist2
          movement: mist2
        - to: Fortress Ledge
          req: Nanite_Mist
          movement: mist1
      hybrid:
        - name: Flask Collection Skip
          to: Menu > Warp Only > Kiengir
          canon: Glacier 40,8 Flask
          item: Flask
          req: $melee_cskip
          tags: [cskip]
        - name: Flask Fast Travel
          to: Menu > Kiengir Map > Glacier East Revival Flask
          canon: Glacier 40,8 Flask
          item: Flask
          req: Fast_Travel and $melee_cskip
          tags: [cskip]
    - name: Fortress Ledge
      coord: [40.05, 6.75]
      local:
        - to: Fortress Wall
        - to: Upper Scaffolding
        - to: Under Scaffolding
      exits:
        - to: Floating Rock
          req: $hover
          movement: base
          jumps: 1
        - to: Fortress > Gate East
          movement: base
          penalty_tags: [xshift, -base.1]
        - to: Fortress > Parapet East Ledge
          movement: base
          jumps: 2
          penalty_tags: [xshift, -base.1]
    - name: Fortress Wall
      coord: [40.1, 7.75]
      local:
        - to: West
      exits:
        - to: Fortress Ledge
          req: $infinite_climb and Slingshot_Hook
          time: 3.0  # ?
        - to: Fortress Ledge
          req: $infinite_climb
          time: 4.2  # ?

    - name: Upper Scaffolding
      coord: [40.3, 7.95]
      local:
        - to: Upper East
        - to: West
        - to: Under Scaffolding
          jumps_down: 1
      exits:
        - to: Fortress Wall
          req: $hover and Anuman and Wall_Climb
          movement: base
          jumps: 2

    - name: West
      coord: [39.05, 8.65]
      local:
        - to: Upper Scaffolding
          thru: [[40.0, 8.3], [40.0, 8.2]]
          jumps: [2, 1, 1]
      exits:
        - to: Grid 37-38,9 > East
          tags: [xshift]
        - to: Fortress Ledge
          req: $mist2
          movement: mist2
        - to: Fortress Ledge
          req: Nanite_Mist
          movement: mist1

    # Southeast
    - name: Under Scaffolding
      coord: [40.3, 8.35]
      local:
        - to: West
        - to: Lower Floor
        - to: Upper Scaffolding
          thru: [[40.1, 8.25], [40.1, 8.1]]
          jumps: [1, 1, 1]
      exits:
        - to: East 9
          req: $hover
          movement: base
        - to: Upper Scaffolding
          req: $grab or $hook
          movement: base
          jumps: 2
        - to: Fortress Wall
          req: $hover and Anuman and Wall_Climb
          movement: base
          jumps: 3
    - name: Lower Floor
      coord: [40.65, 8.75]
      local:
        - to: West
          jumps: 1
      exits:
        - to: East 9
          req: $grab
          movement: base
          jumps: 2
        - to: East 9
          req: $hook
          movement: base
          jumps: 1
        - to: Under Scaffolding
          req: Anuman and $grab
          movement: base
          jumps: 2
        - to: Under Scaffolding
          req: $hook
          movement: base
          jumps: 1
    - name: East 9
      coord: [40.95, 8.4]
      local:
        - to: Lower Floor
      exits:
        - to: Revival > West 9
          tags: [xshift]
        - to: Under Scaffolding
          req: $hover
          movement: base
          jumps: 1

- name: Grid 37-38,9  # MARK: Grid 37-38,9
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East
      coord: [38.95, 8.65]
      local:
        - to: West
          jumps: 4
      exits:
        - to: Grid 39-40,7-9 > West
          tags: [xshift]
    - name: West
      coord: [37.05, 8.75]
      local:
        - to: East
          jumps: 4
      exits:
        - to: Vertical Room > East 9
          tags: [xshift]

- name: Vertical Room  # MARK: Vertical Room
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [36, 8, 37, 9]
    midgatestone: [36, 15, 37, 16]
    lswitch: [36, 16, 37, 17]
    south: [36, 17, 37, 18]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Glacier Vertical Room Flask
    water:
      midgatestone: true
      lswitch: true
      south: true
  start:
    _upper_gatestone: false
    _lower_gatestones: false
  spots:
    #region Upper
    - name: East 9
      coord: [36.95, 8.75]
      local:
        - to: West 9
        - to: Mid 9
        - to: Mid 11
          jumps_down: 1
      exits:
        - to: Grid 37-38,9 > West
          tags: [xshift]
        - to: Peak
          req: $grab
          time: 2.4
        - to: Peak
          req: $hook
          movement: base
          jumps: 2
        - to: Fortress Ledge
          req: $mist2
          movement: mist2
        - to: Fortress Ledge
          req: Nanite_Mist
          movement: mist1
    - name: West 9
      coord: [36.05, 8.75]
      local:
        - to: Mid 9
        - to: Mid 11
          jumps_down: 1
        - to: Under Switch
      exits:
        - to: Ledge Grab Room > East 9
          tags: [xshift]
        - to: Secret Door
          req: ^_hammonds_doors
          movement: base
    - name: Mid 9
      coord: [36.5, 8.8]
      local:
        - to: West 9
          jumps: 1
        - to: East 9
          jumps: 2
        - to: Mid 11
        - to: Under Switch
      exits:
        - to: Peak
          req: $grab
          time: 2
        - to: Peak
          req: $hook
          movement: base
          jumps: 2
        - to: Secret Door
          req: ^_hammonds_doors
          movement: base
    - name: Mid 11
      coord: [36.5, 11.3]
      local:
        - to: Under Switch
          jumps: 4
        - to: Mid 9
          jumps: 19
        - to: West 9
          jumps: 19
        - to: Lower West Corner
          jumps_down: 2
        - to: East 13
          jumps_down: 2
        - to: East Corner
      exits:
        - to: Mid 9
          req: $grab
          time: 10
        - to: Secret Door
          req: ^_hammonds_doors
          movement: base
          jumps: 6
        - to: Secret Door
          req: ^_hammonds_doors and $hook
          movement: base
          jumps: 3
    - name: Under Switch
      coord: [36.15, 10.7]
      local:
        - to: Mid 9
          jumps: 14
        - to: West 9
          jumps: 14
        - to: Mid 11
      locations:
        - name: Switch
          item: Switch_36_11
          req: Boomerang
          tags: [event]
      exits:
        - to: Mid 9
          req: $grab
          time: 7.5
        - to: Past Gate
          req: Switch_36_11
          movement: base
        - to: Secret Door
          req: ^_hammonds_doors
          movement: base
    - name: Past Gate
      coord: [36.05, 10.7]
      exits:
        - to: Under Switch
          req: Switch_36_11
          movement: base
        - to: Ledge Grab Room > East 11
          tags: [xshift]
    - name: Secret Door
      coord: [36.8, 10.75]
      local:
        - to: Mid 11
          thru: [36.5, 11.0]
        - to: Mid 9
          jumps: 15
        - to: West 9
          jumps: 15
        - to: Under Switch
          jumps: 3
      exits:
        - to: East 11
          req: ^_hammonds_doors
          movement: base
        - to: Under Switch
          req: ^_hammonds_doors and $hookhover
          movement: fast_hover
          jumps: 2
    - name: East 11
      coord: [36.95, 10.75]
      exits:
        - to: Secret Door
          req: ^_hammonds_doors
        - to: Secret Chamber > West 11
          tags: [xshift]
    - name: Peak
      coord: [36.4, 8.2]
      local:
        - to: Mid 9
        - to: East 9
      locations:
        - name: Flask
          canon: Glacier_Vertical_Room_Flask
          item: Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Glacier_Vertical_Room_Flask
          item: Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Glacier_Vertical_Room_Flask
          item: Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
      exits:
        - to: West 8
          req: $grab
          time: 2
        - to: West 8
          req: $hook
          movement: base
          jumps: 2
        - to: Fortress Wall
          req: $hover and Anuman and Wall_Climb
          movement: base
          jumps: 2
        - to: Fortress Ledge
          req: $mist2
          movement: mist2
        - to: Fortress Ledge
          req: Nanite_Mist
          movement: mist1
    - name: West 8
      coord: [36.05, 7.75]
      local:
        - to: Peak
      exits:
        - to: Peak > East 8
          tags: [xshift]
        - to: Fortress Wall
          req: $hover and Anuman and Wall_Climb
          movement: base
    #endregion

    #region Upper Mid
    - name: East Corner
      coord: [36.85, 11.55]
      local:
        - to: Mid 11
          jumps: 2
        - to: Lower West Corner
        - to: East 13
          thru: [36.5, 12.0]
      exits:
        - to: East 12
          req: $grab
          movement: base
          jumps: 2
    - name: East 12
      coord: [36.95, 11.3]
      local:
        - to: East Corner
      exits:
        - to: Boomerang Antechamber > West 12
          req: $grab
          tags: [xshift]
    - name: Lower West Corner
      coord: [36.3, 12.4]
      local:
        - to: Mid 11
          jumps: 8
        - to: East Corner
          thru: [36.3, 11.7]
          jumps: [5, 3]
        - to: East 13
        - to: Upper Gatestone
    - name: East 13
      coord: [36.95, 12.8]
      local:
        - to: Lower West Corner
          jumps: 3
        - to: Upper Gatestone
          jumps: 2
      exits:
        - to: Boomerang Antechamber > West 13
          tags: [xshift]
    - name: Upper Gatestone
      coord: [36.5, 12.7]
      local:
        - to: Lower West Corner
          jumps: 2
        - to: East 13
          jumps: 2
      exits:
        - to: Above Switch
          req: ^_upper_gatestone
          movement: base
        - to: Upper Switch
          req: ^_upper_gatestone
          movement: base
        - to: Below Upper Switch
          req: ^_upper_gatestone
          movement: base
    #endregion

    #region Lower
    - name: Above Switch
      coord: [36.65, 13.4]
      local:
        - to: East 14
        - to: Upper Switch
      exits:
        - to: Upper Gatestone
          req: $hook and $hover and ^_upper_gatestone

    - name: East 14
      coord: [36.95, 13.8]
      local:
        - to: Upper Switch
        - to: Below Upper Switch
          thru: [36.75, 13.85]
      exits:
        - to: Crystals > West
          tags: [xshift]
        - to: Above Switch
          req: $hook
          movement: base
          jumps: 1
    - name: Upper Switch
      coord: [36.5, 13.8]
      local:
        - to: Below Upper Switch
        - to: East 14
      exits:
        - to: Above Switch
          req: $hook
          movement: base
          jumps: 1
      actions:
        - name: Open Gate
          req: $open
          do: ^_upper_gatestone = true
          tags: [hack]
    - name: Below Upper Switch
      coord: [36.65, 14.15]
      local:
        - to: Flat Platform
        - to: Middle Gatestone
      exits:
        - to: Upper Switch
          req: $grab or $hook
          movement: base
          jumps: 1
        - to: East 14
          req: $grab
          movement: base
          jumps: 2
        - to: East 14
          req: $hook
          movement: base
          jumps: 1
        - to: Amagi > East Lake > East 15 Upper Hover
          req: $hook and $hover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: Flat Platform
      coord: [36.45, 14.55]
      local:
        - to: West 15 Flat
        - to: West 15 Lower
          jumps_down: 1
        - to: Middle Gatestone
      exits:
        - to: Below Upper Switch
          req: $hook and $hover
          movement: base
          jumps: 2
    - name: West 15 Flat
      coord: [36.05, 14.55]
      local:
        - to: Flat Platform
        - to: Water's Ledge
          jumps_down: 1
      exits:
        - to: Amagi > East Lake > East 15 Flat
          tags: [xshift]
    - name: West 15 Lower
      coord: [36.05, 14.7]
      local:
        - to: Flat Platform
          jumps: 1
        - to: Water's Ledge
      exits:
        - to: Amagi > East Lake > East 15 Lower
          tags: [xshift]
    - name: Water's Ledge
      coord: [36.5, 14.8]
      local:
        - to: Middle Gatestone
        - to: West 15 Lower
          jumps: 1
        - to: West 15 Flat
          jumps: 1
        - to: Flat Platform
          jumps: 1
      exits:
        - to: Amagi > East Lake > East 15 Lower Hover
          req: $hook and $hover
          movement: fast_hover
          jumps: 1
          penalty_tags: [xshift, -fast_hover.1]


    - name: Middle Gatestone
      coord: [36.6, 15.75]
      data:
        flipside: Amagi Breach > East Connector > Center Right
      local:
        - to: Outcrop by Middle Gatestone
          jumps: 1
          jump_mvmt: water
      exits:
        - to: Lower Switch
          req: ^_lower_gatestones
          movement: base
        - to: Lower Gatestone
          req: ^_lower_gatestones
          movement: base
        - to: Lower Switch
          req: ^_lower_gatestones and Underwater_Movement
          movement: water
        - to: Lower Gatestone
          req: ^_lower_gatestones and Underwater_Movement
          movement: water
    - name: Middle Gatestone Left
      coord: [36.45, 15.75]
      data:
        flipside: Amagi Breach > East Connector > Center Left
      local:
        - to: Middle Gatestone
      exits:
        - to: Lower Switch
          req: ^_lower_gatestones
          movement: base
        - to: Lower Gatestone
          req: ^_lower_gatestones
          movement: base
        - to: Lower Switch
          req: ^_lower_gatestones and Underwater_Movement
          movement: water
        - to: Lower Gatestone
          req: ^_lower_gatestones and Underwater_Movement
          movement: water
    - name: Outcrop by Middle Gatestone
      coord: [36.75, 15.4]
      data:
        flipside: Amagi Breach > East Connector > Outcrop
      local:
        - to: Middle Gatestone
      exits:
        - to: Water's Ledge
          req: Underwater_Movement and $hook
          movement: water
          jumps: 2

    - name: Lower Switch
      coord: [36.5, 16.5]
      data:
        water: true
      local:
        - to: Lower Gatestone
        - to: East 17
      exits:
        - to: Middle Gatestone
          req: Underwater_Movement and $hook and ^_lower_gatestones
          movement: base
          jumps: 2
      actions:
        - name: Open Lower Gatestones
          req: $open
          do: ^_lower_gatestones = true
          tags: [open]
    - name: East 17
      coord: [36.9, 16.75]
      data:
        water: true
      local:
        - to: Lower Switch
          jumps: 1  # Not that doable without Water Movement but we can reach the switch with the hack radius
        - to: Lower Gatestone
      exits:
        - to: Annuna > Hidden Portal > West
          tags: [xdoor]
    - name: East 17 while hovering
      coord: [36.9, 16.65]
      data:
        water: true
      local:
        - to: Lower Gatestone
        - to: East 17
      exits:
        - to: Lower Switch
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          jumps: 1
        - to: Lower Switch
          req: $hook and $hover
          movement: base  # I think we get slowed down?
          jumps: 1
        - to: Lower Gatestone
          req: Underwater_Movement
          movement: fast_hover
    - name: Lower Gatestone
      coord: [36.6, 17.0]
      data:
        water: true
      local:
        - to: East 17
          jumps: 1
          jump_mvmt: water
      exits:
        - to: Lower Switch
          req: $hook
          movement: base
          jumps: 2
        - to: South
          req: ^_lower_gatestones
          movement: base
    - name: South
      coord: [36.5, 17.8]
      exits:
        - to: Lower Gatestone
          req: Underwater_Movement and ^_lower_gatestones
          movement: base
          jumps: 2
        # There are probably other options without water movement (hook etc)
        - to: Annuna > West Climb > North
          tags: [ydoor]
    #endregion

    #region Aerial
    - name: Fortress Wall
      coord: [36.9, 7.9]
      local:
        - to: East 9
      exits:
        - to: Fortress Ledge
          req: $infinite_climb and Slingshot_Hook
          time: 3.6  # ?
        - to: Fortress Ledge
          req: $infinite_climb
          time: 4.8  # ?
    - name: Fortress Ledge
      coord: [36.95, 6.75]
      local:
        - to: Peak
        - to: Mid 9
        - to: Fortress Wall
      exits:
        - to: West 8
          req: $hover
          movement: base
        - to: Fortress > Parapet West Ledge
          req: $hook
          movement: base
          jumps: 1
          penalty_tags: [xshift, -base.1]
        - to: Fortress > Parapet West Ledge
          req: $grab and $climb
          movement: base
          jumps: 3
          penalty_tags: [xshift, -base.1]
    - name: Flying West
      coord: [36.2, 5.9]
      exits:
        - to: Peak > Top Platform East
          req: $hookhover
          movement: fast_hover
    - name: Hovering East
      coord: [36.5, 6.0]
      exits:
        - to: Fortress > Parapet West Ledge
          req: $hover
          movement: base
          penalty_tags: [xshift, -base.1]
        - to: Fortress > Parapet West Hook Point
          req: $hookhover
          movement: base
          penalty_tags: [xshift, -base.1]
    #endregion

- name: Boomerang Antechamber  # MARK: Boomerang Antechamber
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West 13
      coord: [37.05, 12.8]
      local:
        - to: East 12
          jumps: 9
        - to: East 13
          jumps: 4
        # technically others are feasible but omitted for uselessness
      exits:
        - to: Vertical Room > East 13
          tags: [xshift]
    - name: East 12
      coord: [38.95, 11.8]
      local:
        - to: Upper East
          thru: [38.35, 11.55]
          jumps: [2, 2]
        - to: West 12
          jumps: 2
        - to: West 13
        - to: East 13
          thru: [38.55, 12.0]
      exits:
        - to: Boomerang Room > West
          tags: [xshift]
    - name: Upper East
      coord: [38.95, 11.35]
      local:
        - to: West 13
        - to: West 12
          jumps: 2
        - to: East 12
          thru: [38.6, 11.4]
        - to: East 13
          thru: [[38.6, 11.4], [38.55, 12.0]]
          jumps_down: [0, 1, 0]
      exits:
        - to: Boomerang Room > Upper West
          req: Switch_40_12
          tags: [xshift]
    - name: West 12
      coord: [37.05, 11.3]
      local:
        - to: West 13
          thru: [37.9, 11.8]
        - to: Upper East
          jumps: 1
        - to: East 12
        - to: East 13
      exits:
        - to: Vertical Room > East 12
          tags: [xshift]
    - name: East 13
      coord: [38.95, 12.75]
      local:
        - to: West 13
          jumps: 4
        - to: East 12
          thru: [38.15, 12.6]
          jumps: [1, 5]
      exits:
        - to: Sea Burial > West 13
          tags: [xshift]
        - to: Sea Burial > West 14
          req: $offset
          time: 50
          tags: [xshift, offset]

- name: Boomerang Room  # MARK: Boomerang Room
  on_entry: $reset_old_area(^newpos)
  map:
    rang: [40, 11, 41, 12]
  datamap:
    map_spot:
      rang: Menu > Kiengir Map > Boomerang
  spots:
    - name: West
      coord: [39.05, 11.8]
      local:
        - to: Platform
          jumps: 2
      exits:
        - to: Boomerang Antechamber > East 12
          tags: [xshift]
    - name: Platform
      coord: [39.4, 11.55]
      local:
        - to: West
        - to: Center-ish
      exits:
        - to: Upper West
          req: Switch_40_12
          movement: base
          jumps: 2
    - name: Center-ish
      coord: [39.8, 11.6]
      local:
        - to: Platform
          jumps: 1
        - to: Pedestal
      exits:
        - to: Center Ledge
          req: $grab and Switch_40_12
          movement: base
          jumps: 2
    - name: Pedestal
      coord: [40.5, 11.75]
      local:
        - to: Center-ish
          jumps: 1
      locations:
        - name: Item
          item: Boomerang
          tags: [standing]
        - name: Switch
          item: Switch_40_12
          req: Boomerang
          tags: [event]
      exits:
        - to: Upper Gate East
          req: Switch_40_12
          movement: base
          jumps: 3
    - name: Upper Gate East
      coord: [40.35, 11.35]
      local:
        - to: Pedestal
      exits:
        - to: Center Ledge
          req: Switch_40_12
          movement: base
    - name: Center Ledge
      coord: [40.0, 11.35]
      local:
        - to: Center-ish
        - to: Platform
      exits:
        - to: Upper Gate East
          req: Switch_40_12
          movement: base
    - name: Upper West
      coord: [39.05, 11.35]
      exits:
        - to: Platform
          req: Switch_40_12
          movement: base
        - to: Boomerang Antechamber > Upper East
          tags: [xshift]

- name: Ledge Grab Room  # MARK: Ledge Grab Room
  on_entry: $reset_old_area(^newpos)
  map:
    urn: [33, 10, 34, 11]
  datamap:
    map_spot:
      urn: Menu > Kiengir Map > Ledge Grab
  spots:
    - name: East 9
      coord: [35.95, 8.75]
      exits:
        - to: Vertical Room > West 9
          tags: [xshift]
        - to: Column
          req: $grab
          time: 2
        - to: Column
          req: $hook
          movement: base
          jumps: 1
        - to: Vertical Room > Past Gate
          req: $offset
          time: 20
          tags: [xshift, offset]
    - name: Column
      coord: [35.4, 8.55]
      local:
        - to: Gate Ledge
        - to: Fork
        - to: East 9
      exits:
        - to: Ledge Grab Room > Mid 35
          time: 2.25
    - name: Gate Ledge
      coord: [35.1, 8.65]
      local:
        - to: Fork
        - to: Upper Grate Right
          jumps: 1
      exits:
        # Requires mist, hover, hook, climb, or grab
        - to: Column
          req: $grab or $climb
          time: 2
        - to: Column
          req: $hover or $hook
          movement: base
          jumps: 1

    - name: East 11
      coord: [35.95, 10.7]
      local:
        - to: Mid 35
      exits:
        - to: Vertical Room > Past Gate
          tags: [xshift]
    - name: Mid 35
      coord: [35.4, 10.75]
      local:
        - to: East 11
          jumps: 1
        - to: Mid 34
          jumps: 3
      exits:
        - to: Fork
          req: $grab
          time: 6.1
    - name: Mid 34
      coord: [34.5, 10.35]
      local:
        - to: Mid 35
        - to: Cliff
      exits:
        - to: Lower Platform
          req: $grab
        - to: Lower Platform
          req: $hook
          movement: base
          jumps: 1
    - name: Cliff
      coord: [34.1, 10.5]
      local:
        - to: Mid 34
          jumps: 1
        - to: Cliff Bottom
      exits:
        - to: Lower Platform
          req: $grab
          time: 1.2

    - name: Cliff Bottom
      coord: [34.0, 10.8]
      local:
        - to: Pedestal
          jumps: 1
      locations:
        - name: Quick Grab
          item: Ledge_Grab
          canon: Ledge_Grab
          req: Boomerang
          tags: [remote_urn]
      exits:
        - to: Cliff
          req: $grab
          movement: base
          jumps: 2
        - to: Cliff
          req: $hook
          movement: base
          jumps: 1
    - name: Pedestal
      coord: [33.5, 10.6]
      local:
        - to: Gate
        - to: Cliff Bottom
      locations:
        - name: Item
          item: Ledge_Grab
          canon: Ledge_Grab
          tags: [urn]
      exits:
        - to: West End
          req: $grab
          time: 4
    - name: Gate
      coord: [33.15, 10.75]
      local:
        - to: Pedestal
          jumps: 1
      exits:
        - to: West End
          req: $grab
          time: 3.1
        - to: West 11
          req: Nanite_Mist
          movement: mist1
        - to: West 11
          req: $mist2
          movement: mist2
        - to: Angry Guards > Gate
          req: $mist2
          movement: mist2
          penalty_tags: [xshift, -base.1]
    - name: West 11
      coord: [33.05, 10.85]
      exits:
        - to: Angry Guards > East 11
          tags: [xshift]
        - to: Gate
          req: Nanite_Mist
          movement: mist1
        - to: Gate
          req: $mist2
          movement: mist2

    - name: West End
      coord: [33.3, 9.8]
      local:
        - to: Upper Platform
          jumps: 1
        - to: Lower Platform
        - to: Gate
        - to: Pedestal
    - name: Lower Platform
      coord: [34.4, 10.1]
      local:
        - to: Mid 34
        - to: Cliff
      exits:
        - to: Upper Platform
          req: $grab
          time: 2
        - to: Upper Platform
          req: $hook
          movement: base
          jumps: 3
        - to: West End
          req: $climb
          movement: base
          jumps: 3
    - name: Upper Platform
      coord: [34.5, 9.55]
      local:
        - to: West End
        - to: Lower Platform
        - to: Cliff
        - to: Mid 34
      exits:
        - to: Fork
          req: $grab
          time: 2.4
    - name: Fork
      coord: [35, 9.1]
      local:
        - to: Upper Platform
        - to: Mid 34
          thru: [34.65, 9.3]
        - to: East 11
          thru: [35.4, 9.65]
        - to: Mid 35
          thru: [35.4, 9.65]
      exits:
        - to: Column
          req: $grab
          movement: base
          jumps: 4
        - to: Column
          req: $hook
          movement: base
          jumps: 3
        - to: Gate Ledge
          req: $grab
          movement: base
          jumps: 4
        - to: Gate Ledge
          req: $hook
          movement: base
          jumps: 2

    # Northwest area
    - name: Upper Grate Right
      coord: [34.75, 8.5]
      local:
        - to: Gate Ledge
      exits:
        - to: Upper Grate Left
          req: Nanite_Mist
          movement: mist1
        - to: Upper Grate Left
          req: $mist2
          movement: mist2
        - to: North
          req: Nanite_Mist
          movement: mist1
        - to: North
          req: $mist2
          movement: mist2
    - name: Upper Grate Left
      coord: [34.65, 8.5]
      local:
        - to: Upper Mid-air
          jumps: 1
      exits:
        - to: Upper Grate Right
          req: Nanite_Mist
          movement: mist1
        - to: Upper Grate Right
          req: $mist2
          movement: mist2
    - name: North
      coord: [34.5, 8.2]
      local:
        - to: Upper Path
        - to: Upper Mid-air
        - to: Upper Hill
        - to: Upper Grate Left
      exits:
        - to: Peak > South
          req: Nanite_Mist
          movement: mist1  
          tags: [ydoor]  # tags, not penalty_tags, to set the time
          # TODO: this can be partially paid, because we still make it if we run out partway
    - name: Upper Mid-air
      coord: [34.5, 8.45]
      local:
        - to: Upper Hill
        - to: Upper Grate Left
        - to: Upper Path
      exits:
        - to: North
          req: Nanite_Mist
          movement: mist1
        - to: North
          req: $mist2
          movement: mist2
    - name: Upper Hill
      coord: [34.45, 8.55]
      local:
        - to: Upper Path
        - to: Upper Mid-air
          jumps: 1
        - to: Upper Grate Left
          jumps: 1
    - name: Upper Path
      coord: [33.6, 9.1]
      local:
        - to: Upper at Wall
          jumps: 2
        - to: Upper Hill
          jumps: 5
      exits:
        - to: Northwest Ledge
          req: $hook and $hover
          movement: base
          jumps: 1
    - name: Upper at Wall
      coord: [33.25, 8.95]
      local:
        - to: Upper Path
      exits:
        - to: Northwest Ledge
          req: $grab
          movement: base
          jumps: 2
        - to: Northwest Ledge
          req: $hook
          movement: base
          jumps: 1
    - name: Northwest Ledge
      coord: [33.15, 8.6]
      local:
        - to: West 9
          jumps: 1
        - to: Upper Path
        - to: Upper at Wall
    - name: West 9
      coord: [33.05, 8.5]
      local:
        - to: Northwest Ledge
      exits:
        - to: Grid 32,7-10 > East 9
          tags: [xshift]

- name: Peak  # MARK: Peak
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 8
      coord: [35.95, 7.75]
      exits:
        - to: Vertical Room > West 8
          tags: [xshift]
        - to: Top Platform East
          req: $grab or $climb
          time: 7
    - name: Top Platform East
      coord: [35.1, 6.05]
      local:
        - to: Top Rock
          jumps: 1
        - to: East 8
      exits:
        - to: Highest Platform
          req: $hover
          movement: base
          jumps: 1
        - to: Vertical Room > Hovering East
          req: $hover
          movement: base
          jumps: 1
          penalty_tags: [xshift, -base.1]
    - name: Top Rock
      coord: [34.6, 5.9]
      local:
        - to: West Cliff
        - to: Top Platform East
      exits:
        - to: Highest Platform
          req: $hover
          movement: base
          jumps: 2
    - name: Highest Platform
      coord: [34.6, 5.7]
      local:
        - to: Top Rock
          jumps_down: 1
        - to: West Cliff
        - to: Top Platform East
    - name: West Cliff
      coord: [33.65, 6.55]
      local:
        - to: Top Rock
          jumps: 7
        - to: Under West Cliff
        - to: West 8
    - name: Under West Cliff
      coord: [33.6, 7.2]
      local:
        - to: West 8
      exits:
        - to: West Cliff
          req: $grab
          time: 2
        - to: West Cliff
          req: $hook
          movement: base
          jumps: 3
    - name: West 8
      coord: [33.05, 7.75]
      local:
        - to: Under West Cliff
          jumps: 4
      exits:
        - to: Grid 32,7-10 > East 8
          tags: [xshift]

    # Small cave in the south
    - name: South
      coord: [34.5, 7.8]
      data:
        map_spot: Menu > Kiengir Map > Glacier Peak Bird's Eye
      local:
        - to: Bird's Eye
      exits:
        - to: Ledge Grab Room > North
          tags: [ydoor]
    - name: Bird's Eye
      coord: [34.6, 7.8]
      data:
        map_spot: Menu > Kiengir Map > Glacier Peak Bird's Eye
      local:
        - to: South
      locations:
        - name: Item
          item: Health_Fragment
          tags: [standing]

- name: Grid 32,7-10  # MARK: Grid 32,7-10
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 8
      coord: [32.95, 7.75]
      local:
        - to: Center Platform
        - to: Column
        - to: Grate Left Upper
          thru: [32.75, 8.0]
      exits:
        - to: Peak > West 8
          tags: [xshift]
    - name: Center Platform
      coord: [32.6, 7.8]
      local:
        - to: East 8
          jumps: 1
        - to: Column
          jumps_down: 1
        - to: West 9
        - to: Left Rock
    - name: Column
      coord: [32.6, 8.2]
      local:
        - to: East 8
        - to: Center Platform
        - to: West 9
        - to: Left Rock
        - to: Grate Left
      local:
        - to: Center Platform
          jumps: 3
        - to: East 8
          jumps: 3
    - name: Left Rock
      coord: [32.3, 8.6]
      local:
        - to: West 9
          jumps: 1
        - to: West 10
      exits:
        - to: Column
          req: $grab or $climb
          time: 1.4
        - to: Column
          req: $hook
          movement: base
          jumps: 1
    - name: West 9
      coord: [32.05, 8.55]
      local:
        - to: West 10
          jumps_down: 1
        - to: Left Rock
      exits:
        - to: Grid 31,9-12 > East 9
          tags: [xshift]
        - to: Column
          req: $hookhover
          movement: base
          jumps: 1
        - to: Grate Left Upper
          req: $hookhover
          movement: base
          jumps: 1
    - name: West 10
      coord: [32.05, 9.275]
      exits:
        - to: Left Rock
          req: $grab or $climb
          time: 1.6
        - to: Left Rock
          req: $hook
          movement: base
          jumps: 2
    # Grate
    - name: Grate Left
      coord: [32.8, 8.5]
      local:
        - to: Column
          jumps: 1
      exits:
        - to: East 9
          req: Nanite_Mist
          movement: mist1
        - to: East 9
          req: $mist2
          movement: mist2
    - name: Grate Left Upper
      coord: [32.8, 8.3]
      local:
        - to: Grate Left
      exits:
        - to: East 9
          req: Nanite_Mist
          movement: mist1
        - to: East 9
          req: $mist2
          movement: mist2
    - name: East 9
      coord: [32.95, 8.5]
      exits:
        - to: Grate Left
          req: Nanite_Mist
          movement: mist1
        - to: Grate Left
          req: $mist2
          movement: mist2
        - to: Ledge Grab Room > West 9
          tags: [xshift]

- name: Grid 31,9-12  # MARK: Grid 31,9-12
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 9
      coord: [31.95, 8.55]
      local:
        - to: East 10
        - to: Observation Tower
        - to: Midair
      exits:
        - to: Grid 32,7-10 > West 9
          tags: [xshift]
    - name: East 10
      coord: [31.95, 9.275]
      local:
        - to: Observation Tower
        - to: Midair
      exits:
        - to: Grid 32,7-10 > West 10
          tags: [xshift]
    - name: Observation Tower
      coord: [31.3, 10.35]
      local:
        - to: East 10
          jumps: 7
        - to: Midair
        - to: Observation Tower L4
        - to: West 12
    - name: Observation Tower L4
      coord: [31.2, 10.8]
      local:
        - to: Observation Tower
          jumps: 2
        - to: West 12
        - to: Midair
          jumps: 2
    - name: West 12
      coord: [31.05, 11.7]
      local:
        - to: Observation Tower L4
          jumps: 5
      exits:
        - to: Ebih > Base Camp > East 12
          tags: [xshift]
    - name: Midair
      coord: [31.05, 10.35]
      local:
        - to: Observation Tower
        - to: Observation Tower L4
      exits:
        - to: Ebih > Base Camp > East 11
          tags: [xshift]
        - to: East 10
          req: $mist2
          movement: mist2

- name: Lake Main Entrance  # MARK: Lake Main Entrance
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [32, 12, 33, 13]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Glacier Lake Main Entrance Flask
  spots:
    - name: Ebih Access
      coord: [31.05, 12.7]
      local:
        - to: Upper
      exits:
        - to: Ebih > Base Camp > Lake Access
          tags: [xshift]
    - name: Upper
      coord: [31.35, 13.05]
      local:
        - to: Ebih Access
          jumps: 2
        - to: Upper Platform
        - to: Ledge
    - name: Upper Platform
      coord: [31.6, 13.6]
      local:
        - to: Ledge
        - to: Lower Platform
          jumps_down: 1
        - to: Bottom
          jumps_down: 1
        - to: Lake Access
          jumps_down: 1
        - to: Side Jump
      exits:
        - to: Upper
          req: $grab
          time: 1.85
        - to: Upper
          req: $hook
          movement: base
          jumps: 2
    - name: Ledge
      coord: [31.55, 13.7]
      local:
        - to: Upper Platform
          jumps: 1
        - to: Lower Platform
        - to: Bottom
          thru: [31.55, 13.8]
        - to: Lake Access
          thru: [31.55, 13.8]
      exits:
        - to: Upper
          req: $climb and $grab
          time: 2
        - to: Upper
          req: $hook
          movement: base
          jumps: 2
    - name: Lower Platform
      coord: [31.7, 13.95]
      local:
        - to: Hill
        - to: Side Jump
          jumps: 1
      exits:
        - to: Ledge
          req: $grab
        - to: Ledge
          req: $hook
          movement: base
          jumps: 1
    - name: Hill
      coord: [31.85, 14.1]
      local:
        - to: Lower Platform
          jumps: 1
        - to: Side
        - to: Bottom
    - name: Bottom
      coord: [31.4, 14.85]
      local:
        - to: Hill
          jumps: 4
        - to: Lake Access
    - name: Side Jump
      coord: [32.0, 13.9]
      local:
        - to: Side
    - name: Side
      coord: [32.0, 14.1]
      local:
        - to: Side Jump
          jumps: 1
        - to: Lower Platform
          jumps: 1
        - to: Hill
    - name: Lake Access
      coord: [31.05, 14.85]
      local:
        - to: Bottom
      exits:
        - to: Amagi > Main Area > East 15
          tags: [xshift]

    - name: East 13
      coord: [32.95, 12.7]
      local:
        - to: Close Enough
          jumps: 1
      exits:
        - to: Sliced Cavern > West 13
          tags: [xshift]
    - name: Close Enough
      coord: [32.75, 12.4]
      local:
        - to: Cache
          jumps: 1
        - to: East 13
      locations:
        - name: Shockwave Flask
          canon: Glacier_Lake_Main_Entrance_Flask
          item: Big_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
        - name: Boomerang Flask
          canon: Glacier_Lake_Main_Entrance_Flask
          item: Big_Flask
          req: $boomerang
          tags: [remote_flask]
        - name: Boomerang Fast Travel
          canon: Glacier_Lake_Main_Entrance_Flask
          item: Big_Flask
          req: $boomerang and Fast_Travel
          to: ^map_spot
          tags: [throw]
    - name: Cache
      coord: [32.6, 12.3]
      local:
        - to: Close Enough
      locations:
        - name: Flask
          canon: Glacier_Lake_Main_Entrance_Flask
          item: Big_Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Glacier_Lake_Main_Entrance_Flask
          item: Big_Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Glacier_Lake_Main_Entrance_Flask
          item: Big_Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]

- name: Apocalypse Entry  # MARK: Apocalypse Entry
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West 10
      coord: [44.05, 10.0]
      local:
        - to: Terminal
      exits:
        - to: Grid 43,10-11 > East
          tags: [xshift]
    - name: Terminal
      coord: [44.6, 10.0]
      local:
        - to: West 10
        - to: Grate Ledge
        - to: Above Grate
    - name: Grate Ledge
      coord: [44.65, 10.2]
      local:
        - to: Above Grate
      exits:
        - to: Terminal
          req: not Apocalypse_Bomb
          movement: base
          jumps: 2
      hybrid:
        - name: Escape
          canon: Escape
          item: Escape
          req: Apocalypse_Bomb
          to: Terminal
          movement: base
          jumps: 1
        - name: Hook Escape
          canon: Escape
          item: Escape
          req: Apocalypse_Bomb and $hook
          to: Terminal
          movement: fast_hover
          jumps: 1
    - name: Above Grate
      coord: [44.55, 10.2]
      exits:
        - to: Below Grate
          req: Nanite_Mist
          movement: mist1
        - to: Below Grate
          req: $mist2
          movement: mist2
    - name: Below Grate
      coord: [44.55, 10.5]
      local:
        - to: Shaft Bottom
      exits:
        - to: Grate Ledge
          req: Apocalypse_Bomb
          movement: base  # TODO: slingshot movements etc
          jumps: 2
        - to: Grate Ledge
          req: Apocalypse_Bomb and $hook
          movement: fast_hover
          jumps: 1
    - name: Shaft Bottom
      coord: [44.45, 14.4]
      local:
        - to: Lowest Stair
      exits:
        - to: Below Grate
          req: $grab
          movement: base
          jumps: 25
        - to: Below Grate
          req: $hook
          movement: base
          jumps: 10
    - name: Lowest Stair
      coord: [44.2, 14.7]
      local:
        - to: West 15 Lower
        - to: West 15 Upper
          jumps: 1
        - to: Shaft Bottom
          jumps: 2
      exits:
        - to: Shaft Bottom
          req: $hook
          movement: fast_hover
          jumps: 1
    - name: West 15 Lower
      coord: [44.05, 14.75]
      local:
        - to: Lowest Stair
          jumps: 1
      exits:
        - to: Annuna > Apocalypse Hallway > Lower East
          tags: [xshift]
        - to: Lowest Stair
          req: $hook
          movement: fast_hover  # ?
          jumps: 1
    - name: West 15 Upper
      coord: [44.05, 14.6]
      local:
        - to: Lowest Stair
      exits:
        - to: Annuna > Apocalypse Hallway > Upper East
          tags: [xshift]

- name: Crystals  # MARK: Crystals
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Cage
  map:
    lower: [37, 15, 38, 16]
    upper: [37, 13, 38, 14]
  datamap:
    map_spot:
      lower: Menu > Kiengir Map > Breach Attractor
      upper: Menu > Kiengir Map > Bounty List
    water:
      lower: true
  spots:
    - name: West
      coord: [37.05, 13.8]
      local:
        - to: Middle Ledge
      exits:
        - to: Upper Ledge
          req: $hover or $hook
          movement: base
          jumps: 1
        - to: Vertical Room > East 14
          tags: [xshift]
    - name: Upper Ledge
      coord: [37.5, 13.7]
      local:
        - to: Top Corner
        - to: Middle Ledge
        - to: Grate Left
        - to: Portal Stand
        - to: Lower Corner
        - to: Midwest Slope
      exits:
        - to: West
          req: $hover
          movement: base
        - to: Top Corner
          req: $hook and $hover
          movement: fast_hover
    - name: Top Corner
      coord: [37.8, 13.7]
      local:
        - to: Upper Ledge
      locations:
        - name: Tablet
          item: Bounty_List
          tags: [standing]

    - name: Midwest Slope
      coord: [37.15, 14.25]
      local:
        - to: Middle Ledge
      exits:
        - to: West
          req: $hover
          movement: base
          jumps: 3
        - to: Upper Ledge
          req: $hook and $hover
          movement: base
          jumps: 3

    - name: Middle Ledge
      coord: [37.35, 14.6]
      data:
        flipside: Amagi Breach > East Entrance > Upper Slope
      local:
        - to: Grate Left
        - to: Portal Stand
        - to: Lower Corner
        - to: Midwest Slope
          jumps: 2
    - name: Grate Left
      coord: [37.75, 14.7]
      data:
        flipside: SpotId::None
      local:
        - to: Portal Stand
        - to: Lower Corner
      exits:
        - to: Middle Ledge
          req: $hover
          movement: base
          jumps: 1
        - to: Portal Cage
          req: Nanite_Mist
          movement: mist1
        - to: Portal Cage
          req: $mist2
          movement: mist2

    - name: Lower Slope
      coord: [37.8, 15.3]
      local:
        - to: Lower Corner
        - to: Portal Stand
      exits:
        - to: Middle Ledge
          req: Underwater_Movement and $hook and $hover
          movement: water
          jumps: 2
        - to: Grate Left
          req: Nanite_Mist
          movement: mist1
        - to: Grate Left
          req: $mist2
          movement: mist2
    - name: Lower Corner
      coord: [37.7, 15.6]
      local:
        - to: Lower Slope
          jumps: 2
        - to: Lower Slope
          jumps: 1
          jump_mvmt: water
        - to: Portal Stand
      locations:
        - name: Item
          item: Breach_Attractor
          tags: [standing]
    - name: Portal Stand
      coord: [37.475, 15.6]
      data:
        flipside: Amagi Breach > East Entrance > Save Point
      local:
        - to: Lower Corner
        - to: Lower Slope
          jumps: 1
          jumps_mvmt: water
      exits:
        - to: Lower Slope
          req: $hover
          movement: base
          jumps: 1

    - name: East
      coord: [37.95, 14.6]
      local:
        - to: Portal Cage
      exits:
        - to: Annuna > Lamassu > West 15
          tags: [xshift]
    - name: Portal Cage
      coord: [37.85, 14.7]
      data:
        flipside: Amagi Breach > East Entrance > Grate Right
      local:
        - to: East
          jumps: 1
      exits:
        - to: Grate Left
          req: Nanite_Mist
          movement: mist1
        - to: Grate Left
          req: $mist2
          movement: mist2

- name: Hammond's End  # MARK: Hammond's End
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Upper Portal Stand
  map:
    hammond: [40, 10, 41, 11]
    health: [39, 10, 40, 11]
  datamap:
    map_spot:
      hammond: Menu > Kiengir Map > Hammond
      health: Menu > Kiengir Map > Hammond's Health
  spots:
    - name: Upper Grate Left
      coord: [39.9, 9.6]
      local:
        - to: Upper Stair
      exits:
        - to: Upper Portal Stand
          req: $hover
          movement: base
    - name: Upper Grate Right
      coord: [40.05, 9.6]
      data:
        flipside: Glacier Breach > Save and Exit > Halfway
      local:
        - to: Upper Floor
        - to: Upper Right Pedestal
      exits:
        - to: Upper Grate Left
          req: Nanite_Mist
          movement: mist1
        - to: Upper Grate Left
          req: $mist2
          movement: mist2
    - name: Upper Floor
      coord: [40.25, 9.8]
      local:
        - to: Upper Grate Right
          jumps: 1
        - to: Upper Right Pedestal
          jumps: 1
      actions:
        - name: Move Portal to Lower West
          req: Breach_Attractor and Anuman
          do: ^portal = `Glacier > Hammond's End > Lower Pedestal West`
          to: Upper Right Mid-air
          time: 3
        - name: Move Portal to Note
          req: Breach_Attractor and Anuman
          do: ^portal = `Glacier > Hammond's End > Hammond`
          to: Hammond
          time: 5.5
      exits:
        - to: Upper Right Mid-air
          req: $hook and $hover
          movement: fast_hover
          jumps: 1
    - name: Upper Right Pedestal
      coord: [40.475, 9.6]
      data:
        flipside: Glacier Breach > Save and Exit > Portal Stand
      local:
        - to: Upper Right Mid-air
        - to: Upper Floor
        - to: Upper Grate Right
      actions:
        - name: Move Portal to Lower West
          req: Breach_Attractor and Anuman
          do: ^portal = `Glacier > Hammond's End > Lower Pedestal West`
          to: Upper Right Mid-air
          time: 2.5
        - name: Move Portal to Note
          req: Breach_Attractor and Anuman
          do: ^portal = `Glacier > Hammond's End > Hammond`
          to: Hammond
          time: 5

    - name: Upper Right Mid-air
      coord: [40.7, 10.1]
      local:
        - to: Corner
        - to: Hammond
        - to: Lower Right Pedestal
        - to: East 11 Door
      actions:
        - name: Move Portal to Corner
          req: Breach_Attractor and ^mode == 'drone' and ^indra WITHIN `Annuna > Filter Teleporter > Shaft Top`
          do: ^portal = `Glacier > Hammond's End > Corner`
          to: Corner
          time: 4

    - name: Lower Right Pedestal
      coord: [40.475, 10.5]
      data:
        flipside: Glacier Breach > Hammond's Breach > Save Point
      local:
        - to: Hammond
        - to: Lower Pedestal West
    - name: Hammond
      coord: [40.6, 10.6]
      data:
        flipside: Glacier Breach > Hammond's Breach > First Step
      local:
        - to: Lower Right Pedestal
          jumps: 1
        - to: Corner
        - to: East 11 Door
          jumps: 1
      locations:
        - name: Note
          canon: Hammonds_Note
          item: Goodbye
          tags: [standing]
    - name: Corner
      coord: [40.75, 10.75]
      data:
        flipside: Glacier Breach > Hammond's Breach > East Side
      local:
        - to: Hammond
          jumps: 1
        - to: East 11 Door
          jumps: 1
      locations:
        - name: Quick Note
          canon: Hammonds_Note
          item: Goodbye
          req: ^portal == ^position
          tags: [standing]
    - name: Lower Pedestal West
      coord: [40.3, 10.7]
      data:
        flipside: Glacier Breach > Hammond's Breach > West Side
      local:
        - to: Lower Right Pedestal
          jumps: 1
        - to: Center Door Right
          jumps: 1

    - name: East 11 Door
      coord: [40.85, 10.55]
      local:
        - to: Hammond
        - to: Corner
      exits:
        - to: The Big Drop > West 11 Door
          req: ^_hammonds_doors
          time: 3

    - name: Upper Portal Stand
      coord: [39.475, 9.6]
      data:
        flipside: Glacier Breach > Save and Exit > Save Point
      local:
        - to: West 10
        - to: Upper Stair
        - to: Lower Grate Right
        - to: Center Door Left
      exits:
        - to: Between Center Doors
          req: ^_hammonds_doors
          movement: base
    - name: West 10
      coord: [39.05, 9.75]
      local:
        - to: Upper Portal Stand
          jumps: 1
      exits:
        - to: Secret Chamber > East 10
          tags: [xshift]
    - name: Upper Stair
      coord: [39.8, 9.95]
      local:
        - to: Upper Grate Left
          jumps: 2
        - to: Lower Grate Right
        - to: Center Door Left
      exits:
        - to: Upper Portal Stand
          req: $hook
          movement: base
          jumps: 2
        - to: Upper Portal Stand
          req: $grab
          movement: base
          jumps: 3

    - name: Lower Grate Right
      coord: [39.6, 10.3]
      local:
        - to: Center Door Left
      exits:
        - to: Upper Portal Stand
          req: $hook
          movement: base
          jumps: 3
        - to: Upper Stair
          req: $grab
          movement: base
          jumps: 3
        - to: Lower Grate Left
          req: Nanite_Mist
          movement: mist1
        - to: Lower Grate Left
          req: $mist2
          movement: mist2

    - name: Lower Grate Left
      coord: [39.5, 10.3]
      local:
        - to: Switch from Ledge
      exits:
        - to: Lower Grate Right
          req: Nanite_Mist
          movement: mist1
        - to: Lower Grate Right
          req: $mist2
          movement: mist2

    - name: Switch from Ledge
      coord: [39.3, 10.4]
      local:
        - to: Lower Grate Left
          jumps: 1
        - to: Switch Near
      actions:
        - name: Open Doors
          req: $open and $range2
          do: ^_hammonds_doors = true
          tags: [hack]
    - name: Switch Near
      coord: [39.2, 10.5]
      local:
        - to: West 11
      exits:
        - to: Switch from Ledge
          req: $hook or $hover
          movement: base
          jumps: 1
      actions:
        - name: Open Doors
          req: $open
          do: ^_hammonds_doors = true
          tags: [hack]
    - name: West 11
      coord: [39.05, 10.7]
      exits:
        - to: Secret Chamber > East 11
          tags: [xshift]
        - to: Switch from Ledge
          req: $hook
          movement: base
          jumps: 1
        - to: Switch from Ledge
          req: $grab
          movement: base
          jumps: 2
      actions:
        - name: Open Doors
          req: $open
          do: ^_hammonds_doors = true
          tags: [hack]

    - name: Center Door Left
      coord: [39.65, 10.5]
      local:
        - to: Lower Grate Right
          jumps: 1
      exits:
        - to: Upper Stair
          req: $hook
          movement: base
          jumps: 2
        - to: Between Center Doors
          req: ^_hammonds_doors
          movement: base
    - name: Between Center Doors
      coord: [39.85, 10.5]
      locations:
        - name: Health
          item: Health_Fragment
          tags: [standing]
      exits:
        - to: Center Door Left
          req: ^_hammonds_doors
          movement: base
        - to: Center Door Right
          req: ^_hammonds_doors
          movement: base
    - name: Center Door Right
      coord: [40.0, 10.5]
      local:
        - to: Lower Pedestal West
      exits:
        - to: Between Center Doors
          req: ^_hammonds_doors
          movement: base

- name: Secret Chamber  # MARK: Secret Chamber
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: East 10
      coord: [38.95, 9.75]
      local:
        - to: Upper East Ledge
      exits:
        - to: Hammond's End > West 10
          tags: [xshift]
    - name: Upper East Ledge
      coord: [38.8, 9.75]
      local:
        - to: East 10
        - to: Grate West
        - to: Door East
      exits:
        - to: Hammond's End > Upper Portal Stand
          req: $hookhover
          movement: fast_hover
          jumps: 2
          penalty_tags: [xshift, -fast_hover.1]
        - to: Door East
          req: $hookhover
          movement: fast_hover
    - name: East 11
      coord: [38.95, 10.7]
      exits:
        - to: Hammond's End > West 11
          tags: [xshift]
        - to: Grate West
          req: $mist2
          movement: mist2
        - to: Grate West
          req: Nanite_Mist
          movement: mist1
    - name: Grate West
      coord: [38.8, 10.7]
      local:
        - to: Door East
          jumps: 3
      exits:
        - to: Door East
          req: $hookhover
          movement: fast_hover
          jumps: 2
    - name: Door East
      coord: [37.3, 10.75]
      local:
        - to: Grate West
          jumps: 4
      exits:
        - to: West 11
          req: ^_hammonds_doors
          movement: base
        - to: Grate West
          req: $hookhover
          movement: fast_hover
          jumps: 2
        - to: Upper East Ledge
          req: $hookhover
          movement: fast_hover
          jumps: 4
    - name: West 11
      coord: [37.05, 10.75]
      exits:
        - to: Door East
          req: ^_hammonds_doors
          movement: base
        - to: Vertical Room > East 11
          tags: [xshift]

- name: Angry Guards  # MARK: Angry Guards
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Stand
  map:
    portal: [32, 11, 33, 12]
  datamap:
    map_spot:
      portal: Menu > Kiengir Map > Glacier Angry Guards Portal
  spots:
    - name: East 11
      coord: [32.95, 10.85]
      exits:
        - to: Ledge Grab Room > West 11
          tags: [xshift]
        - to: Gate
          req: Nanite_Mist
          movement: mist1
        - to: Gate
          req: $mist2
          movement: mist2
    - name: Gate
      coord: [32.85, 10.85]
      local:
        - to: Middle
      exits:
        - to: Ledge Grab Room > Gate
          req: $mist2
          movement: mist2
        - to: East 11
          req: Nanite_Mist
          movement: mist1
        - to: East 11
          req: $mist2
          movement: mist2
    - name: Middle
      coord: [32.7, 11.1]
      local:
        - to: Portal Stand
        - to: East 12
      exits:
        - to: Gate
          req: $hook
          movement: base
          jumps: 1
        - to: Corner
          req: $hook or $hover
          movement: base
    - name: Corner
      coord: [32.9, 11.35]
      data:
        flipside: Glacier Breach > West Save > Hidden
      local:
        - to: Portal Stand
        - to: East 12
          thru: [32.8, 11.45]
      exits:
        - to: Middle
          req: $hook
          movement: base
          jumps: 2
      actions:
        - name: Move Portal Here
          req: Breach_Attractor and ^mode == 'drone' and ^indra WITHIN (`Glacier > Grid 39-40,7-9`, `Glacier > Revival`, `Glacier > Dock Outside`) and ^portal == ^portal_start
          do: ^portal = ^position
          time: 0.1
          penalties:
            - calc: $diagonal_speed_spots(^position, ^portal, 0.55, 1.0) * 0.5
    - name: Portal Stand
      coord: [32.525, 11.6]
      data:
        flipside: Glacier Breach > West Save > Save Point
      local:
        - to: East 12
      exits:
        - to: Middle
          req: $hookhover
          movement: base
          jumps: 4
        - to: Corner
          req: $hook or $hover
          movement: base
          jumps: 1
    - name: East 12
      coord: [32.95, 11.7]
      local:
        - to: Portal Stand
          jumps: 1
        - to: Corner
          req: $hook
          movement: base
          jumps: 3
      exits:
        - to: Sliced Cavern > West 12
          tags: [xshift]

- name: Sliced Cavern  # MARK: Sliced Cavern
  on_entry: $reset_old_area(^newpos)
  map:
    health: [33, 11, 34, 12]
    note: [33, 13, 34, 14]
  datamap:
    map_spot:
      health: Menu > Kiengir Map > Glacier Sliced Cavern Health
      note: Menu > Kiengir Map > Sagiga on the Worldstream
  spots:
    - name: West 12
      coord: [33.05, 11.7]
      local:
        - to: Upper Middle
      exits:
        - to: Angry Guards > East 12
          tags: [xshift]
    - name: Upper Middle
      coord: [33.525, 11.9]
      local:
        - to: West 12
          jumps: 3
        - to: East 12
          jumps: 3
      locations:
        - name: Health
          item: Health_Fragment
          tags: [standing]
    - name: East 12
      coord: [33.95, 11.7]
      local:
        - to: Upper Middle
      exits:
        - to: Inner Caverns > West 12
          tags: [xshift]

    - name: West 13
      coord: [33.05, 12.6]
      local:
        - to: East 13
          jumps: 1
      exits:
        - to: Glacier > Lake Main Entrance > East 13
          tags: [xshift]
    - name: East 13
      coord: [33.95, 12.7]
      local:
        - to: West 13
          jumps: 1
      exits:
        - to: Inner Caverns > West 13
          tags: [xshift]
    - name: West Rock
      coord: [33.25, 12.75]
      local:
        - to: West 13
          jumps: 1

    - name: Cache
      coord: [33.7, 13.35]
      local:
        - to: East 14
      locations:
        - name: Note
          item: Sagiga_on_the_Worldstream
          tags: [standing]
    - name: East 14
      coord: [33.95, 13.7]
      local:
        - to: Cache
          thru: [33.8, 13.5]
          jumps: [2, 1]
      exits:
        - to: Inner Caverns > West 14
          tags: [xshift]

- name: Inner Caverns  # MARK: Inner Caverns
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West 12
      coord: [34.05, 11.7]
      local:
        - to: Northwest Drone
      exits:
        - to: Sliced Cavern > East 12
          tags: [xshift]
    - name: Northwest Drone
      coord: [34.25, 11.75]
      local:
        - to: West 12
          jumps: 1
        - to: Northwest Stone
          jumps: 1
      locations:
        - name: Item
          item: Power_Core
          req: $more_refills
          tags: [standing]
    - name: Northwest Stone
      coord: [34.5, 11.7]
      local:
        - to: Northwest Drone
        - to: West Shaft Bottom
        - to: West Shaft Hook Point
          thru: [34.7, 12.8]
      exits:
        - to: Sliced Cavern > Upper Middle
          req: $hookhover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: West Shaft Bottom
      coord: [34.75, 12.85]
      local:
        - to: West Shaft Hook Point
      exits:
        - to: Northwest Stone
          req: $hook
          movement: base
          jumps: 3
        - to: Southwest Ledge
          req: $hook or $hover
          movement: base
    - name: West Shaft Hook Point
      coord: [34.55, 13.3]
      local:
        - to: Southwest Hill
        - to: Center Bottom
      exits:
        - to: Southwest Ledge
          req: $hook
          movement: fast_hover
          jumps: 1
        - to: West Shaft Bottom
          req: $hook
          movement: base
          jumps: 2
    - name: Southwest Ledge
      coord: [34.35, 13.2]
      local:
        - to: Southwest Hill
      exits:
        - to: West 13
          req: $hook
          movement: base
          jumps: 2
        - to: West 13 Hook Point
          req: $hook
          movement: base
          jumps: 2
        - to: West 13
          req: $grab
          movement: base
          jumps: 3
    - name: West 13 Hook Point
      coord: [34.25, 12.8]
      local:
        - to: Southwest Ledge
        - to: Center Bottom
      exits:
        - to: Sliced Cavern > West Rock
          req: $hookhover
          movement: fast_hover
          jumps: 1
          penalty_tags: [xshift, -fast_hover.1]
      exits:
        - to: West Shaft Hook Point
          req: $hover
          movement: base
        - to: West Shaft Bottom
          req: $hookhover
          movement: base
    - name: West 13
      coord: [34.05, 12.7]
      local:
        - to: Southwest Ledge
        - to: West 13 Hook Point
      exits:
        - to: Sliced Cavern > East 13
          tags: [xshift]

    - name: Southwest Hill
      coord: [34.3, 13.55]
      local:
        - to: West 14
        - to: Center Bottom
      exits:
        - to: Sliced Cavern > Cache
          req: $hover
          movement: base
          jumps: 2
          penalty_tags: [xshift, -base.1]
        - to: Southwest Ledge
          req: $hook or (Anuman and $grab)
          movement: base
          jumps: 1
        - to: West Shaft Hook Point
          req: $hookhover
          movement: base
          jumps: 1
    - name: West 14
      coord: [34.05, 13.7]
      local:
        - to: Southwest Hill
          jumps: 2
      exits:
        - to: Sliced Cavern > East 14
          tags: [xshift]

    - name: Center Bottom
      coord: [34.85, 13.75]
      local:
        - to: Southwest Hill
          jumps: 1
      exits:
        - to: West Shaft Hook Point
          req: $hookhover
          movement: base
          jumps: 2

- name: Fortress  # MARK: Fortress
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Stand
  map:
    health: [38, 6, 39, 7]
    flask_left: [37, 6, 38, 7]
    ne: [38, 5, 39, 6]
    portal: [38, 7, 39, 8]
  datamap:
    map_spot:
      health: Menu > Kiengir Map > Glacier Fortress Health
      flask_left: Menu > Kiengir Map > Glacier Fortress Flask Left
      ne: Menu > Kiengir Map > Glacier Fortress Northeast
      portal: Menu > Kiengir Map > Glacier Fortress Portal
  spots:
    - name: Button
      coord: [38.55, 7.75]
      local:
        - to: Portal Stand
          jumps: 1
      locations:
        - name: Hit Button
          item: Glacier_Fortress_Gate
          req: $can_damage
          tags: [button]
    - name: Portal Stand
      coord: [38.475, 7.7]
      data:
        flipside: Glacier Breach > Fortress > Portal Entry
      local:
        - to: Button
      exits:
        - to: Inner East Ledge
          req: $mist2
          movement: mist2
        - to: Inner East Ledge
          req: Nanite_Mist
          movement: mist1
    - name: Inner East Ledge
      coord: [38.4, 7.0]
      data:
        flipside: Glacier Breach > Fortress > East Ledge
      local:
        - to: Portal Stand
          thru: [38.4, 7.2]
        - to: Button
          thru: [38.4, 7.2]
        - to: Inner Mid Tier East
    - name: Inner Mid Tier East
      coord: [38.7, 7.0]
      data:
        flipside: Glacier Breach > Fortress > Mid Tier East
      local:
        - to: Inner East Ledge
      exits:
        - to: Inner Upper Tier East
          req: $hook or Anuman
          movement: base
          jumps: 1
        - to: Inner Upper Tier East
          req: $grab or $hover
          movement: base
          jumps: 2
        - to: Gate East
          req: Glacier_Fortress_Gate and ($hook or Anuman)
          movement: base
          jumps: 1
        - to: Gate East
          req: Glacier_Fortress_Gate and ($grab or $hover)
          movement: base
          jumps: 2
    - name: Inner Upper Tier East
      coord: [38.7, 6.75]
      data:
        flipside: Glacier Breach > Fortress > Upper Tier East
      local:
        - to: Inner Mid Tier East
        - to: Inner Center
      exits:
        - to: Inner Center
          req: $hookhover
          movement: fast_hover
        - to: Gate East
          req: Glacier_Fortress_Gate
          movement: base
    - name: Inner Center
      coord: [38.075, 6.75]
      data:
        flipside: Glacier Breach > Fortress > Upper Tier Middle
      local:
        - to: Inner Upper Tier East
        - to: Inner Upper Tier West
      locations:
        - name: Health
          item: Health_Node
          tags: [standing]
        - name: Shockwave Block
          canon: Glacier_Fortress_Flask
          item: Big_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
          penalty_tags: [flask]
        - name: Shockwave Fast Travel
          canon: Glacier_Fortress_Flask
          item: Big_Flask
          req: block_fast_travel and $shockwave and Fast_Travel
          price: 100
          tags: [shockwave]
          to: ^map_spot
          penalty_tags: [cskip]
    - name: Inner Upper Tier West
      coord: [37.55, 6.75]
      data:
        flipside: Glacier Breach > Fortress > Upper Tier West
      local:
        - to: Inner Center
        - to: Inner Mid Tier West
      exits:
        - to: Inner Center
          req: $hookhover
          movement: fast_hover
    - name: Inner Mid Tier West
      coord: [37.55, 7.0]
      data:
        flipside: Glacier Breach > Fortress > Mid Tier West
      local:
        - to: West Staircase
      exits:
        - to: Inner Upper Tier West
          req: $hook or Anuman
          movement: base
          jumps: 1
        - to: Inner Upper Tier West
          req: $grab or $hover
          movement: base
          jumps: 2
    - name: West Staircase
      coord: [37.85, 7.45]
      data:
        flipside: Glacier Breach > Fortress > Southwest Stair
      exits:
        - to: Inner Mid Tier West
          req: $hook
          movement: fast_hover
          jumps: 2
        - to: Inner Mid Tier West
          req: $hover
          movement: base
          jumps: 4
        - to: Inner Mid Tier West
          req: Anuman
          movement: base
          jumps: 2
        - to: Inner Mid Tier West
          req: $grab
          movement: base
          jumps: 3

    - name: Parapet West Ledge
      coord: [37.1, 6.25]
      local:
        - to: Parapet West Hook Point
          jumps: 2
      exits:
        - to: Vertical Room > Fortress Ledge
          movement: base
          penalty_tags: [xshift, -base.1]
        - to: Parapet West Hook Point
          req: $hook
          movement: fast_hover
          jumps: 1
        - to: Parapet West Hook Point
          req: Anuman
          movement: base
          jumps: 1
    - name: Parapet West Hook Point
      coord: [37.4, 6.1]
      local:
        - to: Parapet West Ledge
          jumps: 2
        - to: Parapet Crenelle 2
          jumps: 2
      exits:
        - to: Vertical Room > Flying West
          req: $hookhover
          movement: fast_hover
          jumps: 1
          penalty_tags: [xshift, -fast_hover.1]
        - to: Parapet Crenelle 2
          req: $hook
          movement: fast_hover
          jumps: 1
        - to: Parapet Peak
          req: $hookhover
          movement: fast_hover
          jumps: 3
        - to: Parapet West Ledge
          req: $hook
          movement: fast_hover
    - name: Parapet Crenelle 2
      coord: [37.65, 6.15]
      local:
        - to: Parapet West Hook Point
          jumps: 1
        - to: Parapet Peak
          jumps: 3
      locations:
        - name: Shockwave Block
          canon: Glacier_Fortress_Flask
          item: Big_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
          penalty_tags: [flask]
        - name: Shockwave Fast Travel
          canon: Glacier_Fortress_Flask
          item: Big_Flask
          req: block_fast_travel and $shockwave and Fast_Travel
          price: 100
          tags: [shockwave]
          to: ^map_spot
          penalty_tags: [cskip]
      exits:
        - to: Parapet West Hook Point
          req: $hook
          movement: fast_hover
          jumps: 1
        - to: Parapet Peak
          req: $hook
          movement: fast_hover
          jumps: 3
    - name: Parapet Peak
      coord: [38.0, 5.65]
      local:
        - to: Parapet West Hook Point
        - to: Parapet Crenelle 2
        - to: Parapet Center East
        - to: Parapet East Hook Point
      exits:
        - to: Parapet West Hook Point
          req: $hookhover
          movement: fast_hover
        - to: Parapet East Hook Point
          req: $hookhover
          movement: fast_hover
    - name: Parapet Center East
      coord: [38.2, 6.0]
      local:
        - to: Parapet Peak
          jumps: 2
        - to: Parapet East Hook Point
      locations:
        - name: Shockwave Block
          canon: Glacier_Fortress_Flask
          item: Big_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
          penalty_tags: [flask]
        - name: Shockwave Fast Travel
          canon: Glacier_Fortress_Flask
          item: Big_Flask
          req: block_fast_travel and $shockwave and Fast_Travel
          price: 100
          tags: [shockwave]
          to: ^map_spot
          penalty_tags: [cskip]
        - name: Bomberang
          item: Glacier_Fortress_Bomberang
          req: $bomberang and Anuman and not $visited(`Glacier > Fortress > Inner Center > Shockwave Block`)
          price: 100
          to: Gate East
          time: 10
          tags: [shockwave]
      exits:
        - to: Parapet Peak
          req: $hook
          movement: base
          jumps: 1
        - to: Parapet East Hook Point
          req: $hook
          movement: fast_hover
    - name: Parapet East Hook Point
      coord: [38.6, 6.1]
      local:
        - to: Parapet Center East
          jumps: 3
        - to: Parapet East Ledge
          jumps: 1
      exits:
        - to: Parapet Peak
          req: $hookhover
          movement: fast_hover
          jumps: 3
        - to: Parapet East Ledge
          req: $hook
          movement: fast_hover
        - to: Grid 39-40,7-9 > Floating Rock
          req: $hookhover
          movement: fast_hover
        - to: Grid 39-40,7-9 > Upper East
          req: $hookhover
          movement: fast_hover
        - to: Grid 39-40,7-9 > East 9
          req: $hookhover
          movement: fast_hover
    - name: Parapet East Ledge
      coord: [38.9, 6.3]
      local:
        - to: Parapet East Hook Point
          jumps: 2
        - to: Gate East
      exits:
        - to: Parapet East Hook Point
          req: $hook
          movement: fast_hover
          jumps: 1
        - to: Parapet East Hook Point
          req: Anuman
          movement: base
          jumps: 1
        - to: Grid 39-40,7-9 > Fortress Ledge
          movement: base
          penalty_tags: [xshift, -base.1]
    - name: Gate East
      coord: [38.9, 6.75]
      exits:
        - to: Parapet East Ledge
          req: $hook or (Anuman and $climb)
          movement: base
          jumps: 2
        - to: Inner Upper Tier East
          req: Glacier_Fortress_Gate
          movement: base
        - to: Inner Mid Tier East
          req: Glacier_Fortress_Gate
          movement: base
        - to: Grid 39-40,7-9 > Fortress Ledge
          movement: base
          penalty_tags: [xshift, -base.1]
