name: Glacier

areas:
- name: Dock Elevator
  spots:
    - name: Elevator
      coord: [44.5, 9]
    - name: Connector
      coord: [44.05, 9]
      exits:
        - to: Dock Interior > Connector
          tags: [xshift]

- name: Dock Interior
  spots:
    - name: Connector
      coord: [43.95, 9]
      exits:
        - to: Dock Elevator > Connector
          tags: [xshift]
    - name: Entry
      coord: [43.4, 9]
      exits:
        - to: Dock Outside > Entry
          tags: [exterior]

- name: Dock Outside
  spots:
    - name: Entry
      coord: [43.4, 9]
      exits:
        - to: Dock Interior > Entry
          tags: [interior]
    # the first time you reach here, this becomes the save point.
    # however, this doesn't ever seem relevant
    # and I'm not sure how to force it in the logic
    #- name: Save Point
    #  coord: [43.0, 9]
    - name: Do Not Enter
      coord: [42.05, 9]
      exits:
        - to: Grid 41,9-10 > East
          tags: [xshift]

# It sure is going to get difficult naming every grid square without generic names
- name: Grid 41,9-10
  spots:
    - name: East
      coord: [41.95, 9]
      exits:
        - to: Dock Outside > Do Not Enter
          tags: [xshift]
    - name: Overhang
      coord: [41.6, 9]
      local:
        - to: Lower East
          jumps_down: 2
    - name: Ledge
      coord: [41.3, 9.2]
      local:
        - to: Overhang
          jumps: 2
        - to: Lower East
          jumps_down: 3
    - name: Lower East
      coord: [41.95, 10]
      local:
        - to: Ledge
          jumps: 8
      exits:
        - to: Grid 42,10 > West
          tags: [xshift]

- name: Grid 42,10
  spots:
    - name: West
      coord: [42.05, 10]
      exits:
        - to: Grid 41,9-10 > Lower East
          tags: [xshift]
    - name: East
      coord: [42.95, 10]
      exits:
        - to: Grid 43,10-11 > Top
          tags: [xshift]

- name: Grid 43,10-11
  spots:
    - name: Top
      coord: [43.05, 10]
      local:
        - to: Lower
          thru: [43.3, 10.15]
      exits:
        - to: Grid 42,10 > East
          tags: [xshift]
    - name: East
      coord: [43.95, 10.3]
      local:
        - to: Top
          jumps: 3
      exits:
        - to: Apocalypse Entry > West
          tags: [xshift]
    - name: Lower
      coord: [43.05, 11]
      local:
        - to: Top
          thru: [[43.2, 10.7], [43.3, 10.5], [43.3, 10.3]]
          jumps: [2, 3, 3, 1]
        - to: East
          thru: [[43.2, 10.7], [43.5, 10.4]]
          jumps: [2, 4, 2]
      exits:
        - to: Compass Room > East
          tags: [xshift]

- name: Compass Room
  spots:
    - name: East
      coord: [42.95, 11]
      exits:
        - to: Grid 43,10-11 > Lower
          tags: [xshift]
    - name: Center
      coord: [42.5, 11]
      locations:
        - name: Table
          item: Compass
          tags: [standing]
    - name: West  # This is also an autosave location in the early game, also irrelevant.
      coord: [42.05, 11]
      exits:
        - to: The Big Drop > East
          tags: [xshift]

- name: The Big Drop
  spots:
    - name: East
      coord: [41.95, 11]
      exits:
        - to: Compass Room > West
          tags: [xshift]
    - name: Small Path
      coord: [41.95, 13]
    - name: Water Surface
      coord: [41.05, 13]
      hybrid:
        - name: Drown  # This is technically the next grid over, but it's a cutscene really
          to: Glacier > Revival > Save Point
          req: NOT Amashilama
          item: Amashilama
          time: 48.5
          item_time: 0

- name: Revival
  spots:
    - name: Save Point
      coord: [41.4, 8]
      actions:
        - name: Save
          do: ^save = ^position
          time: 1.2
    - name: West
      coord: [41.05, 8]
      exits:
        - to: Grid 39-40,7-9 > Upper East
          tags: [xshift]

- name: Grid 39-40,7-9
  spots:
    - name: Upper East
      coord: [40.95, 8]
      exits:
        - to: Revival > West
          tags: [xshift]
    - name: West
      coord: [39.05, 9]
      local:
        - to: Upper East
          thru: [[40.0, 8.5], [40.0, 8.4]]
          jumps: [2, 1, 1]
      exits:
        - to: Grid 37-38,9 > East
          tags: [xshift]

- name: Grid 37-38,9
  spots:
    - name: East
      coord: [38.95, 9]
      exits:
        - to: Grid 39-40,7-9 > West
          tags: [xshift]
    - name: West
      coord: [37.05, 9]
      exits:
        - to: Vertical Room Top > East 9
          tags: [xshift]

- name: Vertical Room Top
  spots:
    - name: East 9
      coord: [36.95, 9]
      local:
        - to: Mid 11
          jumps_down: 1
      exits:
        - to: Grid 37-38,9 > West
          tags: [xshift]
        - to: Peak
          req: $grab
          time: 2.4
    - name: West 9
      coord: [36.05, 9]
      local:
        - to: Mid 11
          jumps_down: 1
        - to: Peak
          thru: [36.5, 9]
      exits:
        - to: Ledge Grab Balcony > East 9
          tags: [xshift]
    - name: Mid 9
      coord: [36.5, 9]
      exits:
        - to: Peak
          req: $grab
          time: 2
    - name: Mid 11
      coord: [36.5, 11.5]
      local:
        - to: Under Switch
          jumps: 4
      exits:
        - to: Mid 9
          req: $grab
          time: 10
        - to: Vertical Room Upper Mid > Mid 11
          tags: [overlap]
    - name: Under Switch
      coord: [36.2, 11]
      local:
        - to: Mid 9
          jumps: 14
        - to: West 9
          jumps: 14
      locations:
        - name: Switch
          item: Switch_36_11
          req: Boomerang
          tags: [event]
      exits:
        - to: Mid 9
          req: $grab
          time: 7.5
        - to: Vertical Room Left > Past Gate
          req: Switch_36_11
          time: 0.1
    - name: Peak
      coord: [36.4, 8.5]
      locations:
        - name: Flask
          item: Flask
          tags: [flask]

- name: Vertical Room Upper Mid
  spots:
    - name: Mid 11  # This spot is in both areas, by way of a reversible instant exit
      coord: [36.5, 11.5]
      local:
        - to: Lower West Corner
          jumps_down: 2
        - to: East 13
          jumps_down: 2
      exits:
        - to: Vertical Room Top > Mid 11
          tags: [overlap]
    - name: East 12
      coord: [36.9, 11.7]
      local:
        - to: Mid 11
          jumps: 2
      exits:
        - to: Boomerang Antechamber > West 12
          req: $grab
          tags: [xshift]
    - name: Lower West Corner
      coord: [36.3, 12.4]
      local:
        - to: Mid 11
          jumps: 7
    - name: East 13
      coord: [36.95, 13]
      local:
        - to: Lower West Corner
          jumps: 3
      exits:
        - to: Boomerang Antechamber > West 13
          tags: [xshift]
    # TODO: bottom spot and exit

- name: Vertical Room Left
  spots:
    - name: Past Gate
      coord: [36.05, 11]
      exits:
        - to: Vertical Room Top > Under Switch
          req: Switch_36_11
          time: 0.1
        - to: Ledge Grab Room > East 11
          tags: [xshift]

- name: Boomerang Antechamber
  spots:
    - name: West 13
      coord: [37.05, 13]
      local:
        - to: East 12
          jumps: 9
      exits:
        - to: Vertical Room Upper Mid > East 13
          tags: [xshift]
    - name: East 12
      coord: [38.95, 12]
      local:
        - to: Upper East
          thru: [38.2, 11.6]
          jumps: [1, 2]
        - to: West 12
          jumps: 2
      exits:
        - to: Boomerang Room > West
          tags: [xshift]
    - name: Upper East
      coord: [38.95, 11.5]
      exits:
        - to: Boomerang Room Switched > Upper West
          req: Switch_40_12
          tags: [xshift]
    - name: West 12
      coord: [37.05, 11.5]
      local:
        - to: West 13
          thru: [38, 12]
      exits:
        - to: Vertical Room Upper Mid > East 12
          tags: [xshift]

- name: Boomerang Room
  spots:
    - name: West
      coord: [39.05, 12]
      local:
        - to: Platform
          jumps: 2
      exits:
        - to: Boomerang Antechamber > East 12
          tags: [xshift]
    - name: Platform
      coord: [39.4, 11.75]
      exits:
        - to: Boomerang Room Switched > Platform
          req: Switch_40_12
          tags: [overlap]
    - name: Center-ish
      coord: [39.8, 11.75]
      exits:
        - to: Boomerang Room Switched > Center Ledge
          req: $grab and Switch_40_12
    - name: Pedestal
      coord: [40.5, 12]
      local:
        - to: Center-ish
          jumps: 1
      locations:
        - name: Item
          item: Boomerang
          tags: [standing]
        - name: Switch
          item: Switch_40_12
          req: Boomerang
          tags: [event]
      exits:
        - to: Boomerang Room Switched > Pedestal
          req: Switch_40_12
          tags: [overlap]

- name: Boomerang Room Switched
  spots:
    - name: Pedestal
      coord: [40.5, 12]
      local:
        - to: Upper Gate East
          jumps: 2
      exits:
        - to: Boomerang Room > Pedestal
          tags: [overlap]
    - name: Upper Gate East
      coord: [40.3, 11.5]
    - name: Center Ledge
      coord: [40.0, 11.5]
    - name: Platform
      coord: [39.4, 11.75]
      local:
        - to: Upper West
          jumps: 1
      exits:
        - to: Boomerang Room > Platform
          tags: [overlap]
    - name: Upper West
      coord: [39.05, 11.5]
      exits:
        - to: Boomerang Antechamber > Upper East
          tags: [xshift]

- name: Ledge Grab Balcony
  spots:
    - name: East 9
      coord: [35.95, 9]
      exits:
        - to: Vertical Room Top > West 9
          tags: [xshift]
        - to: Column
          req: $grab
          time: 2
        - to: Vertical Room Left > Past Gate
          req: $offset
          time: 20
          tags: [xshift, offset]
    - name: Column
      coord: [35.5, 8.7]
      exits:
        - to: Ledge Grab Room > Mid 35
          time: 2.25s
    - name: Gate Ledge
      coord: [35.0, 8.8]
      exits:
        - to: Column
          req: $grab
          time: 2

- name: Ledge Grab Room
  spots:
    - name: East 11
      coord: [35.95, 11]
      exits:
        - to: Vertical Room Left > Past Gate
          tags: [xshift]
    - name: Mid 35
      coord: [35.4, 11]
      local:
        - to: Mid 34
          jumps: 3
      exits:
        - to: Ledge Grab Upper > Fork
          req: $grab
          time: 6.1
    - name: Mid 34
      coord: [34.5, 10.5]
    - name: Cliff
      coord: [34.0, 10.6]
      local:
        - to: Mid 34
          jumps: 1
      exits:
        - to: Ledge Grab Area > Cliff Bottom
          time: 0.6

- name: Ledge Grab Area
  spots:
    - name: Cliff Bottom
      coord: [33.9, 11]
      local:
        - to: Pedestal
          jumps: 1
      locations:
        - name: Quick Grab
          item: Ledge_Grab
          canon: Ledge_Grab
          time: 6
          tags: [urn]
      exits:
        - to: Ledge Grab Room > Cliff
          req: $grab
    - name: Pedestal
      coord: [33.5, 10.8]
      locations:
        - name: Item
          item: Ledge_Grab
          canon: Ledge_Grab
          tags: [urn]
      exits:
        - to: Ledge Grab Upper > West
          req: $grab
          time: 4
    - name: Gate
      coord: [33.1, 11]
      local:
        - to: Pedestal
          jumps: 1
      exits:
        - to: Ledge Grab Upper > West
          req: $grab
          time: 3.1

- name: Ledge Grab Upper
  spots:
    - name: West
      coord: [33.3, 10]
      local:
        - to: Upper Platform
          jumps: 1
      exits:
        - to: Ledge Grab Area > Gate
        - to: Ledge Grab Area > Pedestal
    - name: Lower Platform
      coord: [34.3, 10.3]
      exits:
        - to: Upper Platform
          req: $grab
          time: 2
    - name: Upper Platform
      coord: [34.4, 9.7]
      exits:
        - to: Fork
          req: $grab
          time: 2.4
    - name: Fork
      coord: [35, 9.4]
      exits:
        - to: Ledge Grab Balcony > Column
          req: $grab
          time: 2.4
        - to: Ledge Grab Balcony > Gate Ledge
          req: $grab
          time: 2
        - to: Ledge Grab Room > Mid 35
          time: 2.5


- name: Apocalypse Entry
  spots:
    - name: West
      coord: [44.05, 10.3]
      exits:
        - to: Grid 43,10-11 > East
          tags: [xshift]
    - name: Terminal
      coord: [44.6, 10.3]
      locations:
        - name: Escape
          item: Escape
          req: Apocalypse_Bomb
    # TODO: the path to Apocalypse... whether in this area or another