//! AUTOGENERATED FOR Axiom Verge 2 - MODIFICATIONS WILL BE LOST

#![allow(non_snake_case)]
#![allow(unused)]

use crate::graph::{self, *};
use crate::graph_enums::*;
use crate::items::Item;
use crate::movements;
use crate::prices::Currency;
use crate::rules;
use analyzer::context;
use analyzer::world::World;
use enum_map::EnumMap;
use serde::{Deserialize, Serialize};
use serde_repr::{Deserialize_repr, Serialize_repr};
use std::str::FromStr;
use yaml_rust::Yaml;

pub mod enums {
    use std::fmt;
    #[derive(
        Debug,
        PartialEq,
        Eq,
        Copy,
        Clone,
        Hash,
        Ord,
        PartialOrd,
        Default,
        serde_repr::Serialize_repr,
        serde_repr::Deserialize_repr,
    )]
    #[repr(u8)]
    pub enum Mode {
        #[default]
        Indra,
        Drone,
    }
    impl fmt::Display for Mode {
        fn fmt(&self, f: &mut fmt::Formatter) -> fmt::Result {
            match self {
                Mode::Indra => write!(f, "{}", "Indra"),
                Mode::Drone => write!(f, "{}", "Drone"),
            }
        }
    }
    impl std::str::FromStr for Mode {
        type Err = String;

        fn from_str(s: &str) -> Result<Self, Self::Err> {
            match s {
                "Drone" | "drone" => Ok(Mode::Drone),
                "Indra" | "indra" => Ok(Mode::Indra),
                _ => Err(format!("Could not recognize as a Mode: {}", s)),
            }
        }
    }
}

#[derive(Debug, Copy, Clone, Eq, PartialEq)]
pub enum Expectation {
    Position(SpotId),
    Energy(i16),
    Flasks(i8),
    Refills(i8),
    Mode(enums::Mode),
    Save(SpotId),
    Indra(SpotId),
    Last(SpotId),
    PrevArea(AreaId),
    AmagiMainAreaCtxCombo(bool),
    EbihBaseCampCtxLeftPlatformMoved(bool),
    EbihGrid251012CtxDoorOpen(bool),
    EbihWaterfallCtxWestDoorOpen(bool),
    EbihEbihWestCtxDoorOpen(bool),
    EbihEbihEastCtxPlatform1Moved(bool),
    EbihEbihEastCtxPlatform2Moved(bool),
    EbihDroneRoomCtxPlatformMoved(bool),
    EbihVerticalInterchangeCtxDoorOpen(bool),
    GigunaBreachSwSaveCtxDoorOpened(bool),
    GigunaGigunaNortheastCtxDoorOpened(bool),
    GigunaCarnelianCtxDoorOpened(bool),
    GigunaCarnelianCtxUpperSusar(bool),
    GigunaCarnelianCtxLowerSusar(bool),
    GigunaWestCavernsCtxEastSusar(bool),
    GigunaGigunaBaseCtxDoorOpen(bool),
    GigunaRuinsWestCtxKishibHandled(bool),
    GigunaRuinsTopCtxDoorsOpen(bool),
    GigunaCloudsCtxPlatformAndPortal(bool),
    GigunaEastCavernsCtxDoorOpened(bool),
    GigunaEastCavernsCtxComboEntered(bool),
    GigunaEastCavernsCtxUpperSusar(bool),
    GigunaEastCavernsCtxMidSusar(bool),
    GigunaGatewayCtxDoorOpened(bool),
    // items
    AmagiDragonEyePassage(bool),
    AmagiStrongholdBoulder1(bool),
    AmagiStrongholdBoulder2(bool),
    AmagiStrongholdWall1(bool),
    AmagiStrongholdWall2(bool),
    AmagiWestLakeSurfaceWall(bool),
    Amashilama(bool),
    Anuman(bool),
    ApocalypseBomb(bool),
    Boomerang(bool),
    BreachAttractor(bool),
    BreachSight(bool),
    BronzeAxe(bool),
    BuildingOfTheSchool(bool),
    CommemorativeSpeech(bool),
    CompaniesLayoff(bool),
    DearErnest(bool),
    DefeatEbihAlu(bool),
    DefeatMUSAM20(bool),
    DroneHover(bool),
    DroneMeleeDamage(i8),
    DroneMeleeSpeed(i8),
    EbihInterchangeBlock(bool),
    EbihInterchangeGate(bool),
    EbihWastelandDoor(bool),
    EbihWastelandPassageH(bool),
    EbihWaterfallBlockLeft(bool),
    EbihWaterfallBlockRight(bool),
    EbihWaterfallWall(bool),
    EbihWestBlock(bool),
    ExitBreach(bool),
    FastTravel(bool),
    Flask(i8),
    GigunaBoulder(bool),
    GigunaDualPathSwitch(bool),
    GigunaGatewayBlock(bool),
    GigunaGatewayGate(bool),
    GigunaGubi(bool),
    GigunaNortheastGate(bool),
    HealthFragment(i8),
    HealthNode(bool),
    HealthUpgrade(i8),
    HereticsTablet(bool),
    IceAxe(bool),
    Infect(i8),
    InfectionRange(i8),
    InfectionSpeed(bool),
    LedgeGrab(bool),
    LetterFromTrace(bool),
    Map1710(bool),
    MeleeDamage(i8),
    MeleeSpeed(i8),
    MistUpgrade(bool),
    NaniteMist(bool),
    NanoPoints(i8),
    PowerMatrix(bool),
    RangedDamage(i8),
    RangedSpeed(i8),
    RecordLosses(bool),
    RemoteDrone(bool),
    ResearchersMissing(bool),
    Shockwave(bool),
    SlingshotCharge(bool),
    SlingshotHook(bool),
    SlingshotWeapon(bool),
    StationPower(bool),
    Switch3611(bool),
    Switch4012(bool),
    TerminalBreakthrough1(bool),
    TheIdealKiengir(bool),
    UnderSiege(bool),
    UnderwaterMovement(bool),
    WallClimb(bool),
}

pub mod data {
    #[allow(unused_imports)]
    use crate::context::enums;
    use crate::graph_enums::*;
    pub fn breach(spot_id: SpotId) -> bool {
        match spot_id {
            SpotId::Giguna_Breach__Antechamber__North => true,
            SpotId::Giguna_Breach__Ascent__Bottom => true,
            SpotId::Giguna_Breach__Ascent__Top => true,
            SpotId::Giguna_Breach__Ascent__West_6 => true,
            SpotId::Giguna_Breach__Ascent__West_9 => true,
            SpotId::Giguna_Breach__Below_Chimney__Cubby_Entrance => true,
            SpotId::Giguna_Breach__Below_Chimney__East_Ledge => true,
            SpotId::Giguna_Breach__Below_Chimney__North => true,
            SpotId::Giguna_Breach__Below_Chimney__Passage_Lip => true,
            SpotId::Giguna_Breach__Below_Chimney__Southwest => true,
            SpotId::Giguna_Breach__Below_Chimney__West_Passage => true,
            SpotId::Giguna_Breach__Central__East_9 => true,
            SpotId::Giguna_Breach__Central__East_Brick => true,
            SpotId::Giguna_Breach__Central__Middle_Statue => true,
            SpotId::Giguna_Breach__Central__South => true,
            SpotId::Giguna_Breach__Central__Statuette => true,
            SpotId::Giguna_Breach__Central__Tunnel => true,
            SpotId::Giguna_Breach__Central__Upper_Floating_Brick => true,
            SpotId::Giguna_Breach__Central__Wall => true,
            SpotId::Giguna_Breach__Central__West_8 => true,
            SpotId::Giguna_Breach__Central__West_9 => true,
            SpotId::Giguna_Breach__Central__West_Statue => true,
            SpotId::Giguna_Breach__Chimney__Cache => true,
            SpotId::Giguna_Breach__Chimney__East_7 => true,
            SpotId::Giguna_Breach__Chimney__East_8 => true,
            SpotId::Giguna_Breach__Chimney__East_9 => true,
            SpotId::Giguna_Breach__Chimney__Middle_Platform => true,
            SpotId::Giguna_Breach__Chimney__South => true,
            SpotId::Giguna_Breach__Chimney__Top => true,
            SpotId::Giguna_Breach__Cubby__Entrance => true,
            SpotId::Giguna_Breach__Cubby__Rocks => true,
            SpotId::Giguna_Breach__Fire_Room__Cuesta => true,
            SpotId::Giguna_Breach__Fire_Room__East_11 => true,
            SpotId::Giguna_Breach__Fire_Room__First_Fire => true,
            SpotId::Giguna_Breach__Fire_Room__South => true,
            SpotId::Giguna_Breach__Fire_Room__West_10 => true,
            SpotId::Giguna_Breach__Fire_Room__West_11 => true,
            SpotId::Giguna_Breach__Fire_Room__West_Plateau => true,
            SpotId::Giguna_Breach__Grid_14_10_11__East_10 => true,
            SpotId::Giguna_Breach__Grid_14_10_11__East_11 => true,
            SpotId::Giguna_Breach__Grid_14_10_11__High_Ledge => true,
            SpotId::Giguna_Breach__Grid_14_10_11__North => true,
            SpotId::Giguna_Breach__Grid_14_10_11__South => true,
            SpotId::Giguna_Breach__Peak__Column => true,
            SpotId::Giguna_Breach__Peak__East_6 => true,
            SpotId::Giguna_Breach__Peak__East_Passage => true,
            SpotId::Giguna_Breach__Peak__Portal => true,
            SpotId::Giguna_Breach__Peak__Save_Point => true,
            SpotId::Giguna_Breach__Peak__Upper_East => true,
            SpotId::Giguna_Breach__Peak__Upper_West => true,
            SpotId::Giguna_Breach__Peak__West_7 => true,
            SpotId::Giguna_Breach__Pink_Clouds__Corner => true,
            SpotId::Giguna_Breach__Pink_Clouds__Normal_Entry => true,
            SpotId::Giguna_Breach__Pink_Clouds__Quick_Entry => true,
            SpotId::Giguna_Breach__Robopede__Center => true,
            SpotId::Giguna_Breach__Robopede__North => true,
            SpotId::Giguna_Breach__Robopede__West => true,
            SpotId::Giguna_Breach__SW_Save__East_12 => true,
            SpotId::Giguna_Breach__SW_Save__Lower_Platform => true,
            SpotId::Giguna_Breach__SW_Save__North => true,
            SpotId::Giguna_Breach__SW_Save__Save_Point => true,
            SpotId::Giguna_Breach__SW_Save__Side_Door => true,
            SpotId::Giguna_Breach__SW_Save__West_11 => true,
            SpotId::Giguna_Breach__Slingshot__Column => true,
            SpotId::Giguna_Breach__Slingshot__Ravine => true,
            SpotId::Giguna_Breach__Slingshot__West => true,
            SpotId::Irikar_Breach__Save_Room__Save_Point => true,
            _ => false,
        }
    }
    pub fn water(spot_id: SpotId) -> bool {
        match spot_id {
            SpotId::Amagi__Cave_Behind_Waterfall__Bottom => false,
            SpotId::Amagi__Cave_Behind_Waterfall__Middle => false,
            SpotId::Amagi__Cave_Behind_Waterfall__Top => false,
            SpotId::Amagi__Grid_31_19__East => true,
            SpotId::Amagi__Grid_31_19__West => true,
            SpotId::Amagi__Liru_Room__Bottom => true,
            SpotId::Amagi__Liru_Room__East_Passage => true,
            SpotId::Amagi__Liru_Room__Hidden_Enemies => true,
            SpotId::Amagi__Liru_Room__Hidden_Exit => true,
            SpotId::Amagi__Liru_Room__Platform_1_Left => true,
            SpotId::Amagi__Liru_Room__Platform_1_Right => true,
            SpotId::Amagi__Liru_Room__Platform_2_Left => true,
            SpotId::Amagi__Liru_Room__Platform_2_Right => true,
            SpotId::Amagi__Liru_Room__Platform_3_Left => true,
            SpotId::Amagi__Liru_Room__Platform_3_Right => true,
            SpotId::Amagi__Liru_Room__Platform_4_Left => true,
            SpotId::Amagi__Liru_Room__Platform_4_Right => true,
            SpotId::Amagi__Liru_Room__Shrine => true,
            SpotId::Amagi__Liru_Room__West_19 => true,
            SpotId::Amagi__Liru_Room__West_20 => true,
            SpotId::Amagi__Main_Area__Broken_Wall => true,
            SpotId::Amagi__Main_Area__Carving => false,
            SpotId::Amagi__Main_Area__Catwalk_Broken_Part => true,
            SpotId::Amagi__Main_Area__Catwalk_Center => true,
            SpotId::Amagi__Main_Area__Catwalk_East_Edge => true,
            SpotId::Amagi__Main_Area__Cliff => true,
            SpotId::Amagi__Main_Area__East_15 => false,
            SpotId::Amagi__Main_Area__East_19 => true,
            SpotId::Amagi__Main_Area__East_Ledge => true,
            SpotId::Amagi__Main_Area__Enemy_Side => true,
            SpotId::Amagi__Main_Area__Flat_Ruin => true,
            SpotId::Amagi__Main_Area__Half_Pillar => true,
            SpotId::Amagi__Main_Area__Platform_2 => true,
            SpotId::Amagi__Main_Area__Platform_3 => true,
            SpotId::Amagi__Main_Area__Save_Point => true,
            SpotId::Amagi__Main_Area__Secret_Outcropping => false,
            SpotId::Amagi__Main_Area__Secret_Waterfall => false,
            SpotId::Amagi__Main_Area__Shallow_End => true,
            SpotId::Amagi__Main_Area__Small_Cliff => true,
            SpotId::Amagi__Main_Area__Upper_Platform => true,
            SpotId::Amagi__Main_Area__Wall_Stuck_Spot => true,
            SpotId::Amagi__Main_Area__Waters_Edge => false,
            SpotId::Amagi__Main_Area__Way_Off_To_The_Side => false,
            SpotId::Amagi__Main_Area__West_15 => false,
            SpotId::Amagi__Main_Area__West_18 => true,
            SpotId::Amagi__Main_Area__West_19 => true,
            SpotId::Amagi__Main_Area__West_Mini_Hill => true,
            SpotId::Amagi__Main_Area__West_Shelf => true,
            SpotId::Amagi__Main_Area__West_Side => true,
            SpotId::Amagi__West_Lake__Cavern_Back_Teeth => true,
            SpotId::Amagi__West_Lake__Cavern_Chin => true,
            SpotId::Amagi__West_Lake__Cavern_Eye => true,
            SpotId::Amagi__West_Lake__Cavern_Front_Pillar => true,
            SpotId::Amagi__West_Lake__Cavern_Front_Teeth => true,
            SpotId::Amagi__West_Lake__Cavern_Jaw => true,
            SpotId::Amagi__West_Lake__Cavern_Lower_Trachea => true,
            SpotId::Amagi__West_Lake__Cavern_Middle_Pillar => true,
            SpotId::Amagi__West_Lake__Cavern_Neck => true,
            SpotId::Amagi__West_Lake__Cavern_Rear_Pillar => true,
            SpotId::Amagi__West_Lake__Cavern_Refill_Station => true,
            SpotId::Amagi__West_Lake__Cavern_Tear_Duct => true,
            SpotId::Amagi__West_Lake__East_15 => false,
            SpotId::Amagi__West_Lake__East_18 => true,
            SpotId::Amagi__West_Lake__East_19 => true,
            SpotId::Amagi__West_Lake__East_20 => true,
            SpotId::Amagi__West_Lake__East_Bank => true,
            SpotId::Amagi__West_Lake__East_Platform => true,
            SpotId::Amagi__West_Lake__East_Shore => false,
            SpotId::Amagi__West_Lake__Left_of_Enemy => true,
            SpotId::Amagi__West_Lake__Northeast_Platform => true,
            SpotId::Amagi__West_Lake__Northwest_Platform => true,
            SpotId::Amagi__West_Lake__Pillar => true,
            SpotId::Amagi__West_Lake__Pillar_Platform => true,
            SpotId::Amagi__West_Lake__Small_Hill => true,
            SpotId::Amagi__West_Lake__Some_Rock => true,
            SpotId::Amagi__West_Lake__Somewhat_Central_Platform => true,
            SpotId::Amagi__West_Lake__Stronghold_Ceiling_Left => true,
            SpotId::Amagi__West_Lake__Stronghold_Ceiling_Right => true,
            SpotId::Amagi__West_Lake__Stronghold_Front_Door => true,
            SpotId::Amagi__West_Lake__Stronghold_Front_Room => true,
            SpotId::Amagi__West_Lake__Stronghold_Item => true,
            SpotId::Amagi__West_Lake__Stronghold_Middle_Column => true,
            SpotId::Amagi__West_Lake__Stronghold_Rear_Wall => true,
            SpotId::Amagi__West_Lake__Stronghold_Top => true,
            SpotId::Amagi__West_Lake__Surface_Wall_Left => false,
            SpotId::Amagi__West_Lake__Surface_Wall_Right => false,
            SpotId::Amagi__West_Lake__Tentacle_Gap => true,
            SpotId::Amagi__West_Lake__Upper_Center_Platform => true,
            SpotId::Amagi__West_Lake__Water_Surface => false,
            SpotId::Amagi__West_Lake__West_15 => false,
            SpotId::Amagi__West_Lake__West_Bank => true,
            SpotId::Amagi__West_Lake__West_Cliff => true,
            SpotId::Amagi__West_Lake__West_Platform => true,
            SpotId::Amagi__West_Lake__West_Shore => false,
            _ => false,
        }
    }
    pub fn flipside(spot_id: SpotId) -> SpotId {
        match spot_id {
            SpotId::Giguna_Breach__Peak__Portal => SpotId::Giguna__Ruins_Top__Save_Point,
            SpotId::Giguna_Breach__Peak__Save_Point => SpotId::Giguna__Ruins_Top__Portal,
            SpotId::Giguna_Breach__Pink_Clouds__Corner => SpotId::Giguna__Clouds__Cache,
            SpotId::Giguna_Breach__Pink_Clouds__Normal_Entry => {
                SpotId::Giguna__Clouds__Platform_Stop
            }
            SpotId::Giguna__Clouds__Cache => SpotId::Giguna_Breach__Pink_Clouds__Corner,
            SpotId::Giguna__Clouds__Platform_Stop => {
                SpotId::Giguna_Breach__Pink_Clouds__Normal_Entry
            }
            SpotId::Giguna__Ruins_Top__Portal => SpotId::Giguna_Breach__Peak__Save_Point,
            SpotId::Giguna__Ruins_Top__Save_Point => SpotId::Giguna_Breach__Peak__Portal,
            SpotId::Irikar_Breach__Save_Room__Save_Point => SpotId::Irikar__Sight_Room__Portal,
            SpotId::Irikar__Sight_Room__Portal => SpotId::Irikar_Breach__Save_Room__Save_Point,
            _ => SpotId::None,
        }
    }
}

pub mod flags {
    use bitflags::bitflags;
    use serde::{self, Deserialize, Serialize};

    bitflags! {
        #[derive(Copy, Clone, Debug, Default, PartialEq, Eq, Hash, Serialize, Deserialize)]
        pub struct ContextBits1 : u32 {
            const AMAGI__MAIN_AREA__CTX__COMBO = 0x1;
            const EBIH__BASE_CAMP__CTX__LEFT_PLATFORM_MOVED = 0x2;
            const EBIH__GRID_25_10_12__CTX__DOOR_OPEN = 0x4;
            const EBIH__WATERFALL__CTX__WEST_DOOR_OPEN = 0x8;
            const EBIH__EBIH_WEST__CTX__DOOR_OPEN = 0x10;
            const EBIH__EBIH_EAST__CTX__PLATFORM1_MOVED = 0x20;
            const EBIH__EBIH_EAST__CTX__PLATFORM2_MOVED = 0x40;
            const EBIH__DRONE_ROOM__CTX__PLATFORM_MOVED = 0x80;
            const EBIH__VERTICAL_INTERCHANGE__CTX__DOOR_OPEN = 0x100;
            const GIGUNA_BREACH__SW_SAVE__CTX__DOOR_OPENED = 0x200;
            const GIGUNA__GIGUNA_NORTHEAST__CTX__DOOR_OPENED = 0x400;
            const GIGUNA__CARNELIAN__CTX__DOOR_OPENED = 0x800;
            const GIGUNA__CARNELIAN__CTX__UPPER_SUSAR = 0x1000;
            const GIGUNA__CARNELIAN__CTX__LOWER_SUSAR = 0x2000;
            const GIGUNA__WEST_CAVERNS__CTX__EAST_SUSAR = 0x4000;
            const GIGUNA__GIGUNA_BASE__CTX__DOOR_OPEN = 0x8000;
            const GIGUNA__RUINS_WEST__CTX__KISHIB_HANDLED = 0x10000;
            const GIGUNA__RUINS_TOP__CTX__DOORS_OPEN = 0x20000;
            const GIGUNA__CLOUDS__CTX__PLATFORM_AND_PORTAL = 0x40000;
            const GIGUNA__EAST_CAVERNS__CTX__DOOR_OPENED = 0x80000;
            const GIGUNA__EAST_CAVERNS__CTX__COMBO_ENTERED = 0x100000;
            const GIGUNA__EAST_CAVERNS__CTX__UPPER_SUSAR = 0x200000;
            const GIGUNA__EAST_CAVERNS__CTX__MID_SUSAR = 0x400000;
            const GIGUNA__GATEWAY__CTX__DOOR_OPENED = 0x800000;
            const BOOMERANG_STEERING = 0x1000000;
            const MAJOR_GLITCHES = 0x2000000;
            const MINOR_GLITCHES = 0x4000000;
            const AMAGI_DRAGON_EYE_PASSAGE = 0x8000000;
            const AMAGI_STRONGHOLD_BOULDER_1 = 0x10000000;
            const AMAGI_STRONGHOLD_BOULDER_2 = 0x20000000;
            const AMAGI_STRONGHOLD_WALL_1 = 0x40000000;
            const AMAGI_STRONGHOLD_WALL_2 = 0x80000000;
        }
    }
    bitflags! {
        #[derive(Copy, Clone, Debug, Default, PartialEq, Eq, Hash, Serialize, Deserialize)]
        pub struct ContextBits2 : u32 {
            const AMAGI_WEST_LAKE_SURFACE_WALL = 0x1;
            const AMASHILAMA = 0x2;
            const ANUMAN = 0x4;
            const APOCALYPSE_BOMB = 0x8;
            const BOOMERANG = 0x10;
            const BREACH_ATTRACTOR = 0x20;
            const BREACH_SIGHT = 0x40;
            const BRONZE_AXE = 0x80;
            const BUILDING_OF_THE_SCHOOL = 0x100;
            const COMMEMORATIVE_SPEECH = 0x200;
            const COMPANIES_LAYOFF = 0x400;
            const DEAR_ERNEST = 0x800;
            const DEFEAT_EBIH_ALU = 0x1000;
            const DEFEAT_MUS_A_M20 = 0x2000;
            const DRONE_HOVER = 0x4000;
            const EBIH_INTERCHANGE_BLOCK = 0x8000;
            const EBIH_INTERCHANGE_GATE = 0x10000;
            const EBIH_WASTELAND_DOOR = 0x20000;
            const EBIH_WASTELAND_PASSAGE_H = 0x40000;
            const EBIH_WATERFALL_BLOCK_LEFT = 0x80000;
            const EBIH_WATERFALL_BLOCK_RIGHT = 0x100000;
            const EBIH_WATERFALL_WALL = 0x200000;
            const EBIH_WEST_BLOCK = 0x400000;
            const EXIT_BREACH = 0x800000;
            const FAST_TRAVEL = 0x1000000;
            const GIGUNA_BOULDER = 0x2000000;
            const GIGUNA_DUAL_PATH_SWITCH = 0x4000000;
            const GIGUNA_GATEWAY_BLOCK = 0x8000000;
            const GIGUNA_GATEWAY_GATE = 0x10000000;
            const GIGUNA_GUBI = 0x20000000;
            const GIGUNA_NORTHEAST_GATE = 0x40000000;
            const HEALTH_NODE = 0x80000000;
        }
    }
    bitflags! {
        #[derive(Copy, Clone, Debug, Default, PartialEq, Eq, Hash, Serialize, Deserialize)]
        pub struct ContextBits3 : u32 {
            const HERETICS_TABLET = 0x1;
            const ICE_AXE = 0x2;
            const INFECTION_SPEED = 0x4;
            const LEDGE_GRAB = 0x8;
            const LETTER_FROM_TRACE = 0x10;
            const MAP_17_10 = 0x20;
            const MIST_UPGRADE = 0x40;
            const NANITE_MIST = 0x80;
            const POWER_MATRIX = 0x100;
            const RECORD_LOSSES = 0x200;
            const REMOTE_DRONE = 0x400;
            const RESEARCHERS_MISSING = 0x800;
            const SHOCKWAVE = 0x1000;
            const SLINGSHOT_CHARGE = 0x2000;
            const SLINGSHOT_HOOK = 0x4000;
            const SLINGSHOT_WEAPON = 0x8000;
            const STATION_POWER = 0x10000;
            const SWITCH_36_11 = 0x20000;
            const SWITCH_40_12 = 0x40000;
            const TERMINAL_BREAKTHROUGH_1 = 0x80000;
            const THE_IDEAL_KIENGIR = 0x100000;
            const UNDER_SIEGE = 0x200000;
            const UNDERWATER_MOVEMENT = 0x400000;
            const WALL_CLIMB = 0x800000;
        }
    }
}

#[derive(Copy, Clone, Debug, Default, PartialEq, Eq, Hash, Serialize_repr, Deserialize_repr)]
#[repr(u8)]
pub enum Status {
    #[default]
    None,
    Visited,
    Skipped,
}

#[derive(Clone, Debug, Eq, PartialEq, Hash, Serialize, Deserialize)]
pub struct Context {
    // context vars
    pub position: SpotId,
    pub energy: i16,
    pub flasks: i8,
    pub refills: i8,
    pub mode: enums::Mode,
    pub save: SpotId,
    pub indra: SpotId,
    pub last: SpotId,
    pub prev_area: AreaId,
    // settings
    // items
    pub drone_melee_damage: i8,
    pub drone_melee_speed: i8,
    pub flask: i8,
    pub health_fragment: i8,
    pub health_upgrade: i8,
    pub infect: i8,
    pub infection_range: i8,
    pub melee_damage: i8,
    pub melee_speed: i8,
    pub nano_points: i8,
    pub ranged_damage: i8,
    pub ranged_speed: i8,
    // bitflags
    pub cbits1: flags::ContextBits1,
    pub cbits2: flags::ContextBits2,
    pub cbits3: flags::ContextBits3,
    // other
    pub status: EnumMap<LocationId, Status>,

    visits: u32,
    skips: u32,
}

impl Default for Context {
    fn default() -> Context {
        Context {
            position: SpotId::Antarctica__West__Helipad,
            save: SpotId::Antarctica__West__Helipad,
            indra: SpotId::None,
            last: SpotId::None,
            prev_area: AreaId::Antarctica__West,
            energy: 0,
            flasks: 0,
            refills: 0,
            mode: enums::Mode::Indra,
            // settings
            // items
            drone_melee_damage: Default::default(),
            drone_melee_speed: Default::default(),
            flask: Default::default(),
            health_fragment: Default::default(),
            health_upgrade: Default::default(),
            infect: Default::default(),
            infection_range: Default::default(),
            melee_damage: Default::default(),
            melee_speed: Default::default(),
            nano_points: Default::default(),
            ranged_damage: Default::default(),
            ranged_speed: Default::default(),
            // bitflags
            cbits1: Default::default(),
            cbits2: Default::default(),
            cbits3: Default::default(),
            // other
            status: Default::default(),
            visits: Default::default(),
            skips: Default::default(),
        }
    }
}

impl context::Ctx for Context {
    type World = graph::World;
    type ItemId = Item;
    type AreaId = AreaId;
    type RegionId = RegionId;
    type MovementState = movements::MovementState;
    type Expectation = Expectation;
    const NUM_ITEMS: u32 = 73;

    fn has(&self, item: Item) -> bool {
        match item {
            Item::Amagi_Dragon_Eye_Passage => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_DRAGON_EYE_PASSAGE),
            Item::Amagi_Stronghold_Boulder_1 => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_1),
            Item::Amagi_Stronghold_Boulder_2 => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_2),
            Item::Amagi_Stronghold_Wall_1 => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_1),
            Item::Amagi_Stronghold_Wall_2 => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_2),
            Item::Amagi_West_Lake_Surface_Wall => self
                .cbits2
                .contains(flags::ContextBits2::AMAGI_WEST_LAKE_SURFACE_WALL),
            Item::Amashilama => self.cbits2.contains(flags::ContextBits2::AMASHILAMA),
            Item::Anuman => self.cbits2.contains(flags::ContextBits2::ANUMAN),
            Item::Apocalypse_Bomb => self.cbits2.contains(flags::ContextBits2::APOCALYPSE_BOMB),
            Item::Boomerang => self.cbits2.contains(flags::ContextBits2::BOOMERANG),
            Item::Breach_Attractor => self.cbits2.contains(flags::ContextBits2::BREACH_ATTRACTOR),
            Item::Breach_Sight => self.cbits2.contains(flags::ContextBits2::BREACH_SIGHT),
            Item::Bronze_Axe => self.cbits2.contains(flags::ContextBits2::BRONZE_AXE),
            Item::Building_of_the_School => self
                .cbits2
                .contains(flags::ContextBits2::BUILDING_OF_THE_SCHOOL),
            Item::Commemorative_Speech => self
                .cbits2
                .contains(flags::ContextBits2::COMMEMORATIVE_SPEECH),
            Item::Companies_Layoff => self.cbits2.contains(flags::ContextBits2::COMPANIES_LAYOFF),
            Item::Dear_Ernest => self.cbits2.contains(flags::ContextBits2::DEAR_ERNEST),
            Item::Defeat_Ebih_Alu => self.cbits2.contains(flags::ContextBits2::DEFEAT_EBIH_ALU),
            Item::Defeat_MUS_A_M20 => self.cbits2.contains(flags::ContextBits2::DEFEAT_MUS_A_M20),
            Item::Drone_Hover => self.cbits2.contains(flags::ContextBits2::DRONE_HOVER),
            Item::Drone_Melee_Damage => self.drone_melee_damage >= 1,
            Item::Drone_Melee_Speed => self.drone_melee_speed >= 1,
            Item::Ebih_Interchange_Block => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_INTERCHANGE_BLOCK),
            Item::Ebih_Interchange_Gate => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_INTERCHANGE_GATE),
            Item::Ebih_Wasteland_Door => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WASTELAND_DOOR),
            Item::Ebih_Wasteland_Passage_H => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WASTELAND_PASSAGE_H),
            Item::Ebih_Waterfall_Block_Left => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WATERFALL_BLOCK_LEFT),
            Item::Ebih_Waterfall_Block_Right => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WATERFALL_BLOCK_RIGHT),
            Item::Ebih_Waterfall_Wall => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WATERFALL_WALL),
            Item::Ebih_West_Block => self.cbits2.contains(flags::ContextBits2::EBIH_WEST_BLOCK),
            Item::Exit_Breach => self.cbits2.contains(flags::ContextBits2::EXIT_BREACH),
            Item::Fast_Travel => self.cbits2.contains(flags::ContextBits2::FAST_TRAVEL),
            Item::Flask => self.flask >= 1,
            Item::Giguna_Boulder => self.cbits2.contains(flags::ContextBits2::GIGUNA_BOULDER),
            Item::Giguna_Dual_Path_Switch => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_DUAL_PATH_SWITCH),
            Item::Giguna_Gateway_Block => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_GATEWAY_BLOCK),
            Item::Giguna_Gateway_Gate => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_GATEWAY_GATE),
            Item::Giguna_Gubi => self.cbits2.contains(flags::ContextBits2::GIGUNA_GUBI),
            Item::Giguna_Northeast_Gate => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_NORTHEAST_GATE),
            Item::Health_Fragment => self.health_fragment >= 1,
            Item::Health_Node => self.cbits2.contains(flags::ContextBits2::HEALTH_NODE),
            Item::Health_Upgrade => self.health_upgrade >= 1,
            Item::Heretics_Tablet => self.cbits3.contains(flags::ContextBits3::HERETICS_TABLET),
            Item::Ice_Axe => self.cbits3.contains(flags::ContextBits3::ICE_AXE),
            Item::Infect => self.infect >= 1,
            Item::Infection_Range => self.infection_range >= 1,
            Item::Infection_Speed => self.cbits3.contains(flags::ContextBits3::INFECTION_SPEED),
            Item::Ledge_Grab => self.cbits3.contains(flags::ContextBits3::LEDGE_GRAB),
            Item::Letter_from_Trace => self.cbits3.contains(flags::ContextBits3::LETTER_FROM_TRACE),
            Item::Map_17_10 => self.cbits3.contains(flags::ContextBits3::MAP_17_10),
            Item::Melee_Damage => self.melee_damage >= 1,
            Item::Melee_Speed => self.melee_speed >= 1,
            Item::Mist_Upgrade => self.cbits3.contains(flags::ContextBits3::MIST_UPGRADE),
            Item::Nanite_Mist => self.cbits3.contains(flags::ContextBits3::NANITE_MIST),
            Item::Nano_Points => self.nano_points >= 1,
            Item::Power_Matrix => self.cbits3.contains(flags::ContextBits3::POWER_MATRIX),
            Item::Ranged_Damage => self.ranged_damage >= 1,
            Item::Ranged_Speed => self.ranged_speed >= 1,
            Item::Record_Losses => self.cbits3.contains(flags::ContextBits3::RECORD_LOSSES),
            Item::Remote_Drone => self.cbits3.contains(flags::ContextBits3::REMOTE_DRONE),
            Item::Researchers_Missing => self
                .cbits3
                .contains(flags::ContextBits3::RESEARCHERS_MISSING),
            Item::Shockwave => self.cbits3.contains(flags::ContextBits3::SHOCKWAVE),
            Item::Slingshot_Charge => self.cbits3.contains(flags::ContextBits3::SLINGSHOT_CHARGE),
            Item::Slingshot_Hook => self.cbits3.contains(flags::ContextBits3::SLINGSHOT_HOOK),
            Item::Slingshot_Weapon => self.cbits3.contains(flags::ContextBits3::SLINGSHOT_WEAPON),
            Item::Station_Power => self.cbits3.contains(flags::ContextBits3::STATION_POWER),
            Item::Switch_36_11 => self.cbits3.contains(flags::ContextBits3::SWITCH_36_11),
            Item::Switch_40_12 => self.cbits3.contains(flags::ContextBits3::SWITCH_40_12),
            Item::Terminal_Breakthrough_1 => self
                .cbits3
                .contains(flags::ContextBits3::TERMINAL_BREAKTHROUGH_1),
            Item::The_Ideal_Kiengir => self.cbits3.contains(flags::ContextBits3::THE_IDEAL_KIENGIR),
            Item::Under_Siege => self.cbits3.contains(flags::ContextBits3::UNDER_SIEGE),
            Item::Underwater_Movement => self
                .cbits3
                .contains(flags::ContextBits3::UNDERWATER_MOVEMENT),
            Item::Wall_Climb => self.cbits3.contains(flags::ContextBits3::WALL_CLIMB),
            _ => false,
        }
    }
    fn count(&self, item: Item) -> i16 {
        match item {
            Item::Amagi_Dragon_Eye_Passage => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_DRAGON_EYE_PASSAGE)
                .into(),
            Item::Amagi_Stronghold_Boulder_1 => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_1)
                .into(),
            Item::Amagi_Stronghold_Boulder_2 => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_2)
                .into(),
            Item::Amagi_Stronghold_Wall_1 => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_1)
                .into(),
            Item::Amagi_Stronghold_Wall_2 => self
                .cbits1
                .contains(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_2)
                .into(),
            Item::Amagi_West_Lake_Surface_Wall => self
                .cbits2
                .contains(flags::ContextBits2::AMAGI_WEST_LAKE_SURFACE_WALL)
                .into(),
            Item::Amashilama => self.cbits2.contains(flags::ContextBits2::AMASHILAMA).into(),
            Item::Anuman => self.cbits2.contains(flags::ContextBits2::ANUMAN).into(),
            Item::Apocalypse_Bomb => self
                .cbits2
                .contains(flags::ContextBits2::APOCALYPSE_BOMB)
                .into(),
            Item::Boomerang => self.cbits2.contains(flags::ContextBits2::BOOMERANG).into(),
            Item::Breach_Attractor => self
                .cbits2
                .contains(flags::ContextBits2::BREACH_ATTRACTOR)
                .into(),
            Item::Breach_Sight => self
                .cbits2
                .contains(flags::ContextBits2::BREACH_SIGHT)
                .into(),
            Item::Bronze_Axe => self.cbits2.contains(flags::ContextBits2::BRONZE_AXE).into(),
            Item::Building_of_the_School => self
                .cbits2
                .contains(flags::ContextBits2::BUILDING_OF_THE_SCHOOL)
                .into(),
            Item::Commemorative_Speech => self
                .cbits2
                .contains(flags::ContextBits2::COMMEMORATIVE_SPEECH)
                .into(),
            Item::Companies_Layoff => self
                .cbits2
                .contains(flags::ContextBits2::COMPANIES_LAYOFF)
                .into(),
            Item::Dear_Ernest => self
                .cbits2
                .contains(flags::ContextBits2::DEAR_ERNEST)
                .into(),
            Item::Defeat_Ebih_Alu => self
                .cbits2
                .contains(flags::ContextBits2::DEFEAT_EBIH_ALU)
                .into(),
            Item::Defeat_MUS_A_M20 => self
                .cbits2
                .contains(flags::ContextBits2::DEFEAT_MUS_A_M20)
                .into(),
            Item::Drone_Hover => self
                .cbits2
                .contains(flags::ContextBits2::DRONE_HOVER)
                .into(),
            Item::Drone_Melee_Damage => self.drone_melee_damage.into(),
            Item::Drone_Melee_Speed => self.drone_melee_speed.into(),
            Item::Ebih_Interchange_Block => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_INTERCHANGE_BLOCK)
                .into(),
            Item::Ebih_Interchange_Gate => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_INTERCHANGE_GATE)
                .into(),
            Item::Ebih_Wasteland_Door => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WASTELAND_DOOR)
                .into(),
            Item::Ebih_Wasteland_Passage_H => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WASTELAND_PASSAGE_H)
                .into(),
            Item::Ebih_Waterfall_Block_Left => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WATERFALL_BLOCK_LEFT)
                .into(),
            Item::Ebih_Waterfall_Block_Right => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WATERFALL_BLOCK_RIGHT)
                .into(),
            Item::Ebih_Waterfall_Wall => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WATERFALL_WALL)
                .into(),
            Item::Ebih_West_Block => self
                .cbits2
                .contains(flags::ContextBits2::EBIH_WEST_BLOCK)
                .into(),
            Item::Exit_Breach => self
                .cbits2
                .contains(flags::ContextBits2::EXIT_BREACH)
                .into(),
            Item::Fast_Travel => self
                .cbits2
                .contains(flags::ContextBits2::FAST_TRAVEL)
                .into(),
            Item::Flask => self.flask.into(),
            Item::Giguna_Boulder => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_BOULDER)
                .into(),
            Item::Giguna_Dual_Path_Switch => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_DUAL_PATH_SWITCH)
                .into(),
            Item::Giguna_Gateway_Block => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_GATEWAY_BLOCK)
                .into(),
            Item::Giguna_Gateway_Gate => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_GATEWAY_GATE)
                .into(),
            Item::Giguna_Gubi => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_GUBI)
                .into(),
            Item::Giguna_Northeast_Gate => self
                .cbits2
                .contains(flags::ContextBits2::GIGUNA_NORTHEAST_GATE)
                .into(),
            Item::Health_Fragment => self.health_fragment.into(),
            Item::Health_Node => self
                .cbits2
                .contains(flags::ContextBits2::HEALTH_NODE)
                .into(),
            Item::Health_Upgrade => self.health_upgrade.into(),
            Item::Heretics_Tablet => self
                .cbits3
                .contains(flags::ContextBits3::HERETICS_TABLET)
                .into(),
            Item::Ice_Axe => self.cbits3.contains(flags::ContextBits3::ICE_AXE).into(),
            Item::Infect => self.infect.into(),
            Item::Infection_Range => self.infection_range.into(),
            Item::Infection_Speed => self
                .cbits3
                .contains(flags::ContextBits3::INFECTION_SPEED)
                .into(),
            Item::Ledge_Grab => self.cbits3.contains(flags::ContextBits3::LEDGE_GRAB).into(),
            Item::Letter_from_Trace => self
                .cbits3
                .contains(flags::ContextBits3::LETTER_FROM_TRACE)
                .into(),
            Item::Map_17_10 => self.cbits3.contains(flags::ContextBits3::MAP_17_10).into(),
            Item::Melee_Damage => self.melee_damage.into(),
            Item::Melee_Speed => self.melee_speed.into(),
            Item::Mist_Upgrade => self
                .cbits3
                .contains(flags::ContextBits3::MIST_UPGRADE)
                .into(),
            Item::Nanite_Mist => self
                .cbits3
                .contains(flags::ContextBits3::NANITE_MIST)
                .into(),
            Item::Nano_Points => self.nano_points.into(),
            Item::Power_Matrix => self
                .cbits3
                .contains(flags::ContextBits3::POWER_MATRIX)
                .into(),
            Item::Ranged_Damage => self.ranged_damage.into(),
            Item::Ranged_Speed => self.ranged_speed.into(),
            Item::Record_Losses => self
                .cbits3
                .contains(flags::ContextBits3::RECORD_LOSSES)
                .into(),
            Item::Remote_Drone => self
                .cbits3
                .contains(flags::ContextBits3::REMOTE_DRONE)
                .into(),
            Item::Researchers_Missing => self
                .cbits3
                .contains(flags::ContextBits3::RESEARCHERS_MISSING)
                .into(),
            Item::Shockwave => self.cbits3.contains(flags::ContextBits3::SHOCKWAVE).into(),
            Item::Slingshot_Charge => self
                .cbits3
                .contains(flags::ContextBits3::SLINGSHOT_CHARGE)
                .into(),
            Item::Slingshot_Hook => self
                .cbits3
                .contains(flags::ContextBits3::SLINGSHOT_HOOK)
                .into(),
            Item::Slingshot_Weapon => self
                .cbits3
                .contains(flags::ContextBits3::SLINGSHOT_WEAPON)
                .into(),
            Item::Station_Power => self
                .cbits3
                .contains(flags::ContextBits3::STATION_POWER)
                .into(),
            Item::Switch_36_11 => self
                .cbits3
                .contains(flags::ContextBits3::SWITCH_36_11)
                .into(),
            Item::Switch_40_12 => self
                .cbits3
                .contains(flags::ContextBits3::SWITCH_40_12)
                .into(),
            Item::Terminal_Breakthrough_1 => self
                .cbits3
                .contains(flags::ContextBits3::TERMINAL_BREAKTHROUGH_1)
                .into(),
            Item::The_Ideal_Kiengir => self
                .cbits3
                .contains(flags::ContextBits3::THE_IDEAL_KIENGIR)
                .into(),
            Item::Under_Siege => self
                .cbits3
                .contains(flags::ContextBits3::UNDER_SIEGE)
                .into(),
            Item::Underwater_Movement => self
                .cbits3
                .contains(flags::ContextBits3::UNDERWATER_MOVEMENT)
                .into(),
            Item::Wall_Climb => self.cbits3.contains(flags::ContextBits3::WALL_CLIMB).into(),
            _ => 0,
        }
    }
    fn collect(&mut self, item: Item) {
        match item {
            Item::Amagi_Dragon_Eye_Passage => {
                self.cbits1.insert(flags::ContextBits1::AMAGI_DRAGON_EYE_PASSAGE);
            },
            Item::Amagi_Stronghold_Boulder_1 => {
                self.cbits1.insert(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_1);
            },
            Item::Amagi_Stronghold_Boulder_2 => {
                self.cbits1.insert(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_2);
            },
            Item::Amagi_Stronghold_Wall_1 => {
                self.cbits1.insert(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_1);
            },
            Item::Amagi_Stronghold_Wall_2 => {
                self.cbits1.insert(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_2);
            },
            Item::Amagi_West_Lake_Surface_Wall => {
                self.cbits2.insert(flags::ContextBits2::AMAGI_WEST_LAKE_SURFACE_WALL);
            },
            Item::Amashilama => {
                self.cbits2.insert(flags::ContextBits2::AMASHILAMA);
                rules::action_save__glacier__revival__save_point(self);
            },
            Item::Anuman => {
                self.cbits2.insert(flags::ContextBits2::ANUMAN);
            },
            Item::Apocalypse_Bomb => {
                self.cbits2.insert(flags::ContextBits2::APOCALYPSE_BOMB);
            },
            Item::Boomerang => {
                self.cbits2.insert(flags::ContextBits2::BOOMERANG);
            },
            Item::Breach_Attractor => {
                self.cbits2.insert(flags::ContextBits2::BREACH_ATTRACTOR);
            },
            Item::Breach_Sight => {
                self.cbits2.insert(flags::ContextBits2::BREACH_SIGHT);
            },
            Item::Bronze_Axe => {
                self.cbits2.insert(flags::ContextBits2::BRONZE_AXE);
            },
            Item::Building_of_the_School => {
                self.cbits2.insert(flags::ContextBits2::BUILDING_OF_THE_SCHOOL);
            },
            Item::Commemorative_Speech => {
                self.cbits2.insert(flags::ContextBits2::COMMEMORATIVE_SPEECH);
            },
            Item::Companies_Layoff => {
                self.cbits2.insert(flags::ContextBits2::COMPANIES_LAYOFF);
            },
            Item::Dear_Ernest => {
                self.cbits2.insert(flags::ContextBits2::DEAR_ERNEST);
            },
            Item::Defeat_Ebih_Alu => {
                self.cbits2.insert(flags::ContextBits2::DEFEAT_EBIH_ALU);
            },
            Item::Defeat_MUS_A_M20 => {
                self.cbits2.insert(flags::ContextBits2::DEFEAT_MUS_A_M20);
                rules::action_skip__amagi__west_lake__cavern_refill_station__break_wall_add_item__amagi_dragon_eye_passage(self);
            },
            Item::Drone_Hover => {
                self.cbits2.insert(flags::ContextBits2::DRONE_HOVER);
            },
            Item::Drone_Melee_Damage => {
                self.drone_melee_damage += 1;
            },
            Item::Drone_Melee_Speed => {
                self.drone_melee_speed += 1;
            },
            Item::Ebih_Interchange_Block => {
                self.cbits2.insert(flags::ContextBits2::EBIH_INTERCHANGE_BLOCK);
            },
            Item::Ebih_Interchange_Gate => {
                self.cbits2.insert(flags::ContextBits2::EBIH_INTERCHANGE_GATE);
            },
            Item::Ebih_Wasteland_Door => {
                self.cbits2.insert(flags::ContextBits2::EBIH_WASTELAND_DOOR);
            },
            Item::Ebih_Wasteland_Passage_H => {
                self.cbits2.insert(flags::ContextBits2::EBIH_WASTELAND_PASSAGE_H);
            },
            Item::Ebih_Waterfall_Block_Left => {
                self.cbits2.insert(flags::ContextBits2::EBIH_WATERFALL_BLOCK_LEFT);
            },
            Item::Ebih_Waterfall_Block_Right => {
                self.cbits2.insert(flags::ContextBits2::EBIH_WATERFALL_BLOCK_RIGHT);
            },
            Item::Ebih_Waterfall_Wall => {
                self.cbits2.insert(flags::ContextBits2::EBIH_WATERFALL_WALL);
            },
            Item::Ebih_West_Block => {
                self.cbits2.insert(flags::ContextBits2::EBIH_WEST_BLOCK);
            },
            Item::Exit_Breach => {
                self.cbits2.insert(flags::ContextBits2::EXIT_BREACH);
            },
            Item::Fast_Travel => {
                self.cbits2.insert(flags::ContextBits2::FAST_TRAVEL);
            },
            Item::Flask => {
                self.flask += 1;
                rules::action_flasks__1(self);
            },
            Item::Giguna_Boulder => {
                self.cbits2.insert(flags::ContextBits2::GIGUNA_BOULDER);
            },
            Item::Giguna_Dual_Path_Switch => {
                self.cbits2.insert(flags::ContextBits2::GIGUNA_DUAL_PATH_SWITCH);
            },
            Item::Giguna_Gateway_Block => {
                self.cbits2.insert(flags::ContextBits2::GIGUNA_GATEWAY_BLOCK);
            },
            Item::Giguna_Gateway_Gate => {
                self.cbits2.insert(flags::ContextBits2::GIGUNA_GATEWAY_GATE);
            },
            Item::Giguna_Gubi => {
                self.cbits2.insert(flags::ContextBits2::GIGUNA_GUBI);
            },
            Item::Giguna_Northeast_Gate => {
                self.cbits2.insert(flags::ContextBits2::GIGUNA_NORTHEAST_GATE);
            },
            Item::Health_Fragment => {
                self.health_fragment += 1;
            },
            Item::Health_Node => {
                self.cbits2.insert(flags::ContextBits2::HEALTH_NODE);
                rules::action_energy__max_energy(self);
            },
            Item::Health_Upgrade => {
                self.health_upgrade += 1;
            },
            Item::Heretics_Tablet => {
                self.cbits3.insert(flags::ContextBits3::HERETICS_TABLET);
            },
            Item::Ice_Axe => {
                self.cbits3.insert(flags::ContextBits3::ICE_AXE);
            },
            Item::Infect => {
                self.infect += 1;
                rules::action_energy__max_energy(self);
            },
            Item::Infection_Range => {
                self.infection_range += 1;
            },
            Item::Infection_Speed => {
                self.cbits3.insert(flags::ContextBits3::INFECTION_SPEED);
            },
            Item::Ledge_Grab => {
                self.cbits3.insert(flags::ContextBits3::LEDGE_GRAB);
            },
            Item::Letter_from_Trace => {
                self.cbits3.insert(flags::ContextBits3::LETTER_FROM_TRACE);
            },
            Item::Map_17_10 => {
                self.cbits3.insert(flags::ContextBits3::MAP_17_10);
            },
            Item::Melee_Damage => {
                self.melee_damage += 1;
            },
            Item::Melee_Speed => {
                self.melee_speed += 1;
            },
            Item::Mist_Upgrade => {
                self.cbits3.insert(flags::ContextBits3::MIST_UPGRADE);
            },
            Item::Nanite_Mist => {
                self.cbits3.insert(flags::ContextBits3::NANITE_MIST);
            },
            Item::Nano_Points => {
                self.nano_points += 1;
            },
            Item::Power_Matrix => {
                self.cbits3.insert(flags::ContextBits3::POWER_MATRIX);
            },
            Item::Ranged_Damage => {
                self.ranged_damage += 1;
            },
            Item::Ranged_Speed => {
                self.ranged_speed += 1;
            },
            Item::Record_Losses => {
                self.cbits3.insert(flags::ContextBits3::RECORD_LOSSES);
            },
            Item::Remote_Drone => {
                self.cbits3.insert(flags::ContextBits3::REMOTE_DRONE);
            },
            Item::Researchers_Missing => {
                self.cbits3.insert(flags::ContextBits3::RESEARCHERS_MISSING);
            },
            Item::Shockwave => {
                self.cbits3.insert(flags::ContextBits3::SHOCKWAVE);
            },
            Item::Slingshot_Charge => {
                self.cbits3.insert(flags::ContextBits3::SLINGSHOT_CHARGE);
            },
            Item::Slingshot_Hook => {
                self.cbits3.insert(flags::ContextBits3::SLINGSHOT_HOOK);
            },
            Item::Slingshot_Weapon => {
                self.cbits3.insert(flags::ContextBits3::SLINGSHOT_WEAPON);
            },
            Item::Station_Power => {
                self.cbits3.insert(flags::ContextBits3::STATION_POWER);
            },
            Item::Switch_36_11 => {
                self.cbits3.insert(flags::ContextBits3::SWITCH_36_11);
            },
            Item::Switch_40_12 => {
                self.cbits3.insert(flags::ContextBits3::SWITCH_40_12);
            },
            Item::Terminal_Breakthrough_1 => {
                self.cbits3.insert(flags::ContextBits3::TERMINAL_BREAKTHROUGH_1);
            },
            Item::The_Ideal_Kiengir => {
                self.cbits3.insert(flags::ContextBits3::THE_IDEAL_KIENGIR);
            },
            Item::Under_Siege => {
                self.cbits3.insert(flags::ContextBits3::UNDER_SIEGE);
            },
            Item::Underwater_Movement => {
                self.cbits3.insert(flags::ContextBits3::UNDERWATER_MOVEMENT);
            },
            Item::Wall_Climb => {
                self.cbits3.insert(flags::ContextBits3::WALL_CLIMB);
            },
            Item::Big_Flask => rules::action_flasks__2(self),
            Item::Power_Core => rules::action_refills__1(self),
            Item::Amagi_Stronghold_Wall_And_Boulder_1 => rules::action_skip__amagi__west_lake__stronghold_ceiling_left__knock_down_left_boulder_add_item__amagi_stronghold_wall_1_add_item__amagi_stronghold_boulder_1(self),
            Item::Amagi_Stronghold_Boulder_And_Wall_2 => rules::action_skip__amagi__west_lake__stronghold_ceiling_right__knock_down_right_boulder_add_item__amagi_stronghold_wall_2_add_item__amagi_stronghold_boulder_2(self),
            Item::Ebih_Waterfall_Both_Blocks => rules::action_skip__ebih__waterfall__alcove__block_left_skip__ebih__waterfall__alcove__block_right_skip__ebih__waterfall__alcove_left__block_left_skip__ebih__waterfall__alcove_right__block_right_add_item__ebih_waterfall_block_right_add_item__ebih_waterfall_block_left(self),
            _ => (),
        }
    }

    // test helper for items
    fn add_item(&mut self, item: Item) {
        match item {
            Item::Amagi_Dragon_Eye_Passage => {
                self.cbits1
                    .insert(flags::ContextBits1::AMAGI_DRAGON_EYE_PASSAGE);
            }
            Item::Amagi_Stronghold_Boulder_1 => {
                self.cbits1
                    .insert(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_1);
            }
            Item::Amagi_Stronghold_Boulder_2 => {
                self.cbits1
                    .insert(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_2);
            }
            Item::Amagi_Stronghold_Wall_1 => {
                self.cbits1
                    .insert(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_1);
            }
            Item::Amagi_Stronghold_Wall_2 => {
                self.cbits1
                    .insert(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_2);
            }
            Item::Amagi_West_Lake_Surface_Wall => {
                self.cbits2
                    .insert(flags::ContextBits2::AMAGI_WEST_LAKE_SURFACE_WALL);
            }
            Item::Amashilama => {
                self.cbits2.insert(flags::ContextBits2::AMASHILAMA);
            }
            Item::Anuman => {
                self.cbits2.insert(flags::ContextBits2::ANUMAN);
            }
            Item::Apocalypse_Bomb => {
                self.cbits2.insert(flags::ContextBits2::APOCALYPSE_BOMB);
            }
            Item::Boomerang => {
                self.cbits2.insert(flags::ContextBits2::BOOMERANG);
            }
            Item::Breach_Attractor => {
                self.cbits2.insert(flags::ContextBits2::BREACH_ATTRACTOR);
            }
            Item::Breach_Sight => {
                self.cbits2.insert(flags::ContextBits2::BREACH_SIGHT);
            }
            Item::Bronze_Axe => {
                self.cbits2.insert(flags::ContextBits2::BRONZE_AXE);
            }
            Item::Building_of_the_School => {
                self.cbits2
                    .insert(flags::ContextBits2::BUILDING_OF_THE_SCHOOL);
            }
            Item::Commemorative_Speech => {
                self.cbits2
                    .insert(flags::ContextBits2::COMMEMORATIVE_SPEECH);
            }
            Item::Companies_Layoff => {
                self.cbits2.insert(flags::ContextBits2::COMPANIES_LAYOFF);
            }
            Item::Dear_Ernest => {
                self.cbits2.insert(flags::ContextBits2::DEAR_ERNEST);
            }
            Item::Defeat_Ebih_Alu => {
                self.cbits2.insert(flags::ContextBits2::DEFEAT_EBIH_ALU);
            }
            Item::Defeat_MUS_A_M20 => {
                self.cbits2.insert(flags::ContextBits2::DEFEAT_MUS_A_M20);
            }
            Item::Drone_Hover => {
                self.cbits2.insert(flags::ContextBits2::DRONE_HOVER);
            }
            Item::Drone_Melee_Damage => {
                self.drone_melee_damage += 1;
            }
            Item::Drone_Melee_Speed => {
                self.drone_melee_speed += 1;
            }
            Item::Ebih_Interchange_Block => {
                self.cbits2
                    .insert(flags::ContextBits2::EBIH_INTERCHANGE_BLOCK);
            }
            Item::Ebih_Interchange_Gate => {
                self.cbits2
                    .insert(flags::ContextBits2::EBIH_INTERCHANGE_GATE);
            }
            Item::Ebih_Wasteland_Door => {
                self.cbits2.insert(flags::ContextBits2::EBIH_WASTELAND_DOOR);
            }
            Item::Ebih_Wasteland_Passage_H => {
                self.cbits2
                    .insert(flags::ContextBits2::EBIH_WASTELAND_PASSAGE_H);
            }
            Item::Ebih_Waterfall_Block_Left => {
                self.cbits2
                    .insert(flags::ContextBits2::EBIH_WATERFALL_BLOCK_LEFT);
            }
            Item::Ebih_Waterfall_Block_Right => {
                self.cbits2
                    .insert(flags::ContextBits2::EBIH_WATERFALL_BLOCK_RIGHT);
            }
            Item::Ebih_Waterfall_Wall => {
                self.cbits2.insert(flags::ContextBits2::EBIH_WATERFALL_WALL);
            }
            Item::Ebih_West_Block => {
                self.cbits2.insert(flags::ContextBits2::EBIH_WEST_BLOCK);
            }
            Item::Exit_Breach => {
                self.cbits2.insert(flags::ContextBits2::EXIT_BREACH);
            }
            Item::Fast_Travel => {
                self.cbits2.insert(flags::ContextBits2::FAST_TRAVEL);
            }
            Item::Flask => {
                self.flask += 1;
            }
            Item::Giguna_Boulder => {
                self.cbits2.insert(flags::ContextBits2::GIGUNA_BOULDER);
            }
            Item::Giguna_Dual_Path_Switch => {
                self.cbits2
                    .insert(flags::ContextBits2::GIGUNA_DUAL_PATH_SWITCH);
            }
            Item::Giguna_Gateway_Block => {
                self.cbits2
                    .insert(flags::ContextBits2::GIGUNA_GATEWAY_BLOCK);
            }
            Item::Giguna_Gateway_Gate => {
                self.cbits2.insert(flags::ContextBits2::GIGUNA_GATEWAY_GATE);
            }
            Item::Giguna_Gubi => {
                self.cbits2.insert(flags::ContextBits2::GIGUNA_GUBI);
            }
            Item::Giguna_Northeast_Gate => {
                self.cbits2
                    .insert(flags::ContextBits2::GIGUNA_NORTHEAST_GATE);
            }
            Item::Health_Fragment => {
                self.health_fragment += 1;
            }
            Item::Health_Node => {
                self.cbits2.insert(flags::ContextBits2::HEALTH_NODE);
            }
            Item::Health_Upgrade => {
                self.health_upgrade += 1;
            }
            Item::Heretics_Tablet => {
                self.cbits3.insert(flags::ContextBits3::HERETICS_TABLET);
            }
            Item::Ice_Axe => {
                self.cbits3.insert(flags::ContextBits3::ICE_AXE);
            }
            Item::Infect => {
                self.infect += 1;
            }
            Item::Infection_Range => {
                self.infection_range += 1;
            }
            Item::Infection_Speed => {
                self.cbits3.insert(flags::ContextBits3::INFECTION_SPEED);
            }
            Item::Ledge_Grab => {
                self.cbits3.insert(flags::ContextBits3::LEDGE_GRAB);
            }
            Item::Letter_from_Trace => {
                self.cbits3.insert(flags::ContextBits3::LETTER_FROM_TRACE);
            }
            Item::Map_17_10 => {
                self.cbits3.insert(flags::ContextBits3::MAP_17_10);
            }
            Item::Melee_Damage => {
                self.melee_damage += 1;
            }
            Item::Melee_Speed => {
                self.melee_speed += 1;
            }
            Item::Mist_Upgrade => {
                self.cbits3.insert(flags::ContextBits3::MIST_UPGRADE);
            }
            Item::Nanite_Mist => {
                self.cbits3.insert(flags::ContextBits3::NANITE_MIST);
            }
            Item::Nano_Points => {
                self.nano_points += 1;
            }
            Item::Power_Matrix => {
                self.cbits3.insert(flags::ContextBits3::POWER_MATRIX);
            }
            Item::Ranged_Damage => {
                self.ranged_damage += 1;
            }
            Item::Ranged_Speed => {
                self.ranged_speed += 1;
            }
            Item::Record_Losses => {
                self.cbits3.insert(flags::ContextBits3::RECORD_LOSSES);
            }
            Item::Remote_Drone => {
                self.cbits3.insert(flags::ContextBits3::REMOTE_DRONE);
            }
            Item::Researchers_Missing => {
                self.cbits3.insert(flags::ContextBits3::RESEARCHERS_MISSING);
            }
            Item::Shockwave => {
                self.cbits3.insert(flags::ContextBits3::SHOCKWAVE);
            }
            Item::Slingshot_Charge => {
                self.cbits3.insert(flags::ContextBits3::SLINGSHOT_CHARGE);
            }
            Item::Slingshot_Hook => {
                self.cbits3.insert(flags::ContextBits3::SLINGSHOT_HOOK);
            }
            Item::Slingshot_Weapon => {
                self.cbits3.insert(flags::ContextBits3::SLINGSHOT_WEAPON);
            }
            Item::Station_Power => {
                self.cbits3.insert(flags::ContextBits3::STATION_POWER);
            }
            Item::Switch_36_11 => {
                self.cbits3.insert(flags::ContextBits3::SWITCH_36_11);
            }
            Item::Switch_40_12 => {
                self.cbits3.insert(flags::ContextBits3::SWITCH_40_12);
            }
            Item::Terminal_Breakthrough_1 => {
                self.cbits3
                    .insert(flags::ContextBits3::TERMINAL_BREAKTHROUGH_1);
            }
            Item::The_Ideal_Kiengir => {
                self.cbits3.insert(flags::ContextBits3::THE_IDEAL_KIENGIR);
            }
            Item::Under_Siege => {
                self.cbits3.insert(flags::ContextBits3::UNDER_SIEGE);
            }
            Item::Underwater_Movement => {
                self.cbits3.insert(flags::ContextBits3::UNDERWATER_MOVEMENT);
            }
            Item::Wall_Climb => {
                self.cbits3.insert(flags::ContextBits3::WALL_CLIMB);
            }
            _ => (),
        }
    }

    // test helper for context vars
    fn parse_set_context(&mut self, ckey: &str, cval: &Yaml) -> Result<(), String> {
        match (ckey, cval) {
            ("position", Yaml::String(s)) => {
                self.set_position(SpotId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("position", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("energy", Yaml::Integer(i)) => {
                self.set_energy(i16::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("energy", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("flasks", Yaml::Integer(i)) => {
                self.set_flasks(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("flasks", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("refills", Yaml::Integer(i)) => {
                self.set_refills(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("refills", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("mode", Yaml::String(s)) => {
                self.set_mode(enums::Mode::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("mode", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("save", Yaml::String(s)) => {
                self.set_save(SpotId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("save", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("indra", Yaml::String(s)) => {
                self.set_indra(SpotId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("indra", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("last", Yaml::String(s)) => {
                self.set_last(SpotId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("last", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("prev_area", Yaml::String(s)) => {
                self.set_prev_area(AreaId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("prev_area", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("amagi__main_area__ctx__combo", Yaml::Boolean(b)) => {
                self.set_amagi__main_area__ctx__combo(*b)
            }
            ("amagi__main_area__ctx__combo", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__base_camp__ctx__left_platform_moved", Yaml::Boolean(b)) => {
                self.set_ebih__base_camp__ctx__left_platform_moved(*b)
            }
            ("ebih__base_camp__ctx__left_platform_moved", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__grid_25_10_12__ctx__door_open", Yaml::Boolean(b)) => {
                self.set_ebih__grid_25_10_12__ctx__door_open(*b)
            }
            ("ebih__grid_25_10_12__ctx__door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__waterfall__ctx__west_door_open", Yaml::Boolean(b)) => {
                self.set_ebih__waterfall__ctx__west_door_open(*b)
            }
            ("ebih__waterfall__ctx__west_door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__ebih_west__ctx__door_open", Yaml::Boolean(b)) => {
                self.set_ebih__ebih_west__ctx__door_open(*b)
            }
            ("ebih__ebih_west__ctx__door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__ebih_east__ctx__platform1_moved", Yaml::Boolean(b)) => {
                self.set_ebih__ebih_east__ctx__platform1_moved(*b)
            }
            ("ebih__ebih_east__ctx__platform1_moved", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__ebih_east__ctx__platform2_moved", Yaml::Boolean(b)) => {
                self.set_ebih__ebih_east__ctx__platform2_moved(*b)
            }
            ("ebih__ebih_east__ctx__platform2_moved", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__drone_room__ctx__platform_moved", Yaml::Boolean(b)) => {
                self.set_ebih__drone_room__ctx__platform_moved(*b)
            }
            ("ebih__drone_room__ctx__platform_moved", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__vertical_interchange__ctx__door_open", Yaml::Boolean(b)) => {
                self.set_ebih__vertical_interchange__ctx__door_open(*b)
            }
            ("ebih__vertical_interchange__ctx__door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna_breach__sw_save__ctx__door_opened", Yaml::Boolean(b)) => {
                self.set_giguna_breach__sw_save__ctx__door_opened(*b)
            }
            ("giguna_breach__sw_save__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__giguna_northeast__ctx__door_opened", Yaml::Boolean(b)) => {
                self.set_giguna__giguna_northeast__ctx__door_opened(*b)
            }
            ("giguna__giguna_northeast__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__carnelian__ctx__door_opened", Yaml::Boolean(b)) => {
                self.set_giguna__carnelian__ctx__door_opened(*b)
            }
            ("giguna__carnelian__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__carnelian__ctx__upper_susar", Yaml::Boolean(b)) => {
                self.set_giguna__carnelian__ctx__upper_susar(*b)
            }
            ("giguna__carnelian__ctx__upper_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__carnelian__ctx__lower_susar", Yaml::Boolean(b)) => {
                self.set_giguna__carnelian__ctx__lower_susar(*b)
            }
            ("giguna__carnelian__ctx__lower_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__west_caverns__ctx__east_susar", Yaml::Boolean(b)) => {
                self.set_giguna__west_caverns__ctx__east_susar(*b)
            }
            ("giguna__west_caverns__ctx__east_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__giguna_base__ctx__door_open", Yaml::Boolean(b)) => {
                self.set_giguna__giguna_base__ctx__door_open(*b)
            }
            ("giguna__giguna_base__ctx__door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__ruins_west__ctx__kishib_handled", Yaml::Boolean(b)) => {
                self.set_giguna__ruins_west__ctx__kishib_handled(*b)
            }
            ("giguna__ruins_west__ctx__kishib_handled", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__ruins_top__ctx__doors_open", Yaml::Boolean(b)) => {
                self.set_giguna__ruins_top__ctx__doors_open(*b)
            }
            ("giguna__ruins_top__ctx__doors_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__clouds__ctx__platform_and_portal", Yaml::Boolean(b)) => {
                self.set_giguna__clouds__ctx__platform_and_portal(*b)
            }
            ("giguna__clouds__ctx__platform_and_portal", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__east_caverns__ctx__door_opened", Yaml::Boolean(b)) => {
                self.set_giguna__east_caverns__ctx__door_opened(*b)
            }
            ("giguna__east_caverns__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__east_caverns__ctx__combo_entered", Yaml::Boolean(b)) => {
                self.set_giguna__east_caverns__ctx__combo_entered(*b)
            }
            ("giguna__east_caverns__ctx__combo_entered", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__east_caverns__ctx__upper_susar", Yaml::Boolean(b)) => {
                self.set_giguna__east_caverns__ctx__upper_susar(*b)
            }
            ("giguna__east_caverns__ctx__upper_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__east_caverns__ctx__mid_susar", Yaml::Boolean(b)) => {
                self.set_giguna__east_caverns__ctx__mid_susar(*b)
            }
            ("giguna__east_caverns__ctx__mid_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__gateway__ctx__door_opened", Yaml::Boolean(b)) => {
                self.set_giguna__gateway__ctx__door_opened(*b)
            }
            ("giguna__gateway__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("boomerang_steering", Yaml::Boolean(b)) => self.set_boomerang_steering(*b),
            ("boomerang_steering", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("major_glitches", Yaml::Boolean(b)) => self.set_major_glitches(*b),
            ("major_glitches", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("minor_glitches", Yaml::Boolean(b)) => self.set_minor_glitches(*b),
            ("minor_glitches", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            _ => {
                return Err(format!("Unrecognized context key: {:?}", ckey));
            }
        }
        Ok(())
    }

    fn parse_expect_context(ckey: &str, cval: &Yaml) -> Result<Expectation, String> {
        Ok(match (ckey, cval) {
            ("position", Yaml::String(s)) => {
                Expectation::Position(SpotId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("position", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("energy", Yaml::Integer(i)) => {
                Expectation::Energy(i16::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("energy", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("flasks", Yaml::Integer(i)) => {
                Expectation::Flasks(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("flasks", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("refills", Yaml::Integer(i)) => {
                Expectation::Refills(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("refills", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("mode", Yaml::String(s)) => {
                Expectation::Mode(enums::Mode::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("mode", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("save", Yaml::String(s)) => {
                Expectation::Save(SpotId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("save", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("indra", Yaml::String(s)) => {
                Expectation::Indra(SpotId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("indra", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("last", Yaml::String(s)) => {
                Expectation::Last(SpotId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("last", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("prev_area", Yaml::String(s)) => {
                Expectation::PrevArea(AreaId::from_str(s).map_err(|e| format!("{}", e))?)
            }
            ("prev_area", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("amagi__main_area__ctx__combo", Yaml::Boolean(b)) => {
                Expectation::AmagiMainAreaCtxCombo(*b)
            }
            ("amagi__main_area__ctx__combo", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__base_camp__ctx__left_platform_moved", Yaml::Boolean(b)) => {
                Expectation::EbihBaseCampCtxLeftPlatformMoved(*b)
            }
            ("ebih__base_camp__ctx__left_platform_moved", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__grid_25_10_12__ctx__door_open", Yaml::Boolean(b)) => {
                Expectation::EbihGrid251012CtxDoorOpen(*b)
            }
            ("ebih__grid_25_10_12__ctx__door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__waterfall__ctx__west_door_open", Yaml::Boolean(b)) => {
                Expectation::EbihWaterfallCtxWestDoorOpen(*b)
            }
            ("ebih__waterfall__ctx__west_door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__ebih_west__ctx__door_open", Yaml::Boolean(b)) => {
                Expectation::EbihEbihWestCtxDoorOpen(*b)
            }
            ("ebih__ebih_west__ctx__door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__ebih_east__ctx__platform1_moved", Yaml::Boolean(b)) => {
                Expectation::EbihEbihEastCtxPlatform1Moved(*b)
            }
            ("ebih__ebih_east__ctx__platform1_moved", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__ebih_east__ctx__platform2_moved", Yaml::Boolean(b)) => {
                Expectation::EbihEbihEastCtxPlatform2Moved(*b)
            }
            ("ebih__ebih_east__ctx__platform2_moved", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__drone_room__ctx__platform_moved", Yaml::Boolean(b)) => {
                Expectation::EbihDroneRoomCtxPlatformMoved(*b)
            }
            ("ebih__drone_room__ctx__platform_moved", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("ebih__vertical_interchange__ctx__door_open", Yaml::Boolean(b)) => {
                Expectation::EbihVerticalInterchangeCtxDoorOpen(*b)
            }
            ("ebih__vertical_interchange__ctx__door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna_breach__sw_save__ctx__door_opened", Yaml::Boolean(b)) => {
                Expectation::GigunaBreachSwSaveCtxDoorOpened(*b)
            }
            ("giguna_breach__sw_save__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__giguna_northeast__ctx__door_opened", Yaml::Boolean(b)) => {
                Expectation::GigunaGigunaNortheastCtxDoorOpened(*b)
            }
            ("giguna__giguna_northeast__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__carnelian__ctx__door_opened", Yaml::Boolean(b)) => {
                Expectation::GigunaCarnelianCtxDoorOpened(*b)
            }
            ("giguna__carnelian__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__carnelian__ctx__upper_susar", Yaml::Boolean(b)) => {
                Expectation::GigunaCarnelianCtxUpperSusar(*b)
            }
            ("giguna__carnelian__ctx__upper_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__carnelian__ctx__lower_susar", Yaml::Boolean(b)) => {
                Expectation::GigunaCarnelianCtxLowerSusar(*b)
            }
            ("giguna__carnelian__ctx__lower_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__west_caverns__ctx__east_susar", Yaml::Boolean(b)) => {
                Expectation::GigunaWestCavernsCtxEastSusar(*b)
            }
            ("giguna__west_caverns__ctx__east_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__giguna_base__ctx__door_open", Yaml::Boolean(b)) => {
                Expectation::GigunaGigunaBaseCtxDoorOpen(*b)
            }
            ("giguna__giguna_base__ctx__door_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__ruins_west__ctx__kishib_handled", Yaml::Boolean(b)) => {
                Expectation::GigunaRuinsWestCtxKishibHandled(*b)
            }
            ("giguna__ruins_west__ctx__kishib_handled", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__ruins_top__ctx__doors_open", Yaml::Boolean(b)) => {
                Expectation::GigunaRuinsTopCtxDoorsOpen(*b)
            }
            ("giguna__ruins_top__ctx__doors_open", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__clouds__ctx__platform_and_portal", Yaml::Boolean(b)) => {
                Expectation::GigunaCloudsCtxPlatformAndPortal(*b)
            }
            ("giguna__clouds__ctx__platform_and_portal", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__east_caverns__ctx__door_opened", Yaml::Boolean(b)) => {
                Expectation::GigunaEastCavernsCtxDoorOpened(*b)
            }
            ("giguna__east_caverns__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__east_caverns__ctx__combo_entered", Yaml::Boolean(b)) => {
                Expectation::GigunaEastCavernsCtxComboEntered(*b)
            }
            ("giguna__east_caverns__ctx__combo_entered", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__east_caverns__ctx__upper_susar", Yaml::Boolean(b)) => {
                Expectation::GigunaEastCavernsCtxUpperSusar(*b)
            }
            ("giguna__east_caverns__ctx__upper_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__east_caverns__ctx__mid_susar", Yaml::Boolean(b)) => {
                Expectation::GigunaEastCavernsCtxMidSusar(*b)
            }
            ("giguna__east_caverns__ctx__mid_susar", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("giguna__gateway__ctx__door_opened", Yaml::Boolean(b)) => {
                Expectation::GigunaGatewayCtxDoorOpened(*b)
            }
            ("giguna__gateway__ctx__door_opened", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Amagi_Dragon_Eye_Passage", Yaml::Boolean(b)) => {
                Expectation::AmagiDragonEyePassage(*b)
            }
            ("Amagi_Dragon_Eye_Passage", Yaml::Integer(i)) => {
                Expectation::AmagiDragonEyePassage(*i > 0)
            }
            ("Amagi_Dragon_Eye_Passage", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Amagi_Stronghold_Boulder_1", Yaml::Boolean(b)) => {
                Expectation::AmagiStrongholdBoulder1(*b)
            }
            ("Amagi_Stronghold_Boulder_1", Yaml::Integer(i)) => {
                Expectation::AmagiStrongholdBoulder1(*i > 0)
            }
            ("Amagi_Stronghold_Boulder_1", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Amagi_Stronghold_Boulder_2", Yaml::Boolean(b)) => {
                Expectation::AmagiStrongholdBoulder2(*b)
            }
            ("Amagi_Stronghold_Boulder_2", Yaml::Integer(i)) => {
                Expectation::AmagiStrongholdBoulder2(*i > 0)
            }
            ("Amagi_Stronghold_Boulder_2", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Amagi_Stronghold_Wall_1", Yaml::Boolean(b)) => Expectation::AmagiStrongholdWall1(*b),
            ("Amagi_Stronghold_Wall_1", Yaml::Integer(i)) => {
                Expectation::AmagiStrongholdWall1(*i > 0)
            }
            ("Amagi_Stronghold_Wall_1", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Amagi_Stronghold_Wall_2", Yaml::Boolean(b)) => Expectation::AmagiStrongholdWall2(*b),
            ("Amagi_Stronghold_Wall_2", Yaml::Integer(i)) => {
                Expectation::AmagiStrongholdWall2(*i > 0)
            }
            ("Amagi_Stronghold_Wall_2", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Amagi_West_Lake_Surface_Wall", Yaml::Boolean(b)) => {
                Expectation::AmagiWestLakeSurfaceWall(*b)
            }
            ("Amagi_West_Lake_Surface_Wall", Yaml::Integer(i)) => {
                Expectation::AmagiWestLakeSurfaceWall(*i > 0)
            }
            ("Amagi_West_Lake_Surface_Wall", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Amashilama", Yaml::Boolean(b)) => Expectation::Amashilama(*b),
            ("Amashilama", Yaml::Integer(i)) => Expectation::Amashilama(*i > 0),
            ("Amashilama", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Anuman", Yaml::Boolean(b)) => Expectation::Anuman(*b),
            ("Anuman", Yaml::Integer(i)) => Expectation::Anuman(*i > 0),
            ("Anuman", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Apocalypse_Bomb", Yaml::Boolean(b)) => Expectation::ApocalypseBomb(*b),
            ("Apocalypse_Bomb", Yaml::Integer(i)) => Expectation::ApocalypseBomb(*i > 0),
            ("Apocalypse_Bomb", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Boomerang", Yaml::Boolean(b)) => Expectation::Boomerang(*b),
            ("Boomerang", Yaml::Integer(i)) => Expectation::Boomerang(*i > 0),
            ("Boomerang", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Breach_Attractor", Yaml::Boolean(b)) => Expectation::BreachAttractor(*b),
            ("Breach_Attractor", Yaml::Integer(i)) => Expectation::BreachAttractor(*i > 0),
            ("Breach_Attractor", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Breach_Sight", Yaml::Boolean(b)) => Expectation::BreachSight(*b),
            ("Breach_Sight", Yaml::Integer(i)) => Expectation::BreachSight(*i > 0),
            ("Breach_Sight", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Bronze_Axe", Yaml::Boolean(b)) => Expectation::BronzeAxe(*b),
            ("Bronze_Axe", Yaml::Integer(i)) => Expectation::BronzeAxe(*i > 0),
            ("Bronze_Axe", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Building_of_the_School", Yaml::Boolean(b)) => Expectation::BuildingOfTheSchool(*b),
            ("Building_of_the_School", Yaml::Integer(i)) => {
                Expectation::BuildingOfTheSchool(*i > 0)
            }
            ("Building_of_the_School", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Commemorative_Speech", Yaml::Boolean(b)) => Expectation::CommemorativeSpeech(*b),
            ("Commemorative_Speech", Yaml::Integer(i)) => Expectation::CommemorativeSpeech(*i > 0),
            ("Commemorative_Speech", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Companies_Layoff", Yaml::Boolean(b)) => Expectation::CompaniesLayoff(*b),
            ("Companies_Layoff", Yaml::Integer(i)) => Expectation::CompaniesLayoff(*i > 0),
            ("Companies_Layoff", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Dear_Ernest", Yaml::Boolean(b)) => Expectation::DearErnest(*b),
            ("Dear_Ernest", Yaml::Integer(i)) => Expectation::DearErnest(*i > 0),
            ("Dear_Ernest", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Defeat_Ebih_Alu", Yaml::Boolean(b)) => Expectation::DefeatEbihAlu(*b),
            ("Defeat_Ebih_Alu", Yaml::Integer(i)) => Expectation::DefeatEbihAlu(*i > 0),
            ("Defeat_Ebih_Alu", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Defeat_MUS_A_M20", Yaml::Boolean(b)) => Expectation::DefeatMUSAM20(*b),
            ("Defeat_MUS_A_M20", Yaml::Integer(i)) => Expectation::DefeatMUSAM20(*i > 0),
            ("Defeat_MUS_A_M20", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Drone_Hover", Yaml::Boolean(b)) => Expectation::DroneHover(*b),
            ("Drone_Hover", Yaml::Integer(i)) => Expectation::DroneHover(*i > 0),
            ("Drone_Hover", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Drone_Melee_Damage", Yaml::Integer(i)) => {
                Expectation::DroneMeleeDamage(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Drone_Melee_Damage", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Drone_Melee_Speed", Yaml::Integer(i)) => {
                Expectation::DroneMeleeSpeed(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Drone_Melee_Speed", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ebih_Interchange_Block", Yaml::Boolean(b)) => Expectation::EbihInterchangeBlock(*b),
            ("Ebih_Interchange_Block", Yaml::Integer(i)) => {
                Expectation::EbihInterchangeBlock(*i > 0)
            }
            ("Ebih_Interchange_Block", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ebih_Interchange_Gate", Yaml::Boolean(b)) => Expectation::EbihInterchangeGate(*b),
            ("Ebih_Interchange_Gate", Yaml::Integer(i)) => Expectation::EbihInterchangeGate(*i > 0),
            ("Ebih_Interchange_Gate", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ebih_Wasteland_Door", Yaml::Boolean(b)) => Expectation::EbihWastelandDoor(*b),
            ("Ebih_Wasteland_Door", Yaml::Integer(i)) => Expectation::EbihWastelandDoor(*i > 0),
            ("Ebih_Wasteland_Door", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ebih_Wasteland_Passage_H", Yaml::Boolean(b)) => {
                Expectation::EbihWastelandPassageH(*b)
            }
            ("Ebih_Wasteland_Passage_H", Yaml::Integer(i)) => {
                Expectation::EbihWastelandPassageH(*i > 0)
            }
            ("Ebih_Wasteland_Passage_H", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ebih_Waterfall_Block_Left", Yaml::Boolean(b)) => {
                Expectation::EbihWaterfallBlockLeft(*b)
            }
            ("Ebih_Waterfall_Block_Left", Yaml::Integer(i)) => {
                Expectation::EbihWaterfallBlockLeft(*i > 0)
            }
            ("Ebih_Waterfall_Block_Left", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ebih_Waterfall_Block_Right", Yaml::Boolean(b)) => {
                Expectation::EbihWaterfallBlockRight(*b)
            }
            ("Ebih_Waterfall_Block_Right", Yaml::Integer(i)) => {
                Expectation::EbihWaterfallBlockRight(*i > 0)
            }
            ("Ebih_Waterfall_Block_Right", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ebih_Waterfall_Wall", Yaml::Boolean(b)) => Expectation::EbihWaterfallWall(*b),
            ("Ebih_Waterfall_Wall", Yaml::Integer(i)) => Expectation::EbihWaterfallWall(*i > 0),
            ("Ebih_Waterfall_Wall", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ebih_West_Block", Yaml::Boolean(b)) => Expectation::EbihWestBlock(*b),
            ("Ebih_West_Block", Yaml::Integer(i)) => Expectation::EbihWestBlock(*i > 0),
            ("Ebih_West_Block", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Exit_Breach", Yaml::Boolean(b)) => Expectation::ExitBreach(*b),
            ("Exit_Breach", Yaml::Integer(i)) => Expectation::ExitBreach(*i > 0),
            ("Exit_Breach", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Fast_Travel", Yaml::Boolean(b)) => Expectation::FastTravel(*b),
            ("Fast_Travel", Yaml::Integer(i)) => Expectation::FastTravel(*i > 0),
            ("Fast_Travel", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Flask", Yaml::Integer(i)) => {
                Expectation::Flask(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Flask", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Giguna_Boulder", Yaml::Boolean(b)) => Expectation::GigunaBoulder(*b),
            ("Giguna_Boulder", Yaml::Integer(i)) => Expectation::GigunaBoulder(*i > 0),
            ("Giguna_Boulder", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Giguna_Dual_Path_Switch", Yaml::Boolean(b)) => Expectation::GigunaDualPathSwitch(*b),
            ("Giguna_Dual_Path_Switch", Yaml::Integer(i)) => {
                Expectation::GigunaDualPathSwitch(*i > 0)
            }
            ("Giguna_Dual_Path_Switch", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Giguna_Gateway_Block", Yaml::Boolean(b)) => Expectation::GigunaGatewayBlock(*b),
            ("Giguna_Gateway_Block", Yaml::Integer(i)) => Expectation::GigunaGatewayBlock(*i > 0),
            ("Giguna_Gateway_Block", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Giguna_Gateway_Gate", Yaml::Boolean(b)) => Expectation::GigunaGatewayGate(*b),
            ("Giguna_Gateway_Gate", Yaml::Integer(i)) => Expectation::GigunaGatewayGate(*i > 0),
            ("Giguna_Gateway_Gate", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Giguna_Gubi", Yaml::Boolean(b)) => Expectation::GigunaGubi(*b),
            ("Giguna_Gubi", Yaml::Integer(i)) => Expectation::GigunaGubi(*i > 0),
            ("Giguna_Gubi", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Giguna_Northeast_Gate", Yaml::Boolean(b)) => Expectation::GigunaNortheastGate(*b),
            ("Giguna_Northeast_Gate", Yaml::Integer(i)) => Expectation::GigunaNortheastGate(*i > 0),
            ("Giguna_Northeast_Gate", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Health_Fragment", Yaml::Integer(i)) => {
                Expectation::HealthFragment(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Health_Fragment", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Health_Node", Yaml::Boolean(b)) => Expectation::HealthNode(*b),
            ("Health_Node", Yaml::Integer(i)) => Expectation::HealthNode(*i > 0),
            ("Health_Node", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Health_Upgrade", Yaml::Integer(i)) => {
                Expectation::HealthUpgrade(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Health_Upgrade", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Heretics_Tablet", Yaml::Boolean(b)) => Expectation::HereticsTablet(*b),
            ("Heretics_Tablet", Yaml::Integer(i)) => Expectation::HereticsTablet(*i > 0),
            ("Heretics_Tablet", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ice_Axe", Yaml::Boolean(b)) => Expectation::IceAxe(*b),
            ("Ice_Axe", Yaml::Integer(i)) => Expectation::IceAxe(*i > 0),
            ("Ice_Axe", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Infect", Yaml::Integer(i)) => {
                Expectation::Infect(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Infect", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Infection_Range", Yaml::Integer(i)) => {
                Expectation::InfectionRange(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Infection_Range", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Infection_Speed", Yaml::Boolean(b)) => Expectation::InfectionSpeed(*b),
            ("Infection_Speed", Yaml::Integer(i)) => Expectation::InfectionSpeed(*i > 0),
            ("Infection_Speed", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ledge_Grab", Yaml::Boolean(b)) => Expectation::LedgeGrab(*b),
            ("Ledge_Grab", Yaml::Integer(i)) => Expectation::LedgeGrab(*i > 0),
            ("Ledge_Grab", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Letter_from_Trace", Yaml::Boolean(b)) => Expectation::LetterFromTrace(*b),
            ("Letter_from_Trace", Yaml::Integer(i)) => Expectation::LetterFromTrace(*i > 0),
            ("Letter_from_Trace", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Map_17_10", Yaml::Boolean(b)) => Expectation::Map1710(*b),
            ("Map_17_10", Yaml::Integer(i)) => Expectation::Map1710(*i > 0),
            ("Map_17_10", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Melee_Damage", Yaml::Integer(i)) => {
                Expectation::MeleeDamage(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Melee_Damage", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Melee_Speed", Yaml::Integer(i)) => {
                Expectation::MeleeSpeed(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Melee_Speed", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Mist_Upgrade", Yaml::Boolean(b)) => Expectation::MistUpgrade(*b),
            ("Mist_Upgrade", Yaml::Integer(i)) => Expectation::MistUpgrade(*i > 0),
            ("Mist_Upgrade", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Nanite_Mist", Yaml::Boolean(b)) => Expectation::NaniteMist(*b),
            ("Nanite_Mist", Yaml::Integer(i)) => Expectation::NaniteMist(*i > 0),
            ("Nanite_Mist", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Nano_Points", Yaml::Integer(i)) => {
                Expectation::NanoPoints(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Nano_Points", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Power_Matrix", Yaml::Boolean(b)) => Expectation::PowerMatrix(*b),
            ("Power_Matrix", Yaml::Integer(i)) => Expectation::PowerMatrix(*i > 0),
            ("Power_Matrix", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ranged_Damage", Yaml::Integer(i)) => {
                Expectation::RangedDamage(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Ranged_Damage", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Ranged_Speed", Yaml::Integer(i)) => {
                Expectation::RangedSpeed(i8::try_from(*i).map_err(|e| format!("{}", e))?)
            }
            ("Ranged_Speed", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Record_Losses", Yaml::Boolean(b)) => Expectation::RecordLosses(*b),
            ("Record_Losses", Yaml::Integer(i)) => Expectation::RecordLosses(*i > 0),
            ("Record_Losses", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Remote_Drone", Yaml::Boolean(b)) => Expectation::RemoteDrone(*b),
            ("Remote_Drone", Yaml::Integer(i)) => Expectation::RemoteDrone(*i > 0),
            ("Remote_Drone", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Researchers_Missing", Yaml::Boolean(b)) => Expectation::ResearchersMissing(*b),
            ("Researchers_Missing", Yaml::Integer(i)) => Expectation::ResearchersMissing(*i > 0),
            ("Researchers_Missing", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Shockwave", Yaml::Boolean(b)) => Expectation::Shockwave(*b),
            ("Shockwave", Yaml::Integer(i)) => Expectation::Shockwave(*i > 0),
            ("Shockwave", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Slingshot_Charge", Yaml::Boolean(b)) => Expectation::SlingshotCharge(*b),
            ("Slingshot_Charge", Yaml::Integer(i)) => Expectation::SlingshotCharge(*i > 0),
            ("Slingshot_Charge", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Slingshot_Hook", Yaml::Boolean(b)) => Expectation::SlingshotHook(*b),
            ("Slingshot_Hook", Yaml::Integer(i)) => Expectation::SlingshotHook(*i > 0),
            ("Slingshot_Hook", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Slingshot_Weapon", Yaml::Boolean(b)) => Expectation::SlingshotWeapon(*b),
            ("Slingshot_Weapon", Yaml::Integer(i)) => Expectation::SlingshotWeapon(*i > 0),
            ("Slingshot_Weapon", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Station_Power", Yaml::Boolean(b)) => Expectation::StationPower(*b),
            ("Station_Power", Yaml::Integer(i)) => Expectation::StationPower(*i > 0),
            ("Station_Power", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Switch_36_11", Yaml::Boolean(b)) => Expectation::Switch3611(*b),
            ("Switch_36_11", Yaml::Integer(i)) => Expectation::Switch3611(*i > 0),
            ("Switch_36_11", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Switch_40_12", Yaml::Boolean(b)) => Expectation::Switch4012(*b),
            ("Switch_40_12", Yaml::Integer(i)) => Expectation::Switch4012(*i > 0),
            ("Switch_40_12", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Terminal_Breakthrough_1", Yaml::Boolean(b)) => Expectation::TerminalBreakthrough1(*b),
            ("Terminal_Breakthrough_1", Yaml::Integer(i)) => {
                Expectation::TerminalBreakthrough1(*i > 0)
            }
            ("Terminal_Breakthrough_1", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("The_Ideal_Kiengir", Yaml::Boolean(b)) => Expectation::TheIdealKiengir(*b),
            ("The_Ideal_Kiengir", Yaml::Integer(i)) => Expectation::TheIdealKiengir(*i > 0),
            ("The_Ideal_Kiengir", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Under_Siege", Yaml::Boolean(b)) => Expectation::UnderSiege(*b),
            ("Under_Siege", Yaml::Integer(i)) => Expectation::UnderSiege(*i > 0),
            ("Under_Siege", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Underwater_Movement", Yaml::Boolean(b)) => Expectation::UnderwaterMovement(*b),
            ("Underwater_Movement", Yaml::Integer(i)) => Expectation::UnderwaterMovement(*i > 0),
            ("Underwater_Movement", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            ("Wall_Climb", Yaml::Boolean(b)) => Expectation::WallClimb(*b),
            ("Wall_Climb", Yaml::Integer(i)) => Expectation::WallClimb(*i > 0),
            ("Wall_Climb", _) => {
                return Err(format!(
                    "Key {:?} has value of disallowed type: {:?}",
                    ckey, cval
                ));
            }
            _ => {
                return Err(format!(
                    "Unrecognized/disallowed expect context key: {:?}",
                    ckey
                ));
            }
        })
    }

    fn assert_expectations(&self, exps: &Vec<Self::Expectation>) -> Result<(), String> {
        let mut errs = Vec::new();
        for exp in exps {
            match exp {
                Expectation::Position(e) => {
                    let v = self.position();
                    if v != *e {
                        errs.push(format!("Expected {} = {}, got: {}", "position", e, v));
                    }
                }
                Expectation::Energy(e) => {
                    let v = self.energy();
                    if v != *e {
                        errs.push(format!("Expected {} = {}, got: {}", "energy", e, v));
                    }
                }
                Expectation::Flasks(e) => {
                    let v = self.flasks();
                    if v != *e {
                        errs.push(format!("Expected {} = {}, got: {}", "flasks", e, v));
                    }
                }
                Expectation::Refills(e) => {
                    let v = self.refills();
                    if v != *e {
                        errs.push(format!("Expected {} = {}, got: {}", "refills", e, v));
                    }
                }
                Expectation::Mode(e) => {
                    let v = self.mode();
                    if v != *e {
                        errs.push(format!("Expected {} = {}, got: {}", "mode", e, v));
                    }
                }
                Expectation::Save(e) => {
                    let v = self.save();
                    if v != *e {
                        errs.push(format!("Expected {} = {}, got: {}", "save", e, v));
                    }
                }
                Expectation::Indra(e) => {
                    let v = self.indra();
                    if v != *e {
                        errs.push(format!("Expected {} = {}, got: {}", "indra", e, v));
                    }
                }
                Expectation::Last(e) => {
                    let v = self.last();
                    if v != *e {
                        errs.push(format!("Expected {} = {}, got: {}", "last", e, v));
                    }
                }
                Expectation::PrevArea(e) => {
                    let v = self.prev_area();
                    if v != *e {
                        errs.push(format!("Expected {} = {}, got: {}", "prev_area", e, v));
                    }
                }
                Expectation::AmagiMainAreaCtxCombo(e) => {
                    let v = self.amagi__main_area__ctx__combo();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "amagi__main_area__ctx__combo", e, v
                        ));
                    }
                }
                Expectation::EbihBaseCampCtxLeftPlatformMoved(e) => {
                    let v = self.ebih__base_camp__ctx__left_platform_moved();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "ebih__base_camp__ctx__left_platform_moved", e, v
                        ));
                    }
                }
                Expectation::EbihGrid251012CtxDoorOpen(e) => {
                    let v = self.ebih__grid_25_10_12__ctx__door_open();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "ebih__grid_25_10_12__ctx__door_open", e, v
                        ));
                    }
                }
                Expectation::EbihWaterfallCtxWestDoorOpen(e) => {
                    let v = self.ebih__waterfall__ctx__west_door_open();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "ebih__waterfall__ctx__west_door_open", e, v
                        ));
                    }
                }
                Expectation::EbihEbihWestCtxDoorOpen(e) => {
                    let v = self.ebih__ebih_west__ctx__door_open();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "ebih__ebih_west__ctx__door_open", e, v
                        ));
                    }
                }
                Expectation::EbihEbihEastCtxPlatform1Moved(e) => {
                    let v = self.ebih__ebih_east__ctx__platform1_moved();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "ebih__ebih_east__ctx__platform1_moved", e, v
                        ));
                    }
                }
                Expectation::EbihEbihEastCtxPlatform2Moved(e) => {
                    let v = self.ebih__ebih_east__ctx__platform2_moved();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "ebih__ebih_east__ctx__platform2_moved", e, v
                        ));
                    }
                }
                Expectation::EbihDroneRoomCtxPlatformMoved(e) => {
                    let v = self.ebih__drone_room__ctx__platform_moved();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "ebih__drone_room__ctx__platform_moved", e, v
                        ));
                    }
                }
                Expectation::EbihVerticalInterchangeCtxDoorOpen(e) => {
                    let v = self.ebih__vertical_interchange__ctx__door_open();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "ebih__vertical_interchange__ctx__door_open", e, v
                        ));
                    }
                }
                Expectation::GigunaBreachSwSaveCtxDoorOpened(e) => {
                    let v = self.giguna_breach__sw_save__ctx__door_opened();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna_breach__sw_save__ctx__door_opened", e, v
                        ));
                    }
                }
                Expectation::GigunaGigunaNortheastCtxDoorOpened(e) => {
                    let v = self.giguna__giguna_northeast__ctx__door_opened();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__giguna_northeast__ctx__door_opened", e, v
                        ));
                    }
                }
                Expectation::GigunaCarnelianCtxDoorOpened(e) => {
                    let v = self.giguna__carnelian__ctx__door_opened();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__carnelian__ctx__door_opened", e, v
                        ));
                    }
                }
                Expectation::GigunaCarnelianCtxUpperSusar(e) => {
                    let v = self.giguna__carnelian__ctx__upper_susar();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__carnelian__ctx__upper_susar", e, v
                        ));
                    }
                }
                Expectation::GigunaCarnelianCtxLowerSusar(e) => {
                    let v = self.giguna__carnelian__ctx__lower_susar();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__carnelian__ctx__lower_susar", e, v
                        ));
                    }
                }
                Expectation::GigunaWestCavernsCtxEastSusar(e) => {
                    let v = self.giguna__west_caverns__ctx__east_susar();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__west_caverns__ctx__east_susar", e, v
                        ));
                    }
                }
                Expectation::GigunaGigunaBaseCtxDoorOpen(e) => {
                    let v = self.giguna__giguna_base__ctx__door_open();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__giguna_base__ctx__door_open", e, v
                        ));
                    }
                }
                Expectation::GigunaRuinsWestCtxKishibHandled(e) => {
                    let v = self.giguna__ruins_west__ctx__kishib_handled();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__ruins_west__ctx__kishib_handled", e, v
                        ));
                    }
                }
                Expectation::GigunaRuinsTopCtxDoorsOpen(e) => {
                    let v = self.giguna__ruins_top__ctx__doors_open();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__ruins_top__ctx__doors_open", e, v
                        ));
                    }
                }
                Expectation::GigunaCloudsCtxPlatformAndPortal(e) => {
                    let v = self.giguna__clouds__ctx__platform_and_portal();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__clouds__ctx__platform_and_portal", e, v
                        ));
                    }
                }
                Expectation::GigunaEastCavernsCtxDoorOpened(e) => {
                    let v = self.giguna__east_caverns__ctx__door_opened();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__east_caverns__ctx__door_opened", e, v
                        ));
                    }
                }
                Expectation::GigunaEastCavernsCtxComboEntered(e) => {
                    let v = self.giguna__east_caverns__ctx__combo_entered();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__east_caverns__ctx__combo_entered", e, v
                        ));
                    }
                }
                Expectation::GigunaEastCavernsCtxUpperSusar(e) => {
                    let v = self.giguna__east_caverns__ctx__upper_susar();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__east_caverns__ctx__upper_susar", e, v
                        ));
                    }
                }
                Expectation::GigunaEastCavernsCtxMidSusar(e) => {
                    let v = self.giguna__east_caverns__ctx__mid_susar();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__east_caverns__ctx__mid_susar", e, v
                        ));
                    }
                }
                Expectation::GigunaGatewayCtxDoorOpened(e) => {
                    let v = self.giguna__gateway__ctx__door_opened();
                    if v != *e {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "giguna__gateway__ctx__door_opened", e, v
                        ));
                    }
                }
                Expectation::AmagiDragonEyePassage(e) => {
                    let v = self.has(Item::Amagi_Dragon_Eye_Passage);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Amagi_Dragon_Eye_Passage", e, v
                        ));
                    }
                }
                Expectation::AmagiStrongholdBoulder1(e) => {
                    let v = self.has(Item::Amagi_Stronghold_Boulder_1);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Amagi_Stronghold_Boulder_1", e, v
                        ));
                    }
                }
                Expectation::AmagiStrongholdBoulder2(e) => {
                    let v = self.has(Item::Amagi_Stronghold_Boulder_2);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Amagi_Stronghold_Boulder_2", e, v
                        ));
                    }
                }
                Expectation::AmagiStrongholdWall1(e) => {
                    let v = self.has(Item::Amagi_Stronghold_Wall_1);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Amagi_Stronghold_Wall_1", e, v
                        ));
                    }
                }
                Expectation::AmagiStrongholdWall2(e) => {
                    let v = self.has(Item::Amagi_Stronghold_Wall_2);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Amagi_Stronghold_Wall_2", e, v
                        ));
                    }
                }
                Expectation::AmagiWestLakeSurfaceWall(e) => {
                    let v = self.has(Item::Amagi_West_Lake_Surface_Wall);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Amagi_West_Lake_Surface_Wall", e, v
                        ));
                    }
                }
                Expectation::Amashilama(e) => {
                    let v = self.has(Item::Amashilama);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Amashilama", e, v));
                    }
                }
                Expectation::Anuman(e) => {
                    let v = self.has(Item::Anuman);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Anuman", e, v));
                    }
                }
                Expectation::ApocalypseBomb(e) => {
                    let v = self.has(Item::Apocalypse_Bomb);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Apocalypse_Bomb", e, v
                        ));
                    }
                }
                Expectation::Boomerang(e) => {
                    let v = self.has(Item::Boomerang);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Boomerang", e, v));
                    }
                }
                Expectation::BreachAttractor(e) => {
                    let v = self.has(Item::Breach_Attractor);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Breach_Attractor", e, v
                        ));
                    }
                }
                Expectation::BreachSight(e) => {
                    let v = self.has(Item::Breach_Sight);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Breach_Sight", e, v));
                    }
                }
                Expectation::BronzeAxe(e) => {
                    let v = self.has(Item::Bronze_Axe);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Bronze_Axe", e, v));
                    }
                }
                Expectation::BuildingOfTheSchool(e) => {
                    let v = self.has(Item::Building_of_the_School);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Building_of_the_School", e, v
                        ));
                    }
                }
                Expectation::CommemorativeSpeech(e) => {
                    let v = self.has(Item::Commemorative_Speech);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Commemorative_Speech", e, v
                        ));
                    }
                }
                Expectation::CompaniesLayoff(e) => {
                    let v = self.has(Item::Companies_Layoff);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Companies_Layoff", e, v
                        ));
                    }
                }
                Expectation::DearErnest(e) => {
                    let v = self.has(Item::Dear_Ernest);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Dear_Ernest", e, v));
                    }
                }
                Expectation::DefeatEbihAlu(e) => {
                    let v = self.has(Item::Defeat_Ebih_Alu);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Defeat_Ebih_Alu", e, v
                        ));
                    }
                }
                Expectation::DefeatMUSAM20(e) => {
                    let v = self.has(Item::Defeat_MUS_A_M20);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Defeat_MUS_A_M20", e, v
                        ));
                    }
                }
                Expectation::DroneHover(e) => {
                    let v = self.has(Item::Drone_Hover);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Drone_Hover", e, v));
                    }
                }
                Expectation::DroneMeleeDamage(e) => {
                    let v = self.count(Item::Drone_Melee_Damage);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Drone_Melee_Damage", e, v
                        ));
                    }
                }
                Expectation::DroneMeleeSpeed(e) => {
                    let v = self.count(Item::Drone_Melee_Speed);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Drone_Melee_Speed", e, v
                        ));
                    }
                }
                Expectation::EbihInterchangeBlock(e) => {
                    let v = self.has(Item::Ebih_Interchange_Block);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Ebih_Interchange_Block", e, v
                        ));
                    }
                }
                Expectation::EbihInterchangeGate(e) => {
                    let v = self.has(Item::Ebih_Interchange_Gate);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Ebih_Interchange_Gate", e, v
                        ));
                    }
                }
                Expectation::EbihWastelandDoor(e) => {
                    let v = self.has(Item::Ebih_Wasteland_Door);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Ebih_Wasteland_Door", e, v
                        ));
                    }
                }
                Expectation::EbihWastelandPassageH(e) => {
                    let v = self.has(Item::Ebih_Wasteland_Passage_H);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Ebih_Wasteland_Passage_H", e, v
                        ));
                    }
                }
                Expectation::EbihWaterfallBlockLeft(e) => {
                    let v = self.has(Item::Ebih_Waterfall_Block_Left);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Ebih_Waterfall_Block_Left", e, v
                        ));
                    }
                }
                Expectation::EbihWaterfallBlockRight(e) => {
                    let v = self.has(Item::Ebih_Waterfall_Block_Right);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Ebih_Waterfall_Block_Right", e, v
                        ));
                    }
                }
                Expectation::EbihWaterfallWall(e) => {
                    let v = self.has(Item::Ebih_Waterfall_Wall);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Ebih_Waterfall_Wall", e, v
                        ));
                    }
                }
                Expectation::EbihWestBlock(e) => {
                    let v = self.has(Item::Ebih_West_Block);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Ebih_West_Block", e, v
                        ));
                    }
                }
                Expectation::ExitBreach(e) => {
                    let v = self.has(Item::Exit_Breach);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Exit_Breach", e, v));
                    }
                }
                Expectation::FastTravel(e) => {
                    let v = self.has(Item::Fast_Travel);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Fast_Travel", e, v));
                    }
                }
                Expectation::Flask(e) => {
                    let v = self.count(Item::Flask);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Flask", e, v));
                    }
                }
                Expectation::GigunaBoulder(e) => {
                    let v = self.has(Item::Giguna_Boulder);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Giguna_Boulder", e, v));
                    }
                }
                Expectation::GigunaDualPathSwitch(e) => {
                    let v = self.has(Item::Giguna_Dual_Path_Switch);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Giguna_Dual_Path_Switch", e, v
                        ));
                    }
                }
                Expectation::GigunaGatewayBlock(e) => {
                    let v = self.has(Item::Giguna_Gateway_Block);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Giguna_Gateway_Block", e, v
                        ));
                    }
                }
                Expectation::GigunaGatewayGate(e) => {
                    let v = self.has(Item::Giguna_Gateway_Gate);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Giguna_Gateway_Gate", e, v
                        ));
                    }
                }
                Expectation::GigunaGubi(e) => {
                    let v = self.has(Item::Giguna_Gubi);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Giguna_Gubi", e, v));
                    }
                }
                Expectation::GigunaNortheastGate(e) => {
                    let v = self.has(Item::Giguna_Northeast_Gate);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Giguna_Northeast_Gate", e, v
                        ));
                    }
                }
                Expectation::HealthFragment(e) => {
                    let v = self.count(Item::Health_Fragment);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Health_Fragment", e, v
                        ));
                    }
                }
                Expectation::HealthNode(e) => {
                    let v = self.has(Item::Health_Node);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Health_Node", e, v));
                    }
                }
                Expectation::HealthUpgrade(e) => {
                    let v = self.count(Item::Health_Upgrade);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Health_Upgrade", e, v));
                    }
                }
                Expectation::HereticsTablet(e) => {
                    let v = self.has(Item::Heretics_Tablet);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Heretics_Tablet", e, v
                        ));
                    }
                }
                Expectation::IceAxe(e) => {
                    let v = self.has(Item::Ice_Axe);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Ice_Axe", e, v));
                    }
                }
                Expectation::Infect(e) => {
                    let v = self.count(Item::Infect);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Infect", e, v));
                    }
                }
                Expectation::InfectionRange(e) => {
                    let v = self.count(Item::Infection_Range);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Infection_Range", e, v
                        ));
                    }
                }
                Expectation::InfectionSpeed(e) => {
                    let v = self.has(Item::Infection_Speed);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Infection_Speed", e, v
                        ));
                    }
                }
                Expectation::LedgeGrab(e) => {
                    let v = self.has(Item::Ledge_Grab);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Ledge_Grab", e, v));
                    }
                }
                Expectation::LetterFromTrace(e) => {
                    let v = self.has(Item::Letter_from_Trace);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Letter_from_Trace", e, v
                        ));
                    }
                }
                Expectation::Map1710(e) => {
                    let v = self.has(Item::Map_17_10);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Map_17_10", e, v));
                    }
                }
                Expectation::MeleeDamage(e) => {
                    let v = self.count(Item::Melee_Damage);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Melee_Damage", e, v));
                    }
                }
                Expectation::MeleeSpeed(e) => {
                    let v = self.count(Item::Melee_Speed);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Melee_Speed", e, v));
                    }
                }
                Expectation::MistUpgrade(e) => {
                    let v = self.has(Item::Mist_Upgrade);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Mist_Upgrade", e, v));
                    }
                }
                Expectation::NaniteMist(e) => {
                    let v = self.has(Item::Nanite_Mist);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Nanite_Mist", e, v));
                    }
                }
                Expectation::NanoPoints(e) => {
                    let v = self.count(Item::Nano_Points);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Nano_Points", e, v));
                    }
                }
                Expectation::PowerMatrix(e) => {
                    let v = self.has(Item::Power_Matrix);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Power_Matrix", e, v));
                    }
                }
                Expectation::RangedDamage(e) => {
                    let v = self.count(Item::Ranged_Damage);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Ranged_Damage", e, v));
                    }
                }
                Expectation::RangedSpeed(e) => {
                    let v = self.count(Item::Ranged_Speed);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Ranged_Speed", e, v));
                    }
                }
                Expectation::RecordLosses(e) => {
                    let v = self.has(Item::Record_Losses);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Record_Losses", e, v));
                    }
                }
                Expectation::RemoteDrone(e) => {
                    let v = self.has(Item::Remote_Drone);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Remote_Drone", e, v));
                    }
                }
                Expectation::ResearchersMissing(e) => {
                    let v = self.has(Item::Researchers_Missing);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Researchers_Missing", e, v
                        ));
                    }
                }
                Expectation::Shockwave(e) => {
                    let v = self.has(Item::Shockwave);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Shockwave", e, v));
                    }
                }
                Expectation::SlingshotCharge(e) => {
                    let v = self.has(Item::Slingshot_Charge);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Slingshot_Charge", e, v
                        ));
                    }
                }
                Expectation::SlingshotHook(e) => {
                    let v = self.has(Item::Slingshot_Hook);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Slingshot_Hook", e, v));
                    }
                }
                Expectation::SlingshotWeapon(e) => {
                    let v = self.has(Item::Slingshot_Weapon);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Slingshot_Weapon", e, v
                        ));
                    }
                }
                Expectation::StationPower(e) => {
                    let v = self.has(Item::Station_Power);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Station_Power", e, v));
                    }
                }
                Expectation::Switch3611(e) => {
                    let v = self.has(Item::Switch_36_11);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Switch_36_11", e, v));
                    }
                }
                Expectation::Switch4012(e) => {
                    let v = self.has(Item::Switch_40_12);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Switch_40_12", e, v));
                    }
                }
                Expectation::TerminalBreakthrough1(e) => {
                    let v = self.has(Item::Terminal_Breakthrough_1);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Terminal_Breakthrough_1", e, v
                        ));
                    }
                }
                Expectation::TheIdealKiengir(e) => {
                    let v = self.has(Item::The_Ideal_Kiengir);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "The_Ideal_Kiengir", e, v
                        ));
                    }
                }
                Expectation::UnderSiege(e) => {
                    let v = self.has(Item::Under_Siege);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Under_Siege", e, v));
                    }
                }
                Expectation::UnderwaterMovement(e) => {
                    let v = self.has(Item::Underwater_Movement);
                    if v != (*e).into() {
                        errs.push(format!(
                            "Expected {} = {}, got: {}",
                            "Underwater_Movement", e, v
                        ));
                    }
                }
                Expectation::WallClimb(e) => {
                    let v = self.has(Item::Wall_Climb);
                    if v != (*e).into() {
                        errs.push(format!("Expected {} = {}, got: {}", "Wall_Climb", e, v));
                    }
                }
            }
        }
        if errs.is_empty() {
            Ok(())
        } else {
            Err(errs.join("\n"))
        }
    }

    fn position(&self) -> SpotId {
        self.position
    }
    fn set_position_raw(&mut self, pos: SpotId) {
        self.position = pos;
    }
    fn set_position(&mut self, pos: SpotId) {
        let area = get_area(pos);
        match area {
            AreaId::Amagi__Cave_Behind_Waterfall => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Amagi__Grid_31_19 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Amagi__Liru_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Amagi__Main_Area => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Amagi__West_Lake => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Antarctica__East => {
                if get_area(self.position) != area {
                    self.save = SpotId::Antarctica__East__Save_Point;
                }
            }
            AreaId::Ebih__Base_Camp => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Boss_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Building_Interior => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Bunker_Interior => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__By_Garage => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Cave => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Drone_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Ebih_East => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Ebih_West => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Garage => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Gem_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Grid_21_2_6 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Grid_25_10_12 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Grid_25_2_6 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Grid_26_10_11 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Observation_Tower_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Tent_Interior => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Vertical_Interchange => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Ebih__Waterfall => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Antechamber => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Building_Interior => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Carnelian => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Clouds => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Dual_Path => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__East_Caverns => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Far_Corner => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Gateway => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Giguna_Base => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Giguna_Northeast => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Gubi_Lair => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Hard_Rock => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Helipad => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Labyrinth_East => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Lamassu => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Ruins_Center => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Ruins_East => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Ruins_Top => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Ruins_West => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Vertical_Interchange => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__Wasteland => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__West_Caverns => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna__West_Tower => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Giguna_Breach__Antechamber => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos10(self, pos);
                }
            }
            AreaId::Giguna_Breach__Ascent => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos12(self, pos);
                }
            }
            AreaId::Giguna_Breach__Below_Chimney => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos3(self, pos);
                }
            }
            AreaId::Giguna_Breach__Central => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos11(self, pos);
                }
            }
            AreaId::Giguna_Breach__Chimney => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos2(self, pos);
                }
            }
            AreaId::Giguna_Breach__Cubby => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos4(self, pos);
                }
            }
            AreaId::Giguna_Breach__Fire_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos8(self, pos);
                }
            }
            AreaId::Giguna_Breach__Grid_14_10_11 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos7(self, pos);
                }
            }
            AreaId::Giguna_Breach__Peak => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos1(self, pos);
                }
            }
            AreaId::Giguna_Breach__Pink_Clouds => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos13(self, pos);
                }
            }
            AreaId::Giguna_Breach__Robopede => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos6(self, pos);
                }
            }
            AreaId::Giguna_Breach__Slingshot => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos9(self, pos);
                }
            }
            AreaId::Giguna_Breach__SW_Save => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos5(self, pos);
                }
            }
            AreaId::Glacier__Apocalypse_Entry => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Boomerang_Antechamber => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Boomerang_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Compass_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Dock_Outside => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Grid_31_9_12 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Grid_32_7_10 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Grid_37_38_9 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Grid_39_40_7_9 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Grid_42_10 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Grid_43_10_11 => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Lake_Main_Entrance => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Ledge_Grab_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Peak => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Revival => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__The_Big_Drop => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Glacier__Vertical_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Irikar__Hub => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Irikar__Sight_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            AreaId::Irikar_Breach__Save_Room => {
                if get_area(self.position) != area {
                    rules::action_reset_old_area__newpos(self, pos);
                }
            }
            _ => (),
        }
        self.position = pos;
    }

    fn reload_game(&mut self) {
        self.reset_all();
        self.cbits1
            .remove(flags::ContextBits1::AMAGI__MAIN_AREA__CTX__COMBO);
        self.cbits1
            .remove(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__COMBO_ENTERED);
    }

    fn reset_all(&mut self) {
        self.cbits1
            .remove(flags::ContextBits1::EBIH__BASE_CAMP__CTX__LEFT_PLATFORM_MOVED);
        self.cbits1
            .remove(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM1_MOVED);
        self.cbits1
            .remove(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM2_MOVED);
        self.cbits1
            .remove(flags::ContextBits1::EBIH__DRONE_ROOM__CTX__PLATFORM_MOVED);
        self.cbits1
            .remove(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__UPPER_SUSAR);
        self.cbits1
            .remove(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__LOWER_SUSAR);
        self.cbits1
            .remove(flags::ContextBits1::GIGUNA__WEST_CAVERNS__CTX__EAST_SUSAR);
        self.cbits1
            .remove(flags::ContextBits1::GIGUNA__RUINS_WEST__CTX__KISHIB_HANDLED);
        self.cbits1
            .remove(flags::ContextBits1::GIGUNA__CLOUDS__CTX__PLATFORM_AND_PORTAL);
        self.cbits1
            .remove(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__UPPER_SUSAR);
        self.cbits1
            .remove(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__MID_SUSAR);
        self.cbits1
            .remove(flags::ContextBits1::GIGUNA__GATEWAY__CTX__DOOR_OPENED);
    }

    fn reset_region(&mut self, region_id: RegionId) {}
    fn reset_area(&mut self, area_id: AreaId) {
        match area_id {
            AreaId::Ebih__Base_Camp => {
                self.cbits1
                    .remove(flags::ContextBits1::EBIH__BASE_CAMP__CTX__LEFT_PLATFORM_MOVED);
            }
            AreaId::Ebih__Ebih_East => {
                self.cbits1
                    .remove(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM1_MOVED);
                self.cbits1
                    .remove(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM2_MOVED);
            }
            AreaId::Ebih__Drone_Room => {
                self.cbits1
                    .remove(flags::ContextBits1::EBIH__DRONE_ROOM__CTX__PLATFORM_MOVED);
            }
            AreaId::Giguna__Carnelian => {
                self.cbits1
                    .remove(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__UPPER_SUSAR);
                self.cbits1
                    .remove(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__LOWER_SUSAR);
            }
            AreaId::Giguna__West_Caverns => {
                self.cbits1
                    .remove(flags::ContextBits1::GIGUNA__WEST_CAVERNS__CTX__EAST_SUSAR);
            }
            AreaId::Giguna__Ruins_West => {
                self.cbits1
                    .remove(flags::ContextBits1::GIGUNA__RUINS_WEST__CTX__KISHIB_HANDLED);
            }
            AreaId::Giguna__Clouds => {
                self.cbits1
                    .remove(flags::ContextBits1::GIGUNA__CLOUDS__CTX__PLATFORM_AND_PORTAL);
            }
            AreaId::Giguna__East_Caverns => {
                self.cbits1
                    .remove(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__UPPER_SUSAR);
                self.cbits1
                    .remove(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__MID_SUSAR);
            }
            AreaId::Giguna__Gateway => {
                self.cbits1
                    .remove(flags::ContextBits1::GIGUNA__GATEWAY__CTX__DOOR_OPENED);
            }
            _ => (),
        }
    }
    fn can_afford(&self, cost: &Currency) -> bool {
        match cost {
            Currency::Free => true,
            Currency::Energy(c) => self.energy >= *c,
            Currency::Flasks(c) => self.flasks >= *c,
            Currency::Refills(c) => self.refills >= *c,
        }
    }
    fn spend(&mut self, cost: &Currency) {
        match cost {
            Currency::Free => (),
            Currency::Energy(c) => self.energy -= *c,
            Currency::Flasks(c) => self.flasks -= *c,
            Currency::Refills(c) => self.refills -= *c,
        }
    }

    fn visit(&mut self, loc_id: LocationId) {
        self.status[loc_id] = Status::Visited;
        self.visits += 1;
    }
    fn skip(&mut self, loc_id: LocationId) {
        if self.status[loc_id] == Status::None {
            self.status[loc_id] = Status::Skipped;
            self.skips += 1;
        }
    }
    fn reset(&mut self, loc_id: LocationId) {
        match self.status[loc_id] {
            Status::Visited => self.visits -= 1,
            Status::Skipped => self.skips -= 1,
            _ => (),
        }
        self.status[loc_id] = Status::None;
    }

    fn todo(&self, loc_id: LocationId) -> bool {
        self.status[loc_id] == Status::None
    }
    fn visited(&self, loc_id: LocationId) -> bool {
        self.status[loc_id] == Status::Visited
    }
    fn skipped(&self, loc_id: LocationId) -> bool {
        self.status[loc_id] == Status::Skipped
    }

    fn all_spot_checks(&self, id: SpotId) -> bool {
        let r = spot_locations(id);
        for status in self.status.as_slice()[r.start..r.end].iter() {
            if status == &Status::None {
                return false;
            }
        }
        true
    }
    fn all_area_checks(&self, id: AreaId) -> bool {
        let r = area_locations(id);
        for status in self.status.as_slice()[r.start..r.end].iter() {
            if status == &Status::None {
                return false;
            }
        }
        true
    }
    fn all_region_checks(&self, id: RegionId) -> bool {
        let r = region_locations(id);
        for status in self.status.as_slice()[r.start..r.end].iter() {
            if status == &Status::None {
                return false;
            }
        }
        true
    }
    fn get_movement_state(&self) -> movements::MovementState {
        movements::get_movement_state(self)
    }

    fn local_travel_time(&self, movement_state: movements::MovementState, dest: SpotId) -> u32 {
        movements::local_travel_time(self, movement_state, self.position, dest)
    }

    fn count_visits(&self) -> u32 {
        self.visits
    }
    fn count_skips(&self) -> u32 {
        self.skips
    }
    fn progress(&self) -> u32 {
        if self.visits <= 0 {
            0
        } else {
            self.visits * 100 / (Self::World::NUM_LOCATIONS - self.skips)
        }
    }

    fn diff(&self, old: &Context) -> String {
        let mut list: Vec<String> = Vec::new();

        if old.position != self.position {
            list.push(format!(
                "position: {:?} → {:?}",
                old.position, self.position
            ));
        }
        if old.energy != self.energy {
            list.push(format!("energy: {:?} → {:?}", old.energy, self.energy));
        }
        if old.flasks != self.flasks {
            list.push(format!("flasks: {:?} → {:?}", old.flasks, self.flasks));
        }
        if old.refills != self.refills {
            list.push(format!("refills: {:?} → {:?}", old.refills, self.refills));
        }
        if old.mode != self.mode {
            list.push(format!("mode: {:?} → {:?}", old.mode, self.mode));
        }
        if old.save != self.save {
            list.push(format!("save: {:?} → {:?}", old.save, self.save));
        }
        if old.indra != self.indra {
            list.push(format!("indra: {:?} → {:?}", old.indra, self.indra));
        }
        if old.last != self.last {
            list.push(format!("last: {:?} → {:?}", old.last, self.last));
        }
        if old.prev_area != self.prev_area {
            list.push(format!(
                "prev_area: {:?} → {:?}",
                old.prev_area, self.prev_area
            ));
        }
        if old.drone_melee_damage != self.drone_melee_damage {
            list.push(format!(
                "Drone_Melee_Damage: {:+}",
                self.drone_melee_damage - old.drone_melee_damage
            ));
        }
        if old.drone_melee_speed != self.drone_melee_speed {
            list.push(format!(
                "Drone_Melee_Speed: {:+}",
                self.drone_melee_speed - old.drone_melee_speed
            ));
        }
        if old.flask != self.flask {
            list.push(format!("Flask: {:+}", self.flask - old.flask));
        }
        if old.health_fragment != self.health_fragment {
            list.push(format!(
                "Health_Fragment: {:+}",
                self.health_fragment - old.health_fragment
            ));
        }
        if old.health_upgrade != self.health_upgrade {
            list.push(format!(
                "Health_Upgrade: {:+}",
                self.health_upgrade - old.health_upgrade
            ));
        }
        if old.infect != self.infect {
            list.push(format!("Infect: {:+}", self.infect - old.infect));
        }
        if old.infection_range != self.infection_range {
            list.push(format!(
                "Infection_Range: {:+}",
                self.infection_range - old.infection_range
            ));
        }
        if old.melee_damage != self.melee_damage {
            list.push(format!(
                "Melee_Damage: {:+}",
                self.melee_damage - old.melee_damage
            ));
        }
        if old.melee_speed != self.melee_speed {
            list.push(format!(
                "Melee_Speed: {:+}",
                self.melee_speed - old.melee_speed
            ));
        }
        if old.nano_points != self.nano_points {
            list.push(format!(
                "Nano_Points: {:+}",
                self.nano_points - old.nano_points
            ));
        }
        if old.ranged_damage != self.ranged_damage {
            list.push(format!(
                "Ranged_Damage: {:+}",
                self.ranged_damage - old.ranged_damage
            ));
        }
        if old.ranged_speed != self.ranged_speed {
            list.push(format!(
                "Ranged_Speed: {:+}",
                self.ranged_speed - old.ranged_speed
            ));
        }
        // bitflags
        let n = self
            .cbits1
            .contains(flags::ContextBits1::AMAGI__MAIN_AREA__CTX__COMBO);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::AMAGI__MAIN_AREA__CTX__COMBO);
        if n != p {
            list.push(format!(
                "{}AMAGI__MAIN_AREA__CTX__COMBO",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::EBIH__BASE_CAMP__CTX__LEFT_PLATFORM_MOVED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::EBIH__BASE_CAMP__CTX__LEFT_PLATFORM_MOVED);
        if n != p {
            list.push(format!(
                "{}EBIH__BASE_CAMP__CTX__LEFT_PLATFORM_MOVED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::EBIH__GRID_25_10_12__CTX__DOOR_OPEN);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::EBIH__GRID_25_10_12__CTX__DOOR_OPEN);
        if n != p {
            list.push(format!(
                "{}EBIH__GRID_25_10_12__CTX__DOOR_OPEN",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::EBIH__WATERFALL__CTX__WEST_DOOR_OPEN);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::EBIH__WATERFALL__CTX__WEST_DOOR_OPEN);
        if n != p {
            list.push(format!(
                "{}EBIH__WATERFALL__CTX__WEST_DOOR_OPEN",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::EBIH__EBIH_WEST__CTX__DOOR_OPEN);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::EBIH__EBIH_WEST__CTX__DOOR_OPEN);
        if n != p {
            list.push(format!(
                "{}EBIH__EBIH_WEST__CTX__DOOR_OPEN",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM1_MOVED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM1_MOVED);
        if n != p {
            list.push(format!(
                "{}EBIH__EBIH_EAST__CTX__PLATFORM1_MOVED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM2_MOVED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM2_MOVED);
        if n != p {
            list.push(format!(
                "{}EBIH__EBIH_EAST__CTX__PLATFORM2_MOVED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::EBIH__DRONE_ROOM__CTX__PLATFORM_MOVED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::EBIH__DRONE_ROOM__CTX__PLATFORM_MOVED);
        if n != p {
            list.push(format!(
                "{}EBIH__DRONE_ROOM__CTX__PLATFORM_MOVED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::EBIH__VERTICAL_INTERCHANGE__CTX__DOOR_OPEN);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::EBIH__VERTICAL_INTERCHANGE__CTX__DOOR_OPEN);
        if n != p {
            list.push(format!(
                "{}EBIH__VERTICAL_INTERCHANGE__CTX__DOOR_OPEN",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA_BREACH__SW_SAVE__CTX__DOOR_OPENED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA_BREACH__SW_SAVE__CTX__DOOR_OPENED);
        if n != p {
            list.push(format!(
                "{}GIGUNA_BREACH__SW_SAVE__CTX__DOOR_OPENED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__GIGUNA_NORTHEAST__CTX__DOOR_OPENED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__GIGUNA_NORTHEAST__CTX__DOOR_OPENED);
        if n != p {
            list.push(format!(
                "{}GIGUNA__GIGUNA_NORTHEAST__CTX__DOOR_OPENED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__DOOR_OPENED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__DOOR_OPENED);
        if n != p {
            list.push(format!(
                "{}GIGUNA__CARNELIAN__CTX__DOOR_OPENED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__UPPER_SUSAR);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__UPPER_SUSAR);
        if n != p {
            list.push(format!(
                "{}GIGUNA__CARNELIAN__CTX__UPPER_SUSAR",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__LOWER_SUSAR);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__LOWER_SUSAR);
        if n != p {
            list.push(format!(
                "{}GIGUNA__CARNELIAN__CTX__LOWER_SUSAR",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__WEST_CAVERNS__CTX__EAST_SUSAR);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__WEST_CAVERNS__CTX__EAST_SUSAR);
        if n != p {
            list.push(format!(
                "{}GIGUNA__WEST_CAVERNS__CTX__EAST_SUSAR",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__GIGUNA_BASE__CTX__DOOR_OPEN);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__GIGUNA_BASE__CTX__DOOR_OPEN);
        if n != p {
            list.push(format!(
                "{}GIGUNA__GIGUNA_BASE__CTX__DOOR_OPEN",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__RUINS_WEST__CTX__KISHIB_HANDLED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__RUINS_WEST__CTX__KISHIB_HANDLED);
        if n != p {
            list.push(format!(
                "{}GIGUNA__RUINS_WEST__CTX__KISHIB_HANDLED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__RUINS_TOP__CTX__DOORS_OPEN);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__RUINS_TOP__CTX__DOORS_OPEN);
        if n != p {
            list.push(format!(
                "{}GIGUNA__RUINS_TOP__CTX__DOORS_OPEN",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__CLOUDS__CTX__PLATFORM_AND_PORTAL);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__CLOUDS__CTX__PLATFORM_AND_PORTAL);
        if n != p {
            list.push(format!(
                "{}GIGUNA__CLOUDS__CTX__PLATFORM_AND_PORTAL",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__DOOR_OPENED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__DOOR_OPENED);
        if n != p {
            list.push(format!(
                "{}GIGUNA__EAST_CAVERNS__CTX__DOOR_OPENED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__COMBO_ENTERED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__COMBO_ENTERED);
        if n != p {
            list.push(format!(
                "{}GIGUNA__EAST_CAVERNS__CTX__COMBO_ENTERED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__UPPER_SUSAR);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__UPPER_SUSAR);
        if n != p {
            list.push(format!(
                "{}GIGUNA__EAST_CAVERNS__CTX__UPPER_SUSAR",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__MID_SUSAR);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__MID_SUSAR);
        if n != p {
            list.push(format!(
                "{}GIGUNA__EAST_CAVERNS__CTX__MID_SUSAR",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__GATEWAY__CTX__DOOR_OPENED);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::GIGUNA__GATEWAY__CTX__DOOR_OPENED);
        if n != p {
            list.push(format!(
                "{}GIGUNA__GATEWAY__CTX__DOOR_OPENED",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::BOOMERANG_STEERING);
        let p = old.cbits1.contains(flags::ContextBits1::BOOMERANG_STEERING);
        if n != p {
            list.push(format!("{}BOOMERANG_STEERING", if n { "+" } else { "-" }));
        }
        let n = self.cbits1.contains(flags::ContextBits1::MAJOR_GLITCHES);
        let p = old.cbits1.contains(flags::ContextBits1::MAJOR_GLITCHES);
        if n != p {
            list.push(format!("{}MAJOR_GLITCHES", if n { "+" } else { "-" }));
        }
        let n = self.cbits1.contains(flags::ContextBits1::MINOR_GLITCHES);
        let p = old.cbits1.contains(flags::ContextBits1::MINOR_GLITCHES);
        if n != p {
            list.push(format!("{}MINOR_GLITCHES", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::AMAGI_DRAGON_EYE_PASSAGE);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::AMAGI_DRAGON_EYE_PASSAGE);
        if n != p {
            list.push(format!(
                "{}AMAGI_DRAGON_EYE_PASSAGE",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_1);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_1);
        if n != p {
            list.push(format!(
                "{}AMAGI_STRONGHOLD_BOULDER_1",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_2);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::AMAGI_STRONGHOLD_BOULDER_2);
        if n != p {
            list.push(format!(
                "{}AMAGI_STRONGHOLD_BOULDER_2",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_1);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_1);
        if n != p {
            list.push(format!(
                "{}AMAGI_STRONGHOLD_WALL_1",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits1
            .contains(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_2);
        let p = old
            .cbits1
            .contains(flags::ContextBits1::AMAGI_STRONGHOLD_WALL_2);
        if n != p {
            list.push(format!(
                "{}AMAGI_STRONGHOLD_WALL_2",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::AMAGI_WEST_LAKE_SURFACE_WALL);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::AMAGI_WEST_LAKE_SURFACE_WALL);
        if n != p {
            list.push(format!(
                "{}AMAGI_WEST_LAKE_SURFACE_WALL",
                if n { "+" } else { "-" }
            ));
        }
        let n = self.cbits2.contains(flags::ContextBits2::AMASHILAMA);
        let p = old.cbits2.contains(flags::ContextBits2::AMASHILAMA);
        if n != p {
            list.push(format!("{}AMASHILAMA", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::ANUMAN);
        let p = old.cbits2.contains(flags::ContextBits2::ANUMAN);
        if n != p {
            list.push(format!("{}ANUMAN", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::APOCALYPSE_BOMB);
        let p = old.cbits2.contains(flags::ContextBits2::APOCALYPSE_BOMB);
        if n != p {
            list.push(format!("{}APOCALYPSE_BOMB", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::BOOMERANG);
        let p = old.cbits2.contains(flags::ContextBits2::BOOMERANG);
        if n != p {
            list.push(format!("{}BOOMERANG", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::BREACH_ATTRACTOR);
        let p = old.cbits2.contains(flags::ContextBits2::BREACH_ATTRACTOR);
        if n != p {
            list.push(format!("{}BREACH_ATTRACTOR", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::BREACH_SIGHT);
        let p = old.cbits2.contains(flags::ContextBits2::BREACH_SIGHT);
        if n != p {
            list.push(format!("{}BREACH_SIGHT", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::BRONZE_AXE);
        let p = old.cbits2.contains(flags::ContextBits2::BRONZE_AXE);
        if n != p {
            list.push(format!("{}BRONZE_AXE", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::BUILDING_OF_THE_SCHOOL);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::BUILDING_OF_THE_SCHOOL);
        if n != p {
            list.push(format!(
                "{}BUILDING_OF_THE_SCHOOL",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::COMMEMORATIVE_SPEECH);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::COMMEMORATIVE_SPEECH);
        if n != p {
            list.push(format!("{}COMMEMORATIVE_SPEECH", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::COMPANIES_LAYOFF);
        let p = old.cbits2.contains(flags::ContextBits2::COMPANIES_LAYOFF);
        if n != p {
            list.push(format!("{}COMPANIES_LAYOFF", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::DEAR_ERNEST);
        let p = old.cbits2.contains(flags::ContextBits2::DEAR_ERNEST);
        if n != p {
            list.push(format!("{}DEAR_ERNEST", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::DEFEAT_EBIH_ALU);
        let p = old.cbits2.contains(flags::ContextBits2::DEFEAT_EBIH_ALU);
        if n != p {
            list.push(format!("{}DEFEAT_EBIH_ALU", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::DEFEAT_MUS_A_M20);
        let p = old.cbits2.contains(flags::ContextBits2::DEFEAT_MUS_A_M20);
        if n != p {
            list.push(format!("{}DEFEAT_MUS_A_M20", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::DRONE_HOVER);
        let p = old.cbits2.contains(flags::ContextBits2::DRONE_HOVER);
        if n != p {
            list.push(format!("{}DRONE_HOVER", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::EBIH_INTERCHANGE_BLOCK);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::EBIH_INTERCHANGE_BLOCK);
        if n != p {
            list.push(format!(
                "{}EBIH_INTERCHANGE_BLOCK",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::EBIH_INTERCHANGE_GATE);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::EBIH_INTERCHANGE_GATE);
        if n != p {
            list.push(format!(
                "{}EBIH_INTERCHANGE_GATE",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::EBIH_WASTELAND_DOOR);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::EBIH_WASTELAND_DOOR);
        if n != p {
            list.push(format!("{}EBIH_WASTELAND_DOOR", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::EBIH_WASTELAND_PASSAGE_H);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::EBIH_WASTELAND_PASSAGE_H);
        if n != p {
            list.push(format!(
                "{}EBIH_WASTELAND_PASSAGE_H",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::EBIH_WATERFALL_BLOCK_LEFT);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::EBIH_WATERFALL_BLOCK_LEFT);
        if n != p {
            list.push(format!(
                "{}EBIH_WATERFALL_BLOCK_LEFT",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::EBIH_WATERFALL_BLOCK_RIGHT);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::EBIH_WATERFALL_BLOCK_RIGHT);
        if n != p {
            list.push(format!(
                "{}EBIH_WATERFALL_BLOCK_RIGHT",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::EBIH_WATERFALL_WALL);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::EBIH_WATERFALL_WALL);
        if n != p {
            list.push(format!("{}EBIH_WATERFALL_WALL", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::EBIH_WEST_BLOCK);
        let p = old.cbits2.contains(flags::ContextBits2::EBIH_WEST_BLOCK);
        if n != p {
            list.push(format!("{}EBIH_WEST_BLOCK", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::EXIT_BREACH);
        let p = old.cbits2.contains(flags::ContextBits2::EXIT_BREACH);
        if n != p {
            list.push(format!("{}EXIT_BREACH", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::FAST_TRAVEL);
        let p = old.cbits2.contains(flags::ContextBits2::FAST_TRAVEL);
        if n != p {
            list.push(format!("{}FAST_TRAVEL", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::GIGUNA_BOULDER);
        let p = old.cbits2.contains(flags::ContextBits2::GIGUNA_BOULDER);
        if n != p {
            list.push(format!("{}GIGUNA_BOULDER", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::GIGUNA_DUAL_PATH_SWITCH);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::GIGUNA_DUAL_PATH_SWITCH);
        if n != p {
            list.push(format!(
                "{}GIGUNA_DUAL_PATH_SWITCH",
                if n { "+" } else { "-" }
            ));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::GIGUNA_GATEWAY_BLOCK);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::GIGUNA_GATEWAY_BLOCK);
        if n != p {
            list.push(format!("{}GIGUNA_GATEWAY_BLOCK", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::GIGUNA_GATEWAY_GATE);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::GIGUNA_GATEWAY_GATE);
        if n != p {
            list.push(format!("{}GIGUNA_GATEWAY_GATE", if n { "+" } else { "-" }));
        }
        let n = self.cbits2.contains(flags::ContextBits2::GIGUNA_GUBI);
        let p = old.cbits2.contains(flags::ContextBits2::GIGUNA_GUBI);
        if n != p {
            list.push(format!("{}GIGUNA_GUBI", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits2
            .contains(flags::ContextBits2::GIGUNA_NORTHEAST_GATE);
        let p = old
            .cbits2
            .contains(flags::ContextBits2::GIGUNA_NORTHEAST_GATE);
        if n != p {
            list.push(format!(
                "{}GIGUNA_NORTHEAST_GATE",
                if n { "+" } else { "-" }
            ));
        }
        let n = self.cbits2.contains(flags::ContextBits2::HEALTH_NODE);
        let p = old.cbits2.contains(flags::ContextBits2::HEALTH_NODE);
        if n != p {
            list.push(format!("{}HEALTH_NODE", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::HERETICS_TABLET);
        let p = old.cbits3.contains(flags::ContextBits3::HERETICS_TABLET);
        if n != p {
            list.push(format!("{}HERETICS_TABLET", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::ICE_AXE);
        let p = old.cbits3.contains(flags::ContextBits3::ICE_AXE);
        if n != p {
            list.push(format!("{}ICE_AXE", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::INFECTION_SPEED);
        let p = old.cbits3.contains(flags::ContextBits3::INFECTION_SPEED);
        if n != p {
            list.push(format!("{}INFECTION_SPEED", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::LEDGE_GRAB);
        let p = old.cbits3.contains(flags::ContextBits3::LEDGE_GRAB);
        if n != p {
            list.push(format!("{}LEDGE_GRAB", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::LETTER_FROM_TRACE);
        let p = old.cbits3.contains(flags::ContextBits3::LETTER_FROM_TRACE);
        if n != p {
            list.push(format!("{}LETTER_FROM_TRACE", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::MAP_17_10);
        let p = old.cbits3.contains(flags::ContextBits3::MAP_17_10);
        if n != p {
            list.push(format!("{}MAP_17_10", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::MIST_UPGRADE);
        let p = old.cbits3.contains(flags::ContextBits3::MIST_UPGRADE);
        if n != p {
            list.push(format!("{}MIST_UPGRADE", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::NANITE_MIST);
        let p = old.cbits3.contains(flags::ContextBits3::NANITE_MIST);
        if n != p {
            list.push(format!("{}NANITE_MIST", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::POWER_MATRIX);
        let p = old.cbits3.contains(flags::ContextBits3::POWER_MATRIX);
        if n != p {
            list.push(format!("{}POWER_MATRIX", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::RECORD_LOSSES);
        let p = old.cbits3.contains(flags::ContextBits3::RECORD_LOSSES);
        if n != p {
            list.push(format!("{}RECORD_LOSSES", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::REMOTE_DRONE);
        let p = old.cbits3.contains(flags::ContextBits3::REMOTE_DRONE);
        if n != p {
            list.push(format!("{}REMOTE_DRONE", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits3
            .contains(flags::ContextBits3::RESEARCHERS_MISSING);
        let p = old
            .cbits3
            .contains(flags::ContextBits3::RESEARCHERS_MISSING);
        if n != p {
            list.push(format!("{}RESEARCHERS_MISSING", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::SHOCKWAVE);
        let p = old.cbits3.contains(flags::ContextBits3::SHOCKWAVE);
        if n != p {
            list.push(format!("{}SHOCKWAVE", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::SLINGSHOT_CHARGE);
        let p = old.cbits3.contains(flags::ContextBits3::SLINGSHOT_CHARGE);
        if n != p {
            list.push(format!("{}SLINGSHOT_CHARGE", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::SLINGSHOT_HOOK);
        let p = old.cbits3.contains(flags::ContextBits3::SLINGSHOT_HOOK);
        if n != p {
            list.push(format!("{}SLINGSHOT_HOOK", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::SLINGSHOT_WEAPON);
        let p = old.cbits3.contains(flags::ContextBits3::SLINGSHOT_WEAPON);
        if n != p {
            list.push(format!("{}SLINGSHOT_WEAPON", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::STATION_POWER);
        let p = old.cbits3.contains(flags::ContextBits3::STATION_POWER);
        if n != p {
            list.push(format!("{}STATION_POWER", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::SWITCH_36_11);
        let p = old.cbits3.contains(flags::ContextBits3::SWITCH_36_11);
        if n != p {
            list.push(format!("{}SWITCH_36_11", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::SWITCH_40_12);
        let p = old.cbits3.contains(flags::ContextBits3::SWITCH_40_12);
        if n != p {
            list.push(format!("{}SWITCH_40_12", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits3
            .contains(flags::ContextBits3::TERMINAL_BREAKTHROUGH_1);
        let p = old
            .cbits3
            .contains(flags::ContextBits3::TERMINAL_BREAKTHROUGH_1);
        if n != p {
            list.push(format!(
                "{}TERMINAL_BREAKTHROUGH_1",
                if n { "+" } else { "-" }
            ));
        }
        let n = self.cbits3.contains(flags::ContextBits3::THE_IDEAL_KIENGIR);
        let p = old.cbits3.contains(flags::ContextBits3::THE_IDEAL_KIENGIR);
        if n != p {
            list.push(format!("{}THE_IDEAL_KIENGIR", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::UNDER_SIEGE);
        let p = old.cbits3.contains(flags::ContextBits3::UNDER_SIEGE);
        if n != p {
            list.push(format!("{}UNDER_SIEGE", if n { "+" } else { "-" }));
        }
        let n = self
            .cbits3
            .contains(flags::ContextBits3::UNDERWATER_MOVEMENT);
        let p = old
            .cbits3
            .contains(flags::ContextBits3::UNDERWATER_MOVEMENT);
        if n != p {
            list.push(format!("{}UNDERWATER_MOVEMENT", if n { "+" } else { "-" }));
        }
        let n = self.cbits3.contains(flags::ContextBits3::WALL_CLIMB);
        let p = old.cbits3.contains(flags::ContextBits3::WALL_CLIMB);
        if n != p {
            list.push(format!("{}WALL_CLIMB", if n { "+" } else { "-" }));
        }
        for (loc_id, status) in self.status.iter() {
            if *status != old.status[loc_id] {
                list.push(format!("{:?}: {}", status, loc_id));
            }
        }

        if self.visits != old.visits {
            list.push(format!("Visits: {:+}", self.visits - old.visits));
        }

        if self.skips != old.skips {
            list.push(format!("Skips: {:+}", self.skips - old.skips));
        }

        if list.is_empty() {
            String::from("NONE")
        } else {
            list.join("\n")
        }
    }
}

impl Context {
    fn local_travel_time_b(
        &self,
        movement_state: movements::MovementState,
        dest: BigSpotId,
    ) -> u32 {
        movements::local_travel_time_b(movement_state, BigSpotId::None /*self.position*/, dest)
    }

    // settings
    pub fn boomerang_steering(&self) -> bool {
        self.cbits1
            .contains(flags::ContextBits1::BOOMERANG_STEERING)
    }
    pub fn set_boomerang_steering(&mut self, val: bool) {
        self.cbits1
            .set(flags::ContextBits1::BOOMERANG_STEERING, val);
    }
    pub fn major_glitches(&self) -> bool {
        self.cbits1.contains(flags::ContextBits1::MAJOR_GLITCHES)
    }
    pub fn set_major_glitches(&mut self, val: bool) {
        self.cbits1.set(flags::ContextBits1::MAJOR_GLITCHES, val);
    }
    pub fn minor_glitches(&self) -> bool {
        self.cbits1.contains(flags::ContextBits1::MINOR_GLITCHES)
    }
    pub fn set_minor_glitches(&mut self, val: bool) {
        self.cbits1.set(flags::ContextBits1::MINOR_GLITCHES, val);
    }
    // context
    pub fn position(&self) -> SpotId {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self.position,
                },
            },
        }
    }
    pub fn energy(&self) -> i16 {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self.energy,
                },
            },
        }
    }
    pub fn set_energy(&mut self, val: i16) {
        self.energy = val;
    }
    pub fn flasks(&self) -> i8 {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self.flasks,
                },
            },
        }
    }
    pub fn set_flasks(&mut self, val: i8) {
        self.flasks = val;
    }
    pub fn refills(&self) -> i8 {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self.refills,
                },
            },
        }
    }
    pub fn set_refills(&mut self, val: i8) {
        self.refills = val;
    }
    pub fn mode(&self) -> enums::Mode {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self.mode,
                },
            },
        }
    }
    pub fn set_mode(&mut self, val: enums::Mode) {
        self.mode = val;
    }
    pub fn save(&self) -> SpotId {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self.save,
                },
            },
        }
    }
    pub fn set_save(&mut self, val: SpotId) {
        self.save = val;
    }
    pub fn indra(&self) -> SpotId {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self.indra,
                },
            },
        }
    }
    pub fn set_indra(&mut self, val: SpotId) {
        self.indra = val;
    }
    pub fn last(&self) -> SpotId {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self.last,
                },
            },
        }
    }
    pub fn set_last(&mut self, val: SpotId) {
        self.last = val;
    }
    pub fn prev_area(&self) -> AreaId {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self.prev_area,
                },
            },
        }
    }
    pub fn set_prev_area(&mut self, val: AreaId) {
        self.prev_area = val;
    }
    pub fn amagi__main_area__ctx__combo(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::AMAGI__MAIN_AREA__CTX__COMBO),
                },
            },
        }
    }
    pub fn set_amagi__main_area__ctx__combo(&mut self, val: bool) {
        self.cbits1
            .set(flags::ContextBits1::AMAGI__MAIN_AREA__CTX__COMBO, val);
    }
    pub fn ebih__base_camp__ctx__left_platform_moved(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::EBIH__BASE_CAMP__CTX__LEFT_PLATFORM_MOVED),
                },
            },
        }
    }
    pub fn set_ebih__base_camp__ctx__left_platform_moved(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::EBIH__BASE_CAMP__CTX__LEFT_PLATFORM_MOVED,
            val,
        );
    }
    pub fn ebih__grid_25_10_12__ctx__door_open(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::EBIH__GRID_25_10_12__CTX__DOOR_OPEN),
                },
            },
        }
    }
    pub fn set_ebih__grid_25_10_12__ctx__door_open(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::EBIH__GRID_25_10_12__CTX__DOOR_OPEN,
            val,
        );
    }
    pub fn ebih__waterfall__ctx__west_door_open(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::EBIH__WATERFALL__CTX__WEST_DOOR_OPEN),
                },
            },
        }
    }
    pub fn set_ebih__waterfall__ctx__west_door_open(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::EBIH__WATERFALL__CTX__WEST_DOOR_OPEN,
            val,
        );
    }
    pub fn ebih__ebih_west__ctx__door_open(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::EBIH__EBIH_WEST__CTX__DOOR_OPEN),
                },
            },
        }
    }
    pub fn set_ebih__ebih_west__ctx__door_open(&mut self, val: bool) {
        self.cbits1
            .set(flags::ContextBits1::EBIH__EBIH_WEST__CTX__DOOR_OPEN, val);
    }
    pub fn ebih__ebih_east__ctx__platform1_moved(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM1_MOVED),
                },
            },
        }
    }
    pub fn set_ebih__ebih_east__ctx__platform1_moved(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM1_MOVED,
            val,
        );
    }
    pub fn ebih__ebih_east__ctx__platform2_moved(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM2_MOVED),
                },
            },
        }
    }
    pub fn set_ebih__ebih_east__ctx__platform2_moved(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::EBIH__EBIH_EAST__CTX__PLATFORM2_MOVED,
            val,
        );
    }
    pub fn ebih__drone_room__ctx__platform_moved(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::EBIH__DRONE_ROOM__CTX__PLATFORM_MOVED),
                },
            },
        }
    }
    pub fn set_ebih__drone_room__ctx__platform_moved(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::EBIH__DRONE_ROOM__CTX__PLATFORM_MOVED,
            val,
        );
    }
    pub fn ebih__vertical_interchange__ctx__door_open(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::EBIH__VERTICAL_INTERCHANGE__CTX__DOOR_OPEN),
                },
            },
        }
    }
    pub fn set_ebih__vertical_interchange__ctx__door_open(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::EBIH__VERTICAL_INTERCHANGE__CTX__DOOR_OPEN,
            val,
        );
    }
    pub fn giguna_breach__sw_save__ctx__door_opened(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA_BREACH__SW_SAVE__CTX__DOOR_OPENED),
                },
            },
        }
    }
    pub fn set_giguna_breach__sw_save__ctx__door_opened(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA_BREACH__SW_SAVE__CTX__DOOR_OPENED,
            val,
        );
    }
    pub fn giguna__giguna_northeast__ctx__door_opened(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__GIGUNA_NORTHEAST__CTX__DOOR_OPENED),
                },
            },
        }
    }
    pub fn set_giguna__giguna_northeast__ctx__door_opened(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__GIGUNA_NORTHEAST__CTX__DOOR_OPENED,
            val,
        );
    }
    pub fn giguna__carnelian__ctx__door_opened(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__DOOR_OPENED),
                },
            },
        }
    }
    pub fn set_giguna__carnelian__ctx__door_opened(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__CARNELIAN__CTX__DOOR_OPENED,
            val,
        );
    }
    pub fn giguna__carnelian__ctx__upper_susar(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__UPPER_SUSAR),
                },
            },
        }
    }
    pub fn set_giguna__carnelian__ctx__upper_susar(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__CARNELIAN__CTX__UPPER_SUSAR,
            val,
        );
    }
    pub fn giguna__carnelian__ctx__lower_susar(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__CARNELIAN__CTX__LOWER_SUSAR),
                },
            },
        }
    }
    pub fn set_giguna__carnelian__ctx__lower_susar(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__CARNELIAN__CTX__LOWER_SUSAR,
            val,
        );
    }
    pub fn giguna__west_caverns__ctx__east_susar(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__WEST_CAVERNS__CTX__EAST_SUSAR),
                },
            },
        }
    }
    pub fn set_giguna__west_caverns__ctx__east_susar(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__WEST_CAVERNS__CTX__EAST_SUSAR,
            val,
        );
    }
    pub fn giguna__giguna_base__ctx__door_open(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__GIGUNA_BASE__CTX__DOOR_OPEN),
                },
            },
        }
    }
    pub fn set_giguna__giguna_base__ctx__door_open(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__GIGUNA_BASE__CTX__DOOR_OPEN,
            val,
        );
    }
    pub fn giguna__ruins_west__ctx__kishib_handled(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__RUINS_WEST__CTX__KISHIB_HANDLED),
                },
            },
        }
    }
    pub fn set_giguna__ruins_west__ctx__kishib_handled(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__RUINS_WEST__CTX__KISHIB_HANDLED,
            val,
        );
    }
    pub fn giguna__ruins_top__ctx__doors_open(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__RUINS_TOP__CTX__DOORS_OPEN),
                },
            },
        }
    }
    pub fn set_giguna__ruins_top__ctx__doors_open(&mut self, val: bool) {
        self.cbits1
            .set(flags::ContextBits1::GIGUNA__RUINS_TOP__CTX__DOORS_OPEN, val);
    }
    pub fn giguna__clouds__ctx__platform_and_portal(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__CLOUDS__CTX__PLATFORM_AND_PORTAL),
                },
            },
        }
    }
    pub fn set_giguna__clouds__ctx__platform_and_portal(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__CLOUDS__CTX__PLATFORM_AND_PORTAL,
            val,
        );
    }
    pub fn giguna__east_caverns__ctx__door_opened(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__DOOR_OPENED),
                },
            },
        }
    }
    pub fn set_giguna__east_caverns__ctx__door_opened(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__DOOR_OPENED,
            val,
        );
    }
    pub fn giguna__east_caverns__ctx__combo_entered(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__COMBO_ENTERED),
                },
            },
        }
    }
    pub fn set_giguna__east_caverns__ctx__combo_entered(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__COMBO_ENTERED,
            val,
        );
    }
    pub fn giguna__east_caverns__ctx__upper_susar(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__UPPER_SUSAR),
                },
            },
        }
    }
    pub fn set_giguna__east_caverns__ctx__upper_susar(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__UPPER_SUSAR,
            val,
        );
    }
    pub fn giguna__east_caverns__ctx__mid_susar(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__MID_SUSAR),
                },
            },
        }
    }
    pub fn set_giguna__east_caverns__ctx__mid_susar(&mut self, val: bool) {
        self.cbits1.set(
            flags::ContextBits1::GIGUNA__EAST_CAVERNS__CTX__MID_SUSAR,
            val,
        );
    }
    pub fn giguna__gateway__ctx__door_opened(&self) -> bool {
        match self.position {
            _ => match get_area(self.position) {
                _ => match get_region(self.position) {
                    _ => self
                        .cbits1
                        .contains(flags::ContextBits1::GIGUNA__GATEWAY__CTX__DOOR_OPENED),
                },
            },
        }
    }
    pub fn set_giguna__gateway__ctx__door_opened(&mut self, val: bool) {
        self.cbits1
            .set(flags::ContextBits1::GIGUNA__GATEWAY__CTX__DOOR_OPENED, val);
    }
}
