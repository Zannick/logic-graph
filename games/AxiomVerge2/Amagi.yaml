name: Lake Amagi
short: Amagi
data:
  water: true

# TODO: Needs to be routed without Underwater_Movement to determine accessibility
areas:
- name: Main Area  # MARK: Main Area
  on_entry: $reset_old_area(^newpos)
  load:
    _combo: false
  map:
    save: [29, 18, 30, 19]
    cave: [27, 14, 28, 15]
    upper_flask: [30, 13, 31, 14]
    lower_flask: [30, 15, 31, 16]
  data:
    save_point: Save Point
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Amagi Main Area
      cave: Menu > Kiengir Map > Amagi Main Area Cave Entrance
      upper_flask: Menu > Kiengir Map > Amagi Main Area Cave Flask
      lower_flask: Menu > Kiengir Map > Amagi Main Area Water Flask
  spots:
    - name: East 15
      coord: [30.95, 14.85]
      local:
        - to: Water's Edge
      data:
        water: false
      exits:
        - to: Glacier > Lake Main Entrance > Lake Access
          tags: [xshift]
    - name: Water's Edge
      coord: [29.8, 14.85]
      local:
        - to: East 15
        - to: Shallow End
      data:
        water: false
    - name: Shallow End
      coord: [29.6, 15.15]
      local:
        - to: Cliff
      exits:
        - to: Water's Edge
          req: Underwater_Movement or $hook or $grab
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement and not $hook
              movement: base
              jumps: 1
            - when: not Underwater_Movement
              movement: base
    - name: Cliff
      coord: [28.45, 15.4]
      local:
        - to: Shallow End
          jumps: 2
        - to: Upper Platform
    - name: Upper Platform
      coord: [28.25, 15.6]
      local:
        - to: Cliff
          jumps: 1
          jump_mvmt: water
        - to: West Shelf
        - to: Platform 2
        - to: East Ledge
          jumps_down: 1
    - name: West Shelf
      coord: [27.9, 15.9]
      local:
        - to: West Side
          jumps: 1
        - to: Platform 2
        - to: Upper Platform
          jumps: 2
    - name: West Side
      coord: [27.5, 15.75]
      local:
        - to: West Shelf
      exits:
        - to: Carving
          req: Underwater_Movement and ($hook or $grab or $climb)
          movement: water
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
      keep: true
    - name: Platform 2
      coord: [28.05, 16.15]
      local:
        - to: Upper Platform
          jumps: 1
          jump_movement: water
        - to: East Ledge
        - to: Platform 3
          jumps_down: 1
        - to: Catwalk Center
      exits:
        - to: West Shelf
          req: Underwater_Movement or $hook or $grab
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement and not $hook
              movement: base
              jumps: 1
            - when: not Underwater_Movement
              movement: base
      keep: true
    - name: East Ledge
      coord: [28.25, 16.3]
      local:
        - to: Platform 2
          jumps: 1
        - to: Platform 3
        - to: Catwalk Center
      keep: true

    - name: Carving
      coord: [27.15, 14.6]
      data:
        water: false
      local:
        - to: West 15
        - to: West Side
      actions:
        - name: Key Combo
          req: not ^_combo
          do: ^_combo = true
          tags: [combo]
      exits:
        - to: Secret Outcropping
          req: ^_combo and ($hook or $grab or $climb)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: West 15
      coord: [27.05, 14.85]
      data:
        water: false
      local:
        - to: Carving
          jumps: 1
      exits:
        - to: West Lake > East 15
          tags: [xshift]
    - name: Secret Outcropping
      coord: [27.55, 14.15]
      data:
        water: false
      local:
        - to: Carving
        - to: West Shelf
        - to: Upper Platform
        - to: Shallow End
      exits:
        - to: Interior > Cave Behind Waterfall > Bottom
          tags: [interior]

    - name: Platform 3
      coord: [28.0, 16.7]
      local:
        - to: Platform 2
          jumps: 1.5
          jump_movement: water
        - to: East Ledge
          jumps: 1
          jump_movement: water
        - to: Catwalk Center
        - to: West 18
        - to: Flat Ruin
      exits:
        - to: West 18 Hook Point
          req: $hover
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
      actions:
        - name: Throw Drone West
          do: $deploy_drone
          to: West 18 Hook Point
          req: $can_deploy and Drone_Hover
          movement: fast_hover
        - name: Throw Drone East
          do: $deploy_drone
          to: Grid 31,19 > Center
          req: $can_deploy and Drone_Hover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: Catwalk Center
      coord: [28.3, 17.1]
      local:
        - to: Catwalk Broken Part
        - to: Broken Wall
        - to: Wall Stuck Spot
      exits:
        - to: Platform 3
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
              jumps: 2
        - to: East Ledge
          req: Underwater_Movement and ($grab or $climb)
          movement: water
          jumps: 2
        - to: West 18 Hook Point
          req: $hover
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
      actions:
        - name: Throw Drone West
          do: $deploy_drone
          to: West 18 Hook Point
          req: $can_deploy and Drone_Hover
          movement: fast_hover
        - name: Throw Drone East
          do: $deploy_drone
          to: Grid 31,19 > Center
          req: $can_deploy and Drone_Hover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
      keep: true
    - name: Catwalk Broken Part
      coord: [29.05, 17.1]
      local:
        - to: Catwalk Center
        - to: Save Point
        - to: Catwalk East Edge
    - name: Catwalk East Edge
      coord: [29.5, 17.1]
      local:
        - to: Catwalk Broken Part
        - to: Save Point
        - to: Enemy Side
      exits:
        - to: Broken Catwalk Far Side
          req: Underwater_Movement and $hover
          movement: water
        - to: Southeast Ledge
          req: Underwater_Movement and $hover
          movement: water
        - to: East 19
          req: Underwater_Movement and $hover
          movement: water
    - name: Save Point
      coord: [29.525, 18.6]
      local:
        - to: Broken Wall
          jumps: 4
          jump_movement: water
        - to: Enemy Side
      actions:
        - name: Save
          do: $save
          time: 1.2
    - name: Enemy Side
      coord: [29.8, 18.6]
      local:
        - to: Save Point
        - to: Small Cliff
          jumps: 1
    - name: Small Cliff
      coord: [30.4, 18.55]
      local:
        - to: Enemy Side
        - to: East 19
    - name: East 19
      coord: [30.95, 18.7]
      local:
        - to: Small Cliff
          jumps: 1
      exits:
        - to: Grid 31,19 > West
          tags: [xshift]

    - name: Broken Catwalk Far Side
      coord: [30.15, 17.1]
      local:
        - to: Save Point
        - to: Catwalk Far East
      exits:
        - to: Catwalk East Edge
          req: Underwater_Movement and $hover
          movement: water
    - name: Catwalk Far East
      coord: [30.5, 17.1]
      local:
        - to: East 18
        - to: Broken Catwalk Far Side
      exits:
        - to: Gated Community > Platform 2 West
          req: Underwater_Movement and $hover
          movement: water
          jumps: 2
          penalty_tags: [xshift, -base.1]
        - to: Cache Ledge
          req: Underwater_Movement and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Southeast Ledge
      coord: [30.8, 17.8]
      local:
        - to: Small Cliff
        - to: East 18
        - to: East 19
          thru: [30.75, 18.2]
      exits:
        - to: Cache Ledge
          req: Underwater_Movement and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: East 18
      coord: [30.95, 17.8]
      local:
        - to: Southeast Ledge
      exits:
        - to: Gated Community > West 18
          tags: [xshift]
        - to: Cache Ledge
          req: Underwater_Movement and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1

    - name: Northeast Ledge
      coord: [30.8, 16.0]
      local:
        - to: East 16
        - to: Broken Catwalk Far Side
        - to: Catwalk Far East
        - to: East 18
          thru: [30.75, 16.3]
        - to: East 19
          thru: [[30.75, 16.3], [30.75, 18.2]]
      exits:
        - to: Cache Ledge
          req: Underwater_Movement or $hook or $grab
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement and not $hook
              movement: base
              jumps: 1
            - when: not Underwater_Movement
              movement: base
            - when: not $hook
              jumps: 1
    - name: East 16
      coord: [30.95, 16.0]
      exits:
        - to: Gated Community > West 16
          tags: [xshift]
        - to: Cache Ledge
          req: $hook
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
    - name: Cache Ledge
      coord: [30.7, 15.7]
      local:
        - to: Cache Jump
          jumps: 1
        - to: Cache
        - to: East 18
          thru: [30.75, 16.3]
        - to: East 19
          thru: [[30.75, 16.3], [30.75, 18.2]]
        - to: Catwalk Far East
          thru: [30.75, 16.0]
    - name: Cache Jump
      coord: [30.5, 15.55]
      local:
        - to: Cache
        - to: Cache Ledge
      locations:
        - name: Nearby Flask
          canon: Amagi_Main_Area_Water_Flask
          item: Flask
          req: $boomerang
          tags: [nearby_flask]
        - name: Shockwave Flask  # Not actually in the air but close enough
          canon: Amagi_Main_Area_Water_Flask
          item: Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
    - name: Cache
      coord: [30.3, 15.8]
      local:
        - to: Cache Ledge
          jumps: 1
      locations:
        - name: Item
          canon: Amagi_Main_Area_Water_Flask
          item: Flask
          tags: [flask]
      hybrid:
        - name: Item Collection Skip
          canon: Amagi_Main_Area_Water_Flask
          item: Flask
          to: Menu > Warp Only > Kiengir
          req: $melee_cskip
          tags: [cskip]
        - name: Item Fast Travel
          canon: Amagi_Main_Area_Water_Flask
          item: Flask
          to: ^map_spot
          req: Fast_Travel and $melee_cskip
          tags: [cskip]

    - name: Broken Wall
      coord: [28.425, 17.35]
      local:
        - to: Catwalk Center
          jumps: 1
        - to: Wall Stuck Spot
        - to: Save Point
      actions:
        - name: Throw Drone West
          do: $deploy_drone
          to: West 18 Hook Point
          req: $can_deploy and Drone_Hover and Slingshot_Hook
          movement: fast_hover
    - name: Wall Stuck Spot
      coord: [28.4, 17.8]
      local:
        - to: Broken Wall
          jumps: 1
      actions:
        - name: Throw Drone West
          do: $deploy_drone
          to: West 18 Hook Point
          req: $can_deploy and Drone_Hover and Slingshot_Hook
          movement: fast_hover
          jumps: 1
    - name: Half Pillar
      coord: [28, 18.15]
      local:
        - to: Broken Wall
          jumps: 2
        - to: Flat Ruin
        - to: West Mini-Hill
    - name: Flat Ruin
      coord: [27.5, 18.15]
      local:
        - to: West 18
          jumps: 2
          jump_movement: water
        - to: West 19
        - to: Half Pillar
        - to: West Mini-Hill
      exits:
        - to: West 18 Hook Point
          req: Underwater_Movement and $hook
          movement: water
          jumps: 1
    - name: West Mini-Hill
      coord: [27.8, 18.5]
      local:
        - to: West 19
        - to: Flat Ruin
          jumps: 1
        - to: Half Pillar
          jumps: 1
    - name: West 18
      coord: [27.05, 17.35]
      local:
        - to: Flat Ruin
      exits:
        - to: West Lake > East 18
          tags: [xshift]
    - name: West 18 Hook Point
      coord: [27.2, 17.45]
      local:
        - to: West 18
          jumps: 1
        - to: Flat Ruin
      exits:
        - to: West Lake > West Platform
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
        - to: West Lake > Some Rock
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
        - to: West Lake > Tentacle Gap
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: West 19
      coord: [27.05, 18.7]
      local:
        - to: West Mini-Hill
          jumps: 1
      exits:
        - to: West Lake > East 19
          tags: [xshift]

    - name: Secret Waterfall
      coord: [27.4, 13.35]
      data:
        water: false
      local:
        - to: Way Off To The Side
          jumps: 1
      exits:
        - to: Interior > Cave Behind Waterfall > Top
          tags: [interior]
    - name: Way Off To The Side
      coord: [30.4, 13.3]
      data:
        water: false
      local:
        - to: Secret Waterfall
      locations:
        - name: Item
          item: Flask
          tags: [flask]

- name: Grid 31,19  # MARK: Grid 31,19
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West
      coord: [31.05, 18.7]
      local:
        - to: East
      exits:
        - to: Main Area > East 19
          tags: [xshift]
    - name: Center
      coord: [31.45, 18.75]
      data:
        flipside: Amagi Breach > Upper Hallway > West Hook Point
      local:
        - to: East
          jumps: 1
        - to: West
          jumps: 1
    - name: East
      coord: [31.95, 18.7]
      local:
        - to: West
      exits:
        - to: Liru Room > West 19
          tags: [xshift]

- name: Liru Room  # MARK: Liru Room
  on_entry: $reset_old_area(^newpos)
  map:
    urn: [33, 20, 34, 21]
  datamap:
    map_spot:
      urn: Menu > Kiengir Map > Water Movement
  spots:
    - name: West 19
      coord: [32.05, 18.7]
      local:
        - to: Hidden Enemies
      exits:
        - to: Grid 31,19 > East
          tags: [xshift]
    - name: Hidden Enemies
      coord: [32.4, 18.7]
      local:
        - to: West 19
        - to: Platform 1 Left
        - to: Platform 1 Right
        - to: West 20
    - name: Platform 1 Left
      coord: [32.4, 19.2]
      local:
        - to: Hidden Enemies
          jumps: 1.2
          jump_movement: water
        - to: West 20
        - to: Platform 1 Right
        - to: Platform 2 Left
          jumps_down: 1
    - name: Platform 1 Right
      coord: [32.65, 19.2]
      local:
        - to: Platform 1 Left
        - to: Platform 2 Left
          jumps_down: 1
        - to: Platform 2 Right
    - name: Platform 2 Left
      coord: [32.4, 19.6]
      local:
        - to: Platform 1 Left
          jumps: 1
          jump_movement: water
        - to: West 20
        - to: Platform 2 Right
        - to: Platform 3 Left
          jumps_down: 1
        - to: Platform 3 Right
          jumps_down: 1
    - name: Platform 2 Right
      coord: [32.8, 19.6]
      local:
        - to: Platform 1 Right
          jumps: 1
          jump_movement: water
        - to: Platform 2 Left
        - to: East Passage
        - to: Platform 3 Right
          jumps_down: 1
        - to: Bottom
          jumps_down: 1
    - name: Platform 3 Left
      coord: [32.4, 20.0]
      local:
        - to: Platform 2 Left
          jumps: 1
          jump_movement: water
        - to: West 20
        - to: Platform 3 Right
    - name: Platform 3 Right
      coord: [32.7, 20.0]
      local:
        - to: Platform 2 Left
          jumps: 1
          jump_movement: water
        - to: Platform 2 Right
          jumps: 1
          jump_movement: water
        - to: East Passage
          jumps: 1
          jump_movement: water
        - to: Platform 3 Left
        - to: Platform 4 Right
        - to: Bottom
    - name: Platform 4 Left
      coord: [32.5, 20.4]
      local:
        - to: Platform 3 Left
          jumps: 1
          jump_movement: water
        - to: Platform 4 Right
      exits:
        - to: West 20
          req: $hook and $hover and Underwater_Movement
    - name: Platform 4 Right
      coord: [32.75, 20.4]
      local:
        - to: Platform 3 Right
          jumps: 1
          jump_movement: water
        - to: Platform 4 Left
        - to: Bottom
      exits:
        - to: East Passage
          req: $hook and Underwater_Movement
    - name: Bottom
      coord: [33, 20.8]
      local:
        - to: Platform 4 Right
          jumps: 1
          jump_movement: water
        - to: Shrine
          jumps: 1
    - name: Shrine
      coord: [33.5, 20.4]
      local:
        - to: Bottom
      locations:
        - name: Item
          item: Underwater_Movement
          tags: [urn]
    - name: West 20
      coord: [32.05, 20.0]
      local:
        - to: Platform 2 Left
          jumps: 2
        - to: Platform 3 Left
        - to: Bottom
      exits:
        - to: Platform 4 Right
          req: $hook
        - to: Platform 4 Left
          req: $hover
        - to: Shrine
          req: $hook and $hover
          time: 3.5
        - to: Divided Room > East
          tags: [xshift]

    - name: East Passage
      coord: [33, 19.8]
      local:
        - to: Platform 2 Right
          jumps: 1
        - to: Platform 3 Right
          jumps_down: 1
        - to: Bottom
          jumps_down: 1
      exits:
        - to: East Platform 1 Left
          req: Underwater_Movement
          movement: water
          jumps: 1

    - name: East Platform 1 Left
      coord: [33.4, 19.35]
      local:
        - to: East Platform 1 Right
        - to: East Passage
      exits:
        - to: Hidden Exit
          req: Underwater_Movement or ($hook or $grab or $climb)
          movement: water
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: East Platform 2 Right
          req: Underwater_Movement or ($hook or $grab)
          movement: water
          jumps: 1.5
          penalties:
            - when: not $hook
              jumps: 0.5
        - to: East Platform 3 Left
          req: $hook and Underwater_Movement
          movement: water
          jumps: 2
    - name: East Platform 1 Right
      coord: [33.8, 19.35]
      local:
        - to: East Platform 1 Left
      exits:
        - to: Hidden Exit
          req: Underwater_Movement and ($hook or $grab or $climb)
          movement: water
          jumps: 2
        - to: East Platform 2 Right
          req: $hook and Underwater_Movement
          movement: water
          jumps: 1
    - name: East Platform 2 Left
      coord: [33.15, 18.8]
      local:
        - to: East Platform 2 Right
        - to: East Passage
          thru: [33.1, 19.3]
    - name: East Platform 2 Right
      coord: [33.35, 18.8]
      local:
        - to: East Platform 2 Left
        - to: East Platform 1 Left
        - to: East Platform 1 Right
        - to: East Platform 3 Left
          jumps: 1
          jump_mvmt: water
      exits:
        - to: Hidden Exit
          req: $hover
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
      
    - name: East Platform 3 Left
      coord: [33.45, 18.5]
      local:
        - to: East Platform 3 Right
        - to: East Platform 2 Right
        - to: East Platform 2 Left
        - to: East Platform 1 Left
      exits:
        - to: Hidden Exit
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
    - name: East Platform 3 Right
      coord: [33.65, 18.5]
      local:
        - to: East Platform 3 Left
        - to: East Platform 1 Right
        - to: East Platform 1 Left
          thru: [33.65, 18.7]
        - to: Hidden Exit
    - name: Hidden Exit
      coord: [33.95, 18.8]
      local:
        - to: East Platform 3 Right
          jumps: 1
          jump_mvmt: water
        - to: East Platform 1 Left
        - to: East Platform 1 Right
      exits:
        - to: Secret Chamber > West
          tags: [xshift]

- name: Secret Chamber  # MARK: Secret Chamber
  on_entry: $reset_old_area(^newpos)
  reset:
    _west_dur_esla: false
    _east_dur_esla: false
  data:
    portal_start: Portal Wall
    portal_hidden: true
  map:
    health: [35, 18, 36, 19]
    flask: [35, 19, 36, 20]
  datamap:
    map_spot:
      health: Menu > Kiengir Map > Amagi Secret Chamber Health
      flask: Menu > Kiengir Map > Amagi Secret Chamber Flask
  spots:
    - name: West
      coord: [34.05, 18.8]
      local:
        - to: West Dur-Esla
      exits:
        - to: Column
          req: Underwater_Movement and $hover
          movement: water
        - to: Liru Room > Hidden Exit
          tags: [xshift]
    - name: West Dur-Esla
      coord: [34.3, 19.75]
      local:
        - to: East Dur-Esla
      exits:
        - to: West
          req: ^_west_dur_esla and Underwater_Movement and $hookhover
          movement: water
          jumps: 4
        - to: West
          req: ^_west_dur_esla and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
      actions:
        - name: Kill Dur-Esla
          req: $melee and not ^_west_dur_esla
          do: ^_west_dur_esla = true
          time: 1
        - name: Shockwave Dur-Esla
          req: $shockwave and not ^_west_dur_esla
          price: 100
          do: ^_east_dur_esla = true
          tags: [shockwave]
    - name: East Dur-Esla
      coord: [34.75, 19.75]
      data:
        flipside: Amagi Breach > Fishy Secrets > Shaft Bottom
      local:
        - to: West Dur-Esla
      exits:
        - to: Column
          req: ^_east_dur_esla and Underwater_Movement and $hookhover
          movement: water
          jumps: 4
        - to: Column
          req: ^_east_dur_esla and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
      actions:
        - name: Kill Dur-Esla
          req: $melee and not ^_east_dur_esla
          do: ^_east_dur_esla = true
          time: 1
        - name: Shockwave Dur-Esla
          req: $shockwave and not ^_east_dur_esla
          price: 100
          do: ^_east_dur_esla = true
          tags: [shockwave]
    - name: Column
      coord: [34.9, 18.9]
      data:
        flipside: Amagi Breach > Fishy Secrets > Center Column
      local:
        - to: Middle Ledge
        - to: East Dur-Esla
      exits:
        - to: West
          req: Underwater_Movement and $hover
          movement: water
          jumps: 1
        - to: Upper Ledge
          req: $hook or (Underwater_Movement and $hover)
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
              jumps: 1
        - to: Upper Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Middle Ledge
      coord: [35.3, 18.9]
      data:
        flipside: Amagi Breach > Fishy Secrets > East Pentomino
      local:
        - to: Column
      exits:
        - to: Upper Ledge
          req: Underwater_Movement or $hook
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
              jumps: 1
        - to: Upper Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Upper Ledge
      coord: [35.35, 18.5]
      local:
        - to: Upper Cache
        - to: Middle Ledge
        - to: Column
      locations:
        - name: Steer Boomerang
          canon: Amagi_Secret_Chamber_Flask
          item: Flask
          req: $boomerang
          to: Middle Ledge
          time: 8  # ?
    - name: Upper Cache
      coord: [35.7, 18.5]
      data:
        flipside: Amagi Breach > Fishy Secrets > Northeast Corner
      local:
        - to: Upper Ledge
      locations:
        - name: Health
          item: Health_Fragment
          tags: [standing]
    - name: Portal Wall
      coord: [35.85, 18.7]
    - name: Enclosed Cache
      coord: [35.7, 19.1]
      data:
        flipside: Amagi Breach > Fishy Secrets > East Corner
      locations:
        - name: Flask
          canon: Amagi_Secret_Chamber_Flask
          item: Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Amagi_Secret_Chamber_Flask
          item: Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Amagi_Secret_Chamber_Flask
          item: Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]

- name: West Lake  # MARK: West Lake
  on_entry: $reset_old_area(^newpos)
  map:
    urn: [23, 19, 24, 20]
    refills: [23, 16, 24, 17]
    flask: [24, 16, 25, 17]
    mus: [22, 15, 23, 16]
  datamap:
    map_spot:
      urn: Menu > Kiengir Map > Shockwave
      refills: Menu > Kiengir Map > Amagi West Lake Refill Station
      flask: Menu > Kiengir Map > Amagi Dragon Eye Flask
      mus: Menu > Kiengir Map > MUS A M20 Flask
  spots:
    - name: East 15
      coord: [26.95, 14.85]
      data:
        water: false
      local:
        - to: East Shore
      exits:
        - to: Main Area > West 15
          tags: [xshift]
    - name: East Shore
      coord: [26.8, 14.85]
      data:
        water: false
      local:
        - to: East Shore
        - to: East Bank
    - name: East Bank
      coord: [26.45, 15.6]
      local:
        - to: East Shore
          jumps: 3
    - name: Northeast Platform
      coord: [26.1, 16]
      local:
        - to: East Bank
          jumps: 1
          jump_movement: water
        - to: West Cliff
          jumps: 2
          jump_movement: water
        - to: Northwest Platform
        - to: Upper Center Platform
          jumps_down: 1
        - to: Pillar
        - to: East Platform
    - name: Northwest Platform
      coord: [25.8, 16.15]
      local:
        - to: Northeast Platform
          jumps: 1
          jump_movement: water
        - to: Upper Center Platform
        - to: Somewhat Central Platform
        - to: West Platform
      exits:
        - to: West Cliff
          req: Underwater_Movement or $hook or $grab
          movement: fast_hover  # Underwater_Movement and $hook
          jumps: 1
          penalties:
            - when: not Underwater_Movement and not $hook
              movement: base
              jumps: 2
            - when: not Underwater_Movement
              movement: base
              jumps: 1
            - when: not $hook
              movement: water
    - name: Upper Center Platform
      coord: [26, 17.1]
      local:
        - to: Northwest Platform
          jumps: 3
          jump_movement: water
        - to: Northeast Platform
          jumps: 3
          jump_movement: water
        - to: East Platform
        - to: Tentacle Gap
    - name: East Platform
      coord: [26.45, 17.1]
      data:
        flipside: Amagi Breach > West Ruins > Center Platform
      local:
        - to: Upper Center Platform
        - to: East 18
        - to: Northeast Platform
          jumps: 4
          jump_movement: water
    - name: East 18
      coord: [26.95, 17.35]
      local:
        - to: East Platform
          jumps: 1
          jump_movement: water
        - to: Pillar
      exits:
        - to: Main Area > West 18
          tags: [xshift]
    - name: Pillar
      coord: [26.6, 17.9]
      local:
        - to: East 18
          jumps: 1
          jump_movement: water
        - to: Pillar Platform
        - to: Tentacle Gap
        - to: Somewhat Central Platform
    - name: Pillar Platform
      coord: [26.75, 18.3]
      local:
        - to: Pillar
          jumps: 1
          jump_movement: water
        - to: East 19
          jumps_down: 1
    - name: East 19
      coord: [26.95, 18.7]
      local:
        - to: Pillar Platform
          jumps: 1
          jump_movement: water
      # this could probably be done with wall climb... if it mattered
      exits:
        - to: Main Area > West 19
          tags: [xshift]

    - name: Somewhat Central Platform
      coord: [25.35, 17.9]
      local:
        - to: West Platform
          jumps: 1
          jump_movement: water
        - to: Pillar
          jumps: 2
          jump_movement: water
        - to: Some Rock
    - name: West Platform
      coord: [25.05, 17.7]
      local:
        - to: Somewhat Central Platform
        - to: Cavern Front Teeth
          jumps: 1
          jump_movement: water
        - to: Cavern Chin
    - name: Cavern Front Teeth
      coord: [24.7, 17.5]
      local:
        - to: West Platform
        - to: Cavern Back Teeth
          jumps: 1
          jump_movement: water
    - name: Cavern Back Teeth
      coord: [24.1, 17.3]
      local:
        - to: Cavern Front Teeth
        - to: Cavern Jaw
          jumps: 1
          jump_movement: water
    - name: Cavern Jaw
      coord: [23.7, 17.15]
      local:
        - to: Cavern Neck
        - to: Cavern Back Teeth
          jumps: 1
          jump_movement: water
        - to: Cavern Chin
        - to: Cavern Front Pillar
          jumps: 3
          jump_movement: water
        - to: Cavern Refill Station
          jumps: 3
          jump_movement: water
    - name: Cavern Neck
      coord: [23.5, 18.2]
      local:
        - to: Cavern Chin
          jumps: 1
          jump_movement: water
        - to: Cavern Middle Pillar
          jumps: 5
          jump_movement: water
    - name: Cavern Chin
      coord: [24.5, 18.3]
      local:
        - to: Cavern Neck
          jumps: 1
          jump_movement: water
        - to: Somewhat Central Platform
          jumps: 3
          jump_movement: water
        - to: Some Rock
        - to: Stronghold Front Door

    - name: Cavern Refill Station
      coord: [23.6, 16.15]
      local:
        - to: Cavern Jaw
        - to: Cavern Front Pillar
      locations:
        - name: Break Wall
          item: Amagi_Dragon_Eye_Passage
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      hybrid:
        - name: Defeat MUS A M20
          to: Cavern Rear Pillar
          item: Defeat_MUS_A_M20
          req: $shockwave and not Defeat_MUS_A_M20
          # A lie, because it isn't worth adding refill actions here
          # when the time is subsumed by boss movement
          price: 300
          time: 56
          tags: [shockwave, event]
      exits:
        - to: Cavern Tear Duct
          req: Amagi_Dragon_Eye_Passage
          time: 2.8
    - name: Cavern Tear Duct
      coord: [24.4, 16.2]
      local:
        - to: Cavern Eye
      locations:
        - name: Remote Flask
          item: Flask
          canon: Amagi Dragon Eye Flask
          req: $boomerang
          tags: [nearby_flask]
      exits:
        - to: Cavern Refill Station
          req: Amagi_Dragon_Eye_Passage
          time: 2.8
    - name: Cavern Eye
      coord: [24.6, 16.35]
      local:
        - to: Cavern Tear Duct
          jumps: 1
      locations:
        - name: Item
          item: Flask
          canon: Amagi Dragon Eye Flask
          tags: [flask]

    - name: Cavern Front Pillar
      coord: [23.3, 16.2]
      local:
        - to: Cavern Refill Station
          jumps: 1
        - to: Cavern Middle Pillar
        - to: Cavern Jaw
      exits:
        - to: Cavern Rear Pillar
          req: Underwater_Movement and $hover
          movement: water
          jumps: 2
    - name: Cavern Middle Pillar
      coord: [23.05, 16.5]
      local:
        - to: Cavern Lower Trachea
          thru: [22.5, 17.5]
        - to: Cavern Front Pillar
          jumps: 1
          jump_movement: water
      exits:
        - to: Cavern Rear Pillar
          req: Underwater_Movement and $climb
          movement: water
          jumps: 2
    - name: Cavern Rear Pillar
      coord: [22.7, 15.9]
      local:
        - to: Cavern Middle Pillar
        - to: Cavern Lower Trachea
          thru: [22.225, 17.0]
      locations:
        - name: Boss Reward
          item: Flask
          req: Defeat_MUS_A_M20
          tags: [flask]

    - name: Cavern Lower Trachea
      coord: [22.4, 18.2]
      local:
        - to: Cavern Middle Pillar
          thru: [22.5, 17.5]
          jumps: [2, 3]
          jump_movement: water
        - to: Stronghold Top

    - name: Stronghold Top
      coord: [23.25, 19.1]
      local:
        - to: Cavern Lower Trachea
          jumps: 3
          jump_movement: water
        - to: Stronghold Item
      hybrid:
        - name: Remote Urn
          to: Stronghold Item
          item: Shockwave
          canon: Shockwave
          req: $boomerang
          time: 1
          item_tags: [urn]
    - name: Stronghold Item
      coord: [23.4, 19.75]
      local:
        - to: Stronghold Rear Wall
          jumps: 1
      locations:
        - name: Item
          item: Shockwave
          canon: Shockwave
          tags: [urn]
        - name: Break Wall
          item: Amagi_Stronghold_Wall_And_Boulder_1
          canon: Amagi_Stronghold_Wall_1
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Stronghold Middle Column
          req: Amagi_Stronghold_Wall_1
    - name: Stronghold Rear Wall
      coord: [23.1, 19.6]
      local:
        - to: Stronghold Item
      locations:
        - name: Break Left Wall
          canon: Amagi Stronghold Left Wall
          item: Amagi_Stronghold_Left_Wall
          req: $shockwave
          price: 100
          tags: [shockwave, event]
        - name: Mist Through Wall
          canon: Amagi Stronghold Left Wall
          item: Amagi_Stronghold_Left_Wall
          req: Nanite_Mist
          to: West Stronghold Wall
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
          tags: [event]
      exits:
        - to: West Stronghold Wall
          req: Amagi_Stronghold_Left_Wall
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: Stronghold Top
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Stronghold Middle Column
      coord: [23.7, 19.7]
      locations:
        - name: Break Wall
          item: Amagi_Stronghold_Wall_1
          canon: Amagi_Stronghold_Wall_1
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Stronghold Item
          req: Amagi_Stronghold_Wall_1
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: Stronghold Ceiling Left
          req: Amagi_Stronghold_Boulder_1 and Underwater_Movement and ($hook or $grab or $climb)
          movement: water
          jumps: 2
    - name: Stronghold Ceiling Left
      coord: [23.9, 19.1]
      local:
        - to: Stronghold Ceiling Right
      locations:
        - name: Knock Down Left Boulder
          item: Amagi_Stronghold_Boulder_1
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Stronghold Middle Column
          req: Amagi_Stronghold_Boulder_1
          time: .8
    - name: Stronghold Ceiling Right
      coord: [24.1, 19.1]
      local:
        - to: Stronghold Ceiling Left
      locations:
        - name: Knock Down Right Boulder
          item: Amagi_Stronghold_Boulder_2
          canon: Amagi Stronghold Boulder 2
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Stronghold Front Room
          req: Amagi_Stronghold_Boulder_2
    - name: Stronghold Front Room
      coord: [24.4, 19.7]
      locations:
        - name: Break Wall
          item: Amagi_Stronghold_Wall_2
          canon: Amagi Stronghold Wall 2
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Stronghold Ceiling Right
          req: Amagi_Stronghold_Boulder_2 and $grab
        - to: Stronghold Front Door
          req: Amagi_Stronghold_Wall_2
    - name: Stronghold Front Door
      coord: [24.7, 19.8]
      local:
        - to: Some Rock
          jumps: 2
          jump_movement: water
        - to: Small Hill
          jumps: 2
      locations:
        - name: Break Wall
          item: Amagi_Stronghold_Boulder_And_Wall_2
          canon: Amagi Stronghold Wall 2
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Stronghold Front Room
          req: Amagi_Stronghold_Wall_2

    - name: Some Rock
      coord: [25, 18.95]
      local:
        - to: Cavern Chin
          jumps: 2
          jump_movement: water
        - to: Somewhat Central Platform
          jumps: 3
          jump_movement: water
        - to: Stronghold Front Door
        - to: Small Hill
        - to: Tentacle Gap
          jumps: 2
          jump_movement: water
    - name: Small Hill
      coord: [25.3, 19.35]
      local:
        - to: Stronghold Front Door
        - to: Some Rock
          jumps: 2
          jump_movement: water
        - to: Tentacle Gap
          jumps: 3
          jump_movement: water
        - to: Left of Enemy
    - name: Mid-water Above Gap
      coord: [26.25, 17.75]
      data:
        flipside: SpotId::None
      local:
        - to: Tentacle Gap
        - to: Some Rock
        - to: Small Hill
        - to: Somewhat Central Platform
      exits:
        - to: Pillar
          req: Underwater_Movement and ($hook or $hover)
          movement: water
    - name: Tentacle Gap
      coord: [26.25, 18.7]
      local:
        - to: Some Rock
        - to: Pillar
          jumps: 2
          jump_movement: water
        - to: Left of Enemy
        - to: East 20
    - name: Left of Enemy
      coord: [26.1, 19.8]
      local:
        - to: Small Hill
          jumps: 2
          jump_movement: water
        - to: East 20
          jumps: 1
    - name: East 20
      coord: [26.95, 19.75]
      local:
        - to: Left of Enemy
      exits:
        - to: Wiggly Room > West
          tags: [xshift]

    - name: West Cliff
      coord: [25.6, 15.8]
      local:
        - to: Northeast Platform
        - to: Northwest Platform
        - to: West Bank
          jumps: 2
    - name: West Bank
      coord: [25.05, 15.35]
      local:
        - to: Water Surface
          jumps: 1
          jump_movement: water
        - to: West Cliff
      exits:
        - to: West Shore
          req: Underwater_Movement or $hook or $grab or $climb
          movement: water
          jumps: 2
          penalties:
            - when: not Underwater_Movement and not $hook
              movement: base
              jumps: 2
            - when: not Underwater_Movement
              movement: base
    - name: Water Surface
      coord: [25.05, 15.0]
      data:
        water: false
      local:
        - to: West Bank
        - to: West Cliff
    - name: West Shore
      coord: [24.55, 14.85]
      data:
        water: false
      local:
        - to: West Bank
        - to: Water Surface
        - to: Surface Wall Right
          jumps: 2
    - name: Surface Wall Right
      coord: [23.05, 14.65]
      data:
        water: false
      local:
        - to: West Shore
      locations:
        - name: Break Wall
          item: Amagi_West_Lake_Surface_Wall
          canon: Amagi_West_Lake_Surface_Wall
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Surface Wall Left
          req: Amagi_West_Lake_Surface_Wall
          movement: base
    - name: Surface Wall Left
      coord: [22.9, 14.65]
      data:
        water: false
      local:
        - to: West 15
      locations:
        - name: Break Wall
          item: Amagi_West_Lake_Surface_Wall
          canon: Amagi_West_Lake_Surface_Wall
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Surface Wall Right
          req: Amagi_West_Lake_Surface_Wall
          movement: base
    - name: West 15
      coord: [22.05, 14.75]
      data:
        water: false
      local:
        - to: Surface Wall Left
          jumps: 2
      exits:
        - to: Ebih > Vertical Interchange > East 15
          tags: [xshift]

    # West Stronghold
    - name: West 20
      coord: [22.1, 19.75]
      local:
        - to: West Stronghold Button
          jumps: 1
        - to: West Stronghold Gate
      locations:
        - name: Remote Button
          canon: Amagi_West_Lake_Gate
          item: Amagi_West_Lake_Gate
          req: $boomerang
          tags: [throw, event]
      exits:
        - to: Giguna > Vertical Interchange > East 20
          tags: [xdoor]
    - name: West Stronghold Button
      coord: [22.15, 19.5]
      local:
        - to: West Stronghold Gate
        - to: West 20
      locations:
        - name: Button
          canon: Amagi_West_Lake_Gate
          item: Amagi_West_Lake_Gate
          req: $can_damage
          tags: [button, event]
    - name: West Stronghold Gate
      coord: [22.45, 19.75]
      local:
        - to: West 20
        - to: West Stronghold Button
          jumps: 1
      exits:
        - to: West Stronghold Wall
          req: Amagi_West_Lake_Gate
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
    - name: West Stronghold Wall
      coord: [22.85, 19.55]
      locations:
        - name: Break Wall
          canon: Amagi Stronghold Left Wall
          item: Amagi_Stronghold_Left_Wall
          req: $shockwave
          price: 100
          tags: [shockwave, event]
        - name: Mist Through Wall
          canon: Amagi Stronghold Left Wall
          item: Amagi_Stronghold_Left_Wall
          req: Nanite_Mist
          to: Stronghold Rear Wall
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
          tags: [event]
      exits:
        - to: Stronghold Rear Wall
          req: Amagi_Stronghold_Left_Wall
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: West Stronghold Gate
          req: Amagi_West_Lake_Gate
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base

# MUS A M20 : 56s
# TODO: try defeating MUS without grabbing the flask in between

- name: East Lake  # MARK: East Lake
  on_entry: $reset_old_area(^newpos)
  map:
    save: [34, 17, 35, 18]
    surface_east: [35, 14, 36, 15]
    surface_center: [34, 14, 35, 15]
    surface_west: [33, 14, 34, 15]
    southeast: [35, 17, 36, 18]
  data:
    save_point: Save Point
    portal_start: Portal Stand
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Amagi East Lake
      southeast: Menu > Kiengir Map > Forbidden Knowledge
    water:
      surface_east: false
      surface_center: false
      surface_west: false
  spots:
    - name: East 15 Flat
      coord: [35.95, 14.55]
      local:
        - to: East Hill
      exits:
        - to: Glacier > Vertical Room > West 15 Flat
          tags: [xshift]
      actions:
        - name: Attract Portal to Arch
          do: ^portal = `Amagi > East Lake > Arch East`
          to: Arch East
          req: $hover and Underwater_Movement and Breach_Attractor and Anuman and ^portal == ^portal_start
          time: 6
    - name: East 15 Lower
      coord: [35.95, 14.7]
      local:
        - to: East Hill
      exits:
        - to: Glacier > Vertical Room > West 15 Lower
          tags: [xshift]
      actions:
        - name: Attract Portal to Arch
          do: ^portal = `Amagi > East Lake > Arch East`
          to: Arch East
          req: $hover and Underwater_Movement and Breach_Attractor and Anuman and ^portal == ^portal_start
          time: 6
    - name: East 15 Upper Hover
      coord: [35.95, 14.5]
      local:
        - to: East Hill
      exits:
        - to: Center East Water Surface Fast
          req: $hook and $hover
          movement: fast_hover
        - to: Center Lower Platform East
          req: $hook and $hover
          movement: fast_hover
        - to: Center Northeast Platform
          req: $hook and $hover
          movement: fast_hover
        - to: West Platform 3
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Southwest Brick
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Portal Ledge
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Arch East
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Arch West
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
      actions:
        - name: Attract Portal to Arch
          do: ^portal = `Amagi > East Lake > Arch West`
          to: Arch West
          req: $hook and $hover and Underwater_Movement and Breach_Attractor and Anuman and ^portal == ^portal_start
          time: 5.5
    - name: East 15 Lower Hover
      coord: [35.95, 14.65]
      local:
        - to: East Hill
      exits:
        - to: Center East Water Surface Fast
          req: $hook and $hover
          movement: fast_hover
        - to: Center Lower Platform East
          req: $hook and $hover
          movement: fast_hover
        - to: West Platform 3
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Southwest Brick
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Portal Ledge
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Arch East
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Arch West
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
      actions:
        - name: Attract Portal to Arch
          do: ^portal = `Amagi > East Lake > Arch West`
          to: Arch West
          req: $hook and $hover and Underwater_Movement and Breach_Attractor and Anuman and ^portal == ^portal_start
          time: 5.5
    - name: East Hill
      coord: [35.7, 14.7]
      local:
        - to: East Water Surface
          jumps_down: 1
        - to: East 15 Lower
        - to: East 15 Flat
          jumps: 1
      exits:
        - to: Center Lower Platform East
          req: $hover
          movement: base
          jumps: 1
        - to: Center Northeast Platform
          req: $hover
          movement: base
          jumps: 1

    - name: Underwater Hill
      coord: [35.7, 15.7]
      local:
        - to: Southeast Column
        - to: Kum Abala
      exits:
        - to: East Hill
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Center Northeast Platform
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Center Lower Platform East
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1

    - name: East Water Surface
      coord: [35.5, 15.0]
      data:
        water: true
      local:
        - to: Kum Abala
        - to: Foot
          thru: [35.25, 16.9]
        - to: Southeast Column
      exits:
        - to: Arch East
          req: $hover
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: Arch West
          req: $hover
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
    - name: Center East Water Surface Fast
      coord: [34.9, 15.0]
      data:
        water: true
      local:
        - to: Arch East
      exits:
        - to: Arch West
          movement: fast_hover
          penalties:
            - when: not Underwater_Movement
              movement: base
            - when: not $hookhover
              movement: water
        - to: Portal Ledge
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: West Platform 3
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Southwest Brick
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
    - name: Center East Water Surface Slow
      coord: [34.95, 15.0]
      data:
        water: true
      local:
        - to: Kum Abala
        - to: Foot
          thru: [35.25, 16.9]
    - name: Center Lower Platform East
      coord: [34.7, 14.9]
      local:
        - to: Center East Water Surface Slow
        - to: Center Water Below Platform East
          jumps_down: 1
        - to: Center Water Below Platform West
          jumps_down: 1
        - to: Center Northeast Platform
          jumps: 1
        - to: Center Upper Platform
          jumps: 1
        - to: Center West Platform
          jumps: 1
        - to: West Platform 1 East
      exits:
        - to: East Hill
          req: $hover
          movement: base
          jumps: 1
    - name: Center Water Below Platform East
      coord: [34.7, 15.0]
      data:
        water: true
      local:
        - to: Kum Abala
        - to: Southeast Column
        - to: Arch East
        - to: Arch West
        - to: Southwest Column East
        - to: Southwest Column West
      exits:
        - to: West Platform 3
          req: $hover and Underwater_Movement
          movement: water
        - to: Portal Ledge
          req: $hook and $hover and Underwater_Movement
          movement: water
        - to: Southwest Brick
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
            - when: not $hookhover
              movement: water
    - name: Center Water Below Platform West
      coord: [34.3, 15.0]
      data:
        water: true
      local:
        - to: Kum Abala
        - to: Arch East
        - to: Arch West
        - to: Southwest Column East
        - to: Southwest Column West
          thru: [34.15, 16.3]
        - to: West Platform 3
    - name: Center Northeast Platform
      coord: [34.75, 14.7]
      data:
        flipside: Amagi Breach > Upper Lake > Portal Stand
      local:
        - to: Center Upper Platform
          jumps: 1
        - to: Center Lower Platform East
          jumps_down: 1
        - to: Center Water Below Platform West
          jumps_down: 1
        - to: West Platform 1 East
        - to: Center East Water Surface Slow
      exits:
        - to: East Hill
          req: $hover
          movement: base
    - name: Center Upper Platform
      coord: [34.4, 14.65]
      data:
        flipside: Amagi Breach > Upper Lake > Center of Platform
      local:
        - to: Center West Platform
        - to: Center Water Below Platform West
          jumps_down: 2
        - to: Center Northeast Platform
        - to: Center Lower Platform East
          jumps_down: 1
      actions:
        - name: Move Portal Here
          req: Breach_Attractor and ^mode == 'drone' and ^indra WITHIN (`Glacier > Grid 39-40,7-9`, `Glacier > Revival`, `Glacier > Dock Outside`) and ^portal == ^portal_start
          do: ^portal = ^position
          time: 0.1
          penalties:
            - calc: $diagonal_speed_spots(^position, ^portal, 0.55, 1.0) * 0.5
    - name: Center West Platform
      coord: [34.15, 14.75]
      data:
        flipside: Amagi Breach > Upper Lake > Middle
      local:
        - to: West Platform 1 West
        - to: Center West Water Surface
          jumps_down: 1
        - to: Center Water Below Platform West
          jumps_down: 1
        - to: Center Lower Platform East
        - to: Center Upper Platform
          jumps: 1
      exits:
        - to: Far West Water Surface
          req: $hover
          movement: base
    - name: Center West Water Surface
      coord: [34.1, 15.0]
      data:
        water: true
      local:
        - to: West Platform 3
        - to: Arch West
        - to: Save Point
          thru: [34.35, 17.2]
        - to: Southwest Column West
          thru: [34.15, 16.3]

    - name: Center Above
      coord: [34.475, 14.5]
      data:
        flipside: SpotId::None
      local:
        - to: Center Upper Platform
        - to: Center Northeast Platform
        - to: Center Lower Platform East
          jumps_down: 1
    - name: Far West Above
      coord: [33.5, 14.5]
      data:
        flipside: SpotId::None
      local:
        - to: Far West Water Surface
        - to: West Platform 1 West Hook
      exits:
        - to: West Water Surface
          req: $hover
          movement: base
        - to: Center West Platform
          req: $hover
          movement: base

    - name: West Water Surface
      coord: [33.8, 15.0]
      exits:
        - to: Center West Platform
          req: $hover
          movement: base
          jumps: 1
    - name: Far West Water Surface
      coord: [33.35, 15.0]
      data:
        water: true
      local:
        - to: West Platform 2 West
        - to: West 17
    - name: West Platform 1 West
      coord: [33.75, 15.05]
      local:
        - to: West Water Surface
          jumps: 1
        - to: West Platform 1 East
        - to: West Platform 1 West Hook
        - to: West Platform 2 West
        - to: West Platform 3
    - name: West Platform 1 West Hook
      coord: [33.65, 15.1]
      local:
        - to: West Platform 2 West
        - to: West Platform 2 East
        - to: Arch West
        - to: Arch East
      exits:
        - to: West Platform 1 West
          req: $hook
          movement: fast_hover
          jumps: 0.5
        - to: Kum Abala
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Foot
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Center West Platform
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          jumps: 1
        - to: Center Upper Platform
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          jumps: 1
        - to: Center Northeast Platform
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          jumps: 1
        - to: Center Lower Platform East
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          jumps: 1
        - to: Underwater Hill
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
    - name: West Platform 1 East
      coord: [34.05, 15.05]
      local:
        - to: West Platform 1 West
        - to: West Platform 3
        - to: Save Point
        - to: Southwest Column East
        - to: Southwest Column West
          thru: [34.15, 16.3]
        - to: Arch West
        - to: Arch East
        - to: Center West Platform
          jumps: 1
          jump_mvmt: water
        - to: Center Lower Platform East
          jumps: 1
          jump_mvmt: water
      exits:
        - to: West Platform 2 West
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
    - name: West Platform 2 West
      coord: [33.3, 15.45]
      local:
        - to: West 17
        - to: Portal Stand
        - to: West Platform 2 East
        - to: West Platform 1 West Hook
          jumps: 1
          jump_mvmt: water
      exits:
        - to: West Platform 1 West
          req: Underwater_Movement or $hook or $grab
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement and not $hook
              movement: base
              jumps: 1
            - when: not Underwater_Movement
              movement: base
    - name: West Platform 2 East
      coord: [33.65, 15.45]
      local:
        - to: West Platform 2 West
        - to: West Platform 1 West Hook
          jumps: 1
          jump_mvmt: water
        - to: Arch East
        - to: Arch West
        - to: Save Point
          thru: [34.35, 17.2]
        - to: Southwest Column West
          thru: [34.15, 16.3]
        - to: West Platform 3
        - to: Portal Stand
          thru: [33.7, 15.7]
      exits:
        - to: West Platform 1 West
          req: Underwater_Movement or $hook or $grab
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement and not $hook
              movement: base
              jumps: 1
            - when: not Underwater_Movement
              movement: base
    - name: West Platform 3
      coord: [33.7, 15.95]
      local:
        - to: Portal Stand
        - to: Arch East
        - to: Arch West
        - to: Save Point
          thru: [34.15, 16.3]
      exits:
        - to: West Platform 2 East
          req: $hook and Underwater_Movement
          movement: water
          jumps: 1
    - name: West Platform 3 Hook
      coord: [33.6, 16.0]
      exits:
        - to: Kum Abala
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Foot
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Underwater Hill
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          jumps: 1

    - name: Portal Stand
      coord: [33.45, 16.3]
      data:
        flipside: Amagi Breach > East Ruins > Save Point
      local:
        - to: West Platform 3 Hook
          jumps: 1
          jump_mvmt: water
      exits:
        - to: West Platform 3
          req: Underwater_Movement or $hook or $grab
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement and not $hook
              movement: base
              jumps: 1
            - when: not Underwater_Movement
              movement: base
        - to: West 17
          movement: fast_hover
          penalties:
            - when: not Underwater_Movement
              movement: base
            - when: not $hookhover
              movement: water
        - to: Portal Ledge
          movement: fast_hover
          penalties:
            - when: not Underwater_Movement
              movement: base
            - when: not $hookhover
              movement: water
        - to: Save Point
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
        - to: Kum Abala
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
    - name: Portal Ledge
      coord: [33.8, 16.45]
      local:
        - to: Southwest Brick
          thru: [33.75, 16.8]
        - to: Southwest Column Base
        - to: Southwest Column West
        - to: Southwest Column East
      exits:
        - to: Arch West
          req: $hover
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: Portal Stand
          movement: fast_hover
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
            - when: not $hookhover
              movement: water
    - name: West 17
      coord: [33.05, 16.6]
      local:
        - to: Portal Stand
          jumps: 2
      exits:
        - to: Gated Community > East 17
          tags: [xshift]

    - name: Save Point
      coord: [34.5, 17.6]
      data:
        flipside: Amagi Breach > East Ruins > Plinth
      exits:
        - to: Southwest Column East
          req: Underwater_Movement and ($hook or $climb)
          movement: water
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 2
        - to: Southeast Column
          req: Underwater_Movement and ($hook or $climb)
          movement: water
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 2
      actions:
        - name: Save
          do: $save
          tags: [save]
    - name: Southeast Column
      coord: [34.8, 17.1]
      data:
        flipside: Amagi Breach > East Ruins > Southeast Rock Wall
      local:
        - to: Save Point
        - to: Arch East
          jumps: 1
      exits:
        - to: Underwater Hill
          req: $hook and $hover and Underwater_Movement
          movement: water
          jumps: 6
        - to: Portal Ledge
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          jumps: 1
        - to: Southwest Brick
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
          jumps: 1
        - to: Kum Abala
          movement: fast_hover
          penalties:
            - when: not Underwater_Movement
              movement: base
            - when: not $hookhover
              movement: water
        - to: Foot
          req: $hook and $hover and Underwater_Movement
          movement: fast_hover
    - name: Arch East
      coord: [34.65, 16.8]
      data:
        flipside: Amagi Breach > East Ruins > Arch East
      local:
        - to: Arch West
        - to: Save Point
          thru: [34.65, 17.2]
        - to: Kum Abala
        - to: Southeast Column
      exits:
        - to: Underwater Hill
          req: $hook and $hover and Underwater_Movement
          movement: water
          jumps: 4
    - name: Arch West
      coord: [34.35, 16.8]
      data:
        flipside: Amagi Breach > East Ruins > Arch West
      local:
        - to: Arch East
        - to: Save Point
          thru: [34.35, 17.2]
        - to: Southwest Column East
        - to: Southwest Column West
      exits:
        - to: Portal Ledge
          req: $hover and Underwater_Movement
          movement: water
          jumps: 1
    - name: Southwest Column East
      coord: [34.15, 17.1]
      data:
        flipside: Amagi Breach > East Ruins > Small Column East
      local:
        - to: Save Point
        - to: Arch West
          jumps: 1
          jump_mvmt: water
        - to: Southwest Column West
      exits:
        - to: Portal Ledge
          req: $hook and Underwater_Movement
          movement: water
          jumps: 2
    - name: Southwest Column West
      coord: [33.9, 17.1]
      data:
        flipside: Amagi Breach > East Ruins > Small Column West
      local:
        - to: Southwest Column East
        - to: Southwest Column Base
        - to: Southwest Brick
      exits:
        - to: Portal Ledge
          req: $hook and Underwater_Movement
          movement: water
          jumps: 2
    - name: Southwest Column Base
      coord: [33.7, 17.75]
      local:
        - to: Southwest Brick
      exits:
        - to: Southwest Column West
          req: Underwater_Movement and ($hook or $climb)
          movement: water
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
    - name: Southwest Brick
      coord: [33.15, 17.75]
      local:
        - to: West 18
          jumps: 1
        - to: Southwest Column Base
    - name: West 18
      coord: [33.05, 17.7]
      local:
        - to: Southwest Brick
      exits:
        - to: Gated Community > East 18
          tags: [xshift]

    - name: Kum Abala
      coord: [35.2, 17.25]
      local:
        - to: Foot
      exits:
        - to: Underwater Hill
          req: Underwater_Movement and $hookhover
          movement: water
          jumps: 6
        - to: Southeast Column
          movement: fast_hover
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
            - when: not $hookhover
              movement: water
    - name: Foot
      coord: [35.8, 17.75]
      local:
        - to: Kum Abala
          jumps: 2
      locations:
        - name: Tablet
          item: Forbidden_Knowledge
          tags: [standing]

- name: Gated Community  # MARK: Gated Community
  on_entry: $reset_old_area(^newpos)
  reset:
    _dur_esla: false
  map:
    button: [32, 17, 33, 18]
    flask: [32, 15, 33, 16]
  datamap:
    map_spot:
      button: Menu > Kiengir Map > Amagi Gated Community Button
      flask: Menu > Kiengir Map > Amagi Gated Community Flask
  spots:
    - name: East 17
      coord: [32.95, 16.6]
      local:
        - to: Middle East Ledge
      exits:
        - to: East Lake > West 17
          tags: [xshift]
    - name: Middle East Ledge
      coord: [32.7, 16.75]
      local:
        - to: East 17
          jumps: 1
        - to: East 18
        - to: Button
      exits:
        - to: Upper East Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Upper Gate East
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Upper East Ledge
      coord: [32.55, 15.6]
      local:
        - to: Middle East Ledge
        - to: East 17
          thru: [32.55, 15.85]
        - to: Lower Gate East
      locations:
        - name: Flask
          canon: Amagi_Gated_Community_Flask
          item: Flask
          tags: [flask]
        - name: Shockwave Flask
          canon: Amagi_Gated_Community_Flask
          item: Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
        - name: Flask Collection Skip
          canon: Amagi_Gated_Community_Flask
          item: Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Amagi_Gated_Community_Flask
          item: Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
      exits:
        - to: Upper Gate East
          req: $hover
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
    - name: East 18
      coord: [32.95, 17.7]
      local:
        - to: Button
          jumps: 1
      exits:
        - to: East Lake > West 18
          tags: [xshift]

    - name: Button
      coord: [32.65, 17.65]
      local:
        - to: Dur-Esla
        - to: East 18
      locations:
        - name: Hit Button
          item: Amagi_Gated_Community_Gate
          req: $can_damage
          tags: [button]
    - name: Dur-Esla
      coord: [32.4, 17.75]
      local:
        - to: Button
          jumps: 1
        - to: Lower Gate East
          jumps: 2
      exits:
        - to: Upper East Ledge
          req: Nanite_Mist and ^_dur_esla
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
      actions:
        - name: Kill Dur-Esla
          req: $melee and not ^_dur_esla
          do: ^_dur_esla = true
          time: 1
        - name: Shockwave Dur-Esla
          req: $shockwave and not ^_dur_esla
          price: 100
          do: ^_dur_esla = true
          tags: [shockwave]

    - name: Lower Gate East
      coord: [32.1, 17.55]
      local:
        - to: Dur-Esla
      exits:
        - to: Platform 1 East
          req: $hookhover and Underwater_Movement and Amagi_Gated_Community_Gate
          movement: fast_hover
          jumps: 2
        - to: Lower Gate West
          req: Amagi_Gated_Community_Gate
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
    - name: Lower Gate West
      coord: [31.95, 17.55]
      local:
        - to: West 18
      exits:
        - to: Platform 1 East
          req: ($hook or $hover) and Underwater_Movement
          movement: water
          jumps: 1
        - to: East Lake > Southwest Brick
          req: $hookhover and Amagi_Gated_Community_Gate and Underwater_Movement and ^_dur_esla
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
        - to: Lower Gate East
          req: Amagi_Gated_Community_Gate
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: Platform 3 East
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1

    - name: Upper Gate East
      coord: [32.1, 15.8]
      local:
        - to: Upper Gate East Mid-air
          jumps: 1
      exits:
        - to: Upper East Ledge
          req: ($hook or $hover) and Underwater_Movement
          movement: water
          jumps: 1
        - to: Upper Gate West
          req: Amagi_Gated_Community_Gate
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: Upper West Hook Point
          req: $hookhover and Amagi_Gated_Community_Gate and Underwater_Movement
          movement: fast_hover
    - name: Upper Gate East Mid-air
      coord: [32.25, 15.6]
      locations:
        - name: Boomerang Flask and Fall Left
          canon: Amagi_Gated_Community_Flask
          item: Flask
          req: $boomerang
          to: Lower Gate East
          movement: base
          penalty_tags: [throw, flask]
        - name: Boomerang Flask and Fall Right
          canon: Amagi_Gated_Community_Flask
          item: Flask
          req: $boomerang
          to: Button
          movement: base
          penalty_tags: [throw, flask]
        - name: Boomerang Flask and Hover
          canon: Amagi_Gated_Community_Flask
          item: Flask
          req: $hover and Anuman and Underwater_Movement and (Boomerang or Boomerang_Upgrade)
          to: East 17
          movement: water
          penalty_tags: [throw, flask]
        - name: Boomerang Flask Fast Travel
          canon: Amagi_Gated_Community_Flask
          item: Flask
          req: $boomerang and Fast_Travel
          to: ^map_spot
          tags: [throw]
    - name: Upper Gate West
      coord: [31.95, 15.8]
      local:
        - to: Platform 3 East
        - to: Platform 1 East
      exits:
        - to: Upper Gate East
          req: Amagi_Gated_Community_Gate
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: Upper East Ledge
          req: $hookhover and Amagi_Gated_Community_Gate and Underwater_Movement
          movement: fast_hover
          jumps: 1
        - to: East Lake > Portal Stand
          req: $hookhover and Amagi_Gated_Community_Gate and Underwater_Movement and ^_dur_esla
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]

    - name: West 18
      coord: [31.05, 17.75]
      local:
        - to: Lower Gate West
          jumps: 1
      exits:
        - to: Main Area > East 18
          tags: [xshift]
        - to: Platform 1 West
          req: $hook and Underwater_Movement
          movement: water
          jumps: 2
    - name: West 16
      coord: [31.05, 16.0]
      local:
        - to: Upper East Ledge
          jumps: 1
      exits:
        - to: Main Area > East 16
          tags: [xshift]

    - name: Platform 1 West
      coord: [31.4, 17.2]
      data:
        flipside: Amagi Breach > East Ruins > West Bubbly Pillar
      local:
        - to: West 18
        - to: Platform 1 East
      exits:
        - to: Platform 2 East
          req: $hook and Underwater_Movement
          movement: water
          jumps: 2
        - to: Platform 3 West
          req: $hookhover and Underwater_Movement
          movement: water
          jumps: 3
    - name: Platform 1 East
      coord: [31.6, 17.2]
      local:
        - to: Platform 1 West
        - to: Lower Gate West
      exits:
        - to: Platform 2 East
          req: $hook and Underwater_Movement
          movement: water
          jumps: 2
    - name: Platform 2 West
      coord: [31.1, 16.7]
      local:
        - to: Platform 2 East
      exits:
        - to: Main Area > Catwalk Far East
          req: $hover and Underwater_Movement
          movement: water
          penalty_tags: [xshift, -base.1]
        - to: Main Area > Southeast Ledge
          movement: water
          penalty_tags: [xshift, -base.1]
          penalties:
            - when: not Underwater_Movement
              movement: base
              tags: [base.1, -slow.1]
    - name: Platform 2 East
      coord: [31.3, 16.7]
      local:
        - to: Platform 1 East
        - to: Platform 3 West
          jumps: 1
        - to: Platform 2 West
    - name: Platform 3 West
      coord: [31.55, 16.5]
      local:
        - to: Platform 2 East
        - to: Platform 3 East
      exits:
        - to: Upper West Hook Point
          req: $hookhover and Underwater_Movement
          movement: water
          jumps: 1
        - to: Upper West Ledge
          req: $hook and Underwater_Movement
          movement: water
          jumps: 2
        - to: Upper West Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Platform 3 East
      coord: [31.65, 16.5]
      local:
        - to: Platform 3 West
        - to: Lower Gate West
      exits:
        - to: Upper West Hook Point
          req: $hookhover and Underwater_Movement
          movement: water
          jumps: 1
        - to: Upper West Ledge
          req: $hook and Underwater_Movement
          movement: water
          jumps: 2
        - to: Upper West Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Upper Gate West
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Upper West Ledge
      coord: [31.3, 15.95]
      local:
        - to: West 16
        - to: Platform 2 East
        - to: Platform 3 East
      exits:
        - to: Upper Gate West
          req: $hookhover and Underwater_Movement
          movement: water
          jumps: 1
    - name: Upper West Hook Point
      coord: [31.4, 16.1]
      exits:
        - to: Main Area > Cache Ledge
          req: $hookhover and Underwater_Movement
          movement: fast_hover
          jumps: 1
          penalty_tags: [xshift, -fast_hover.1]
        - to: Main Area > Northeast Ledge
          req: $hookhover and Underwater_Movement
          movement: fast_hover
          jumps: 1
          penalty_tags: [xshift, -fast_hover.1]

- name: Wiggly Room  # MARK: Wiggly Room
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Hole
  map:
    tablet: [27, 19, 28, 20]
    gate: [28, 20, 29, 21]
    portal: [29, 20, 30, 21]
  datamap:
    map_spot:
      tablet: Menu > Kiengir Map > Urgent Message
      gate: Menu > Kiengir Map > Amagi Wiggly Room Gate
      portal: Menu > Kiengir Map > Amagi Wiggly Room Portal
  spots:
    - name: West
      coord: [27.05, 19.75]
      local:
        - to: West Ledge
      exits:
        - to: West Lake > East 20
          tags: [xshift]
    - name: West Ledge
      coord: [27.35, 20.2]
      local:
        - to: West
          jumps: 2
        - to: Dur-Esla
        - to: West Platform
          jumps: 1
          jump_mvmt: water
    - name: Dur-Esla
      coord: [27.8, 20.8]
      local:
        - to: West Ledge
          jumps: 3
        - to: Midwest Rock
          jumps: 2
          jump_mvmt: water
      exits:
        - to: Below West Cache
          req: Nanite_Mist
          movement: mist2
          penalties:
            - add: 1  # kill Dur-Esla first
            - when: not Mist_Upgrade
              movement: mist1
    - name: West Platform
      coord: [27.65, 19.95]
      local:
        - to: Below West Cache
          jumps: 1
          jump_mvmt: water
        - to: West Ledge
        - to: Dur-Esla
          jumps_down: 1
      exits:
        - to: Midwest Rock
          req: Underwater_Movement
          movement: water
    - name: Below West Cache
      coord: [27.8, 19.8]
      local:
        - to: West Platform
      exits:
        - to: Cache
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Cache
          req: Slingshot_Hook
          movement: base
          jumps: 2
    - name: Cache
      coord: [27.75, 19.5]
      local:
        - to: Below West Cache
        - to: Midwest Rock
      locations:
        - name: Tablet
          item: Urgent_Message
          tags: [standing]
    - name: Midwest Rock
      coord: [28.1, 20.05]
      local:
        - to: Dur-Esla
        - to: Midwest Hook Point
        - to: West Platform
          jumps: 1
          jump_mvmt: water
      exits:
        - to: Cache
          req: $hook and (Underwater_Movement or Drone_Hover)
          movement: water
          jumps: 2
          penalties:
            - when: not Underwater_Movement
              movement: base
              jumps: 1
        - to: Cache
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Midwest Hook Point
      coord: [28.4, 20.1]
      local:
        - to: Gate East
          thru: [28.7, 20.3]
        - to: Middle Rock West
        - to: Midwest Rock
          jumps: 1
      exits:
        - to: West
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          jumps: 2
        - to: Portal Rock West
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          jumps: 3

    - name: Button
      coord: [28.25, 20.75]
      local:
        - to: South
      locations:
        - name: Hit Button
          item: Amagi_Wiggly_Room_Gate
          req: $can_damage
          tags: [button]
    - name: South
      coord: [28.5, 20.8]
      data:
        flipside: Amagi Breach > Twisty Passages > South
      local:
        - to: Button
          jumps: 1
      exits:
        - to: Uhrum > Tulip Tower > North
          tags: [ydoor]
        - to: Gate East
          req: Amagi_Wiggly_Room_Gate
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
    - name: Gate East
      coord: [28.7, 20.7]
      data:
        flipside: Amagi Breach > Twisty Passages > West Flora
      local:
        - to: Middle Rock West
          jumps: 1
      exits:
        - to: Button
          req: Amagi_Wiggly_Room_Gate
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: South
          req: Amagi_Wiggly_Room_Gate
          movement: water
          penalties:
            - when: not Underwater_Movement
              movement: base
        - to: Portal Rock West
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          jumps: 2
        - to: Midwest Hook Point
          req: Underwater_Movement and $hook
          movement: water
          jumps: 2
    - name: Middle Rock West
      coord: [28.85, 20.45]
      local:
        - to: Gate East
        - to: Middle Rock East
      exits:
        - to: Midwest Hook Point
          movement: fast_hover
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
              jumps: 1
            - when: not $hookhover
              movement: water
              jumps: 1
    - name: Middle Rock East
      coord: [29.25, 20.45]
      local:
        - to: Middle Rock West
        - to: Portal Rock West
          jumps: 1
      exits:
        - to: Midwest Hook Point
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          jumps: 1
    - name: Portal Rock West
      coord: [29.5, 20.4]
      local:
        - to: Middle Rock East
        - to: Portal Rock East
          jumps: 2
      exits:
        - to: East
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          jumps: 1
        - to: East Bottom
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          jumps: 1
    - name: Portal Rock East
      coord: [29.8, 20.05]
      local:
        - to: Portal Rock West
        - to: East Rock
        - to: East Chamber
      exits:
        - to: Midwest Hook Point
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          jumps: 1
        - to: Gate East
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          jumps: 1
    - name: Portal Hole
      coord: [29.6, 20.85]
    - name: East Chamber
      coord: [29.95, 20.9]
      data:
        flipside: Amagi Breach > Twisty Passages > Closed Chamber
      exits:
        - to: Portal Rock East
          req: Underwater_Movement and $hook
          movement: water
          jumps: 3
    - name: East Rock
      coord: [30.3, 20.3]
      local:
        - to: East
          jumps: 1
      exits:
        - to: Portal Rock East
          movement: fast_hover
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
              jumps: 1
            - when: not $hookhover
              movement: water
              jumps: 1
    - name: East Bottom
      coord: [30.5, 20.6]
      data:
        flipside: Amagi Breach > Twisty Passages > East Bottom
      local:
        - to: East
          jumps: 1
      exits:
        - to: East Rock
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
              jumps: 1
    - name: East
      coord: [30.95, 20.35]
      local:
        - to: East Bottom
      exits:
        - to: Divided Room > West
          tags: [xshift]
        - to: East
          req: Underwater_Movement and $hover
          movement: water
          jumps: 1

- name: Divided Room  # MARK: Divided Room
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Stand
  map:
    portal: [31, 19, 32, 20]
  datamap:
    map_spot:
      portal: Menu > Kiengir Map > Amagi Divided Room Portal
  spots:
    - name: East
      coord: [31.95, 20]
      exits:
        - to: Liru Room > West 20
          tags: [xshift]
        - to: Column East
          req: $hook or (Underwater_Movement and $grab)
          movement: water
          jumps: 1
          penalties:
            - when: not Underwater_Movement
              movement: base
              jumps: 1
            - when: not $hook
              jumps: 1
    - name: Column East
      coord: [31.6, 19.8]
      local:
        - to: East
        - to: Column West
      exits:
        - to: West
          req: Underwater_Movement and $hookhover
          movement: fast_hover
        - to: Wiggly Room > East Rock
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: Column West
      coord: [31.4, 19.8]
      local:
        - to: West
          jumps_down: 1
        - to: Column East
      exits:
        - to: East
          req: Underwater_Movement and $hookhover
          movement: fast_hover
        - to: Liru Room > Platform 3 Left
          req: Underwater_Movement and $hookhover
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: West
      coord: [31.05, 20.35]
      exits:
        - to: Column West
          movement: water
          jumps: 2
          penalties:
            - when: not Underwater_Movement
              movement: base
              jumps: 1
        - to: Wiggly Room > East
          tags: [xshift]

    - name: Portal Stand
      coord: [31.5, 19.4]
      data:
        flipside: Amagi Breach > Lower Hallway > Cache
      local:
        - to: Portal West
        - to: Portal East
    - name: Portal West
      coord: [31.3, 19.55]
      data:
        flipside: Amagi Breach > Lower Hallway > West Ledge
      exits:
        - to: Portal Stand
          movement: fast_hover
          jumps: 1
          penalties:
            - when: not $hook
              movement: base
    - name: Portal East
      coord: [31.8, 19.55]
      data:
        flipside: Amagi Breach > Lower Hallway > East Ledge
      exits:
        - to: Portal Stand
          movement: fast_hover
          jumps: 1
          penalties:
            - when: not $hook
              movement: base
    - name: Portal East Mid-air
      coord: [31.75, 19.4]
      data:
        flipside: SpotId::None
      exits:
        - to: Portal Stand
          movement: fast_hover
          penalties:
            - when: not $hook
              movement: base

    - name: Upper Left Corner
      coord: [31.1, 19.75]
      data:
        flipside: Amagi Breach > Lower Hallway > West
      exits:
        - to: Wiggly Room > East
          movement: water
          penalty_tags: [xshift, -base.1]
          penalties:
            - when: not Underwater_Movement
              movement: base
    - name: Upper Right Corner
      coord: [31.9, 19.7]
      data:
        flipside: Amagi Breach > Lower Hallway > Middle Bubbles
      exits:
        - to: Liru Room > West 20
          movement: water
          penalty_tags: [xshift, -base.1]
          penalties:
            - when: not Underwater_Movement
              movement: base
              tags: [base.1, -slow.1]

- name: Isolation  # MARK: Isolation
  on_entry: $reset_old_area(^newpos)
  data:
    save_point: Save Point
    portal_start: Portal Hole
    water: false
  map:
    save: [34, 20, 35, 21]
    portal: [35, 20, 36, 21]
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Amagi Isolation
      portal: Menu > Kiengir Map > Amagi Isolation Portal
  spots:
    - name: Portal Hole
      coord: [35.9, 20.25]
    - name: Empty Plinth
      coord: [35.625, 20.7]
      data:
        flipside: Amagi Breach > Divided > Save Point
      local:
        - to: Midway
    - name: Midway
      coord: [35.125, 20.75]
      data:
        flipside: Amagi Breach > Divided > Wall East
      local:
        - to: Empty Plinth
          jumps: 1
        - to: Save Point
          jumps: 1
    - name: Save Point
      coord: [34.5, 20.7]
      data:
        flipside: Amagi Breach > Divided > Empty Plinth
      local:
        - to: Midway
      actions:
        - name: Save
          do: $save
          tags: [save]
