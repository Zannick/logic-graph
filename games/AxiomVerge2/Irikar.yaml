name: Irikar

areas:
- name: Hub  # MARK: Hub
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Stand
    portal_hidden: true
    save_point: Save Point
  map:
    save: [12, 22, 13, 23]
    well: [12, 23, 13, 24]
    west25: [10, 24, 11, 25]
    royal: [12, 25, 13, 26]
    speech: [13, 21, 14, 22]
    broken_wall: [11, 25, 12, 26]
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Irikar Hub
      well: Menu > Kiengir Map > Irikar Well
      west25: Menu > Kiengir Map > Irikar 10,25
      royal: Menu > Kiengir Map > Irikar Royal Storage
      speech: Menu > Kiengir Map > Commemorative Speech
      broken_wall: Menu > Kiengir Map > Irikar Broken Wall
  spots:
    - name: Northwest
      coord: [11.0, 20.1]
      local:
        - to: West Rooftops Upper East
        - to: West Rooftops Upper Middle
        - to: West Small Middle Rooftop
    - name: North Above Portal
      coord: [11.3, 20.1]
      local:
        - to: Portal Stand
        - to: NW Middle Building Corner
        - to: West Rooftops Upper East
    - name: Northwest Above Bowl
      coord: [12.25, 20.1]
      local:
        - to: West Rim
        - to: Bowl Top Platform
        - to: NW Bowl Edifice
    - name: Northeast Above Bowl
      coord: [12.8, 20.1]
      local:
        - to: East Rim
        - to: Sat Tower West Valley

    #region The Bowl
    - name: West Rim
      coord: [12.2, 20.45]
      local:
        - to: Bowl Top Platform
        - to: NW Bowl Edifice
      exits:
        - to: East Rim
          req: $hover
          movement: base
        - to: East Rim
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
      actions:
        - name: Throw Drone Far East High
          req: $can_deploy and Drone_Hover
          to: Airy > Left Hover Throw End
          do: $deploy_drone
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
        - name: Throw Drone Far East Low
          req: $can_deploy and Drone_Hover
          to: Airy > Lower Throw End
          do: $deploy_drone
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
        - name: Throw Drone Further East and Low
          req: $can_deploy and Drone_Hover
          to: Airy > South Center
          do: $deploy_drone
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: East Rim
      coord: [12.8, 20.5]
      local:
        - to: Save Point
          jumps_down: 2
        - to: Bowl Hole
          jumps_down: 1
        - to: Sat Tower West Valley
      exits:
        - to: Sat Tower Roof West
          req: $hover
          movement: base
          jumps: 1
        - to: Airy > Right Hover Throw End
          req: $hover
          movement: base
          penalty_tags: [xshift, -base.1]
        - to: Airy > Lower Throw End
          movement: base
          penalty_tags: [xshift, -base.1]
        - to: West Rim
          req: $hover
          movement: base
          jumps: 1
        - to: West Rim
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
      actions:
        - name: Throw Drone Far East High
          req: $can_deploy and Drone_Hover
          to: Airy > Right Hover Throw End
          do: $deploy_drone
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
        - name: Throw Drone Far East Low
          req: $can_deploy and Drone_Hover
          to: Airy > South Center
          do: $deploy_drone
          movement: fast_hover
          penalty_tags: [xshift, -fast_hover.1]
    - name: Bowl Top Platform
      coord: [12.4, 20.85]
      local:
        - to: Bowl Middle Ledge
          jumps_down: 1
        - to: Bowl Hole
          jumps_down: 2
      exits:
        - to: West Rim
          req: $hook
          time: 0.7
    - name: Bowl Middle Ledge
      coord: [12.45, 21.45]
      local:
        - to: Bowl Middle Platform Center
      exits:
        - to: Bowl Top Platform
          req: $hook
          time: 1.6
    - name: Bowl Middle Platform Center
      coord: [12.5, 22.0]
      local:
        - to: Save Point
          jumps_down: 1
      exits:
        - to: Bowl Middle Ledge
          req: $hook
          time: 1  # ?
    - name: Bowl Middle Platform West
      coord: [12.35, 22.0]
      local:
        - to: Bowl Middle Platform Center
        - to: Save Point
          jumps_down: 1
      exits:
        - to: Bowl Middle Ledge
          req: $hook
          time: 1
    - name: Bowl Platform 3
      coord: [12.3, 22.25]
      local:
        - to: Save Point
      exits:
        - to: Bowl Middle Platform Center
          req: $hook
          time: 1.2
    - name: Save Point
      coord: [12.5, 22.75]
      data:
        flipside: Irikar Breach > Hover Room > Bottom
      local:
        - to: Bowl Platform 3
          jumps: 3
        - to: Bowl Hole
          thru: [[12.5, 22.4], [12.85, 22.4]]
          jumps: [2, 0, 0]
          jumps_down: [0, 0, 1]
      exits:
        - to: Bowl Hole
          req: $hook
          time: 1.4
      actions:
        - name: Save
          do: $save
          tags: [save]
    - name: Bowl Hole
      coord: [12.95, 22.65]
      local:
        - to: Save Point
          jumps: 2
        - to: Sat Tower Middle Ledge
          jumps: 1
    #endregion

    #region Satellite Tower
    - name: Sat Tower Roof West
      coord: [13.4, 20.5]
      local:
        - to: Sat Tower Roof East
        - to: Sat Tower West Valley
    - name: Sat Tower Roof East
      coord: [13.65, 20.5]
      local:
        - to: Sat Tower Roof West
        - to: Sat Tower Northeast
    - name: Sat Tower West Valley
      coord: [13.15, 21.2]
      local:
        - to: East Rim
          jumps: 5
        - to: Sat Tower Roof West
          jumps: 4
    - name: Sat Tower Northeast
      coord: [13.95, 20.7]
      exits:
        - to: Airy > Northwest
          tags: [xshift]
    - name: Sat Tower Middle Ledge
      coord: [13.4, 22.6]
      local:
        - to: Bowl Hole
        - to: Sat Tower Lower Right Ledge
        - to: Sat Tower Lower Left Ledge
      exits:
        - to: Sat Tower Floating Platform
          req: $hook
          time: 1.5
    - name: Sat Tower Floating Platform
      coord: [13.5, 22.05]
      local:
        - to: Sat Tower Middle Ledge
        - to: Sat Tower Lower Right Ledge
        - to: Sat Tower Lower Left Ledge
      exits:
        - to: Sat Tower Top Ledge
          req: $hook
          time: 1
    - name: Sat Tower Top Ledge
      coord: [13.55, 21.5]
      local:
        - to: Sat Tower Floating Platform
        - to: Sat Tower Lower Right Ledge
        - to: Sat Tower Lower Left Ledge
          thru: [13.6, 22.1]
      locations:
        - name: Tablet
          item: Commemorative_Speech
          tags: [standing]
    - name: Sat Tower Lower Right Ledge
      coord: [13.55, 23.1]
      local:
        - to: Sat Tower Lower Left Ledge
      # TODO: back up?
    - name: Sat Tower Lower Left Ledge
      coord: [13.5, 23.6]
      local:
        - to: Sat Tower Long Ledge
    - name: Sat Tower Long Ledge
      coord: [13.1, 24.2]
      data:
        flipside: Irikar Breach > Flappy Drone > Passage Corner
      local:
        - to: Sat Tower Bottom
    - name: Sat Tower Bottom
      coord: [13.4, 24.8]
      local:
        - to: Sat Tower East 24
          jumps: 2
    - name: Sat Tower East 24
      coord: [13.95, 24.55]
      exits:
        - to: Sight Room > West 24
          tags: [xshift]
    - name: Sat Tower Lower Exterior
      coord: [13.95, 23.1]
      exits:
        - to: Sight Room > Northwest
          tags: [xshift]
    #endregion

    #region Northwest Building/Portal
    - name: NW Bowl Edifice
      coord: [11.95, 20.5]
      local:
        - to: West Rim
          jumps: 1
        - to: NW Roof
          jumps: 1
        - to: NW Staircase Upper
    - name: NW Roof
      coord: [11.4, 20.4]
      local:
        - to: NW Bowl Edifice
        - to: NW Middle Building Corner
        - to: West Rooftops Upper East
    - name: NW Staircase Upper
      coord: [11.8, 20.9]
      local:
        - to: Portal Stand
          jumps_down: 2
        - to: NW Middle Building Corner
          jumps_down: 1
        - to: West Rooftops Upper East
      exits:
        - to: NW Bowl Edifice
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 2
    - name: Portal Stand
      coord: [11.3, 21.7]
      data:
        flipside: Irikar Breach > Gauntlet > Save Point
      local:
        - to: NW Staircase Upper
          jumps: 4
        - to: NW Middle Building Corner
    - name: NW Middle Building Corner
      coord: [11.0, 22.2]
      local:
        - to: NW Middle Building Broken Outcrop
        - to: NW Middle Building West Entry
        - to: NW Middle Building West Hook Point
        - to: West 25
          jumps_down: 2
    - name: NW Middle Building Broken Outcrop
      coord: [10.975, 22.6]
      local:
        - to: NW Middle Building West Entry
        - to: NW Middle Building Left Ledge
        - to: NW Middle Building West Hook Point
      exits:
        - to: NW Middle Building Corner
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: NW Middle Building West Hook Point
      coord: [10.9, 23.0]
      exits:
        - to: Ruined Hallway By Well
          req: $hook and $hover
          movement: fast_hover
        - to: Ruined Hallway Gap Left
          req: $hook and $hover
          movement: fast_hover
    - name: NW Middle Building West Entry
      coord: [10.95, 22.95]
      local:
        - to: NW Middle Building Left Ledge
        - to: NW Middle Building West Hook Point
        - to: West 25
          jumps_down: 2
      exits:
        - to: NW Middle Building East Entry
          req: $hover
          movement: base
    #endregion

    #region Royal Storage
    - name: Royal Storage South
      coord: [13.5, 25.8]
      data:
        flipside: Irikar Breach > Four-way > South
      local:
        - to: Dagger Altar
          jumps: 1
      exits:
        - to: Basement Portal > North
          tags: [ydoor]
    - name: Dagger Altar
      coord: [12.75, 25.6]
      local:
        - to: Royal Storage South
        - to: Royal Storage By Wall
      locations:
        - name: Weapon
          item: Royal_Dagger
          tags: [standing]
    - name: Royal Storage By Wall
      coord: [12.2, 25.7]
      data:
        flipside: Irikar Breach > Worm Rave > Corner
      local:
        - to: Dagger Altar
          jumps: 1
      locations:
        - name: Shockwave Just The Wall
          item: Irikar_Royal_Storage_Wall
          canon: Irikar_Royal_Storage_Wall
          req: $shockwave
          price: 100
          tags: [shockwave, event]
      exits:
        - to: Royal Storage in Wall
          req: Irikar_Royal_Storage_Wall
          movement: base
      hybrid:
        - name: Mist into Wall
          to: Royal Storage in Wall
          item: Irikar_Royal_Storage_Wall
          canon: Irikar_Royal_Storage_Wall
          req: not Irikar_Royal_Storage_Wall and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
          tags: [event]
      actions:
        # collects two items with two different canons at the same time?
        # if the item is a flask or urn, this will collect it
        # TODO: add a visit_collect/collect_from builtin
        - name: Shockwave Wall
          req: not Irikar_Royal_Storage_Wall and $shockwave
          do: >
            $collect(Irikar_Royal_Storage_Wall);
            $collect(Flask);
            $visit(`Irikar > Hub > Royal Storage in Wall > Item`);
            $visit(`Irikar > Hub > Royal Storage By Wall > Shockwave Just The Wall`);
          price: 100
          tags: [shockwave, event]
    - name: Royal Storage in Wall
      coord: [12.1, 25.7]
      local:
        - to: Royal Storage By Wall
      locations:
        - name: Item
          item: Flask
          canon: Irikar_Royal_Storage_Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Irikar_Royal_Storage_Flask
          item: Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Irikar_Royal_Storage_Flask
          item: Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
    #endregion

    #region SW Ruined Buildings
    - name: NW Middle Building Left Ledge
      coord: [11.2, 23.3]
      local:
        - to: NW Middle Building Lower Ledge
        - to: SW Building NE Roof
        - to: Lower Well
        - to: SW Building Broken Wall
      exits:
        - to: NW Middle Building East Entry
          req: $hover
          movement: base
        - to: NW Middle Building West Entry
          req: $hook or Anuman or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook and not Anuman
              jumps: 1
            - when: not $hook
              jumps: 0.1
    - name: NW Middle Building Lower Ledge
      coord: [11.35, 23.7]
      local:
        - to: SW Building NE Roof
        - to: SW Building Broken Wall
        - to: Lower Well
      exits:
        - to: NW Middle Building Left Ledge
          req: $hook
          movement: base
          jumps: 1
        - to: NW Middle Building East Entry
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: NW Middle Building East Entry
      coord: [11.6, 23.3]
      local:
        - to: NW Middle Building Lower Ledge
        - to: Ruined Hallway Gap Left
      exits:
        - to: NW Middle Building West Entry
          req: $hover
          movement: base
          jumps: 2
        - to: NW Middle Building Left Ledge
          req: $hover
          movement: base
    - name: SW Building NE Roof
      coord: [11.2, 23.9]
      local:
        - to: SW Building Broken Wall
        - to: Lower Well
        - to: NW Middle Building Lower Ledge
          jumps: 1
    - name: Ruined Hallway Gap Left
      coord: [12.15, 23.7]
      local:
        - to: Ruined Hallway Gap Right
        - to: Exposed Passage Upper Ledge
        - to: NW Middle Building East Entry
          thru: [11.85, 23.7]
          jumps: [0, 2]
      exits:
        - to: NW Middle Building East Entry
          req: $hook
          movement: base
          jumps: 1
    - name: Ruined Hallway Gap Right
      coord: [12.4, 23.7]
      local:
        - to: Ruined Hallway Gap Left
        - to: Exposed Passage Upper Ledge
        - to: Ruined Hallway By Well
    - name: Ruined Hallway By Well
      coord: [12.65, 23.7]
      local:
        - to: Ruined Hallway Gap Right
        - to: Ruined Hallway Atop Well
          jumps: 1
      locations:
        - name: Shockwave Well
          item: Flask
          canon: Irikar_Well_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
    - name: Ruined Hallway Atop Well
      coord: [12.8, 23.6]
      local:
        - to: Ruined Hallway By Well
      locations:
        - name: Well Item
          item: Flask
          canon: Irikar_Well_Flask
          tags: [flask]

    - name: SW Building Broken Wall
      coord: [11.2, 24.7]
      local:
        - to: Lower Well
        - to: SW Building Platform 2
          jumps: 1
        - to: SW Building Lower Platform
          jumps_down: 1
      exits:
        - to: Exposed Passage West
          req: $hover
          movement: base
        - to: Exposed Passage Center
          req: $hover
          movement: base
          jumps: 2
        - to: NW Middle Building Left Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: SW Building Top Platform
      coord: [10.95, 24.35]
      local:
        - to: SW Building Platform 2
          jumps_down: 1
        - to: SW Building Lower Platform
          jumps_down: 3
      locations:
        - name: Power Core
          item: Power_Core
          req: $more_refills
          tags: [standing]
    - name: SW Building Platform 2
      coord: [11.05, 24.6]
      local:
        - to: SW Building Top Platform
          jumps: 1
        - to: SW Building Lower Platform
          jumps_down: 2
        - to: SW Building Broken Wall
      exits:
        - to: Exposed Passage West
          req: $hover
          movement: base
        - to: Exposed Passage Center
          req: $hover
          movement: base
          jumps: 1
    - name: SW Building Lower Platform
      coord: [10.75, 25.15]
      local:
        - to: SW Building Platform 2
          jumps: 4
        - to: SW Building Hallway West
          jumps_down: 1
    - name: SW Building Hallway West
      coord: [10.2, 25.4]
      data:
        flipside: Irikar Breach > Gauntlet > Lower West Ledge
      local:
        - to: SW Building Lower Platform
          jumps: 2
        - to: Lower Hallway West
        - to: West 26
          jumps: 1

    - name: Lower Well
      coord: [11.55, 25.15]
      local:
        - to: Collapsed Column
        - to: Collapsed Column Debris
        - to: SW Building Broken Wall
          jumps: 3
      exits:
        - to: Exposed Passage West
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: Exposed Passage West
      coord: [11.6, 24.8]
      local:
        - to: Lower Well
        - to: Exposed Passage Center
          jumps: 3
      exits:
        - to: SW Building Broken Wall
          req: $hover
          movement: base
          jumps: 1
        - to: NW Middle Building Left Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Exposed Passage Center
      coord: [12.1, 24.6]
      local:
        - to: Exposed Passage West
      exits:
        - to: Exposed Passage Upper Ledge
          req: $hook or (Anuman and $grab)
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: Exposed Passage Upper Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Exposed Passage Upper Ledge
      coord: [12.25, 24.2]
      local:
        - to: Exposed Passage Center
      exits:
        - to: Ruined Hallway Gap Left
          req: $hook or $climb
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 2
        - to: Ruined Hallway Gap Right
          req: $hook or $climb
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: Ruined Hallway Gap Left
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Ruined Hallway Gap Right
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1

    - name: Collapsed Column
      coord: [11.925, 25.625]
      local:
        - to: Collapsed Column Debris
      # A location is necessary for the required_locations part of the search algorithm
      # But it needs to prevent the action from being performed as well
      locations:
        - name: Shockwave to Get Item
          item: Flask
          canon: Irikar_Royal_Storage_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
      exits:
        - to: Lower Well
          req: $hook and $hover
          movement: base
          jumps: 2
      actions:
        # collects two items with two different canons at the same time
        # if the item is a flask or urn, this will collect it
        - name: Shockwave Wall
          req: not Irikar_Royal_Storage_Wall and $shockwave and not $visited(`Irikar > Hub > Collapsed Column > Shockwave to Get Item`)
          do: >
            $collect(Irikar_Royal_Storage_Wall);
            $collect(Flask);
            $visit(`Irikar > Hub > Royal Storage in Wall > Item`);
            $visit(`Irikar > Hub > Royal Storage By Wall > Shockwave Just The Wall`);
          price: 100
          tags: [shockwave, event]

    - name: Collapsed Column Debris
      coord: [11.8, 25.7]
      local:
        - to: Collapsed Column
          jumps: 1
        - to: Lower Hallway West
      exits:
        - to: Lower Well
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
      actions:
        - name: Throw Drone and Hover
          req: $can_deploy and Drone_Hover
          do: $deploy_drone
          to: Lower Hallway West
          movement: fast_hover
    - name: Lower Hallway West
      coord: [10.2, 25.8]
      local:
        - to: Collapsed Column Debris
          jumps: 2
      exits:
        - to: West 26
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: SW Building Hallway West
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: West 26
      coord: [10.05, 25.35]
      local:
        - to: SW Building Hallway West
        - to: Lower Hallway West
      exits:
        - to: Midwest > East 26
          tags: [xshift]
    #endregion

    #region West Rooftops
    - name: West 25
      coord: [10.05, 24.25]
      local:
        - to: West Rooftop 1
      exits:
        - to: Midwest > East 25
          tags: [xshift]
        - to: West Rooftop 2
          req: $grab
          movement: base
          jumps: 3
    - name: West Rooftop 1
      coord: [10.5, 24.35]
      local:
        - to: West 25
          jumps: 1
        - to: West Rooftop 2
          jumps: 3
    - name: West Rooftop 2
      coord: [10.65, 23.8]
      local:
        - to: West 25
          jumps_down: 1
        - to: West Rooftop 1
          jumps_down: 1
        - to: West 24 Ground
          jumps: 2
        - to: West Rooftop 3
          jumps: 2
    - name: West Rooftop 3
      coord: [10.8, 23.5]
      local:
        - to: West 24 Ground
        - to: West Rooftop 2
          jumps_down: 2
        - to: West 25
          jumps_down: 2
        - to: NW Middle Building West Hook Point
          jumps: 2
        - to: NW Middle Building West Entry
          jumps: 2
      exits:
        - to: West 24 Rooftop
          req: $hover or Anuman
          movement: base
          jumps: 1
        - to: West Small Middle Rooftop
          req: $hover or Anuman
          movement: base
          jumps: 2
    - name: West 24 Ground
      coord: [10.05, 23.7]
      local:
        - to: West Rooftop 2
        - to: West Rooftop 3
          jumps: 2
      exits:
        - to: Midwest > East 24 on Floor
          tags: [xshift]
    - name: West 24 Rooftop
      coord: [10.05, 23.3]
      local:
        - to: West Small Middle Rooftop
          jumps: 2
        - to: West Rooftop 3
      exits:
        - to: Midwest > East 24 on Building
          tags: [xshift]
    - name: West Small Middle Rooftop
      coord: [10.5, 23.1]
      local:
        - to: West 24 Rooftop
        - to: West 24 Ground
          jumps_down: 1
        - to: West Rooftop 3
        - to: West 23
          jumps: 2
        - to: West Rooftops Upper Staircase
          jumps: 5
        - to: West 25
          thru: [10.35, 23.85]
          jumps_down: [2, 0]
      exits:
        - to: NW Middle Building West Hook Point
          req: $hover
          movement: base
          jumps: 1
        - to: NW Middle Building West Entry
          req: $hover
          movement: base
          jumps: 1
        - to: NW Middle Building West Entry
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: NW Middle Building Corner
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: West 23
      coord: [10.05, 22.8]
      exits:
        - to: Midwest > East 23
          tags: [xshift]
    - name: West Rooftops Upper Staircase
      coord: [10.4, 22.3]
      local:
        - to: West 23
        - to: West Rooftops Upper Middle
          jumps: 2
      exits:
        - to: West Rooftops Upper East
          req: $hover
          movement: base
          jumps: 2
    - name: West Rooftops Upper Middle
      coord: [10.45, 21.9]
      local:
        - to: West 23
        - to: West Rooftops Upper Staircase
          jumps_down: 1
        - to: West Rooftops Upper East
    - name: West Rooftops Upper East
      coord: [10.8, 22.0]
      local:
        - to: West Rooftops Upper Middle
          jumps: 1
        - to: West Rooftops Upper Staircase
        - to: West 24 Rooftop
        - to: West Small Middle Rooftop
          jumps_down: 1
        - to: West 25
          jumps_down: 4
    #endregion

- name: Airy  # MARK: Airy
  on_entry: $reset_old_area(^newpos)
  map:
    flask: [15, 20, 16, 21]
  datamap:
    map_spot:
      flask: Menu > Kiengir Map > Irikar Airy Flask
  spots:
    - name: Northwest
      coord: [14.05, 20.7]
      local:
        - to: South Sight
        - to: Lower Throw End
    - name: South Sight
      coord: [14.65, 22.9]
      exits:
        - to: Sight Room > Above Room North
          tags: [yshift]
    - name: Left Hover Throw End
      coord: [14.4, 20.8]
      local:
        - to: South Center
      exits:
        - to: Cavern Mouth
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Right Hover Throw End
      coord: [15.05, 21.1]
      exits:
        - to: Cavern Mouth
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: East Rooftops > Top Rooftop
          movement: base
          penalty_tags: [yshift, -fall.2]
        - to: Boss Room > Healthy Rooftop
          movement: base
          penalty_tags: [yshift, -fall.2, yshift, -fall.2]
    - name: Lower Throw End
      coord: [14.4, 22.6]
      exits:
        - to: South Sight
          req: $hover
          movement: base
        - to: Sight Room > Portal
          movement: base
          penalty_tags: [yshift, -fall.2]
        - to: Sight Room > Item Pedestal
          movement: base
          penalty_tags: [yshift, -fall.2]
    - name: Cavern Mouth
      coord: [15.7, 21.15]
      local:
        - to: Cavern Side
          jumps: 1
        - to: Cavern Cache
          jumps: 2
      exits:
        - to: Cavern Cache
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: East Rooftops > Top Rooftop
          movement: base
          penalty_tags: [yshift, -fall.2]
        - to: East Rooftops > Off the Edge
          movement: base
          penalty_tags: [yshift, -fall.2]
        - to: Giguna > Breachable Wall > West Ledge
          req: $hover
          movement: base
          penalty_tags: [xshift, -base.1, yshift, -fall.2]
    - name: Cavern Side
      coord: [15.8, 21.0]
      local:
        - to: Cavern Mouth
        - to: Cavern Cache
          jumps: 1
      locations:
        - name: Remote Flask
          item: Big_Flask
          canon: Irikar_Airy_Flask
          req: $boomerang
          tags: [remote_flask]
    - name: Cavern Cache
      coord: [15.65, 20.85]
      local:
        - to: Cavern Mouth
        - to: Cavern Side
      locations:
        - name: Flask
          item: Big_Flask
          canon: Irikar_Airy_Flask
          tags: [flask]
        - name: Shockwave Flask
          item: Big_Flask
          canon: Irikar_Airy_Flask
          req: $shockwave
          price: 100
          tags: [shockwave]
        - name: Flask Collection Skip
          item: Big_Flask
          canon: Irikar_Airy_Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          item: Big_Flask
          canon: Irikar_Airy_Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
    - name: South Center
      coord: [15.0, 22.9]
      exits:
        - to: East Rooftops > Top Rooftop
          movement: base
          penalty_tags: [yshift, -fall.2]

- name: Sight Room  # MARK: Sight Room
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal
    portal_hidden: true
  map:
    urn: [14, 25, 15, 26]
  datamap:
    map_spot:
      urn: Menu > Kiengir Map > Breach Sight
  spots:
    - name: West 24
      coord: [14.05, 24.55]
      local:
        - to: Lower Ledge
      exits:
        - to: Hub > Sat Tower East 24
          tags: [xshift]
    - name: Lower Ledge
      coord: [14.25, 24.75]
      local:
        - to: West 24
          jumps: 1
        - to: Portal
        - to: Item Pedestal
    - name: Portal
      coord: [14.525, 25.35]
      data:
        flipside: Irikar Breach > Save Room > Save Point
      local:
        - to: Item Pedestal
    - name: Item Pedestal
      coord: [14.8, 25.6]
      local:
        - to: Portal
          jumps: 2
      locations:
        - name: Urn
          item: Breach_Sight
          canon: Breach_Sight
          tags: [urn]
      hybrid:
        - name: Urn Collection Skip
          item: Breach_Sight
          canon: Breach_Sight
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Urn Fast Travel
          item: Breach_Sight
          canon: Breach_Sight
          req: Fast_Travel
          to: Menu > Kiengir Map > Breach Sight
          tags: [cskip]

    - name: Above Room North
      coord: [14.65, 23.1]
      local:
        - to: Above Room East
    - name: Above Room East
      coord: [14.95, 23.4]
      exits:
        - to: East Rooftops > Upper West
          tags: [xshift]
    - name: Northwest
      coord: [14.05, 23.1]
      local:
        - to: Portal
        - to: Item Pedestal
      exits:
        - to: Above Room East
          req: $hover
          movement: base

- name: Abandoned Room  # MARK: Abandoned Room
  on_entry: $reset_old_area(^newpos)
  data:
    map_spot: Menu > Kiengir Map > Irikar Abandoned Room
  spots:
    - name: Empty Pedestal
      coord: [14.525, 26.7]
      data:
        flipside: Irikar Breach > Exit Corridor > Portal Stand
      local:
        - to: Corner Core
        - to: West
    - name: Corner Core
      coord: [14.8, 26.7]
      local:
        - to: Empty Pedestal
      locations:
        - name: Core
          item: Power_Core
          req: $more_refills
          tags: [standing]
    - name: West
      coord: [14.05, 26.8]
      local:
        - to: Empty Pedestal
          jumps: 1
      exits:
        - to: Basement Portal > East 27
          tags: [xshift]

- name: Basement Portal  # MARK: Basement Portal
  on_entry: $reset_old_area(^newpos)
  data:
    portal_start: Portal Stand
    portal_hidden: true
  reset:
    _platform_moved: false
  spots:
    - name: East 27
      coord: [13.95, 26.8]
      local:
        - to: Ledge
      exits:
        - to: Abandoned Room > West
          tags: [xshift]
    - name: Ledge
      coord: [12.7, 26.9]
      local:
        - to: East 27
          jumps: 1
        - to: Portal Stand
        - to: West 28
        - to: Bottom Middle
      exits:
        - to: Moving Platform Start
          req: not ^_platform_moved
          movement: base
        - to: Westmost Platform
          req: $hover
          movement: base
          jumps: 1
        - to: East Platform
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Moving Platform Start
      coord: [12.3, 27.2]
      local:
        - to: East 28
        - to: Portal Stand
      exits:
        - to: Ledge
          req: $hook
          time: 1.2  # ?
      actions:
        - name: Activate Platform
          req: $activate
          do: ^_platform_moved = true
          to: Moving Platform End
          time: 8  #y=.9, x=.7
          tags: [hack]
    - name: Moving Platform End
      coord: [13.0, 26.3]
      local:
        - to: Ledge
        - to: East 27
      exits:
        - to: East Platform
          req: $hover
          movement: base
    - name: Westmost Platform
      coord: [12.3, 26.6]
      local:
        - to: Middle Platform
          jumps: 1
        - to: West 28
          jumps_down: 1
        - to: Portal Stand
        - to: Bottom Middle
    - name: Middle Platform
      coord: [12.6, 26.5]
      local:
        - to: East 27
        - to: Ledge
          jumps_down: 1
        - to: Portal Stand
          jumps_down: 1
        - to: West 28
          jumps_down: 1
        - to: Bottom Middle
          jumps_down: 1
      exits:
        - to: East Platform
          req: $hover  # TODO: does this work?
          movement: base
          jumps: 1
        - to: Moving Platform End
          req: ^_platform_moved and $hook
    - name: East Platform
      coord: [13.5, 26.35]
      local:
        - to: North
          jumps: 1
        - to: East 27
        - to: Ledge
    - name: North
      coord: [13.5, 26.2]
      data:
        flipside: SpotId::None
      local:
        - to: East Platform
        - to: Ledge
        - to: East 27
      exits:
        - to: Hub > Royal Storage South
          tags: [ydoor]
    - name: Portal Stand
      coord: [12.525, 27.5]
      data:
        flipside: Irikar Breach > Basement Save > Save Point
      local:
        - to: West 28
        - to: Bottom Middle
      exits:
        - to: Moving Platform Start
          req: not ^_platform_moved
          movement: base
          jumps: 1
        - to: Ledge
          req: $hover and $hook
          time: 1  # ?
    - name: West 28
      coord: [12.05, 27.55]
      local:
        - to: Portal Stand
          jumps: 1
      exits:
        - to: Moving Platform Start
          req: $hook
          time: 1  # ?
        - to: Basement Pipes > East 28
          tags: [xshift]
    - name: Bottom Middle
      coord: [13.0, 27.55]
      local:
        - to: Portal Stand
          jumps: 1
        - to: East 28
          jumps: 2
      exits:
        - to: Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: East 28
      coord: [13.95, 27.7]
      local:
        - to: Bottom Middle
          jumps: 2
      exits:
        - to: Empty Foyer > West
          tags: [xshift]
        - to: Ledge
          req: $hover and $hook and Nanite_Mist
          time: 4.8  # ?
          penalties:
            - when: not Mist_Upgrade
              add: 0.75  # ?

- name: Basement Pipes  # MARK: Basement Pipes
  on_entry: $reset_old_area(^newpos)
  map:
    tablet: [10, 26, 11, 27]
    core: [10, 27, 11, 28]
  datamap:
    map_spot:
      tablet: Menu > Kiengir Map > The Student
      core: Menu > Kiengir Map > Irikar Basement Core
  spots:
    - name: East 28
      coord: [11.95, 27.55]
      local:
        - to: Lower Pipe Right
          jumps: 1
      exits:
        - to: Basement Portal > West 28
          tags: [xshift]
    - name: Lower Pipe Right
      coord: [11.7, 27.4]
      local:
        - to: Lower Pipe Under Ledge
        - to: East 28
    - name: Lower Pipe Under Ledge
      coord: [11.3, 27.4]
      local:
        - to: Lower Pipe Right
      exits:
        - to: Brick Ledge
          req: $hook or $climb
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
    - name: Brick Ledge
      coord: [11.2, 26.95]
      local:
        - to: Lower Pipe Under Ledge
        - to: Bricks Under Pipes
    - name: Bricks Under Pipes
      coord: [11.5, 26.95]
      local:
        - to: Brick Ledge
      exits:
        - to: Double Pipe Right
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: Double Pipe Right
      coord: [11.5, 26.6]
      local:
        - to: Double Pipe Left
        - to: Bricks Under Pipes
    - name: Double Pipe Left
      coord: [11.0, 26.6]
      local:
        - to: Left Vertical Pipe
        - to: Right Vertical Pipe
        - to: Double Pipe Right
      exits:
        - to: High Pipe
          req: $hover and $hook
          movement: base
          jumps: 1
    - name: Right Vertical Pipe
      coord: [10.9, 27.15]
      local:
        - to: Left Vertical Pipe
      exits:
        - to: Double Pipe Left
          req: $hook or $grab or Anuman
          movement: base
          jumps: 2
          penalties:
            - when: not $hook and not Anuman and not Wall_Climb
              jumps: 2
            - when: not $hook and not Anuman
              jumps: 1
    - name: Left Vertical Pipe
      coord: [10.45, 27.35]
      local:
        - to: West 28
        - to: Right Vertical Pipe
          thru: [10.85, 27.35]
          jumps: [0, 1]
      locations:
        - name: Health Pickup
          item: Power_Core
          req: $more_refills
          tags: [standing]
    - name: West 28
      coord: [10.05, 27.6]
      local:
        - to: Left Vertical Pipe
          jumps: 3
      exits:
        - to: Midwest > East 28
          tags: [xshift]
    - name: West 27
      coord: [10.05, 26.35]
      local:
        - to: High Pipe
      exits:
        - to: Midwest > East 27
          tags: [xshift]
    - name: High Pipe
      coord: [10.2, 26.4]
      local:
        - to: West 27
          jumps: 1
        - to: Left Vertical Pipe
        - to: West 28
          thru: [10.275, 26.5]
        - to: Right Vertical Pipe
          thru: [10.85, 27.25]
          jumps: [0, 1]
      locations:
        - name: Tablet
          item: The_Student
          tags: [standing]

- name: Empty Foyer  # MARK: Empty Foyer
  on_entry: $reset_old_area(^newpos)
  spots:
    - name: West
      coord: [14.05, 27.7]
      local:
        - to: East
      exits:
        - to: Basement Portal > East 28
          tags: [xshift]
    - name: East
      coord: [14.95, 27.7]
      local:
        - to: West
      exits:
        - to: Boss Room > West 28
          tags: [xshift]

- name: Boss Room  # MARK: Boss Room
  on_entry: $reset_old_area(^newpos)
  map:
    gudam: [15, 27, 16, 28]
    health: [15, 26, 16, 27]
  datamap:
    map_spot:
      gudam: Menu > Kiengir Map > Irikar Gudam
      health: Menu > Kiengir Map > Irikar Gudam Health
  spots:
    - name: West 28
      coord: [15.05, 27.7]
      local:
        - to: Bull's Feet
      exits:
        - to: Empty Foyer > East
          tags: [xshift]
    - name: Bull's Feet
      coord: [15.8, 27.7]
      local:
        - to: West 28
        - to: East 28
      # TODO: wall climb
      locations:
        - name: Defeat Gudam
          item: Irikar_Gudam
          canon: Irikar_Gudam
          req: $can_damage
          time: 7  # including 3s explode animation
          penalties:
            - when: not $boomerang2 or not Ranged_Damage_3 or not $weapon or not Melee_Damage_3 or not Melee_Speed_3
              add: 13
        - name: Defeat Gudam With Strong Drone
          item: Irikar_Gudam
          canon: Irikar_Gudam
          req: ^mode == 'drone' and Drone_Melee_Damage_3 and Drone_Melee_Speed_2 and Infect
          price: 100
          time: 10
        - name: Shockwave Gudam
          item: Irikar_Gudam
          canon: Irikar_Gudam
          req: $shockwave
          price: 200
          time: 1
          penalty_tags: [shockwave, shockwave]
        - name: Boss Reward
          item: Big_Flask
          canon: Irikar_Gudam_Flask
          req: Irikar_Gudam
          tags: [flask]
        - name: Shockwave Boss Reward
          item: Big_Flask
          canon: Irikar_Gudam_Flask
          req: Irikar_Gudam and $shockwave
          price: 100
          tags: [shockwave]
      # TODO: is it possible to climb up as drone?
    - name: East 28
      coord: [16.95, 27.7]
      local:
        - to: Bull's Feet
      exits:
        - to: Lamassu > West 28
          tags: [xshift]

    - name: Northwest
      coord: [15.2, 25.1]
      local:
        - to: West 28
          thru: [15.15, 27.5]
    - name: Upper Rooftops
      coord: [15.6, 25.1]
      local:
        - to: West 28
          jumps_down: 3
        - to: Bull's Feet
          jumps_down: 3
        - to: Healthy Rooftop
        - to: Sat Tower Roof West
      exits:
        - to: East Rooftops > Off the Edge
          req: $hover or Nanite_Mist
          tags: [yshift]
    - name: Healthy Rooftop
      coord: [15.85, 26.05]
      local:
        - to: West 28
          jumps_down: 2
        - to: Bull's Feet
          jumps_down: 2
        - to: Sat Tower Roof West
        - to: East 28
      locations:
        - name: Health
          item: Health_Fragment
          tags: [standing]
    - name: Sat Tower Roof West
      coord: [16.25, 26.15]
      local:
        - to: Healthy Rooftop
          jumps: 1
        - to: Sat Tower Roof East
        - to: West 28
          jumps_down: 1
        - to: Bull's Feet
          jumps_down: 1
    - name: Sat Tower Roof East
      coord: [16.45, 26.15]
      local:
        - to: Sat Tower Roof West
        - to: Bull's Feet
          jumps_down: 1
        - to: East 28
    - name: Catwalk West
      coord: [16.55, 25.7]
      local:
        - to: Catwalk East
        - to: Healthy Rooftop
        - to: Sat Tower Roof West
        - to: Sat Tower Roof East
      exits:
        - to: Upper Rooftops
          req: $hover
          movement: base
          jumps: 3
    - name: Catwalk East
      coord: [16.95, 25.7]
      local:
        - to: Catwalk West
        - to: Bull's Feet
          jumps_down: 1
      exits:
        - to: Lamassu > Catwalk West
          tags: [xshift]
    - name: Above Catwalk
      coord: [16.55, 25.1]
      local:
        - to: Healthy Rooftop
        - to: Sat Tower Roof West

- name: East Rooftops  # MARK: East Rooftops
  on_entry: $reset_old_area(^newpos)
  map:
    tablet: [15, 24, 16, 25]
  datamap:
    map_spot:
      tablet: Menu > Kiengir Map > Heretic's Granddaughter
  spots:
    - name: Upper West
      coord: [15.05, 23.4]
      local:
        - to: Top Rooftop
        - to: Off the Edge
      exits:
        - to: East Mid-air
          req: $hover
          movement: base
    - name: Top Rooftop
      coord: [15.2, 24.65]
      local:
        - to: Directly Down
          jumps_down: 1
        - to: Off the Edge
      locations:
        - name: Tablet
          item: Heretics_Granddaughter
          tags: [standing]
    - name: Directly Down
      coord: [15.2, 24.9]
      exits:
        - to: Boss Room > Northwest
          tags: [yshift]
    - name: Off the Edge
      coord: [15.6, 24.9]
      exits:
        - to: Top Rooftop
          req: $hover
          movement: base
          jumps: 2
        - to: Top Rooftop
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Boss Room > Upper Rooftops
          tags: [yshift]
    - name: East Mid-air
      coord: [15.95, 24.0]
      local:
        - to: Off the Edge
      exits:
        - to: Top Rooftop
          req: $hover
          movement: base
          jumps: 1
        - to: Giguna > Breachable Wall > West Mid-air
          tags: [xshift]

- name: Midwest  # MARK: Midwest
  on_entry: $reset_old_area(^newpos)
  map:
    save: [9, 24, 10, 25]
    corner: [7, 22, 8, 23]
    tablet: [7, 25, 8, 26]
  data:
    save_point: Save Point
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Irikar Midwest
      corner: Menu > Kiengir Map > Irikar Mid-air Flask
      tablet: Menu > Kiengir Map > Freedom from A'ansur
  start:
    _left_platform: false
    _right_platform: false
  spots:
    - name: East 23
      coord: [9.95, 22.8]  # Arbitrary positioning, just so it's possible to go directly
      local:
        - to: Small Rooftop
        - to: NE Ledge
    - name: East 24 on Building
      coord: [9.95, 23.3]
      local:
        - to: Small Rooftop
        - to: NE Ledge
      exits:
        - to: Hub > West 24 Rooftop
          tags: [xshift]
    - name: East 24 on Floor
      coord: [9.95, 23.7]
      local:
        - to: Small Rooftop
          jumps: 1
        - to: NE Ledge
          jumps: 2
      exits:
        - to: Hub > West 24 Ground
          tags: [xshift]
    - name: Small Rooftop
      coord: [9.3, 23.6]
      local:
        - to: East 24 on Building
          jumps: 2
        - to: East 24 on Floor
          jumps: 1
        - to: NE Ledge
          jumps_down: 1
      exits:
        - to: Left Platform Start
          req: $hover
          movement: base
          jumps: 1
        - to: Right Platform Start
          req: not ^_right_platform and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: NE Ledge
      coord: [9.25, 23.85]
      local:
        - to: East 24 on Floor
          jumps: 2
        - to: Small Rooftop
          jumps: 2
        - to: Save Ledge
        - to: Center Rock 1 East
        - to: Center Rock 3 West
      exits:
        - to: Left Platform Start
          req: $hover and $hook and not ^_left_platform
          movement: base
          jumps: 1

    - name: Left Platform Start
      coord: [8.3, 23.5]
      local:
        - to: Center Rock 1 East
        - to: Center Rock 2 West
      exits:
        - to: Right Platform Start
          req: Nanite_Mist and not ^_right_platform
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
      actions:
        - name: Hack and Ride
          req: not ^_left_platform and $activate
          to: Left Platform Dest
          do: ^_left_platform = true
          time: 13  # ?
          tags: [hack]
    - name: Left Platform Dest
      coord: [7.15, 22.6]
      local:
        - to: Right Platform Start
          jumps: 1
        - to: Lower East Platform
        - to: West 28 Platform
      locations:
        - name: Shockwave Flask
          canon: Irikar_Midwest_Flask
          item: Big_Flask
          tags: [shockwave]
    - name: Right Platform Start
      coord: [7.25, 22.4]
      local:
        - to: Lower East Platform
        - to: West 28 Platform
        - to: Center Rock 2 East
        - to: Tablet Platform
      locations:
        - name: Flask
          canon: Irikar_Midwest_Flask
          item: Big_Flask
          tags: [flask]
        - name: Flask Collection Skip
          canon: Irikar_Midwest_Flask
          item: Big_Flask
          req: $melee_cskip
          to: Menu > Warp Only > Kiengir
          tags: [cskip]
        - name: Flask Fast Travel
          canon: Irikar_Midwest_Flask
          item: Big_Flask
          req: $melee_cskip and Fast_Travel
          to: ^map_spot
          tags: [cskip]
      actions:
        - name: Hack and Ride Platform
          req: not ^_right_platform and $activate
          to: Right Platform Dest
          do: ^_right_platform = true
          time: 20  # ?
    - name: Right Platform Dest
      coord: [9.45, 23.2]
      local:
        - to: NE Ledge
          jumps_down: 1
        - to: Small Rooftop
        - to: East 24 on Building
        - to: East 24 on Floor

    - name: East 25
      coord: [9.95, 24.25]
      local:
        - to: Save Point
      exits:
        - to: Hub > West 25
          tags: [xshift]
    - name: Save Point
      coord: [9.5, 24.6]
      local:
        - to: Save Ledge
      exits:
        - to: East 25
          req: $hook or $grab
          movement: base
          jumps: 2
          penalties:
            - when: not $hook
              jumps: 1
        - to: NE Ledge
          req: $hook and $hover
          movement: base
          jumps: 3
        - to: NE Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
      actions:
        - name: Save
          do: $save
          tags: [save]
    - name: Save Ledge
      coord: [9.3, 24.8]
      local:
        - to: Save Point
          jumps: 1
        - to: Center Rock 1 East
          jumps: 2
        - to: Center Rock 3 East
        - to: Center Rock 3 West
        - to: East Rock 1
          thru: [9.25, 24.85]
    - name: Center Rock 1 East
      coord: [8.8, 24.6]
      local:
        - to: Center Rock 1 West
          jumps: 1
        - to: Save Ledge
        - to: East Rock 1
        - to: The Long Rock East
      exits:
        - to: Left Platform Start
          req: not ^_left_platform and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Center Rock 1 West
      coord: [8.45, 24.55]
      local:
        - to: Center Rock 1 East
        - to: Center Rock 2 East
      exits:
        - to: Right Platform Start
          req: not ^_right_platform and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Center Rock 2 East
      coord: [8.3, 24.75]
      local:
        - to: Center Rock 3 West
        - to: Center Rock 1 West
          jumps: 1
        - to: Center Rock 2 West
        - to: Center Small Rock
      exits:
        - to: Right Platform Start
          req: not ^_right_platform and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Save Point
          req: $hook and $hover
          movement: fast_hover
          jumps: 1
    - name: Center Rock 2 West
      coord: [7.85, 24.95]
      local:
        - to: Center Rock 2 East
          jumps: 2
        - to: Tablet Platform
      exits:
        - to: Right Platform Start
          req: not ^_right_platform and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Center Rock 3 West
      coord: [8.45, 25.05]
      local:
        - to: Center Small Rock
        - to: Center Rock 3 East
      exits:
        - to: Save Ledge
          req: $hover
          movement: base
          jumps: 1
        - to: Center Rock 2 East
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: Center Rock 3 East
      coord: [8.9, 25.3]
      local:
        - to: Center Rock 3 West
          jumps: 1
        - to: East Rock 1
        - to: The Long Rock East
      exits:
        - to: Save Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: Tablet Platform
      coord: [7.65, 25.3]
      local:
        - to: West 28 Platform
        - to: The Long Rock West
          jumps_down: 1
        - to: The Long Rock Middle
      locations:
        - name: Tablet
          item: Freedom_from_Aansur
          tags: [standing]
      exits:
        # This is made slightly harder due to enemy aggro, maybe add extra?
        - to: Right Platform Start
          req: not ^_right_platform and Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
        - to: Beach Save > Partway Up
          req: $hover
          movement: base
          penalty_tags: [xshift, -base.1]
    - name: Center Small Rock
      coord: [8.35, 25.2]
      local:
        - to: The Long Rock East
        - to: The Long Rock Middle
        - to: Center Rock 3 West
          jumps: 1
      exits:
        - to: Center Rock 2 East
          req: $hook
          movement: base
          jumps: 2

    - name: The Long Rock West
      coord: [8.55, 25.65]
      local:
        - to: West Platform
        - to: West 28 Platform
        - to: Tablet Platform
          jumps: 2
        - to: The Long Rock Middle
          jumps: 2
    - name: The Long Rock Middle
      coord: [9.0, 25.4]
      local:
        - to: The Long Rock West
        - to: Tablet Platform
          jumps: 2
        - to: The Long Rock East
        - to: Center Small Rock
          jumps: 1
    - name: The Long Rock East
      coord: [9.2, 26.0]
      local:
        - to: The Long Rock Middle
          jumps: 5
        - to: Lower East Platform
        - to: East Rock 3
          jumps: 1
      exits:
        - to: East Rock 2
          req: $hook
          movement: base
          jumps: 2

    - name: East Rock 1
      coord: [9.3, 25.4]
      local:
        - to: The Long Rock Middle
          jumps: 4
        - to: East Rock 2
        - to: East 27
      exits:
        - to: Save Ledge
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: East Rock 2
      coord: [9.55, 25.55]
      local:
        - to: East Rock 1
          jumps: 1
        - to: East 26
          jumps: 1
        - to: The Long Rock East
        - to: East Rock 3
        - to: East 27
    - name: East Rock 3
      coord: [9.4, 25.95]
      local:
        - to: The Long Rock East
        - to: Lower East Platform
        - to: East 27
      exits:
        - to: East Rock 1
          req: $hook
          movement: base
          jumps: 2
        - to: East Rock 2
          req: $hook
          movement: base
          jumps: 1
    - name: Lower East Platform
      coord: [9.4, 26.3]
      local:
        - to: East 27
        - to: SE Rock West
      exits:
        - to: The Long Rock East
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
        - to: East Rock 3
          req: $hook
          movement: base
          jumps: 1

    - name: East 26
      coord: [9.95, 25.35]
      local:
        - to: East Rock 2
        - to: Lower East Platform
      exits:
        - to: Hub > West 26
          tags: [xshift]
    - name: East 27
      coord: [9.95, 26.35]
      local:
        - to: Lower East Platform
          jumps: 3
        - to: SE Rock West
      exits:
        - to: East Rock 3
          req: $hook
          movement: base
          jumps: 1
        - to: Basement Pipes > West 27
          tags: [xshift]

    - name: East 28
      coord: [9.95, 27.6]
      local:
        - to: Ground Center
          jumps: 3
      exits:
        - to: Basement Pipes > West 28
          tags: [xshift]
    - name: SE Rock West
      coord: [9.0, 26.75]
      local:
        - to: Lower Center Platform
        - to: East 27
          jumps: 3
        - to: Lower East Platform
          thru: [9.45, 26.45]
          jumps: [2, 1]
        - to: Ground Center
    - name: Ground Center
      coord: [9.0, 27.4]
      local:
        - to: East 28
          jumps: 2
        - to: West 28 Ground
          jumps: 4
        - to: SW Platform
          thru: [7.45, 27.45]
          jumps: [1, 1]
      exits:
        - to: SE Rock West
          req: $hook
          movement: base
          jumps: 2
    - name: Lower Center Platform
      coord: [8.6, 26.9]
      local:
        - to: West 28 Ground
        - to: SW Platform
          thru: [7.45, 27.45]
          jumps: [0, 1]
        - to: SE Rock West
          jumps: 1
        - to: Ground Center
          jumps_down: 1
      exits:
        - to: Lower Rock East
          req: $hook or $grab
          movement: base
          jumps: 1
          penalties:
            - when: not $hook
              jumps: 1
    - name: Lower Rock East
      coord: [8.4, 26.55]
      local:
        - to: Lower Center Platform
        - to: SE Rock West
        - to: Lower Rock West
          jumps: 3
    - name: Lower Rock West
      coord: [7.6, 26.6]
      data:
        flipside: Irikar Breach > Rocky Dunes > Center Rock West
      local:
        - to: Lower Rock East
          jumps: 3
        - to: West Platform
          jumps: 1
        - to: West 28 Ground
        - to: SW Platform
    - name: West Platform
      coord: [7.35, 26.35]
      local:
        - to: West 28 Platform
        - to: Lower Rock West
        - to: West 28 Ground
          jumps_down: 1
      exits:
        - to: The Long Rock West
          req: $hook and $hover
          movement: base
          jumps: 3
    - name: SW Platform
      coord: [7.5, 27.2]
      local:
        - to: West 28 Ground
        - to: Ground Center
      exits:
        - to: Lower Rock West
          req: $hook
          movement: base
          jumps: 2
    - name: West 28 Platform
      coord: [7.05, 26.5]
      local:
        - to: West Platform
          jumps: 1
        - to: SW Platform
      exits:
        - to: Beach Save > East 28 Platform
          tags: [xshift]
    - name: West 28 Ground
      coord: [7.05, 27.3]
      local:
        - to: SW Platform
          jumps: 1
        - to: Ground Center
      exits:
        - to: Beach Save > East 28 Ground
          tags: [xshift]

- name: Lamassu  # MARK: Lamassu
  on_entry: $reset_old_area(^newpos)
  map:
    notes: [18, 25, 19, 26]
  datamap:
    map_spot:
      notes: Menu > Kiengir Map > Terminal Breakthrough 2
  spots:
    - name: West 28
      coord: [17.05, 27.7]
      local:
        - to: Bottom Middle
          jumps: 3
      exits:
        - to: Boss Room > East 28
          tags: [xshift]
    - name: Bottom Middle
      coord: [18.1, 27.55]
      local:
        - to: West 28
          jumps: 3
        - to: East 27
          jumps: 4
    - name: East 27
      coord: [18.95, 26.8]
      local:
        - to: Bottom Middle
      exits:
        - to: Uhrum > West Entrance > West 27
          tags: [xshift]
    - name: East 26
      coord: [18.95, 25.85]
      local:
        - to: Desk
      exits:
        - to: Uhrum > West Entrance > West 26
          tags: [xshift]
    - name: Desk
      coord: [18.7, 26.0]
      local:
        - to: Bottom Middle
        - to: East 26
          jumps: 1
      locations:
        - name: Item
          item: Terminal_Breakthrough_2
          tags: [standing]
    - name: Hidden Passage East
      coord: [18.95, 25.2]
      local:
        - to: Hidden Passage West
          jumps: 1
      exits:
        - to: Uhrum > West Entrance > Hidden Passage West
          tags: [xshift]
    - name: Hidden Passage West
      coord: [17.85, 25.1]
      local:
        - to: Hidden Passage East
        - to: Catwalk Middle
    - name: Northwest
      coord: [17.1, 25.1]
      local:
        - to: Catwalk Middle  # maybe technically has to jump off the lower catwalk?
        - to: Bottom Middle
    - name: Catwalk West
      coord: [17.05, 25.7]
      local:
        - to: Catwalk Middle
          jumps: 1
        - to: Bottom Middle
      exits:
        - to: Boss Room > Catwalk East
          tags: [xshift]
    - name: Catwalk Middle
      coord: [17.5, 25.5]
      local:
        - to: Catwalk West
        - to: East 27
      exits:
        - to: Hidden Passage West
          req: $hook
          movement: base
          jumps: 1
        - to: Desk
          req: $hover
          movement: base

- name: Beach Save  # MARK: Beach Save
  on_entry: $reset_old_area(^newpos)
  map:
    save: [5, 27, 6, 28]
    urn: [5, 25, 6, 26]
  datamap:
    map_spot:
      save: Menu > Kiengir Map > Irikar Beach Save
      urn: Menu > Kiengir Map > Irikar Fast Travel
  spots:
    - name: East 28 Platform
      coord: [6.95, 26.5]
      local:
        - to: Save Point
        - to: Center Platform
      exits:
        - to: Midwest > West 28 Platform
          tags: [xshift]
        - to: Top Platform
          req: Nanite_Mist
          movement: mist2
          penalties:
            - when: not Mist_Upgrade
              movement: mist1
    - name: East 28 Ground
      coord: [6.95, 27.3]
      local:
        - to: Save Point
      exits:
        - to: Midwest > West 28 Ground
          tags: [xshift]
    - name: Save Point
      coord: [5.5, 27.4]
      local:
        - to: West Slope
          jumps: 2
        - to: East 28 Ground
          jumps: 2
      actions:
        - name: Save
          do: $save
          tags: [save]
    - name: West Slope
      coord: [4.85, 27.1]
      local:
        - to: Partway Up
          jumps: 4
        - to: Save Point
        - to: West
          jumps: 3
    - name: Center Platform
      coord: [5.7, 26.8]
      local:
        - to: Save Point
        - to: West
          jumps: 6
        - to: Partway Up
          jumps: 2
        - to: East 28 Platform
          jumps: 5
        - to: East 28 Ground
    - name: Partway Up
      coord: [5.75, 26.4]
      local:
        - to: Top Platform
          jumps: 4
        - to: West
        - to: Save Point
        - to: East 28 Platform
    - name: Top Platform
      coord: [5.65, 25.6]
      local:
        - to: West
        - to: East 28 Platform
        - to: Save Point
          jumps_down: 1
      locations:
        - name: Urn
          item: Fast_Travel
          canon: Fast_Travel
          tags: [urn]
    - name: West
      coord: [4.05, 26.55]
      local:
        - to: West Slope
      exits:
        - to: Beach > East
          tags: [xshift]
    - name: West Mid-air
      coord: [4.1, 25.8]
      data:
        flipside: SpotId::None
      local:
        - to: West Slope
      exits:
        - to: Beach > Ivan
          movement: base
          penalty_tags: [xshift, -base.1]

- name: Beach  # MARK: Beach
  on_entry: $reset_old_area(^newpos)
  map:
    shore: [2, 27, 3, 28]
    cache: [3, 27, 4, 28]
  datamap:
    water:
      shore: true
      cache: true
    map_spot:
      cache: Menu > Kiengir Map > Irikar Beach Cache
  spots:
    - name: East
      coord: [3.95, 26.55]
      local:
        - to: Ivan
          jumps: 2
      exits:
        - to: Beach Save > West
          tags: [xshift]
    - name: Ivan
      coord: [3.4, 26.5]
      local:
        - to: East
        - to: Shore
    - name: Shore
      coord: [2.95, 26.975]
      local:
        - to: Wet Feet
        - to: Ivan
          jumps: 2
    - name: Wet Feet
      coord: [2.9, 27.0]
      local:
        - to: Shore
          jumps: 0.1
        - to: Above Tunnel
    - name: Above Tunnel
      coord: [2.55, 27.2]
      local:
        - to: Wet Feet
          jumps: 1
      exits:
        # Simulate entering the combo without storing it as context
        - to: Tunnel Entrance
          movement: base
          penalty_tags: [combo]
    - name: Tunnel Entrance
      coord: [2.55, 27.35]
      local:
        - to: Above Tunnel
          jumps: 1
      exits:
        - to: Cache
          req: ^mode == 'drone'
          movement: base
    - name: Cache
      coord: [3.8, 27.4]
      locations:
        - name: Item
          item: Power_Matrix
          tags: [standing]
      exits:
        - to: Tunnel Entrance
          req: ^mode == 'drone'
          movement: base
          jumps: 1
